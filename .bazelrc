build --workspace_status_command="python ./tools/workspace_status.py" --strategy=Closure=worker
build --repository_cache=~/.gerritcodereview/bazel-cache/repository
build --action_env=PATH
build --disk_cache=~/.gerritcodereview/bazel-cache/cas
build --java_toolchain //tools:error_prone_warnings_toolchain

# Enable strict_action_env flag to. For more information on this feature see
# https://groups.google.com/forum/#!topic/bazel-discuss/_VmRfMyyHBk.
# This will be the new default behavior at some point (and the flag was flipped
# shortly in 0.21.0 - https://github.com/bazelbuild/bazel/issues/7026). Remove
# this flag here once flipped in Bazel again.
build --incompatible_strict_action_env

# WARNING: This is not portable and only added to this CL to activate
# new Error Prone release 2.3.5-SNPASHOT on the CI and trigger
# additional EP checks
build --java_toolchain=@remote_java_tools_linux//:toolchain
build --host_java_toolchain=@remote_java_tools_linux//:toolchain

test --build_tests_only
test --test_output=errors

import %workspace%/tools/remote-bazelrc

# TODO(davido): Remove this when new java_tools version is released with new EP version
# Some checks were demoted to warning severity compared to the severity level defined in
# tools/BUILD file. The reason is that checks defined here are not skiped for generated code,
# so that the new checks are also reported on antlr, protobuf, and JGit code base.
build --javacopt="-XepDisableWarningsInGeneratedCode -Xep:AlmostJavadoc:WARN -Xep:AmbiguousMethodReference:ERROR -Xep:AnnotateFormatMethod:WARN -Xep:ArgumentSelectionDefectChecker:WARN -Xep:ArrayAsKeyOfSetOrMap:WARN -Xep:AssertEqualsArgumentOrderChecker:WARN -Xep:AssertThrowsMultipleStatements:WARN -Xep:AssertionFailureIgnored:ERROR -Xep:AssignmentToMock:ERROR -Xep:AutoValueFinalMethods:ERROR -Xep:AutoValueImmutableFields:ERROR -Xep:AutoValueSubclassLeaked:WARN -Xep:BadAnnotationImplementation:ERROR -Xep:BadComparable:ERROR -Xep:BadImport:WARN -Xep:BadInstanceof:WARN -Xep:BigDecimalEquals:WARN -Xep:BoxedPrimitiveConstructor:WARN -Xep:BoxedPrimitiveEquality:WARN -Xep:ByteBufferBackingArray:WARN -Xep:CacheLoaderNull:WARN -Xep:CatchFail:WARN -Xep:CanonicalDuration:WARN -Xep:CannotMockFinalClass:ERROR -Xep:CatchAndPrintStackTrace:WARN -Xep:ClassCanBeStatic:WARN -Xep:ComparableAndComparator:WARN -Xep:CompareToZero:ERROR -Xep:ComplexBooleanConstant:WARN -Xep:ClassNewInstance:ERROR -Xep:DateFormatConstant:ERROR -Xep:DeduplicateConstants:ERROR -Xep:DefaultCharset:ERROR -Xep:DiscardedPostfixExpression:ERROR -Xep:DoubleBraceInitialization:WARN -Xep:DoubleCheckedLocking:ERROR -Xep:DuplicateMapKeys:ERROR -Xep:ElementsCountedInLoop:ERROR -Xep:EmptyBlockTag:WARN -Xep:EmptySetMultibindingContributions:WARN -Xep:EscapedEntity:WARN -Xep:EqualsGetClass:WARN -Xep:EqualsHashCode:ERROR -Xep:EqualsIncompatibleType:ERROR -Xep:EqualsUnsafeCast:WARN -Xep:EqualsUsingHashCode:WARN -Xep:ExpectedExceptionChecker:ERROR -Xep:ExtendingJUnitAssert:WARN -Xep:FallThrough:WARN -Xep:Finally:WARN -Xep:FloatCast:ERROR -Xep:FloatingPointLiteralPrecision:ERROR -Xep:FormatStringAnnotation:WARN -Xep:FragmentInjection:ERROR -Xep:FragmentNotInstantiable:ERROR -Xep:FunctionalInterfaceClash:WARN -Xep:FutureReturnValueIgnored:ERROR -Xep:GetClassOnEnum:ERROR -Xep:HidingField:WARN -Xep:IgnoredPureGetter:WARN -Xep:ImmutableAnnotationChecker:OFF -Xep:ImmutableEnumChecker:WARN -Xep:InconsistentCapitalization:WARN -Xep:InconsistentHashCode:WARN -Xep:IncompatibleModifiers:ERROR -Xep:IncrementInForLoopAndHeader:WARN -Xep:InheritDoc:ERROR -Xep:InjectOnConstructorOfAbstractClass:ERROR -Xep:InjectedConstructorAnnotations:ERROR -Xep:InlineFormatString:WARN -Xep:InputStreamSlowMultibyteRead:ERROR -Xep:InstanceOfAndCastMatchWrongType:WARN -Xep:IntLongMath:WARN -Xep:InterfaceWithOnlyStatics:WARN -Xep:InvalidBlockTag:WARN -Xep:InvalidInlineTag:WARN -Xep:InvalidLink:WARN -Xep:InvalidParam:WARN -Xep:InvalidTargetingOnScopingAnnotation:WARN -Xep:InvalidThrows:WARN -Xep:IterableAndIterator:ERROR -Xep:JUnit3FloatingPointComparisonWithoutDelta:ERROR -Xep:JUnit4ClassUsedInJUnit3:ERROR -Xep:JUnitAmbiguousTestClass:ERROR -Xep:JavaDurationGetSecondsGetNano:WARN -Xep:JavaDurationWithNanos:WARN -Xep:JavaDurationWithSeconds:WARN -Xep:JavaInstantGetSecondsGetNano:WARN -Xep:LiteralClassName:ERROR -Xep:JavaLocalTimeGetNano:ERROR -Xep:JavaLocalTimeGetNano:ERROR -Xep:JavaPeriodGetDays:ERROR -Xep:JavaTimeDefaultTimeZone:ERROR -Xep:JavaxInjectOnFinalField:ERROR -Xep:LockNotBeforeTry:ERROR -Xep:LockOnBoxedPrimitive:ERROR -Xep:LogicalAssignment:ERROR -Xep:MathAbsoluteRandom:ERROR -Xep:MissingCasesInEnumSwitch:ERROR -Xep:MissingFail:ERROR -Xep:MissingOverride:WARN -Xep:MissingSummary:WARN -Xep:MixedDescriptors:ERROR -Xep:MixedMutabilityReturnType:WARN -Xep:MockitoInternalUsage:ERROR -Xep:ModifiedButNotUsed:WARN -Xep:ModifyCollectionInEnhancedForLoop:WARN -Xep:ModifySourceCollectionInStream:ERROR -Xep:MultipleParallelOrSequentialCalls:WARN -Xep:MultipleUnaryOperatorsInMethodCall:WARN -Xep:MutableConstantField:ERROR -Xep:NarrowingCompoundAssignment:WARN -Xep:NestedInstanceOfConditions:WARN -Xep:NonAtomicVolatileUpdate:ERROR -Xep:NonCanonicalType:WARN -Xep:NonOverridingEquals:ERROR -Xep:NullableConstructor:ERROR -Xep:NullOptional:WARN -Xep:NullableConstructor:WARN -Xep:NullablePrimitive:ERROR -Xep:NullableVoid:ERROR -Xep:ObjectToString:ERROR -Xep:ObjectsHashCodePrimitive:WARN -Xep:OperatorPrecedence:WARN -Xep:OptionalMapToOptional:ERROR -Xep:OptionalNotPresent:WARN -Xep:OrphanedFormatString:WARN -Xep:OutlineNone:ERROR -Xep:OverridesGuiceInjectableMethod:ERROR -Xep:OverrideThrowableToString:WARN -Xep:OverridesGuiceInjectableMethod:WARN -Xep:ParameterName:WARN -Xep:PreconditionsCheckNotNullRepeated:ERROR -Xep:PreconditionsInvalidPlaceholder:ERROR -Xep:PrimitiveAtomicReference:WARN -Xep:ProtectedMembersInFinalClass:WARN -Xep:ProtoDurationGetSecondsGetNano:WARN -Xep:ProtoFieldPreconditionsCheckNotNull:WARN -Xep:ProtoRedundantSet:WARN -Xep:ProtoTimestampGetSecondsGetNano:WARN -Xep:ProtocolBufferOrdinal:WARN -Xep:QualifierOrScopeOnInjectMethod:ERROR -Xep:ReachabilityFenceUsage:ERROR -Xep:RedundantOverride:WARN -Xep:ReferenceEquality:WARN -Xep:RequiredModifiers:ERROR -Xep:ReturnFromVoid:ERROR -Xep:SameNameButDifferent:WARN -Xep:ScopeAnnotationOnInterfaceOrAbstractClass:ERROR -Xep:ShortCircuitBoolean:ERROR -Xep:SimpleDateFormatConstant:ERROR -Xep:StaticAssignmentInConstructor:ERROR -Xep:StaticGuardedByInstance:ERROR -Xep:StringEquality:WARN -Xep:StreamResourceLeak:WARN -Xep:SynchronizeOnNonFinalField:ERROR -Xep:ToStringReturnsNull:ERROR -Xep:TreeToString:ERROR -Xep:TruthAssertExpected:WARN -Xep:TruthConstantAsserts:ERROR -Xep:TruthGetOrDefault:ERROR -Xep:TruthIncompatibleType:ERROR -Xep:TypeEquals:ERROR -Xep:TypeEqualsChecker:ERROR -Xep:TypeNameShadowing:WARN -Xep:TypeParameterShadowing:WARN -Xep:TypeParameterUnusedInFormals:WARN -Xep:URLEqualsHashCode:ERROR -Xep:UndefinedEquals:WARN -Xep:UnescapedEntity:WARN -Xep:UnnecessaryAnonymousClass:WARN -Xep:UnnecessaryLambda:WARN -Xep:UnnecessaryMethodInvocationMatcher:WARN -Xep:UnnecessaryParentheses:WARN -Xep:UnsynchronizedOverridesSynchronized:ERROR -Xep:UnusedException:WARN -Xep:UnusedNestedClass:WARN -Xep:UseCorrectAssertInTests:WARN -Xep:VariableNameSameAsType:WARN -Xep:WaitNotInLoop:ERROR -Xep:WildcardImport:WARN"
