{
  "comments": [
    {
      "key": {
        "uuid": "12a6b1d3_9f8e337c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 23,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-09-02T20:20:10Z",
      "side": 1,
      "message": "deriving might be better",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 8
      },
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32a1f5ba_c0629ed7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 23,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-02T20:51:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "12a6b1d3_9f8e337c",
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "926c6149_837c7e77",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 40,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-09-02T20:20:10Z",
      "side": 1,
      "message": "additional plugins",
      "range": {
        "startLine": 40,
        "startChar": 14,
        "endLine": 40,
        "endChar": 33
      },
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32a1f5ba_a0679ae5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 40,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-02T20:51:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "926c6149_837c7e77",
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "12a6b1d3_7f948f8a",
        "filename": "Documentation/dev-plugins.txt",
        "patchSetId": 9
      },
      "lineNbr": 146,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-09-02T20:20:10Z",
      "side": 1,
      "message": "case is",
      "range": {
        "startLine": 146,
        "startChar": 53,
        "endLine": 146,
        "endChar": 59
      },
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32a1f5ba_807db673",
        "filename": "Documentation/dev-plugins.txt",
        "patchSetId": 9
      },
      "lineNbr": 146,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-02T20:51:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "12a6b1d3_7f948f8a",
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "12a6b1d3_5f91cb98",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/plugins/PluginLoader.java",
        "patchSetId": 9
      },
      "lineNbr": 81,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-09-02T20:20:10Z",
      "side": 1,
      "message": "files is a map of plugin file to plugin name?\n\nand its inverse is plugin name to plugin file?\n\nI find the resulting code somewhat confusing to follow. In a number of places you translate the name from a file name to its plugin name or back.\n\nWhat about modifying rescan() to open each JAR and look at the manifest for the PluginName attribute. Build a Multimap\u003cString, File\u003e listing the non-disabled JARs that define a plugin. Loop through this map and for each name with more than one JAR pick one as the \"winner\" and disable the others by renaming them as disabled.\n\ninstallPluginFromStream() is the only other place where a duplicate name could be defined. If the plugin name declared in the JAR already exists the code path is a bit more complicated because we should be writing the stream out to the name given by the admin, but we should be replacing the plugin instance defined within the manifest. When this happens the existing JAR should be renamed to disabled so rescan() doesn\u0027t pick it.",
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92a70123_8b118d68",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/plugins/PluginLoader.java",
        "patchSetId": 9
      },
      "lineNbr": 81,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-05T21:46:08Z",
      "side": 1,
      "message": "Done (partially).\n\n\u003efiles is a map of plugin file to plugin name?\n\u003eand its inverse is plugin name to plugin file?\n\u003eI find the resulting code somewhat confusing to follow. In a number of places you \u003etranslate the name from a file name to its plugin name or back.\n\nYes x 3, it was messy.\n\nReimplemented it from scratch like you suggested, on top of your change [1]. installPluginFromStream() is still open. I think i don\u0027t understand what you mean by\n\"... we should be writing the stream out to the name given by the admin, but we should be replacing the plugin instance defined within the manifest.\"\n\n[1] Ibdd0e2c44b0cafb35c1b6524807f5ded0ec9f017",
      "parentUuid": "12a6b1d3_5f91cb98",
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "523749c3_2927adc5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/plugins/PluginLoader.java",
        "patchSetId": 9
      },
      "lineNbr": 81,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-06T16:27:53Z",
      "side": 1,
      "message": "\" ... we should be writing the stream out to the name given by the admin, but we should be replacing the plugin instance defined within the manifest.\"\n\nNow i understand what you mean: That\u0027s all about how SSH command and REST endpoint install-plugin work: they accept --name option and pass it together with stream to installPluginFromStream() command.\n\nCurrently the code that handles the case that the plugin with the same name is already active exists. In this case the existing plugin is renamed to .last_\u003cplugin-name\u003e und unloaded. I wonder if it would be enough to just retrieve the Gerrit-PluginName from the new plugin (saved from the stream) and don\u0027t touch the rest of the code. Going to push a new ps.",
      "parentUuid": "12a6b1d3_5f91cb98",
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "926c6149_a3797a86",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/plugins/PluginLoader.java",
        "patchSetId": 9
      },
      "lineNbr": 494,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-09-02T20:20:10Z",
      "side": 1,
      "message": "nit: we put the spaces at the start of the next string so:\n\n  \"Duplicate plugin name: %s.\"\n  + \"  The same plugin ...\"",
      "range": {
        "startLine": 493,
        "startChar": 14,
        "endLine": 494,
        "endChar": 21
      },
      "revId": "03029b168eb7db1058e182402fa83b0144a064cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}