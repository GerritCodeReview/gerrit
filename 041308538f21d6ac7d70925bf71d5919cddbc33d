{
  "comments": [
    {
      "key": {
        "uuid": "4bcaab6f_f668a0d2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-08T18:22:35Z",
      "side": 1,
      "message": "\"description\" here and below",
      "range": {
        "startLine": 7,
        "startChar": 14,
        "endLine": 7,
        "endChar": 19
      },
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4bcaab6f_56e154b9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 162,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-07T23:03:13Z",
      "side": 1,
      "message": "Nit: Stray blank line",
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abbb27d0_1908eb9a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 613,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-07T23:03:13Z",
      "side": 1,
      "message": "By doing this, you\u0027re effectively saying there is no difference between null and \"\" for descriptions. Specifically, desc is never null, but it might be \"\". IMO this is fine from a UX perspective.\n\nSuppose that desc could be null, and you have commits A\u003c-B where A has description \"foo\" and B has description null, i.e. the user explicitly cleared the existing description. When parsing B you would setDescription(null), and then when parsing A you would see that ps.getDescription() is null, so the description would end up as \"foo\". That\u0027s not what the user intended.\n\nTo fix this problem, you have to distinguish between \"empty because it was never set\" and \"explicitly set to empty.\" Fortunately, you\u0027re already doing this: null means never set, and \"\" means set to empty. So there\u0027s nothing you have to fix in ChangeNotesParser.\n\nHowever, I think this means you might end up with a PatchSet in ReviewDb that has a null description, but a description of \"\" in NoteDb. This means there is one far-flung part of the code where you do have to check this,  ChangeBundle#diffPatchSets.",
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abbb27d0_19f1cb7a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 613,
      "author": {
        "id": 1029297
      },
      "writtenOn": "2016-11-07T23:26:22Z",
      "side": 1,
      "message": "Is this because I can\u0027t insert an empty string into ReviewDB, or because I haven\u0027t implemented the ReviewDB side correctly? Because if it\u0027s the latter, I\u0027d rather fix the inconsistency than add more code to mitigate the differences, which seems to be the purpose of ChangeBundle.",
      "parentUuid": "abbb27d0_1908eb9a",
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abbb27d0_79f2c7ed",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 613,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-08T18:13:51Z",
      "side": 1,
      "message": "It\u0027s possible to enforce that ReviewDb contains only the empty string and never null for this field, but it\u0027s not what you\u0027re currently doing.\n\nIf you wanted to do this, you would have to:\n\n* Remove notNull \u003d false from the column spec\n* Update existing null columns to \"\" in the schema upgrade\n* Write an online schema upgrade tool for our googlesource.com implementation that updates existing null columns to \"\" (or do something hacky within the low level storage code).\n\nAt a high level, what you\u0027d be doing in ChangeBundle is saying, explicitly, treat null and the empty string as the same thing. It doesn\u0027t take that much code to do that.",
      "parentUuid": "abbb27d0_19f1cb7a",
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4bcaab6f_d66ba4cc",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 613,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-08T18:22:21Z",
      "side": 1,
      "message": "Discussed offline.\n\nThe intent here was that null means never set, and empty string means set but later cleared (or I guess set to empty string). This definition can be the same in NoteDb and ReviewDb.\n\nSo at this point what\u0027s missing is the documentation in PatchSet.java of this subtle distinction.",
      "parentUuid": "abbb27d0_79f2c7ed",
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abbb27d0_390dafab",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/server/notedb/ChangeNotesTest.java",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-07T23:03:13Z",
      "side": 1,
      "message": "Particularly given my comments in ChangeNotesParser, I think you want to test setting it back to null.\n\nAnother potential test: modifying the description for PS1 doesn\u0027t affect PS2.",
      "revId": "041308538f21d6ac7d70925bf71d5919cddbc33d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}