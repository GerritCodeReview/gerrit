{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1524663722 -0400\nnonce AFN+CTKd3+N2vdBBvApXy3U0GUWW/NNJ0ZYKI1ffl1ML0IoOt8UXzyJ7ZpfUqCZuQ+2q2auK5L3u\n\n0000000000000000000000000000000000000000 ee63b37b7009cb659a650e6fd35784e29739ff0d refs/for/master\n-----BEGIN PGP SIGNATURE-----\n\niQJJBAABCgAzFiEEpPm/sOxWgSqG5grhX9fFmpoSiIwFAlrghaoVHGRib3Jvd2l0\nekBnb29nbGUuY29tAAoJEF/XxZqaEoiMG9oQANE6wb3FkjOT4nlEgHQzSZk71/f+\nRezPGp0jFSf+xZUOa9VeSh0piwxMLw3KEKS/fktcPVQtYcp72RN4aK+KpDB48zm7\nLtcJdM2MrTuCL45HTGbCybGtYSvDmNNEV1msSU3YxBcls4X3kZ7xOe9m/KWVIgvS\ngJDtORTEMX4uvLG/9WwP0F5PyYiRsEeoJ6ejkoUfWohc7mQgpX7HE8Ms3FsMP10e\noVqSkvvUmuEVjkJvGshVHqkpr3/ppfn4UybpUOm/XAx15JstV9GlL1LUvoml2i+c\nqtfCdR+OcrIFcRZEslllJiVJ3+5bcUmRejBu9i+5wfKu5rlbbkpZnHg1FVw6g+OY\nW3nfRtFH1GYs0lDdEIW1wI4kYSiZ3xfg+tPGAnvL94ClqS2CH5Mey620WP3VrLVl\niO6vfRDvJAQ/0kvz5t2w6o4Bl1eU2AzYHrvULs/E0KfJwFrdJfG8h781zdElbEaE\nFTGi76f9L39QufXp6c2Ve1hNYyILbwfnbyLVMPk7/KZd+Oj/1OrWc3hFJw5SUEP7\n/R6E/TmZoq8GFyuGhEOXnqpi+aPgORqEIl4h5HEHp4G6OZD4RvWcicQif/MbafnU\nV0H28h++2+XX+ERLqeLS2+F3sVBu28jCnndm5XL2DCx3og6Z+Q1eXrEOE2Cvlfe8\np8kCOKo8zNmOEJkF\n\u003d8jFa\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "07d871eb_049117a0",
        "filename": "java/com/google/gerrit/server/cache/PersistentCacheProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2018-04-25T15:08:57Z",
      "side": 1,
      "message": "optional: We could also use the type int and a negative value to signify an unset version.",
      "range": {
        "startLine": 30,
        "startChar": 10,
        "endLine": 30,
        "endChar": 17
      },
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d17df375_79f525b9",
        "filename": "java/com/google/gerrit/server/cache/PersistentCacheProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-04-25T15:39:15Z",
      "side": 1,
      "message": "Done, for consistency with diskLimit. Would have caused NPE when returning from the int version() method anyway.",
      "parentUuid": "07d871eb_049117a0",
      "range": {
        "startLine": 30,
        "startChar": 10,
        "endLine": 30,
        "endChar": 17
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92eddb3b_ba794e88",
        "filename": "java/com/google/gerrit/server/cache/h2/H2CacheImpl.java",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2018-04-25T15:08:57Z",
      "side": 1,
      "message": "From what I understood, this code is responsible for flushing the caches when we increment the serialVersionUID. Is this correct?\n\nIf so, using the version column means that we don\u0027t automatically execute this code anymore. Instead, we now rely on the prune() method to be executed. Correct too?\n\nSo long as we are in the migration from the old serialization to this new approach, we need both. Afterwards, we can probably adjust this part.\n\nIf all of this is true, could we please leave a comment?",
      "range": {
        "startLine": 343,
        "startChar": 10,
        "endLine": 353,
        "endChar": 11
      },
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d67950bc_ff8b08e2",
        "filename": "java/com/google/gerrit/server/cache/h2/H2CacheImpl.java",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-04-25T15:39:15Z",
      "side": 1,
      "message": "\u003e From what I understood, this code is responsible for flushing the caches when we increment the serialVersionUID. Is this correct?\n\nRight.\n\n\u003e If so, using the version column means that we don\u0027t automatically execute this code anymore.\n\nThis is still executed in the case where the serialVersionUID is incremented but the version number is not. I think it\u0027s ok in the near term if someone wants to increment serialVersionUID in a cache type that still uses Java serialization, and it should preserve the old behavior. The author of that code should be forgiven for not knowing that there is this alternative way of specifying the version, because the CacheModule they\u0027re looking at won\u0027t (yet) have an explicit version(N) call.\n\n\u003e Instead, we now rely on the prune() method to be executed. Correct too?\n\nBasically. Note that prune() should run shortly after startup since H2CacheFactory has a start() method that takes calls it asynchronously. \n\nAFAICT this block is only necessary due to the bloom filter population. This deserializes keys on the main thread, which might encounter errors before the first prune gets scheduled. In that case it is better to trigger a prune in the main thread and silence many subsequent log errors.\n\nBut a feature of the new design is that data with an old version is ignored *silently*. So it should be fine to wait for the first async prune to complete.\n\nAnyway, left a comment.",
      "parentUuid": "92eddb3b_ba794e88",
      "range": {
        "startLine": 343,
        "startChar": 10,
        "endLine": 353,
        "endChar": 11
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ebf529c1_c3a6a8d1",
        "filename": "java/com/google/gerrit/server/cache/h2/H2CacheImpl.java",
        "patchSetId": 4
      },
      "lineNbr": 430,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2018-04-25T15:08:57Z",
      "side": 1,
      "message": "In theory, we would need the version here too. At the moment, it only works correctly due to the current implementation of prune().",
      "range": {
        "startLine": 430,
        "startChar": 42,
        "endLine": 430,
        "endChar": 80
      },
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3420a8df_6b6b6324",
        "filename": "java/com/google/gerrit/server/cache/h2/H2CacheImpl.java",
        "patchSetId": 4
      },
      "lineNbr": 430,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-04-25T15:39:15Z",
      "side": 1,
      "message": "Whoops, thought I had caught all of these. Done.",
      "parentUuid": "ebf529c1_c3a6a8d1",
      "range": {
        "startLine": 430,
        "startChar": 42,
        "endLine": 430,
        "endChar": 80
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "67192bc6_0cc1a129",
        "filename": "java/com/google/gerrit/server/cache/h2/H2CacheImpl.java",
        "patchSetId": 4
      },
      "lineNbr": 494,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2018-04-25T15:08:57Z",
      "side": 1,
      "message": "Same as above for touch().",
      "range": {
        "startLine": 494,
        "startChar": 48,
        "endLine": 494,
        "endChar": 74
      },
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "054dc033_e3fbccdb",
        "filename": "java/com/google/gerrit/server/cache/h2/H2CacheImpl.java",
        "patchSetId": 4
      },
      "lineNbr": 494,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-04-25T15:39:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "67192bc6_0cc1a129",
      "range": {
        "startLine": 494,
        "startChar": 48,
        "endLine": 494,
        "endChar": 74
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "04a47cb360bfc01309d021b03c415dcb913ac85e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}