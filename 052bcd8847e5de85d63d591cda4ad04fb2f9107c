{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1ffaeea8_ebda5e45",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2023-06-05T23:19:23Z",
      "side": 1,
      "message": "Should this cache be documented?",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 42
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4a3b46be_3a31eae0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-05T22:14:58Z",
      "side": 1,
      "message": "Could you also specify how this differs from the `changes` cache at [1] ?\n\n[1] https://gerrit-documentation.storage.googleapis.com/Documentation/3.8.0/config-gerrit.html#cache_names",
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6d65169_598732d2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-06-05T22:29:58Z",
      "side": 1,
      "message": "The SearchingChangeCacheImpl (which is the \"changes\" cache) only knows how to populate itself from the index, so it does not work for replicas. Also, the the SearchingChangeCacheImpl stores the following: a Change and a ReviewerSet, which takes a lot more memory than the cache from this change. The only field, aside from the number, in the change which is needed for a \"public\" change (the bulk of all changes) is the branch, and that is often duplicated across many changes in a project.\n\nWe are able to easily cache close to 4.5M changes (all the projects and changes on our server) with my change. I currently have some unconfirmed evidence (working on confirming it) that this change may be able to handle more load with running into back2back java gcs on a primary than the 3.5 tip.",
      "parentUuid": "4a3b46be_3a31eae0",
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "413660f0_2282fb13",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-06-05T22:44:00Z",
      "side": 1,
      "message": "Additionally, according to the docs, the \"changes\" cache is not appropriate for a cluster setup since it does not get updated by alterations from other server. The cache in this change records the sha1 of the metaref for each change and updates itself incrementally for each change which is out of date since it was last cached.",
      "parentUuid": "b6d65169_598732d2",
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c03a332_72d6557b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-05T22:55:42Z",
      "side": 1,
      "message": "Cool, can you add the above information to commit message?\nI have personally experienced performance issues when using the \"changes\" cache, so would this new cache be a more suitable choice? (also based on the fact that it has a wider adoption)",
      "parentUuid": "413660f0_2282fb13",
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc32db09_9a99dd0f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-05T22:14:58Z",
      "side": 1,
      "message": "Can you put more details on what `large` looks like in your tests?",
      "range": {
        "startLine": 12,
        "startChar": 43,
        "endLine": 12,
        "endChar": 48
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4f9ff1ab_33179cca",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-06-05T22:29:58Z",
      "side": 1,
      "message": "See below (380K) changes.",
      "parentUuid": "bc32db09_9a99dd0f",
      "range": {
        "startLine": 12,
        "startChar": 43,
        "endLine": 12,
        "endChar": 48
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "098c4047_b4dd3e07",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-05T22:55:42Z",
      "side": 1,
      "message": "Ack, I am surprised that is already so effective with not so many changes. 380k is more a medium number of changes, I have seen setups with over 1M changes.",
      "parentUuid": "4f9ff1ab_33179cca",
      "range": {
        "startLine": 12,
        "startChar": 43,
        "endLine": 12,
        "endChar": 48
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89e48688_dead5172",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-05T22:14:58Z",
      "side": 1,
      "message": "Typo? Before and after are exactly the same?",
      "range": {
        "startLine": 17,
        "startChar": 0,
        "endLine": 19,
        "endChar": 39
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6ef72567_462bafe9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-06-05T22:29:58Z",
      "side": 1,
      "message": "Nope, as long as the other caches are all big enough and the ES server is size right, this seems to be the same. That being said, I have seen plenty of instances where before this change, the 12-17s was not achievable, such as when other work is done on the server in between attempts... In other words, this number seems much more consistent with the new cache, but the \"best\" time hasn\u0027t improved.",
      "parentUuid": "89e48688_dead5172",
      "range": {
        "startLine": 17,
        "startChar": 0,
        "endLine": 19,
        "endChar": 39
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5371570e_351a05d2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 19,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-05T22:55:42Z",
      "side": 1,
      "message": "Can you also add that information to the numbers? (otherwise it looks like it does not benefit the Gerrit primary instance at all)",
      "parentUuid": "6ef72567_462bafe9",
      "range": {
        "startLine": 17,
        "startChar": 0,
        "endLine": 19,
        "endChar": 39
      },
      "revId": "052bcd8847e5de85d63d591cda4ad04fb2f9107c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}