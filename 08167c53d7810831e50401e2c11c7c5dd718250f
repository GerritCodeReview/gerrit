{
  "comments": [
    {
      "key": {
        "uuid": "0402fd8c_c6d8628b",
        "filename": "gerrit-elasticsearch/src/main/java/com/google/gerrit/elasticsearch/ElasticsearchChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 303,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-06-26T09:43:52Z",
      "side": 1,
      "message": "I\u0027ve stepped through this in the debugger.\n\nWhen it get to this method in lucene.search.TermQuery is where it seems to go wrong.\n\n  /** Prints a user-readable version of this query. */\n  @Override\n  public String toString(String field) {\n    StringBuilder buffer \u003d new StringBuilder();\n    if (!term.field().equals(field)) {\n      buffer.append(term.field());\n      buffer.append(\":\");\n    }\n    buffer.append(term.text());\n    buffer.append(ToStringUtils.boost(getBoost()));\n    return buffer.toString();\n  }\n\nAt the line\n\n  buffer.append(term.text());\n\nit\u0027s adding junk instead of a string representation of the user ID.",
      "range": {
        "startLine": 301,
        "startChar": 0,
        "endLine": 303,
        "endChar": 73
      },
      "revId": "08167c53d7810831e50401e2c11c7c5dd718250f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "440875ab_e8fc53db",
        "filename": "gerrit-elasticsearch/src/main/java/com/google/gerrit/elasticsearch/ElasticsearchChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 303,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-06-26T10:00:45Z",
      "side": 1,
      "message": "With a query \"owner:self\", the query string is coming out as:\n\n \"owner:`\\b\\u0000\u003d\\u0004@\"\n\nwhereas for a query \"status:open\" it comes out correctly as:\n\n \"status:new status:submitted status:draft\"",
      "parentUuid": "0402fd8c_c6d8628b",
      "range": {
        "startLine": 301,
        "startChar": 0,
        "endLine": 303,
        "endChar": 73
      },
      "revId": "08167c53d7810831e50401e2c11c7c5dd718250f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0402fd8c_46e59242",
        "filename": "gerrit-elasticsearch/src/main/java/com/google/gerrit/elasticsearch/ElasticsearchChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 303,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-06-26T10:56:00Z",
      "side": 1,
      "message": "Digging a bit deeper, it seems to be because the query builder is generating a TermQuery with encoded bytes:\n\n  private static Term intTerm(String name, int value) {\n    BytesRef bytes \u003d new BytesRef(NumericUtils.BUF_SIZE_INT);\n    NumericUtils.intToPrefixCodedBytes(value, 0, bytes);\n    return new Term(name, bytes);\n  }\n\nand the toString method is returning the encoded bytes, which elasticsearch doesn\u0027t understand.",
      "parentUuid": "440875ab_e8fc53db",
      "range": {
        "startLine": 301,
        "startChar": 0,
        "endLine": 303,
        "endChar": 73
      },
      "revId": "08167c53d7810831e50401e2c11c7c5dd718250f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}