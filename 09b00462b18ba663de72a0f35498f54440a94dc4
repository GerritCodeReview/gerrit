{
  "comments": [
    {
      "key": {
        "uuid": "SKRlq67c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/GarbageCollect.java",
        "patchSetId": 3
      },
      "lineNbr": 71,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-03-21T05:13:33Z",
      "side": 1,
      "message": "We don\u0027t support this over SSH. So why on REST API? Shouldn\u0027t this be easy for the caller to do by discovering the list of projects themselves and then sending us the post requests:\n\n  for p in $(curl http://localhost:8080/projects/?format\u003dTEXT);\n  do curl --data \u0027\u0027 http://localhost:8080/projects/$(echo \"$p\" | sed \"s,/,%2F,g)\"/gc;\n  done\n\nOK that is ugly because of the URL encoding, but I think you get my point. The selection algorithm of what to GC should be better handled client side.",
      "revId": "09b00462b18ba663de72a0f35498f54440a94dc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "SB7sKpy0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/GarbageCollect.java",
        "patchSetId": 3
      },
      "lineNbr": 71,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2013-03-21T05:28:32Z",
      "side": 1,
      "message": "Well, the SSH command has an easy way to trigger the GC for all projects.\nI wanted to enable the same for REST since I believe this is the main use case. I thought the best way to allow this would be triggering GC on the All-Projects project and saying it should be done recursively for all child projects. \n\nActually we want to get way from doing anything on the client but in the end we only want to configure in Gerrit when to run the GC and Gerrit then does it automatically.",
      "parentUuid": "SKRlq67c",
      "revId": "09b00462b18ba663de72a0f35498f54440a94dc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "SLTX8kPc",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/GarbageCollect.java",
        "patchSetId": 3
      },
      "lineNbr": 71,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-03-21T05:38:56Z",
      "side": 1,
      "message": "OK I see what you mean. There isn\u0027t an easy way to attach an operation to the ProjectsCollection that doesn\u0027t need a specific project selected. So then you are looking at some special node to mean \"everything\" and All-Projects with a recursive marker suddenly seems reasonable.\n\nI agree about trying to let Gerrit manage GC automatically. Its what we do in our systems behind gerrit-review, only its down at the JGit DFS implementation tier and isn\u0027t something Gerrit knows about or needs to concern itself about.\n\nUnfortunately not everyone has the CPU resources or RAM resources available to run GC on their bigger repositories during peak time. So there would need to be some sort of scheduling function built into Gerrit here to say \"do not GC during these times\" or \"only GC during these times\".\n\nI\u0027m inclined to say if you want to GC everything by REST API use the little bit of shell or a tiny Python program to do it. We can put the Python into contrib and just leave it at that. Focus our efforts instead on trying to make this more automatic in the server.",
      "parentUuid": "SB7sKpy0",
      "revId": "09b00462b18ba663de72a0f35498f54440a94dc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "SQ-88384",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/GarbageCollect.java",
        "patchSetId": 3
      },
      "lineNbr": 71,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2013-03-21T13:28:46Z",
      "side": 1,
      "message": "OK, I will then abandon this change. You are right that this can be scripted on the client and once we have a possibility to configure the GC runs on the server it\u0027s not important anymore to be able to trigger the gc for all projects via REST.\n\nFor the automatic GC runs I definitely agree that it must be possible to define a schedule so that performance losses during main working hours can be avoided. Maybe we can find some library to handle this scheduling instead of implementing this on our own.",
      "parentUuid": "SLTX8kPc",
      "revId": "09b00462b18ba663de72a0f35498f54440a94dc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}