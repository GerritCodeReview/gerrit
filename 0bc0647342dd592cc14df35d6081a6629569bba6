{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ee78c0cf_d4261bcb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-16T23:14:26Z",
      "side": 1,
      "message": "That looks a cool idea. Why not pushing this to the docker-gerrit project?",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ee43e0d0_0e8966ae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2023-05-21T05:38:29Z",
      "side": 1,
      "message": "Thanks @Luca for taking a look. \n\n\u003e Why not pushing this to the docker-gerrit project?\n\nAs this change is adding functional tests for multi-primary gerrit setup, we thought gerrit project is the right place for these tests to live.",
      "parentUuid": "ee78c0cf_d4261bcb",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6b94fee_0fcf8052",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-21T08:02:31Z",
      "side": 1,
      "message": "\u003e Thanks @Luca for taking a look. \n\u003e \n\u003e \u003e Why not pushing this to the docker-gerrit project?\n\u003e \n\u003e As this change is adding functional tests for multi-primary gerrit setup, we thought gerrit project is the right place for these tests to live.\n\nI see, however this is also a good test for the elasticsearch component and would also be a nice example on how to use it. Would then the `modules/index-elasticsearch` another candidate?\n\nI believe this contribution is really useful and it would be nice to have the CI running it for incoming changes. However, I am concerned about its maintenance and dependencies.\n\nAlso, I am concerned about its discoverability:\n- If someone is using Docker with Gerrit, then he would definitely be interested in it\n- If someone is using Elasticsearch, then it could be for a multi-primary and then again it would be useful",
      "parentUuid": "ee43e0d0_0e8966ae",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0babc55d_c86ab3ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2023-06-01T05:20:33Z",
      "side": 1,
      "message": "\u003e Would then the modules/index-elasticsearch another candidate?\n\u003e However, I am concerned about its maintenance and dependencies\n\u003e Also, I am concerned about its discoverability\n\nYes Luca, I do understand that this setup depends on elastic search module which is not part of core. I did tried to create a Lucene based multi primary setup and it did not work as expected.\n\nI believe it might be a good idea to move this code to docker-gerrit as it improves the discoverability (as we would document it) and probably solves the dependencies aspect as well.\n\n@martin.fick@linaro.org / @nasser.grainawi@linaro.org WDYT?",
      "parentUuid": "d6b94fee_0fcf8052",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ebe51baf_60a84c22",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-06-02T17:43:39Z",
      "side": 1,
      "message": "\u003e \u003e Would then the modules/index-elasticsearch another candidate?\n\u003e \u003e However, I am concerned about its maintenance and dependencies\n\u003e \u003e Also, I am concerned about its discoverability\n\u003e \n\u003e Yes Luca, I do understand that this setup depends on elastic search module which is not part of core. I did tried to create a Lucene based multi primary setup and it did not work as expected.\n\nWe actually have a hacky change which enables Lucene for MP usage, it simply closes the index (and thus release the lock on it) after every update. While this obviously results in a performance degradation for writes, the bulk of a Gerrit worload is reads, so this might actually work for some people. But more importantly, it would be an option to get core to support MP, and I think that would be very valuable as it would encourage people to test MP setups more, and it could mean eventually running MP tests via CI on all changes.\n \n\u003e I believe it might be a good idea to move this code to docker-gerrit as it improves the discoverability (as we would document it) and probably solves the dependencies aspect as well.\n\nWhile these tests provide a docker framework to setup Gerrit MP to run them in, the tests themselves are intended to be independent of that docker Gerrit so that they can be run against any Gerrit MP setup, so I don\u0027t think it is a good idea to tie them to docker. As for dependency maintenance, I would view that on par with how we have to maintain docker tests in plugins. While I wouldn\u0027t necessarily advise it, would you be more comfortable if we separate the docker piece out to somewhere else (or maybe in a separate change perhaps)?\n\nI think the tests belong in gerrit core. I don\u0027t think we should consider MP to be tied to anyone particular external module/plugin, and in my opinion placing them in such a location would make them less discoverable (except for maybe in the outdated MultiMaster plugin). Perhaps there is a better directory location in core that would facilitate discoverability?",
      "parentUuid": "0babc55d_c86ab3ed",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0f97ae61_6282c233",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1155320
      },
      "writtenOn": "2023-06-03T09:08:22Z",
      "side": 1,
      "message": "git clone https://gerrit.googlesource.com/hntu-test",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ae34f5c_af0fdf1e",
        "filename": "contrib/multi-primary-docker-tests/docker-compose.yaml",
        "patchSetId": 4
      },
      "lineNbr": 3,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-16T23:16:21Z",
      "side": 1,
      "message": "I would expect to have also a load-balancer definition: how is the traffic supposed to be balanced?",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53a71cf7_1c730095",
        "filename": "contrib/multi-primary-docker-tests/docker-compose.yaml",
        "patchSetId": 4
      },
      "lineNbr": 3,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2023-05-21T05:38:29Z",
      "side": 1,
      "message": "Yes @Luca, that does make sense to add a load balancer to the setup. But for the initial test we are adding in this change won\u0027t be needing the load balancer. I think it would be better to add the load balancer in a follow-on change along with a test which hits the load balancer. WDYT?",
      "parentUuid": "5ae34f5c_af0fdf1e",
      "revId": "0bc0647342dd592cc14df35d6081a6629569bba6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}