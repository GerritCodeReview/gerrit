{
  "comments": [
    {
      "key": {
        "uuid": "dce1ba08_d8039ad4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1086906
      },
      "writtenOn": "2019-11-15T22:55:13Z",
      "side": 1,
      "message": "this will work for p1, but won\u0027t work for polymer 2 :( as `querySelectorAll` can not pierce through the shadow DOM.\n\nI am thinking of providing a communication channel between plugin and Gerrit main:\n\n```\n// emitter from plugin\nplugin.emit(EVENT_NAME, ...args);\n\n// and then listener from Gerrit\nGerrit.on(PLUGIN_PREFIX + EVENT_NAME, (...args) \u003d\u003e {\n});\n```\n\nBut that will be a new API introduced to plugin, I will need to discuss with Ben on how we move forward with that.",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cd3f15c2_31de1579",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1086906
      },
      "writtenOn": "2019-11-15T23:08:04Z",
      "side": 1,
      "message": "I may find a workaround :) \n\nOnce you moved the `Gerrit.awaitPluginsLoaded` to `ready`, then you can solve the communication issue by moving your `ajax` plugin request before `Gerrit.install` as that\u0027s what triggers pluginLoaded. \n\nso something like:\n\n\n```\n// Gerrit gr-formatted-text\nready() {\n  Gerrit.awaitPluginsLoaded().then(() \u003d\u003e this.contentChanged());\n}\n\n// plugin\n\nfetch(\"plugin_config\").then(config \u003d\u003e {\n  Gerrit.install(plugin \u003d\u003e {\n     // now just add your formatted rules\n  });\n});\n```\n\nnot ideal, but it should work. I will propose the communication channel between plugin and gerrit to the community as well for a better solution.",
      "parentUuid": "dce1ba08_d8039ad4",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "99cf102e_e5a93d58",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2019-11-18T09:24:29Z",
      "side": 1,
      "message": "I tried to get your workaround to work, but it doesn\u0027t seem to work as hoped. There seem to be two issues (with the example of the imagare plugin):\n\n- I get this warning, when Gerrit tries to install this part of the plugin:\n\n  gr-app.js:formatted:27915 Plugin not being loaded from /plugins \n  base path. Unable to determine name.\n\nThis looks to me that Gerrit has issues to deal with Gerrit.install(), if called inside .then(), because it can\u0027t get the URL of the script. Nevertheless, the plugin is somehow loaded, because if opening comments in the diff or posting new comments with images, the image is rendered.\n\n- Existing images in messages are not rendered. I think the .awaitPluginsLoaded() does not work as expected, if the plugin installation is registered quite late, as it is here, since it is only happening after resolving the async-request.\n\nWould there be a way for plugins not to use `.querySelectorAll` from 3.1 onwards and nevertheless achieve the same result? Then, the current solution would work until you finished the new event API.",
      "parentUuid": "cd3f15c2_31de1579",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "68d3243b_9eb8eae1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2019-11-18T09:42:32Z",
      "side": 1,
      "message": "To explain my second point: If I set a break point for the plugin\u0027s `Gerrit.install()`and second one in the callback inside `then()` of `Gerrit.awaitPluginsLoaded().then()`, the first break happens at the second breakpoint, meaning Gerrit doesn\u0027t wait for this specific `Gerrit.install()` to happen.",
      "parentUuid": "99cf102e_e5a93d58",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c788053b_52776e50",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1086906
      },
      "writtenOn": "2019-11-19T23:59:31Z",
      "side": 1,
      "message": "hmm thats actually strange, the `Gerrit.awaitPluginsLoaded` should at least wait until all plugins loaded, which will be only marked as loaded if `Gerrit.install` called or failed due to timeout / js error etc. Let me see if I can make the change to 2.16 to add the event api to Gerrit. Thanks for trying my proposal :)",
      "parentUuid": "68d3243b_9eb8eae1",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dbfcd867_53f687e0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1086906
      },
      "writtenOn": "2019-11-20T00:36:30Z",
      "side": 1,
      "message": "also, may I know how you load your plugins in this case ? are you loading them manually or from some API which should return list of plugins enabled ?",
      "parentUuid": "c788053b_52776e50",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6145a2cb_87a348ab",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2019-11-20T08:16:20Z",
      "side": 1,
      "message": "I usually build my plugins in-tree and package them directly into the gerrit.war and install them using `gerrit.war init`, meaning I do it offline and start the Gerrit server afterwards. However, looking at the browser logs, the UI plugins are loaded, when the page loads, e.g.:\n\n  Plugin codemirror_editor installed.",
      "parentUuid": "dbfcd867_53f687e0",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eaaf41a8_3f5445f1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1086906
      },
      "writtenOn": "2019-11-20T23:54:23Z",
      "side": 1,
      "message": "ya you r right, I just checked, with promises it will be executed in an async anonymous functions scope and loose the info on current script link :(\n\nI have sent out the event interface change to stable-2.16: https://gerrit-review.googlesource.com/c/gerrit/+/246393",
      "parentUuid": "6145a2cb_87a348ab",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82fe7231_db448595",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2019-11-21T09:30:52Z",
      "side": 1,
      "message": "Works like a charm! Thanks!",
      "parentUuid": "eaaf41a8_3f5445f1",
      "revId": "0da07f223468e2672c50861671ed451642c2d9ad",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}