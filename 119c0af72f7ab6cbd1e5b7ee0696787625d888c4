{
  "comments": [
    {
      "key": {
        "uuid": "905e2f2a_8aeaeb0b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 10,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-09-03T16:37:59Z",
      "side": 1,
      "message": "I don\u0027t follow this statement. Are you saying that callers of AbstractChangeNotes.load() should expect loading to _fail_ when notedb is disabled? That doesn\u0027t make sense, why would callers expect it to fail?",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 10,
        "endChar": 13
      },
      "revId": "119c0af72f7ab6cbd1e5b7ee0696787625d888c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "905e2f2a_6af9f7e4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 10,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-09-03T16:41:30Z",
      "side": 1,
      "message": "Ok, I think I see the problem, but this paragraph still makes no sense to me.\n\nThe problem is in the implementation of load(). It should under no circumstances call repoManager.openMetadataRepository() if notedb is disabled. That is an illegal state, so throwing IllegalStateException in that case (i.e. the current behavior) is correct.\n\nAm I describing the right bug here?",
      "parentUuid": "905e2f2a_8aeaeb0b",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 10,
        "endChar": 13
      },
      "revId": "119c0af72f7ab6cbd1e5b7ee0696787625d888c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b02fb38b_4bd52555",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 10,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2014-09-04T07:31:40Z",
      "side": 1,
      "message": "This was exactly my guess ... you\u0027ve put that assertion because you wanted to prevent the method to be called when nodedb is disabled.\n\nThe problem is ... IT IS CALLED and from multiple places ;-(\n\n- ChangeNotesParser (OK)\n- DraftCommentNotesParser (OK)\n- AbstractChangeNotes.load (OK)\n- AbstractChangeUpdate.load (Boom !)\n\nThe AbstractChangeUpdate.load is invoked when adding comments to a change, in the following call-stack:\n        at com.google.gerrit.server.notedb.AbstractChangeNotes.load(AbstractChangeNotes.java:47)\n        at com.google.gerrit.server.notedb.ChangeDraftUpdate.\u003cinit\u003e(ChangeDraftUpdate.java:96)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        [Guice injections stack]\n        at com.google.gerrit.server.notedb.ChangeUpdate.createDraftUpdateIfNull(ChangeUpdate.java:320)\n        at com.google.gerrit.server.notedb.ChangeUpdate.insertDraftComment(ChangeUpdate.java:255)\n        at com.google.gerrit.server.notedb.ChangeUpdate.insertComment(ChangeUpdate.java:205)\n        at com.google.gerrit.server.PatchLineCommentsUtil.insertComments(PatchLineCommentsUtil.java:260)\n\nAs a result of that, if notedb is disabled \u003d\u003e you cannot add comments to changes anymore ;-(\n\nQuite a serious issue that makes Gerrit master unsuitable for production (or even testing !)",
      "parentUuid": "905e2f2a_6af9f7e4",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 10,
        "endChar": 13
      },
      "revId": "119c0af72f7ab6cbd1e5b7ee0696787625d888c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "33310dd2_27099a50",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/LocalDiskRepositoryManager.java",
        "patchSetId": 4
      },
      "lineNbr": 148,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2014-09-01T08:07:45Z",
      "side": 1,
      "message": "This change actually fixes the problem ... BUT I guess this is not what DaveB intended to do.\n\nWhen notesMigration is not enabled, I guess that noteDbPath needs to be null as there is no metaData repository for notesDB correct?\nWhen notesMigration is disabled the openMetdataRepository call *has* to fail because there shouldn\u0027t be any nodesDb activity.\n\nUnfortunately this is not the case as we had the assertion failing. I fear that by returning a valid Git repository (the main one) as valid metdata repository for noteDb ... and possibly more problems on the way :-(\n\nWorth waiting for Shawn and DaveB feedback on this point.",
      "range": {
        "startLine": 148,
        "startChar": 6,
        "endLine": 148,
        "endChar": 27
      },
      "revId": "119c0af72f7ab6cbd1e5b7ee0696787625d888c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}