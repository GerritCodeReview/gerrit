{
  "comments": [
    {
      "key": {
        "uuid": "bf0db020_e6db5465",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/Index.java",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-02-21T07:36:00Z",
      "side": 1,
      "message": "This is unexpected. You\u0027ve integrated the new permissionBackend in ChangeResource, so why not to do the same here and avoid acount handlers the consumer bother to inject permissionBackend directly? I would expect to be able to say just that (like it\u0027s the case in change handlers):\n\n  rsrc.permissions().check(GlobalPermission.MODIFY_ACCOUNT);\n\nAccountResource has the user so that short circuit check could be done in AccountResource as well. Or, is this because we don\u0027t want to eagerly instantiate the PermissionBackend instance if the user equals self? In this case this could just be:\n\n  if (self.get() !\u003d rsrc.getUser()) {\n    rsrc.permissions().check(GlobalPermission.MODIFY_ACCOUNT);\n  }",
      "range": {
        "startLine": 49,
        "startChar": 4,
        "endLine": 51,
        "endChar": 5
      },
      "revId": "12eb62de489260b1c50c35a55b358387bac7be52",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1cff3145_e9d961a2",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/Index.java",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2017-02-21T18:53:59Z",
      "side": 1,
      "message": "Yes, I could have included the PermissionBackend into AccountResource but decided against it given the number of callers that directly create AccountResource. Maybe that was the wrong decision and I should revisit adding it to AccountResource to reduce the number of handlers that need PermissionBackend injected into it.",
      "parentUuid": "bf0db020_e6db5465",
      "range": {
        "startLine": 49,
        "startChar": 4,
        "endLine": 51,
        "endChar": 5
      },
      "revId": "12eb62de489260b1c50c35a55b358387bac7be52",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "390468d7_2d7f5b2d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/Index.java",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2017-02-22T02:50:12Z",
      "side": 1,
      "message": "Adding PermissionBackend to AccountResource is tractable, its a small number of callers, but it feels wrong to me. PermissionBackend doesn\u0027t scope to a user the way it scopes to a project or a change. Its scoping to a user (PermissionBackend.WithUser) is providing context of who is using the object, not what the object is about.\n\nSince these are global permission checks, I think I\u0027d prefer to ask handlers to inject PermissionBackend and verify the global permission themselves.",
      "parentUuid": "1cff3145_e9d961a2",
      "range": {
        "startLine": 49,
        "startChar": 4,
        "endLine": 51,
        "endChar": 5
      },
      "revId": "12eb62de489260b1c50c35a55b358387bac7be52",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}