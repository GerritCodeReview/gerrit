{
  "comments": [
    {
      "key": {
        "uuid": "2e97e955_ccfdcfc6",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 242,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-08T11:38:18Z",
      "side": 1,
      "message": "Prepend WIP: to the subject of the commit message. We still can\u0027t mark changes as Work-In-Progress per UiAction/workflow ;-(",
      "range": {
        "startLine": 241,
        "startChar": 8,
        "endLine": 242,
        "endChar": 29
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2e70c917_a400a22b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 242,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-01-09T00:04:42Z",
      "side": 1,
      "message": "Will do for now. Would an appropriate topic (WIP_atomic_topic) also suffice? That way I don\u0027t need to edit the commits to unmark them for being evolved out of the WIP stage and just need one command line push to readjust the topic for all changes in the branch?",
      "parentUuid": "2e97e955_ccfdcfc6",
      "range": {
        "startLine": 241,
        "startChar": 8,
        "endLine": 242,
        "endChar": 29
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae0839ac_288b8b49",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 242,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T12:17:46Z",
      "side": 1,
      "message": "Interesting idea. i\u0027m fine with this.",
      "parentUuid": "2e70c917_a400a22b",
      "range": {
        "startLine": 241,
        "startChar": 8,
        "endLine": 242,
        "endChar": 29
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e8a5d30_cd18699b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 250,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-08T11:38:18Z",
      "side": 1,
      "message": "Move this if outside of the if (it is needed as well on line 285 below):\n\n  visibility \u003d ...\n  if (!visible) {\n    // We haven\u0027t find a way to suppress passing non visible actions to the client.\n    return ne UiAction.Description()\n        .setLabel(\"dummy\")\n        .setTitle(\"not there\")\n        .setVisible(visibility);\n  } else {\n    if (submitTopic) {\n      // your new case\n    } else {\n      // old code below, with visible true\n    }\n  }",
      "range": {
        "startLine": 247,
        "startChar": 6,
        "endLine": 250,
        "endChar": 49
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0e6dc543_e3fa92cb",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 250,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-01-09T00:04:42Z",
      "side": 1,
      "message": "Why would you include the !visible case with a dummy payload?\n\nWouldn\u0027t \n   \n    visibility \u003d ...;\n    if (submitTopic) {\n        ...\n        ...\n        .setVisible(visibility);\n    } else {\n        ...\n        ...\n        .setVisible(visibility);\n    }\n\nbe sufficient? And by that I mean actually better than the version you\u0027re proposing. As this would have less lines of code(maintainability). Though your code may be better if we\u0027d send less data to the client (\"dummy\" label and specially the tooltip being way smaller).",
      "parentUuid": "4e8a5d30_cd18699b",
      "range": {
        "startLine": 247,
        "startChar": 6,
        "endLine": 250,
        "endChar": 49
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae0839ac_0888c748",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 250,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T12:17:46Z",
      "side": 1,
      "message": "I see your point, there is place for improving my original suggestion. The problem with your current code and new suggestion is: you don\u0027t respect visibility during the whole loop. But the outcome of the loop is entirely useless when current change is say a draft or when the user doesn\u0027t have ACL to submit a change for a project.\n\nExample: if this code is merged as is or with your new suggestion, and you (you don\u0027t have +2 ACL on gerrit-review, right?) would open a change that belongs to a topic, that is shared by 1 million of changes, then you would iterate through all 1 mil. of changes, just to say visible \u003d false, right?",
      "parentUuid": "0e6dc543_e3fa92cb",
      "range": {
        "startLine": 247,
        "startChar": 6,
        "endLine": 250,
        "endChar": 49
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee06512_4bda457c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 262,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-01-09T15:49:03Z",
      "side": 1,
      "message": "I\u0027m not sure what the right behavior here is. This can typically only happen if there is some unrecoverable corruption in one of the other changes in the topic. What is the plan for informing the user about the reasons they can\u0027t submit the whole topic? This would fall under that, I think.\n\nLog the exception at the very least.",
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee06512_2be7f93f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 265,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-01-09T15:49:03Z",
      "side": 1,
      "message": "This is not necessarily going to help; the ordering of byTopic above is undefined. I believe currently it comes out in primary key (numeric change ID) order. In the near future it will come from the secondary index, which is last updated order. Both of these will naturally have changes from different projects interleaved.\n\nHonestly I think it is fine in this change to just always call controlFor. In a future change you can build your own little per-Submit ProjectControl map, or find some way to reuse PerRequestProjectControlCache without a true request scope, or something. That will make the first implementation of this change easier to follow.",
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee0eb1b4_0a88bb48",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 269,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T12:17:46Z",
      "side": 1,
      "message": "The same as above, you should immediately break the loop, once you\u0027ve encountered that visibility is false.",
      "range": {
        "startLine": 267,
        "startChar": 8,
        "endLine": 269,
        "endChar": 9
      },
      "revId": "14ff7c632ec3ea7d0567a73f5a10d9e7b6c65ae5",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}