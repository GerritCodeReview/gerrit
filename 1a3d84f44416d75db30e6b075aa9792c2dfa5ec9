{
  "comments": [
    {
      "key": {
        "uuid": "5d8dd096_93d57733",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 25
      },
      "lineNbr": 2134,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T15:48:33Z",
      "side": 1,
      "message": "Assuming N represents a schema version (181 in this case) then this should be 182.",
      "range": {
        "startLine": 2134,
        "startChar": 66,
        "endLine": 2134,
        "endChar": 69
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "88a388ab_7537d5fc",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 25
      },
      "lineNbr": 2134,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-10T19:19:06Z",
      "side": 1,
      "message": "That\u0027s the wrong assumption: in the above example N was the Gerrit version.\nWith regards to schemas, they don\u0027t exist anymore since we migrated to NoteDb. We have the refs/meta/version that doesn\u0027t correspond to the Gerrit version.",
      "parentUuid": "5d8dd096_93d57733",
      "range": {
        "startLine": 2134,
        "startChar": 66,
        "endLine": 2134,
        "endChar": 69
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f588c4c_c5dcb778",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 25
      },
      "lineNbr": 2134,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T20:10:51Z",
      "side": 1,
      "message": "\u003e That\u0027s the wrong assumption: in the above example N was the Gerrit version.\nIf N represents a Gerrit version then how do we compute N+1?\nAnd what is N+2? How do we ensure that rolling update is only possible from\nN to N+1 but not from N to N+2?",
      "parentUuid": "88a388ab_7537d5fc",
      "range": {
        "startLine": 2134,
        "startChar": 66,
        "endLine": 2134,
        "endChar": 69
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7701b633_ad2b8fbc",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 25
      },
      "lineNbr": 2134,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-10T21:51:57Z",
      "side": 1,
      "message": "The \"N\" and \"N+1\" is misleading. I would just say \"Gerrit version\" and \"next minor Gerrit version\". E\u0027g\u0027 3.N and 3.N+1",
      "parentUuid": "4f588c4c_c5dcb778",
      "range": {
        "startLine": 2134,
        "startChar": 66,
        "endLine": 2134,
        "endChar": 69
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "921b9d2f_6be2d1d1",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 25
      },
      "lineNbr": 2136,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T15:48:33Z",
      "side": 1,
      "message": "OK, so N is definitely a schema version. Then you are missing a test and this change is\nbuggy. See my comment in the test class.",
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78a2a114_7d0a1fd7",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 25
      },
      "lineNbr": 2136,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-10T19:19:06Z",
      "side": 1,
      "message": "No, N was the Gerrit version (not the refs/meta/version value).\nI would rather propose to remove the refs/meta/version reference in the documentation, as it is misleading.\n\nIt was added after the reviews, but I see that confuses the message even more.",
      "parentUuid": "921b9d2f_6be2d1d1",
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd0e67b2_c174bf0b",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 57,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T20:21:01Z",
      "side": 1,
      "message": "This indeed takes the value of refs/meta/version if I understand the code in the\nNoteDbSchemaVersionManager.read well.",
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8edb7679_623b3a29",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 57,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-10T21:51:57Z",
      "side": 1,
      "message": "Yes, that\u0027s why we can only check \u0027\u003e\u0027 and not \u0027\u003d\u0027: we don\u0027t know what will be the refs/meta/version of the next version.",
      "parentUuid": "dd0e67b2_c174bf0b",
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3bdf5df_fa58302a",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 67,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T15:48:33Z",
      "side": 1,
      "message": "This is true also when current - expected \u003e 1 i.e. this allows jumps from schema version\nN to schema version N + k, where k \u003e 1.",
      "range": {
        "startLine": 67,
        "startChar": 10,
        "endLine": 67,
        "endChar": 28
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e7b717b7_a445ab34",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 67,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-10T19:19:06Z",
      "side": 1,
      "message": "No, the next Gerrit version *IS NOT* the current refs/meta/version + 1.",
      "parentUuid": "d3bdf5df_fa58302a",
      "range": {
        "startLine": 67,
        "startChar": 10,
        "endLine": 67,
        "endChar": 28
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4ba8806_5909e708",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 67,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T20:10:51Z",
      "side": 1,
      "message": "What is the next version and how do you make sure that it is only increment by one\nfrom the current version?",
      "parentUuid": "e7b717b7_a445ab34",
      "range": {
        "startLine": 67,
        "startChar": 10,
        "endLine": 67,
        "endChar": 28
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef762562_af31f084",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 67,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-10T21:51:57Z",
      "side": 1,
      "message": "You are never sure of what is the next version: do you know what will be the next refs/meta/version number of 3.3? I do not have the crystal ball and therefore I don\u0027t know. You do not even know if rolling upgrade will be possible or not: that is why the documentation says to check the release notes of the next Gerrit version on the \"Rolling upgrade\" section.",
      "parentUuid": "e4ba8806_5909e708",
      "range": {
        "startLine": 67,
        "startChar": 10,
        "endLine": 67,
        "endChar": 28
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "76d5efa1_84b82d17",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 67,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-11T13:10:18Z",
      "side": 1,
      "message": "\u003e You are never sure of what is the next version: do you know what will be the next refs/meta/version number of 3.3? I do not have the crystal ball and therefore I don\u0027t know.\n\nWell, this is exactly what I assumed when asking the questions. Just the commit\nmessage and the documentation gave a pretty much different impression. N and N+1\nmeans really nothing in this context and is just plain misleading.",
      "parentUuid": "ef762562_af31f084",
      "range": {
        "startLine": 67,
        "startChar": 10,
        "endLine": 67,
        "endChar": 28
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0eeeb89a_e0693ff3",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersionCheck.java",
        "patchSetId": 25
      },
      "lineNbr": 67,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-11T13:32:01Z",
      "side": 1,
      "message": "\u003e \u003e You are never sure of what is the next version: do you know what will be the next refs/meta/version number of 3.3? I do not have the crystal ball and therefore I don\u0027t know.\n\u003e \n\u003e Well, this is exactly what I assumed when asking the questions. Just the commit\n\u003e message and the documentation gave a pretty much different impression. N and N+1\n\u003e means really nothing in this context and is just plain misleading.\n\nAgreed, it is misleading and should amended to make it clearer and unambiguous.",
      "parentUuid": "76d5efa1_84b82d17",
      "range": {
        "startLine": 67,
        "startChar": 10,
        "endLine": 67,
        "endChar": 28
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "181ebe36_37c4e89f",
        "filename": "javatests/com/google/gerrit/server/schema/NoteDbSchemaVersionCheckTest.java",
        "patchSetId": 25
      },
      "lineNbr": 53,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-12T08:21:54Z",
      "side": 1,
      "message": "See the next comment",
      "range": {
        "startLine": 53,
        "startChar": 42,
        "endLine": 53,
        "endChar": 49
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05ec436e_890eb895",
        "filename": "javatests/com/google/gerrit/server/schema/NoteDbSchemaVersionCheckTest.java",
        "patchSetId": 25
      },
      "lineNbr": 68,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-12T08:21:54Z",
      "side": 1,
      "message": "This is a misleading naming, as we (currently) cannot check for \"one more\".\nThe code in the NoteDbSchemaVersionCheck only checks that \"current \u003e expected\".",
      "range": {
        "startLine": 68,
        "startChar": 75,
        "endLine": 68,
        "endChar": 82
      },
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5c31ff3f_282f1e23",
        "filename": "javatests/com/google/gerrit/server/schema/NoteDbSchemaVersionCheckTest.java",
        "patchSetId": 25
      },
      "lineNbr": 72,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-06-10T15:48:33Z",
      "side": 1,
      "message": "Add here another line, thus increasing the version by 2:\n\n  versionManager.increment(NoteDbSchemaVersions.LATEST + 1);\n\nand the test still succeeds.\n\nWe need yet another test which verifies that the version check fails when rolling upgrade\nis enabled and current version is two more than expected.",
      "revId": "1a3d84f44416d75db30e6b075aa9792c2dfa5ec9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}