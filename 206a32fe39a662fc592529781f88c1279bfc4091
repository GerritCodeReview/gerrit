{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0c176655_9f8a65a1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-29T10:31:31Z",
      "side": 1,
      "message": "Edwin, Youssef: Can you please provide a secondary review for this series? I\u0027d like to have good vetting on it since approval copying has led to issues in the past. Thanks!",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17faf807_857c90d1",
        "filename": "java/com/google/gerrit/server/approval/ApprovalInference.java",
        "patchSetId": 7
      },
      "lineNbr": 105,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "Must remove @Nullable here too, otherwise null may be passed into forPatchSet(ChangeNotes, PatchSet, RevWalk, Config) which doesn\u0027t allow null anymore. E.g. forPatchSet(ChangeNotes, PatchSet.Id, RevWalk, Config is called with null value from ApprovalCacheImpl.",
      "range": {
        "startLine": 105,
        "startChar": 43,
        "endLine": 105,
        "endChar": 81
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9819e954_467fd916",
        "filename": "java/com/google/gerrit/server/approval/ApprovalInference.java",
        "patchSetId": 7
      },
      "lineNbr": 105,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T16:35:08Z",
      "side": 1,
      "message": "you\u0027re right, but this is fixed in the follow-up.\nCan we leave it as is given it\u0027s instantly fixed there?\n\nI could merge those 2 changes but I think it\u0027s nicer that way. Alternatively I could add \"@Nullable\" in other methods.",
      "parentUuid": "17faf807_857c90d1",
      "range": {
        "startLine": 105,
        "startChar": 43,
        "endLine": 105,
        "endChar": 81
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8dbe8dbf_f2ace149",
        "filename": "java/com/google/gerrit/server/approval/ApprovalInference.java",
        "patchSetId": 7
      },
      "lineNbr": 105,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-30T08:03:27Z",
      "side": 1,
      "message": "I prefer this to be consistent in this change. Either all is Nullable, or all are non-Nullable. Having non-Nullable parameters for which we pass in null looks wrong. So alternatively adding back @Nullable sounds good to me (if null values are properly handled if they are passed in).",
      "parentUuid": "9819e954_467fd916",
      "range": {
        "startLine": 105,
        "startChar": 43,
        "endLine": 105,
        "endChar": 81
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f7883d8b_ad550a2d",
        "filename": "java/com/google/gerrit/server/approval/ApprovalInference.java",
        "patchSetId": 7
      },
      "lineNbr": 105,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T09:28:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8dbe8dbf_f2ace149",
      "range": {
        "startLine": 105,
        "startChar": 43,
        "endLine": 105,
        "endChar": 81
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e8825e2_d97c657e",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 342,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "Why would anyone need approvals without the copied approvals being included?",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c07ece12_23677e80",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 342,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T13:10:08Z",
      "side": 1,
      "message": "I have only one example right now:\nSubmitWithStickyApprovalDiff uses that, and it is required since we want to figure out when the vote was originally created.\n\nYou have a point that I can somehow simplify this a bit. But anyway, I was just preserving behavior: some cases needed including copied, and some excluding. I\u0027ll refactor a bit since the main reason this behavior was here in the past is to save on calling expensive copying votes code, which is now cheap.",
      "parentUuid": "5e8825e2_d97c657e",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "404b59c1_03637cab",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 342,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T13:17:51Z",
      "side": 1,
      "message": "Thanks for looking into simplifying this.\n\nOne idea. Maybe it would be better is isCopied is a property of PatchSetApproval. Then SubmitWithStickyApprovalDiff could do the filtering on its own.",
      "parentUuid": "c07ece12_23677e80",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3db4aebf_32c4d960",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 342,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T16:35:08Z",
      "side": 1,
      "message": "PatchSetApproval already has this field, so it\u0027s perfectly fine to do this.\n\nHowever, for the sake of preserving existing behavior, can we do this in a follow-up?",
      "parentUuid": "404b59c1_03637cab",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e17a0baa_253488c4",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 342,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T09:28:40Z",
      "side": 1,
      "message": "resolving, getting rid of differentiating copied/non-copied in a follow-up.",
      "parentUuid": "3db4aebf_32c4d960",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "777aa1c0_f37ad952",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 351,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-29T09:17:55Z",
      "side": 1,
      "message": ". This requires passing in the RevWalk that is being used to create the new patch set.",
      "range": {
        "startLine": 351,
        "startChar": 12,
        "endLine": 351,
        "endChar": 13
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "807a6358_2c705410",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 351,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T11:59:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "777aa1c0_f37ad952",
      "range": {
        "startLine": 351,
        "startChar": 12,
        "endLine": 351,
        "endChar": 13
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b56058bd_ec6ee84d",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 358,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-29T09:17:55Z",
      "side": 1,
      "message": "nit: add Javadoc",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b95e5a5f_629ce15f",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 358,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T11:59:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b56058bd_ec6ee84d",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bcd34a48_556267ac",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 373,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "Is this still true now that the labels are just read from NoteDb? \nCan we just use byPatchSet now?",
      "range": {
        "startLine": 373,
        "startChar": 52,
        "endLine": 373,
        "endChar": 61
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "896c628f_b0fd6421",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 373,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T16:35:08Z",
      "side": 1,
      "message": "updated the comment.\nWe can, but it\u0027s not needed to use byPatchSet here (see other comments).",
      "parentUuid": "bcd34a48_556267ac",
      "range": {
        "startLine": 373,
        "startChar": 52,
        "endLine": 373,
        "endChar": 61
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "56c1289c_47d8799d",
        "filename": "java/com/google/gerrit/server/approval/ApprovalsUtil.java",
        "patchSetId": 7
      },
      "lineNbr": 373,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T09:28:40Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "896c628f_b0fd6421",
      "range": {
        "startLine": 373,
        "startChar": 52,
        "endLine": 373,
        "endChar": 61
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc994798_b232f59f",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-29T09:17:55Z",
      "side": 1,
      "message": "I think here we have to take copied votes into account. For reviewer deletion, a copied vote is equivalent to a non-copied vote IMO.",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e87ef77d_7ac7761a",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T11:59:17Z",
      "side": 1,
      "message": "ack, I started looking into this but this change is just preserving behavior.\nI\u0027ll do a follow-up with tests to see if we should change the behavior here.\nI think it is likely okay as is, bsed on the logic of the caller of this classes\u0027 approvals() method.",
      "parentUuid": "bc994798_b232f59f",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1966c7f_bdc61f4f",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "bc994798_b232f59f",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be5f2ce4_8ac21dfe",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:54:46Z",
      "side": 1,
      "message": "Ah, keeping the existing behaviour makes sense for this change. But fixing this is a follow up change would be good. Maybe also mention this in the commit message.",
      "parentUuid": "c1966c7f_bdc61f4f",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c6f96823_4cac0ab9",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-11-29T16:22:50Z",
      "side": 1,
      "message": "+1, I think we should not differentiate between copied and non-copied approvals; a copied vote acts like a normal vote.\n\nFor callers like SubmitWithStickyApprovalDiff, can we add a \"isCopied\" field to PatchSetApproval? We can differentiate between copied and non-copied approvals since we store them with different footers in NoteDb, right?\n\nThat LGTM for this change, but I\u0027m afraid this is adding extra code/logic complexity that we can avoid.",
      "parentUuid": "be5f2ce4_8ac21dfe",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4a9d192e_98af1b81",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-30T08:07:35Z",
      "side": 1,
      "message": "Maybe add a TODO here, that this should be changed to also allow deletion of copied approvals.",
      "parentUuid": "c6f96823_4cac0ab9",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10612f60_51acd5ec",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-30T08:12:45Z",
      "side": 1,
      "message": "\u003e ack, I started looking into this but this change is just preserving behavior.\n\nAh, right. Maybe one has to run this Op on the original patch set for it to work in which case no TODO is needed IMO.\n\nToday, this certainly works and I checked the code and you are right in that we only look at original approval, so the modification you made here LGTM.",
      "parentUuid": "4a9d192e_98af1b81",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "246a70f2_dba2520b",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-30T08:19:34Z",
      "side": 1,
      "message": "Sorry, now I\u0027m confused. How does it help to remove the vote on the original patch set in the new world where the copied approval are persisted on the new patch set?\n\nOld: Removal of the approval on the old patch set would also remove the copied approval, since copied approvals are computed on the fly.\n\nNew: Removal of the approval on the old patch set would have no effect, since the copied approval on the new patch set is still present.\n\nAfter all is it actually a behaviour change if we exclude copied approvals here, because now copied approvals can no longer be removed?",
      "parentUuid": "10612f60_51acd5ec",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e26cf1f0_6af3fa88",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-30T08:22:21Z",
      "side": 1,
      "message": "Ah! You are right, I had a twist in my brain :-)\n\nWe need a test for that as well (put approval on old PS, upload new PS, delete approval, validate it\u0027s gone).",
      "parentUuid": "246a70f2_dba2520b",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "94b1075d_df8c31ef",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T08:57:08Z",
      "side": 1,
      "message": "ack, I\u0027ll do this in this change then.",
      "parentUuid": "e26cf1f0_6af3fa88",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1909116f_fe5bfe77",
        "filename": "java/com/google/gerrit/server/change/DeleteReviewerOp.java",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T09:28:40Z",
      "side": 1,
      "message": "the votes were all anyway removed, but test confirmed it.\nThis code here was just about a change message, added that to the test.",
      "parentUuid": "94b1075d_df8c31ef",
      "range": {
        "startLine": 226,
        "startChar": 30,
        "endLine": 226,
        "endChar": 62
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f8b4e0e_90ba574e",
        "filename": "java/com/google/gerrit/server/change/PatchSetInserter.java",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "Could this be a method inside ApprovalsUtil, e.g. approvalsUtil.copyVotes?\nIn my opinion that would be much more readable.",
      "range": {
        "startLine": 304,
        "startChar": 6,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45ce6ecd_8dba8380",
        "filename": "java/com/google/gerrit/server/change/PatchSetInserter.java",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T13:10:08Z",
      "side": 1,
      "message": "? \nIt\u0027s already a method in ApprovalsUtil, are you suggesting to rename it?",
      "parentUuid": "9f8b4e0e_90ba574e",
      "range": {
        "startLine": 304,
        "startChar": 6,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "358d098c_39c0f987",
        "filename": "java/com/google/gerrit/server/change/PatchSetInserter.java",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T13:14:18Z",
      "side": 1,
      "message": "ah, you meant the forEach part as well :-) \ngot it",
      "parentUuid": "45ce6ecd_8dba8380",
      "range": {
        "startLine": 304,
        "startChar": 6,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77f0aee1_be7ecace",
        "filename": "java/com/google/gerrit/server/change/PatchSetInserter.java",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T13:17:51Z",
      "side": 1,
      "message": "Is it? \n\nWhat I wanted to suggest is that:\n\n   approvalsUtil\n          .dynamicallyComputeCopiedApprovals(\n              ctx.getNotes(), patchSet, ctx.getRevWalk(), ctx.getRepoView().getConfig())\n          .forEach(a -\u003e update.putCopiedApproval(a));\n          \nbecomes something like this:\n\n   approvalsUtil.copyApprovals(ctx.getNotes(), patchSet, ctx.getRevWalk(), ctx.getRepoView().getConfig(), update);\n   \nThe same method could then be used in ReplaceOp.",
      "parentUuid": "45ce6ecd_8dba8380",
      "range": {
        "startLine": 304,
        "startChar": 6,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6fb40b2_4b52b99a",
        "filename": "java/com/google/gerrit/server/change/PatchSetInserter.java",
        "patchSetId": 7
      },
      "lineNbr": 307,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-29T16:35:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "77f0aee1_be7ecace",
      "range": {
        "startLine": 304,
        "startChar": 6,
        "endLine": 307,
        "endChar": 53
      },
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d22ade00_e2ba8561",
        "filename": "java/com/google/gerrit/server/notedb/ChangeNotes.java",
        "patchSetId": 7
      },
      "lineNbr": 395,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "Can we rename this to getApprovals() and drop the current getApprovals() method that excludes copied approvals. I\u0027m not sure I understand why getting approvals without copied approvals is needed.",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdc0c949_11d3aae9",
        "filename": "java/com/google/gerrit/server/notedb/ChangeNotes.java",
        "patchSetId": 7
      },
      "lineNbr": 395,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T09:28:40Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d22ade00_e2ba8561",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f99f2144_0b4fdcd3",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-29T12:30:30Z",
      "side": 1,
      "message": "Why are copied approvals excluded here?",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c4067f73_08557ae5",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-30T08:28:34Z",
      "side": 1,
      "message": "This is preserving behavior, the current method is implemented as:\n\n  public ListMultimap\u003cPatchSet.Id, PatchSetApproval\u003e byChange(ChangeNotes notes) \n  {\n    return notes.load().getApprovals();\n  }",
      "parentUuid": "f99f2144_0b4fdcd3",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fbb7305_c7234d57",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-30T08:37:02Z",
      "side": 1,
      "message": "OK, but unrelated to this change, I would be interested to understand why copied approvals need to be excluded here? E.g. is it a bug that they are excluded?",
      "parentUuid": "c4067f73_08557ae5",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "28857e03_e8613478",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-11-30T08:40:51Z",
      "side": 1,
      "message": "ChangeData has two methods (#currentApprovals and #approvals). I looked at the callers of #approvals and it seems we could migrate them all (not in this change) to #currentApprovals, it\u0027s not that many and the usage doesn\u0027t seem to strictly require non-copied votes only.",
      "parentUuid": "2fbb7305_c7234d57",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc2beedf_7c57e8a8",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-30T08:55:25Z",
      "side": 1,
      "message": "Thanks for checking. +1 to drop redundant methods and always use all approvals if possible (I think the only case where we actually do need to filter out copied approvals is for SubmitWithStickyApprovalDiff, but this can be done by filtering the approvals based on the PatchSetApproval.copied() method). I think the APIs will get much simpler/clearer once we do not differentiate between copied and non-copied approvals everywhere. Agreed that fixing this goes beyond this change, but it would be nice if gets part of this series.",
      "parentUuid": "28857e03_e8613478",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8c59718_f79b9b67",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-11-30T08:57:08Z",
      "side": 1,
      "message": "I will make sure to do this as a follow-up, is that ok?",
      "parentUuid": "fc2beedf_7c57e8a8",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "874442fc_1e5eaa2e",
        "filename": "java/com/google/gerrit/server/query/change/ChangeData.java",
        "patchSetId": 7
      },
      "lineNbr": 773,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-11-30T09:03:19Z",
      "side": 1,
      "message": "Yes, thank you!",
      "parentUuid": "e8c59718_f79b9b67",
      "revId": "206a32fe39a662fc592529781f88c1279bfc4091",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}