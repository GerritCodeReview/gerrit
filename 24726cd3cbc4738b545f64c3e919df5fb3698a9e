{
  "comments": [
    {
      "key": {
        "uuid": "843ef6e8_7fec4f1d",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-12-10T01:22:51Z",
      "side": 1,
      "message": "Would it be better to make this an exact search on change-id rather than a prefix search?",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6443c281_dee5a534",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-12-10T01:22:51Z",
      "side": 1,
      "message": "other changes",
      "range": {
        "startLine": 193,
        "startChar": 20,
        "endLine": 193,
        "endChar": 31
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44407e75_dd13eb7b",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-12-10T01:31:16Z",
      "side": 1,
      "message": "\u0027PREFIX\u0027 is not a Change-Id. I think you might be misinterpreting \"Depends-on\" in exactly the way I was expecting when I made my comment about bikeshedding the name :)",
      "parentUuid": "843ef6e8_7fec4f1d",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "843ef6e8_1f1ee38c",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-12-10T01:36:18Z",
      "side": 1,
      "message": "Hmm, OK, then I think we need some clarification about what values are expected to be put in the Depends-On footer.\n\nI\u0027m interested in this because we are already using a Depends-On footer internally which ties into a workflow and tool chain outside of Gerrit.",
      "parentUuid": "44407e75_dd13eb7b",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44407e75_fd2d07ae",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2014-12-10T01:56:48Z",
      "side": 1,
      "message": "Glad you show up then.\nSo we have the problem as described in the commit message of different repos which should go in atomically.\n\nThere are different ways to expose this dependency modelling to the user. You could have a\n    \n    Depends-On: $CHANGE_ID\n\nbut think about how the work flow would look like for a while. You\u0027d create the commit in the first repo. How much knowledge do you expect the standard user to have about the change IDs? So they commit and look at the commit to retrieve the change ID and copy paste that into the commit of the second repo. \nBetter to be safe, they also copy the change ID of the commit from the second repo to the commit of the first repo.\n\nThat would work, but is that a viable and easy way we should impose on the user? I think we can do better.\n\nSo how about this:\nIn all repositories we want to make changes which depend on each other in a way, we put\n\n    Depends-On: \"My random topic affecting different repos\"\n\nThat string can be anything, it must be unique for all the\ncurrently open changes. So you could in theory reuse the string after a while when all depending changes where merged or abandoned.\n\nThese are my thoughts so far. Please share your thoughts on the Depends-On: field as you seem to use it already.",
      "parentUuid": "843ef6e8_1f1ee38c",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4589271_9a096d50",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-12-10T01:58:11Z",
      "side": 1,
      "message": "I think the idea and the proposed implementation are sound. The name is misleading.",
      "parentUuid": "44407e75_fd2d07ae",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44407e75_3d6f6fed",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2014-12-10T02:04:00Z",
      "side": 1,
      "message": "So you\u0027d rename it?\n\nNaming things is one of the harder problems in computer science, so how about:\n\n   CrossAtomicMerge: \"It should become a merge across repos\"\n   CrossSubmit: \"Submitting is a bit more general\"\n   X-Submit: \"well yeah\"\n   AtomicSubmit: \"could be mistaken easily?\"\n   \nI personally would prefer Cross-Submit.",
      "parentUuid": "e4589271_9a096d50",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "843ef6e8_5f286ba7",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-12-10T02:09:23Z",
      "side": 1,
      "message": "\u003e they commit and look at the commit to retrieve the change ID and copy paste that into the commit of the second repo.\n\nWe\u0027re using it pretty much like this.  I think in most cases the changes are not interdependent though, so we don\u0027t need it in both commits.\n\nFor example we could have commit-A in repo-A and commit-B in repo-B, where commit-A will build standalone, but commit-B needs commit-A to be included.  \"Depends-On: Iabcd123...\" is added in commit-B\u0027s commit message, with the Change-Id of commit-A (which the user manually gets from the git log of repo-A).\n\nThe way you describe the expected workflow is a bit different, and as Dave says the \"Depends-on\" name is misleading.\n\nThat bike shed looks like it needs a new coat of paint... :)",
      "parentUuid": "e4589271_9a096d50",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "843ef6e8_9f095350",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-12-10T02:48:29Z",
      "side": 1,
      "message": "\u003e In all repositories we want to make changes which depend on each other in a way, we put\n\u003e     Depends-On: \"My random topic affecting different repos\"\n\u003e That string can be anything, it must be unique for all the\n\u003e currently open changes. So you could in theory reuse the string after a while when all depending changes where merged or abandoned.\n\nWhat happens if I upload change-A with\n\n  Depends-On: \"My random topic affecting different repos\"\n\nand then continuous integration for change-A is triggered before any other changes with the same Depends-On footer are uploaded?\n\nAssuming the CI system is aware of Depends-On, how can it determine that all the necessary dependent changes have been uploaded?\n\nIf Depends-On is a Change-Id, CI can attempt to fetch it and abort/fail if it doesn\u0027t exist.\n\nOn the other hand if it\u0027s \"My random topic affecting different repos\" and CI uses a query like\n\n dependson:\"My random topic affecting different repos\" status:open\n\nthe result of the query may not include all the necessary changes if they have not been uploaded yet, and CI has no way to know that.",
      "parentUuid": "44407e75_fd2d07ae",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24146a87_24cbf2b4",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-12-10T17:42:27Z",
      "side": 1,
      "message": "Yesterday in our office we had a discussion about what we should do for a name and came up with an interesting idea. We did not discuss the CI dependency issue you bring up, so I\u0027ll leave to Stefan to respond to that.\n\nThe idea was to not introduce an N+1th way of grouping changes together, and instead reuse the existing topic feature for this purpose. If a change has a topic, provide a way at submit time (e.g. a checkbox) to also submit all other changes in that topic. Leave it unchecked by default to preserve the current behavior.\n\nAdvantages include:\n\n* Actually give some functionality to topic other than \"like a hashtag but there can be only one of them\".\n* Reuse existing \"Same topic\" tab on change screen rather than adding an N+1th tab.\n* Allow submitting multiple changes in sequence on a single repo by clicking \"Submit\" only on the last one, which as you know has been a feature request for years.",
      "parentUuid": "843ef6e8_9f095350",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4cb3264_62d5b64d",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2014-12-10T18:47:24Z",
      "side": 1,
      "message": "While commit-A in repo-A builds fine on itself, repo-B without commit-B will be broken as it won\u0027t build using the latest repo-A. That\u0027s why we want to mark them depending on each other. So commit-A must not go in, if commit-B is still under review. They must go in together. That was the initial reasoning for either having circular dependencies on the change IDs or having just one atomic \"group\" in different repos.\n\nDave coined the term \"group\" yesterday in the office discussion, but as he outlined below, we\u0027ll probably reuse the topics for this purpose.\n\nHaving a group/topic without explicitly stating the depending $ChangeId has the risk of not having uploaded the changes in all the repos (Say there is a repo-C which needs commit-C, very similar to commit-B in repo-B). However I feel this may be easier for users than having to deal with the circular dependencies.\nNow that we introduced commit-C in repo-C, and we want to have the \"Depends-On: \" footer being explicit about its dependencies, we\u0027d need to have\n\nIn commit-A:\n    Depends-On $ChangeID(commit-B)\n    Depends-On $ChangeID(commit-C)\n\nIn commit-B:\n    Depends-On $ChangeID(commit-A)\n\nIn commit-C:\n    Depends-On $ChangeID(commit-A)  \n\nImagine there are more than two API consumers (repo-B/C), buth maybe 5. Then writing commit message in commit-A becomes cumbersome. \n\nThat\u0027s why I\u0027d currently rather go with the group/topic approach and hope the users will upload all the changes before there is a subset uploaded\u0026Reviewed\u0026Submitted already. The reviewers may spot the missing dependencies?",
      "parentUuid": "843ef6e8_5f286ba7",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4cb3264_a2dede6f",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 7
      },
      "lineNbr": 193,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2014-12-10T19:00:02Z",
      "side": 1,
      "message": "So to come back to the continuous integration  \n\n\u003e then continuous integration for change-A is triggered before any other changes with the same Depends-On footer are uploaded?\n\nIt will fail, because the topic is not complete yet. So if a user just forgets to upload commit-C in repo-C the CI will fail and they will be reminded to upload it.\n\n\u003e Assuming the CI system is aware of Depends-On, how can it determine that all the necessary dependent changes have been uploaded?\n\nIt cannot. So we\u0027ll probably see at least one failed build for all of these cross repository changes. Maybe we can fix that by having a footer:\n    \n    Topic: 3: \"My random topic affecting different repos\"\n\nand the 3 indicates we will have 3 repositories affected. So the CI system waits until it can see at least 3 repos having a commit with this topic.\nHowever if you find out you need to do changes in another 4th repo, you may need to change the : 3: in all the other repos.\nOr the number is just a hint to wait for so many repos and may be different across repositories/commits.",
      "parentUuid": "e4cb3264_62d5b64d",
      "range": {
        "startLine": 193,
        "startChar": 32,
        "endLine": 193,
        "endChar": 54
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "843ef6e8_5ff18bf3",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/server/query/change/AbstractQueryChangesTest.java",
        "patchSetId": 7
      },
      "lineNbr": 400,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-12-10T01:22:51Z",
      "side": 1,
      "message": "Is this a realistic use case?",
      "range": {
        "startLine": 400,
        "startChar": 24,
        "endLine": 400,
        "endChar": 39
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24146a87_a405223c",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/server/query/change/AbstractQueryChangesTest.java",
        "patchSetId": 7
      },
      "lineNbr": 400,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2014-12-10T20:44:05Z",
      "side": 1,
      "message": "No it is not. I have too many foos in there.",
      "parentUuid": "843ef6e8_5ff18bf3",
      "range": {
        "startLine": 400,
        "startChar": 24,
        "endLine": 400,
        "endChar": 39
      },
      "revId": "24726cd3cbc4738b545f64c3e919df5fb3698a9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}