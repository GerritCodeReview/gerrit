{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "75b821a7_c86d0143",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 127,
      "author": {
        "id": 1139611
      },
      "writtenOn": "2022-02-04T07:24:50Z",
      "side": 1,
      "message": "Doesn\u0027t need to be addressed in this change but have you thought about a more hybrid approach where you decide based on file-length whether to spin it off to a worker vs doing it immediately?",
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "276c2329_ad04adca",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 127,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2022-02-04T07:32:25Z",
      "side": 1,
      "message": "I had thought about it, but decided that this optimization is probably not worthwhile. We are re-using the workers, so for small files the workers are still extremely fast. I have checked that we don\u0027t perform poorly in that case with workers.",
      "parentUuid": "75b821a7_c86d0143",
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ff0a44c_4b3bed05",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 127,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2022-02-04T14:09:04Z",
      "side": 1,
      "message": "Do we expect that if web workers are broken on browser (unsupported, disabled) that user will not have highlighting?",
      "parentUuid": "276c2329_ad04adca",
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1ad90c55_95112cdd",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 127,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2022-03-16T09:33:38Z",
      "side": 1,
      "message": "All browsers support web workers and I am not aware of a mechanism for disabling. So yes, at the moment syntax highlighting will stop working. If users report this as being an issue, then we can probably make this work without workers, but I would like to avoid doing this speculatively.",
      "parentUuid": "1ff0a44c_4b3bed05",
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1047873_1b8f04cd",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 140,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2022-02-04T14:09:04Z",
      "side": 1,
      "message": "In gr-syntax-layer, we start with canceling process. Could it happen that we run several process for same file?",
      "range": {
        "startLine": 140,
        "startChar": 2,
        "endLine": 140,
        "endChar": 19
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10ed05b3_f27df3df",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 140,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2022-03-16T09:33:38Z",
      "side": 1,
      "message": "I had added a TODO to gr-diff-host:\n```\n// TODO: Remove calling cancel() when switching to GrSyntaxLayerWorker.\n// The plan is to only start syntax highlighting when a diff is visible on\n// screen, and HighlightJS itself does not allow cancelling. So there is\n// unclear benefit from the ability to cancel, which would be non-trivial\n// to implement correctly and efficiently.\n```\nI think in theory yes, you could come up with a scenario where you can get into trouble, but in reality `process()` is only called once, and then only when gr-diff-host\u0027s `reload()` is called.\n\nI will follow up with a refactoring after removing the old syntax layer.",
      "parentUuid": "b1047873_1b8f04cd",
      "range": {
        "startLine": 140,
        "startChar": 2,
        "endLine": 140,
        "endChar": 19
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15e955cc_661c61bd",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 170,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2022-02-04T14:09:04Z",
      "side": 1,
      "message": "could it happen that result is already old, because this layer is processing something different? \nDo you need to check if language is still same as it was called and code is still same as it was called?",
      "range": {
        "startLine": 170,
        "startChar": 11,
        "endLine": 170,
        "endChar": 58
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a9bc5946_518c77f2",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 170,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2022-03-16T09:33:38Z",
      "side": 1,
      "message": "In theory yes. Will follow up with a refactoring.",
      "parentUuid": "15e955cc_661c61bd",
      "range": {
        "startLine": 170,
        "startChar": 11,
        "endLine": 170,
        "endChar": 58
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e3415c1_f53f0e79",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 177,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2022-02-04T14:11:48Z",
      "side": 1,
      "message": "What is reason that ranges need to be reversed? lastIndexOf is not enough?",
      "range": {
        "startLine": 177,
        "startChar": 52,
        "endLine": 177,
        "endChar": 59
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "138f9c8d_250aac26",
        "filename": "polygerrit-ui/app/embed/diff/gr-syntax-layer/gr-syntax-layer-worker.ts",
        "patchSetId": 15
      },
      "lineNbr": 177,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2022-03-16T09:33:38Z",
      "side": 1,
      "message": "There is `lastIndexOf()`, but there is no `findLastIndex()`. That is the reason.",
      "parentUuid": "7e3415c1_f53f0e79",
      "range": {
        "startLine": 177,
        "startChar": 52,
        "endLine": 177,
        "endChar": 59
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c582796c_f2eaa78d",
        "filename": "polygerrit-ui/app/services/highlight/highlight-service.ts",
        "patchSetId": 15
      },
      "lineNbr": 30,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2022-02-04T14:09:04Z",
      "side": 1,
      "message": "Do you plan cancelability in future? User expand all 200 files and then without waiting, it go to diff page or dashboard?",
      "range": {
        "startLine": 30,
        "startChar": 13,
        "endLine": 30,
        "endChar": 29
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a486c40e_f28ecfd2",
        "filename": "polygerrit-ui/app/services/highlight/highlight-service.ts",
        "patchSetId": 15
      },
      "lineNbr": 30,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2022-03-16T09:33:38Z",
      "side": 1,
      "message": "I have thought about it, and I am not sure it would pay off.\n\nAt least I could not find a good way to implement cancelability with low implementation and maintenance cost. And I not sure, if the benefit would be huge. But we can later revisit this. I do believe that it would be nice to have.",
      "parentUuid": "c582796c_f2eaa78d",
      "range": {
        "startLine": 30,
        "startChar": 13,
        "endLine": 30,
        "endChar": 29
      },
      "revId": "25de6c05b023c4756bfcf21b0885c600fde37bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}