{
  "pushCert": "certificate version 0.1\npusher A0D0EF51 1513166686 +0100\nnonce ADEcKBqNE0OCxjG4gTqNG20BxNOinFRDaJn5LHA9hDHTClWZjkm5Xz/PmDtNG8ZDTkEW6DtQ/nOe\n\n0000000000000000000000000000000000000000 28253e6c456071324e69e962befe3a65a6e8b760 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJaMRdeAAoJEFG1/Zeg0O9R+uYH/1PBq1L29YZODYDKnf31wln+\nK50aYc4c4YndJnQ7OORYG3pzKyrF/50iE9QoxEOoIDAXWXl9msPZ9kqko7EKJM2/\nUQw65F85h/xhGMKC94NYJHs/fhNQDAXpGEJAHZmPM/r2VWAXK4h7HgRrss16sSWN\n50Ff2r9EG64r0bck4x3uV/uYpqi8FtrPlIlkBwrNdyngWWOFlApHgggnCx+/umIY\nFqwKY5pSNmEsvwUNXh0mimRMff1pMmfXXcsHApnmy2lNV0Mx6JrQ05xytILXwhlE\nmwOw3lDNsJqMlSzpbY4LCTEKZS/Y9Xjql8UyH6WybpHl3mNC1djmvXx2Rf9mFMc\u003d\n\u003d5MKu\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "8cd5da36_a8c00bed",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdsUpdate.java",
        "patchSetId": 4
      },
      "lineNbr": 735,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-12-15T14:32:40Z",
      "side": 1,
      "message": "I don\u0027t see the benefit here of passing this in as an arg as opposed to just referring to the variable from the enclosing scope in the lambda.\n\nFor BatchUpdate.Factory, the reason it is that way is I wanted to make BatchUpdate.Factory non-injectable, forcing users of the BatchUpdate framework to always use RetryHelper. (We haven\u0027t gotten there yet for reasons I don\u0027t recall at the moment.)\n\nI wonder if it makes sense in the long run to do the same thing with ExternalIdUpdater: don\u0027t expose a Guice binding, and force callers to use RetryHelper. But you\u0027re not doing that yet.",
      "range": {
        "startLine": 735,
        "startChar": 8,
        "endLine": 735,
        "endChar": 15
      },
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8844e1c3_60f9f465",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdsUpdate.java",
        "patchSetId": 4
      },
      "lineNbr": 735,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-12-15T16:34:10Z",
      "side": 1,
      "message": "\u003e I don\u0027t see the benefit here of passing this in as an arg as opposed to just referring\n\u003e to the variable from the enclosing scope in the lambda.\n\nAgreed. I actually came to the same conclusion while I was working on the rest of this series, but then forgot to come back.\n\nDone.\n\n\u003e I wonder if it makes sense in the long run to do the same thing with ExternalIdUpdater:\n\u003e don\u0027t expose a Guice binding, and force callers to use RetryHelper. But you\u0027re not doing\n\u003e that yet.\n\nThis might be a good idea. Let\u0027s reconsider this later when all the refactoring for making account updates atomic are done.",
      "parentUuid": "8cd5da36_a8c00bed",
      "range": {
        "startLine": 735,
        "startChar": 8,
        "endLine": 735,
        "endChar": 15
      },
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5125e11c_3fabfef9",
        "filename": "java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 4
      },
      "lineNbr": 169,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-12-15T14:49:22Z",
      "side": 1,
      "message": "The main reason I introduced UpdateException was to simplify throws clauses in downstream method signatures. You don\u0027t have to do it now, but I would at least consider doing that here as well.\n\nThe thing to think about is: will a caller ever want to catch these exception types separately and do something different, as opposed to just letting it propagate? If the answer is no, then there is no benefit to throwing different exception types, and using a single exception type is less boilerplate.\n\nI guess another consideration is if you have a mixture of read and update operations, then you might actually end up with 4 exception types (UpdateException plus the existing 3). So maybe that is not a net win. Although it opens up new avenues for investigation, introducing a new exception type in VersionedMetaData\u0027s method signatures.",
      "range": {
        "startLine": 169,
        "startChar": 12,
        "endLine": 169,
        "endChar": 62
      },
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c3211306_7b31383b",
        "filename": "java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 4
      },
      "lineNbr": 169,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-12-15T16:34:10Z",
      "side": 1,
      "message": "\u003e The main reason I introduced UpdateException was to simplify throws clauses in downstream \n\u003e method signatures. You don\u0027t have to do it now, but I would at least consider doing that \n\u003e here as well.\n\nGood point. Let me come back to this later and see how it fits.\n\n\u003e The thing to think about is: will a caller ever want to catch these exception types\n\u003e separately and do something different, as opposed to just letting it propagate? If\n\u003e the answer is no, then there is no benefit to throwing different exception types, and\n\u003e using a single exception type is less boilerplate.\n\nAt the moment some callers handle OrmDuplicateKeyException specifically, but maybe we can get rid of this somehow.",
      "parentUuid": "5125e11c_3fabfef9",
      "range": {
        "startLine": 169,
        "startChar": 12,
        "endLine": 169,
        "endChar": 62
      },
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "510c74cf_bc6baddc",
        "filename": "java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 4
      },
      "lineNbr": 233,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-12-15T14:32:40Z",
      "side": 1,
      "message": "This is usually not something you want to do, and it took me a minute to convince myself that it was equivalent (enough) to the old behavior. Maybe add a comment that callers are expected to catch and inspect the exception before deciding whether to rethrow it?",
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "764ce292_6b5df9bf",
        "filename": "java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 4
      },
      "lineNbr": 233,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-12-15T16:34:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "510c74cf_bc6baddc",
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fb8aded2_c9b38af1",
        "filename": "java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 4
      },
      "lineNbr": 256,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-12-15T14:32:40Z",
      "side": 1,
      "message": "It\u0027s non-obvious from the constructor signatures that there is going to be this default setup if you don\u0027t pass a retryerStrategySetup. Would it work to move this into the constructor, and make the retryerStrategySetup arg non-nullable?",
      "range": {
        "startLine": 252,
        "startChar": 11,
        "endLine": 256,
        "endChar": 40
      },
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "766be0e3_285c48c5",
        "filename": "java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 4
      },
      "lineNbr": 256,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-12-15T16:34:10Z",
      "side": 1,
      "message": "Unfortunately not, since we need access to the timeout that is passed with the options.\n\nI renamed retryerStrategySetup to overwriteDefaultRetryerStrategySetup to make it more clear.",
      "parentUuid": "fb8aded2_c9b38af1",
      "range": {
        "startLine": 252,
        "startChar": 11,
        "endLine": 256,
        "endChar": 40
      },
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "037a8262_c0c1663d",
        "filename": "javatests/com/google/gerrit/acceptance/rest/account/ExternalIdIT.java",
        "patchSetId": 4
      },
      "lineNbr": 788,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-12-15T14:32:40Z",
      "side": 1,
      "message": "I think this also wants the BlockStrategy? I guess this was an issue with the old test as well.",
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab367ea0_60455b71",
        "filename": "javatests/com/google/gerrit/acceptance/rest/account/ExternalIdIT.java",
        "patchSetId": 4
      },
      "lineNbr": 788,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-12-15T16:34:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "037a8262_c0c1663d",
      "revId": "28253e6c456071324e69e962befe3a65a6e8b760",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}