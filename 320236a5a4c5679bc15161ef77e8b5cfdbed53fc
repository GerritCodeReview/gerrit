{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "54f25760_896647ae",
        "filename": "java/com/google/gerrit/server/cache/PerThreadCache.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-02-21T14:40:05Z",
      "side": 1,
      "message": "Are there any known users left of this cache? If not, you probably need to provide a justification for leaving this around, maybe something like \"there could be plugin users of this cache\", \"this is now used by ... on the master branch\" (if that is true), and, of course, your intended use case for this one this branch?",
      "revId": "320236a5a4c5679bc15161ef77e8b5cfdbed53fc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c071d89e_93c683cb",
        "filename": "java/com/google/gerrit/server/cache/PerThreadCache.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-02-23T00:27:15Z",
      "side": 1,
      "message": "@ekempin@google.com pointed out to me that this is used by the code-owners plugin on master: https://cs.opensource.google/gerrit/gerrit/plugins/code-owners/+/master:java/com/google/gerrit/plugins/codeowners/backend/config/CodeOwnersPluginConfiguration.java;l\u003d58\n\nThe usage on line 58 is a single cache entry; however, the usage on line 72 is again a per-project entry. Perhaps we should find a way to make the PerThreadProjectCache more generic such that its limit applies to how many projects to cache and callers can store multiple different cache entries per-project? That wouldn\u0027t be helpful if the projects don\u0027t overlap, but they probably do?",
      "parentUuid": "54f25760_896647ae",
      "revId": "320236a5a4c5679bc15161ef77e8b5cfdbed53fc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2bfedd0c_b05e45e2",
        "filename": "java/com/google/gerrit/server/cache/PerThreadCache.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2023-02-27T11:02:14Z",
      "side": 1,
      "message": "\u003e If not, you probably need to provide a justification for leaving this around, maybe something like \"there could be plugin users of this cache\", \"this is now used by ... on the master branch\" (if that is true), and, of course, your intended use case for this one this branch?\n\nAck. Done.\n\n\u003e The usage on line 58 is a single cache entry; however, the usage on line 72 is again a per-project entry.\n\nPost merging this change, I think we can update code-owners plugin to use PerThreadProjectCache.\n\n\u003e Perhaps we should find a way to make the PerThreadProjectCache more generic such that its limit applies to how many projects to cache and callers can store multiple different cache entries per-project?\n\nSure, I see this as an enhancement on top of this change. Can be a follow-on change?",
      "parentUuid": "c071d89e_93c683cb",
      "revId": "320236a5a4c5679bc15161ef77e8b5cfdbed53fc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e63183de_b2bc3aa9",
        "filename": "java/com/google/gerrit/server/cache/PerThreadCache.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-02-28T05:53:10Z",
      "side": 1,
      "message": "\u003e \u003e If not, you probably need to provide a justification for leaving this around, maybe something like \"there could be plugin users of this cache\", \"this is now used by ... on the master branch\" (if that is true), and, of course, your intended use case for this one this branch?\n\u003e \n\u003e Ack. Done.\n\u003e \n\u003e \u003e The usage on line 58 is a single cache entry; however, the usage on line 72 is again a per-project entry.\n\u003e \n\u003e Post merging this change, I think we can update code-owners plugin to use PerThreadProjectCache.\n\nRight, but that will mean a bit more refracting to PerThreadProjectCache to really make it generic (as noted below) and move it into the .server.cache package.\n\n\u003e \n\u003e \u003e Perhaps we should find a way to make the PerThreadProjectCache more generic such that its limit applies to how many projects to cache and callers can store multiple different cache entries per-project?\n\u003e \n\u003e Sure, I see this as an enhancement on top of this change. Can be a follow-on change?\n\nI like that as a follow-on change, but since the 3.5 version of the code-owners plugin already uses PerThreadCache [1], we should wait to submit this change until the follow ons for generic PerThreadProjectCache and the code-owners plugin update to use it are ready to submit.\n\n[1] https://gerrit.googlesource.com/plugins/code-owners/+/refs/heads/stable-3.5/java/com/google/gerrit/plugins/codeowners/backend/config/CodeOwnersPluginConfiguration.java#59",
      "parentUuid": "2bfedd0c_b05e45e2",
      "revId": "320236a5a4c5679bc15161ef77e8b5cfdbed53fc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "06b5f795_69ed9012",
        "filename": "java/com/google/gerrit/server/permissions/PerThreadProjectCache.java",
        "patchSetId": 2
      },
      "lineNbr": 53,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2023-02-21T14:40:05Z",
      "side": 1,
      "message": "Maybe call this computeIfAbsent() or computeIfAbsentWithinLimit()?",
      "range": {
        "startLine": 53,
        "startChar": 27,
        "endLine": 53,
        "endChar": 30
      },
      "revId": "320236a5a4c5679bc15161ef77e8b5cfdbed53fc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eb0fd0cc_657841ac",
        "filename": "java/com/google/gerrit/server/permissions/PerThreadProjectCache.java",
        "patchSetId": 2
      },
      "lineNbr": 53,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2023-02-27T11:02:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "06b5f795_69ed9012",
      "range": {
        "startLine": 53,
        "startChar": 27,
        "endLine": 53,
        "endChar": 30
      },
      "revId": "320236a5a4c5679bc15161ef77e8b5cfdbed53fc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}