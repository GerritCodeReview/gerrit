{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5eaed9f7_5e88c0fd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-11T21:12:15Z",
      "side": 1,
      "message": "I believe we should introduce a permission to expose the Gerrit configuration over the wire.\nWDYT?",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "423c5562_3b5ea441",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-03-11T23:08:45Z",
      "side": 1,
      "message": "Do we already have a monitoring permission ?\nHow about other metrics ?",
      "parentUuid": "5eaed9f7_5e88c0fd",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8f9fdce_c6f63d17",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-11T23:35:40Z",
      "side": 1,
      "message": "\u003e Do we already have a monitoring permission ?\n\nWe do.\n\n\u003e How about other metrics ?\n\nThe other metrics do not expose the values in gerrit configuration, which could be sensitive. Having the knowledge of how gerrit is configured could enable targeted exploits.",
      "parentUuid": "423c5562_3b5ea441",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bf4fe98a_ac4e2053",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-03-12T09:00:25Z",
      "side": 1,
      "message": "this looks like a mess\n\nThe javamelody plugin has the monitoring capability, prometheus reporter the view metrics capability, and the other reporters don\u0027t care about permissions. Though I didn\u0027t check if metrics are fetched by the other monitoring systems like this is done by prometheus and jmx or if gerrit pushes metrics to those systems.\n\nNow I add this new metric to Gerrit core and wonder which capability would be the right one ? Maybe administrate server ?",
      "parentUuid": "f8f9fdce_c6f63d17",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1101d54d_0e6ea8ff",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-03-12T09:06:42Z",
      "side": 1,
      "message": "Would it make sense to add a view metrics capability to gerrit core and change the metrics-reporter plugins to respect that centrally defined one instead of each defining its own capability ?\n\nWe currently use metrics-reporter-jmx, metrics-reporter-prometheus and javamelody plugins for our sites.",
      "parentUuid": "bf4fe98a_ac4e2053",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f9444f39_3820a6cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-12T09:45:39Z",
      "side": 1,
      "message": "\u003e Would it make sense to add a view metrics capability to gerrit core and change the metrics-reporter plugins to respect that centrally defined one instead of each defining its own capability ?\n\nOh yes, that would make *a lot of sense* IMHO. The permission of accessing the metrics is an aspect different from the data format and protocol of the metrics.\n\n\u003e We currently use metrics-reporter-jmx, metrics-reporter-prometheus and javamelody \nplugins for our sites.\n\nAnd there are now also many other metrics reporters, we recently introduced CloudWatch and we could develop also StackDriver and DataDog in the near future.",
      "parentUuid": "1101d54d_0e6ea8ff",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44b176eb_bc1e895b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-03-12T11:27:47Z",
      "side": 1,
      "message": "On which branch should such Capability refactoring happen, master ?\n\nI am not sure if it\u0027s a good idea to expose a metric which is subject to different or additional permissions compared to all the other metrics because monitoring systems tend to have a more coarse granular permission model and the user looking at a monitoring dashboard is not the one used by the monitoring system to fetch the metrics from Gerrit. Transferring metrics from Gerrit to a monitoring system doesn\u0027t propagate permission settings so this would need to be done manually if the monitoring system allows that.\n\nIf we want to have additional restrictions for access to current config maybe it\u0027s better to add another REST endpoint and/or ssh command ?",
      "parentUuid": "f9444f39_3820a6cb",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7238af96_2782dacf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-12T11:31:37Z",
      "side": 1,
      "message": "\u003e On which branch should such Capability refactoring happen, master ?\n\nYep.\n\n\u003e I am not sure if it\u0027s a good idea to expose a metric which is subject to different or additional permissions compared to all the other metrics because monitoring systems tend to have a more coarse granular permission model and the user looking at a monitoring dashboard is not the one used by the monitoring system to fetch the metrics from Gerrit.\n\nI don\u0027t believe this new metric you are exposing is supposed to be graphed in any way, isn\u0027t it?\nI believe Gerrit should just hide the metric *IF* the incoming HTTP user (the monitoring one, not the person looking at the metrics) doesn\u0027t have permissions to see it.\n\n\u003e Transferring metrics from Gerrit to a monitoring system doesn\u0027t propagate permission settings so this would need to be done manually if the monitoring system allows that.\n\nI don\u0027t believe that is needed IMHO.\n\n\u003e If we want to have additional restrictions for access to current config maybe it\u0027s better to add another REST endpoint and/or ssh command ?\n\nThat would be best IMHO rather than using the metric system, which isn\u0027t necessarily the correct channel.",
      "parentUuid": "44b176eb_bc1e895b",
      "revId": "35dc92487d291429aedb23851d9276107047990e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}