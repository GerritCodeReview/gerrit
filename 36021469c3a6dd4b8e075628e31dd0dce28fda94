{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "577136a4_7a49e326",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1011217
      },
      "writtenOn": "2022-01-25T17:39:01Z",
      "side": 1,
      "message": "I\u0027m working on testing this locally. I\u0027m not familiar with Gerrit\u0027s built in test framework. I\u0027d be happy to have hints for adding tests there if there is a good way to test this within the Gerrit code base. Or feel free to push a new patchset to add tests or otherwise make a better fix.",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f8e19c1f_beb96575",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1011217
      },
      "writtenOn": "2022-01-25T20:43:44Z",
      "side": 1,
      "message": "Manually testing this on a test Gerrit 3.4 instance with this patch applied seems to have fixed the issue.\n\nWhen I remove all [access \"refs/tags/*\"] entries and try to push it reports:\n\n  To ssh://localhost:29418/x/test-project\n   ! [remote rejected] 0.0.1 -\u003e 0.0.1 (prohibited by Gerrit: not permitted: create signed tag)\n  error: failed to push some refs to \u0027ssh://admin@localhost:29418/x/test-project\u0027\n  \nWhich is good because the error message shows create signed tag is not permitted. Not the normal create tag.\n\nThen I add back only createdSignedTag for my administrators group and try again and it succeeds:\n\n  To ssh://localhost:29418/x/test-project\n   * [new tag]         0.0.1 -\u003e 0.0.1",
      "parentUuid": "577136a4_7a49e326",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50a4daac_224380ce",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T08:53:06Z",
      "side": 1,
      "message": "Could you also add a test that checks createSignedTag permissions, and that as such fails before your fix?",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b1a59c5a_09232685",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T08:54:12Z",
      "side": 1,
      "message": "Sorry, I didn\u0027t read your comments until after I posted this comment.\nMy bad.",
      "parentUuid": "50a4daac_224380ce",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e75fd6c4_3eca3453",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T09:09:35Z",
      "side": 1,
      "message": "There\u0027s currently only one test that checks that you aren\u0027t allowed to push a signed tag when you don\u0027t have any create permission for tags  [1].\nGiven the changes in JGIT it\u0027s not valid anymore.\nI\u0027m not that well versed into the signing/certificate parts but PushCertificateCheckerTest could offer some idea as to how to set up the test for signed tag [2].\n\n[1] https://gerrit.googlesource.com/gerrit/+/refs/tags/v3.4.3/javatests/com/google/gerrit/acceptance/rest/project/TagsIT.java#325\n[2] https://gerrit.googlesource.com/gerrit/+/refs/tags/v3.4.3/javatests/com/google/gerrit/gpg/PushCertificateCheckerTest.java",
      "parentUuid": "f8e19c1f_beb96575",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "046ed16a_b2c226b4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-01-26T16:07:42Z",
      "side": 1,
      "message": "Edwin looks like the most recent active person on those tests, CC\u0027ing him. I\u0027d be happy to have a test added, but this fix looks good and Clark\u0027s testing looks sufficient for me to +2.",
      "parentUuid": "e75fd6c4_3eca3453",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "02a10c49_e860f4eb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1011217
      },
      "writtenOn": "2022-01-26T17:42:00Z",
      "side": 1,
      "message": "Thank you for those pointers. It looks like the existing tests in [1] rely on the Gerrit API to create tags for the tests. That single test method for signed tags is merely verifying that the gerrit api is unable to created a signed tag (I think because it doesn\u0027t have the gpg secret necessary to do so).\n\nTo test this properly we would need to set up a GPG key which [2] has hints towards, then create a tag directly, and finally push that to Gerrit to check the ACLs?\n\nLooking at this I\u0027m quickly feeling out of my depth. I\u0027m happy to wait and see if Edwin would like to help out before submitting this, but I doubt I\u0027ll be able to do all of that myself.\n\nIs there any guidance on when it is appropriate to submit? With our Gerrit installation the reviewers do that for us via the CI system not the submitter. Still trying to learn what the expectations are on this code base.",
      "parentUuid": "046ed16a_b2c226b4",
      "revId": "36021469c3a6dd4b8e075628e31dd0dce28fda94",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}