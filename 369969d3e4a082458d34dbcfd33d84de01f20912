{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9e751b41_b9eeb7db",
        "filename": "polygerrit-ui/app/constants/reporting.ts",
        "patchSetId": 1
      },
      "lineNbr": 136,
      "author": {
        "id": 1139611
      },
      "writtenOn": "2023-04-25T09:27:40Z",
      "side": 1,
      "message": "Please use a better name than \u0027GENERIC\u0027.\n\nMaybe: WINDOW_VISIBLE or USER_ACTIVE.",
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3130a607_4338d8e1",
        "filename": "polygerrit-ui/app/constants/reporting.ts",
        "patchSetId": 1
      },
      "lineNbr": 136,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2023-04-25T11:18:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9e751b41_b9eeb7db",
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f68487c2_47d3c3a9",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 213,
      "author": {
        "id": 1148215
      },
      "writtenOn": "2023-04-25T09:44:42Z",
      "side": 1,
      "message": "I think this is a bit more complicated than it needs to be.\n\nI would suggest\n1) All handlers just add event to `this.interactionEvents`\n2) There is a single setInterval that clears the set and reports if non-empty\n\nIt has a drawback that inactive page has timer running, but that seems very minor. The benefits are, you don\u0027t need to keep track of timers, debounce events, keep track of the latest interaction.",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 25
      },
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54ae4435_0fd8bfc6",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 213,
      "author": {
        "id": 1083880
      },
      "writtenOn": "2023-04-25T10:13:56Z",
      "side": 1,
      "message": "+1 and optionally report early if `interactionEvents` exceeds a certain size, to address Chris\u0027s concern about active users generating a massive amount of events within 30 seconds.\n\nIf the running timer is a concern (likely not in terms of scripting time, but maybe for tab snoozing or similar things) you could always stop the interval in `report()` and recreate it in `maybeReport()` when it\u0027s missing, which is still less manual bookkeeping than the timing calculations right now.",
      "parentUuid": "f68487c2_47d3c3a9",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 25
      },
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2daa4a4c_f590d87e",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 213,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2023-04-25T11:18:03Z",
      "side": 1,
      "message": "Ha! My first version was actually using `setInterval()` exactly as you suggest. But I did not like it very much, because I don\u0027t want to have a timer running in the background, especially when the visibility state of the document is hidden.\n\nIf I stop and re-create the interval in `maybeReport()`, then I still need the same bookkeeping, no?\n\nAnother benefit of not using a `setInterval()` timer is that I report the event right away instead of potentially waiting 29 seconds until the interval timer fires.\n\nI am generally very much in favor of simplicity, but I must admit that I find these 50 lines straightforward to read. I have been extra verbose in variable naming in `maybeReport()` to make it very easy to follow. Does it feel complex to you?\n\nI actually don\u0027t care much, which solution we choose, but the currently implemented solution is done and working, so I am a bit reluctant to invest the extra 30 minutes going back to my initial implementation and testing that.\n\nSorry, I feel bad for pushing back here. Let me honestly know what you think.",
      "parentUuid": "54ae4435_0fd8bfc6",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 25
      },
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "999f2624_4465abf5",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 213,
      "author": {
        "id": 1148215
      },
      "writtenOn": "2023-04-25T11:28:01Z",
      "side": 1,
      "message": "Alright, let\u0027s keep it. Personally, I don\u0027t see timer running as a big drawback (how bad a timer that executes once a 30 seconds can be), which is why is why I am in favor of a simpler solution. But I agree it\u0027s not like this solution is very hard to understand.",
      "parentUuid": "2daa4a4c_f590d87e",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 25
      },
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c6769aef_e9a0ed2c",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 213,
      "author": {
        "id": 1083880
      },
      "writtenOn": "2023-04-25T12:12:03Z",
      "side": 1,
      "message": "I am confused as to why `setInterval()` would have more waiting, don\u0027t you also wait 29 seconds in case there is a user event one second after you reported something? In any case, logging is always delayed from when the thing happened, so you want to timestamp events anyway and probably rely on something like `navigator.sendBeacon()` to send events robustly ahead of the page being closed.\n\nI meant that one variable to track whether `setInterval()` is less code than the timing calculations you have right now, but it\u0027s not a super strong opinion.\n\nIn terms of complexity, I think it\u0027s a bit more obvious when you have one thing that just unconditionally appends to a collection and another thing that just regularly empties it, but again, not a huge concern.",
      "parentUuid": "999f2624_4465abf5",
      "range": {
        "startLine": 213,
        "startChar": 6,
        "endLine": 213,
        "endChar": 25
      },
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "445ce884_e2a1beef",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 244,
      "author": {
        "id": 1139611
      },
      "writtenOn": "2023-04-25T09:30:09Z",
      "side": 1,
      "message": "Don\u0027t you want to keep track of this timeout so you don\u0027t set multiple timeouts?",
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f93b9cbc_18051136",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 244,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2023-04-25T11:18:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "445ce884_e2a1beef",
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f9477de7_2f980c72",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 256,
      "author": {
        "id": 1139611
      },
      "writtenOn": "2023-04-25T09:32:23Z",
      "side": 1,
      "message": "This risks getting very large for active users?",
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c12211fd_9c868ffa",
        "filename": "polygerrit-ui/app/services/gr-reporting/gr-reporting_impl.ts",
        "patchSetId": 1
      },
      "lineNbr": 256,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2023-04-25T11:18:03Z",
      "side": 1,
      "message": "No, `interactionEvents` is a set and can only contain at most 5 different entries.",
      "parentUuid": "f9477de7_2f980c72",
      "revId": "369969d3e4a082458d34dbcfd33d84de01f20912",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}