{
  "pushCert": "certificate version 0.1\npusher A0D0EF51 1494341218 +0200\nnonce APbwY4qT/49bLkl+0RarUw8ah0FhpXEwStWuuxFxfNujDayNOzpNDggRSHtHvg9Nuijc3NXxFKQl\n\n0000000000000000000000000000000000000000 bf41c980e02acf4fa3dc7cee30f8595ae47e9227 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJZEdZiAAoJEFG1/Zeg0O9RAgsH/0M8YoXHsGWv6NZTyviXFylL\nRlHjP330IT2oquoDv26x6p4YYJRBZHG+gLdL5UPfdqM6kIW0ycv9M2zacecas/ZI\n8mD4NwvdbgIca5bUH+5JAQhBxfdbAdhBQ7lkebm3GLEkC3mEWMQmwRM68922v/ur\nW+208fX4I2TenWM/wFPN8/kSO7ldwqcqAXE3f5MZTvsL+LuHdOLpwbxyKOMFRHBR\nDwoiomqqRzY/TcqTDRN8r4A/FmJDzn2ToIbQagRC3l20/plo2iE+pzHwzsWq0gCP\n2gIZdkhwK9TalZmzbfXsFewRMddf/+yj14YSIYwF9Ywnwg8D+6RHD3IrHnaTLYE\u003d\n\u003dP7ek\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "3785f9ed_1d71215c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-05-10T15:14:10Z",
      "side": 1,
      "message": "Not sure where you\u0027re going with this. Currently we have a hard-coded test class for each version we want to support, so we don\u0027t need to control this via the environment.\n\nAre you planning on converting our internal tests so we don\u0027t have to hard code it anymore?\n\nAlso, if so, remember we can\u0027t set environment variables in BUILD rules, we can only do system properties (which is why we did https://gerrit-review.googlesource.com/94054)",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b9aa8cd_84980fa2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-05-10T15:16:09Z",
      "side": 1,
      "message": "When we import Gerrit we execute the upstream tests. The idea is to set our current index version for this test run.",
      "parentUuid": "3785f9ed_1d71215c",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7b30cb2_946a39b1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-05-10T15:20:33Z",
      "side": 1,
      "message": "The Lucene tests, you mean? If we find a bug in the Lucene tests when importing the code, that means there is a real bug upstream that we missed. Wouldn\u0027t it be better to just run the tests on GerritForge CI so we can discover and fix the bug before it gets submitted?",
      "parentUuid": "0b9aa8cd_84980fa2",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a0527eb_e21cf72a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-05-10T15:24:55Z",
      "side": 1,
      "message": "Related question: Why only 2 tests per execution, instead of just running it for all schema versions? Is the problem that ConfigSuite requires one hard-coded method per config? We can probably improve ConfigSuite to support something like:\n\n @ConfigSuite.Configs\n public static Map\u003cString, Config\u003e configs() {\n   return ImmutableMap.of(\"name1\", cfg1, \"name2\", cfg2);\n }\n\n(I guess speed is potentially also a concern?)",
      "parentUuid": "b7b30cb2_946a39b1",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f077d9ab_6a6029d1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-05-10T15:25:39Z",
      "side": 1,
      "message": "GerritForge CI executes the Lucene query tests against the latest schema version and the second last schema version. This should already catch most of the issues. However we may still run on an even older index version internally. So when we import upstream Gerrit, we can run the Lucene tests against exactly this index version that we use internally. GerritForge CI doesn\u0027t know which index version we currently use internally and it can\u0027t run the test against all possible old index versions (because this would take too long).",
      "parentUuid": "b7b30cb2_946a39b1",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a7af035e_3ecd2c1f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-05-10T15:28:37Z",
      "side": 1,
      "message": "I haven\u0027t looked whether this is possible, because I was concerned about the performance impact (but I haven\u0027t done any measurements). But yes, ideally we would run the tests against all index versions.",
      "parentUuid": "8a0527eb_e21cf72a",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "94167f7a_fc2bfb5c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-05-10T15:42:21Z",
      "side": 1,
      "message": "I shouldn\u0027t have been so hesitant in my wording, I agree that speed is definitely a concern. Right now the query_tests target takes ~1m on my workstation; even if we split each version into its own java_test, we are limited by parallelism on one machine.\n\nSo I think in an *ideal* world we would be able to run all versions on GerritForge CI, but we don\u0027t have a distributed build architecture in place, so we have to limit it. Whereas internally at Google we do have the architecture, so we should be able to run everything.\n\nBut this way of running exactly 2 versions per test class seems a little hacky. It\u0027s wasteful in the sense that in order to run N old versions, we also have to run the current version N times.\n\nI would prefer if we could specify exactly the set of versions that we want to run, like:\n\n CHANGES_INDEX_VERSIONS\u003dcurrent,previous,42\n\nor\n\n CHANGES_INDEX_VERSIONS\u003dall\n\nand combine that with dynamic ConfigSuite support.",
      "parentUuid": "a7af035e_3ecd2c1f",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 27,
        "endChar": 62
      },
      "revId": "378811f54e45b92f94dfc122c912be435e31c7b2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}