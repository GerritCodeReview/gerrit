{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "7f5ca1a9_ba14a9c3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "Might be worth adding a section in the documentation: Documentation/metrics.txt",
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff0e1d8c_3148b1ae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-05T16:42:24Z",
      "side": 1,
      "message": "This change can be cleanly cherry-picked to stable-3.1 branch, so may be move this change there?",
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3698ece3_9cc5916c",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 127,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "Might be useful to add the unit",
      "range": {
        "startLine": 127,
        "startChar": 54,
        "endLine": 127,
        "endChar": 55
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "92513e12_2efc7743",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 127,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:23:40Z",
      "side": 1,
      "message": "Isn\u0027t it done at L129 already?\n\nWith regards to the Description, I believe it isn\u0027t the right place as all metrics of latencies in Gerrit have the same unit.\n\nIt would make more sense to add one documentation update for that for all metrics on Documentation/metrics.txt.\n\nWhat do you think?",
      "parentUuid": "3698ece3_9cc5916c",
      "range": {
        "startLine": 127,
        "startChar": 54,
        "endLine": 127,
        "endChar": 55
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2a920215_4c5e6934",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 127,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T20:59:01Z",
      "side": 1,
      "message": "\u003e Isn\u0027t it done at L129 already?\n\u003e \n\nI think you are right\n\n\u003e With regards to the Description, I believe it isn\u0027t the right place as all metrics of latencies in Gerrit have the same unit.\n\u003e \n\u003e It would make more sense to add one documentation update for that for all metrics on Documentation/metrics.txt.\n\u003e \n\u003e What do you think?\n\nMakes sense",
      "parentUuid": "92513e12_2efc7743",
      "range": {
        "startLine": 127,
        "startChar": 54,
        "endLine": 127,
        "endChar": 55
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18a05e15_325df9eb",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 134,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "Might be useful to add the unit",
      "range": {
        "startLine": 134,
        "startChar": 75,
        "endLine": 134,
        "endChar": 76
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc55bf57_3462863f",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 134,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:23:40Z",
      "side": 1,
      "message": "Same as above.",
      "parentUuid": "18a05e15_325df9eb",
      "range": {
        "startLine": 134,
        "startChar": 75,
        "endLine": 134,
        "endChar": 76
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e83b1882_dbb9240b",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 134,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T20:59:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dc55bf57_3462863f",
      "range": {
        "startLine": 134,
        "startChar": 75,
        "endLine": 134,
        "endChar": 76
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d7ffbd9_4b49f99a",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 141,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "Might be useful to add the unit",
      "range": {
        "startLine": 141,
        "startChar": 85,
        "endLine": 141,
        "endChar": 86
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "abbd07f2_388d1fa9",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 141,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:23:40Z",
      "side": 1,
      "message": "Same as above.",
      "parentUuid": "6d7ffbd9_4b49f99a",
      "range": {
        "startLine": 141,
        "startChar": 85,
        "endLine": 141,
        "endChar": 86
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1c51d540_f37242cf",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 141,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T20:59:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "abbd07f2_388d1fa9",
      "range": {
        "startLine": 141,
        "startChar": 85,
        "endLine": 141,
        "endChar": 86
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "75a720de_3dc83879",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "Might be worth keeping a different metric for this one? Maybe with kerberos/login_latency namespace.",
      "range": {
        "startLine": 227,
        "startChar": 33,
        "endLine": 227,
        "endChar": 50
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58f53ac3_3afcec13",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "nit: ignored for consistency with the codebase",
      "range": {
        "startLine": 227,
        "startChar": 24,
        "endLine": 227,
        "endChar": 30
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "050ebc9a_a5ab4cea",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:40:45Z",
      "side": 1,
      "message": "Metrics are very expensive in terms of payload and having a metric that is there with always a zero value (Kerberos auth for LDAP) won\u0027t be helpful.\n\nAlso with Kerberos, it is still an LDAP authentication so the login metrics is appropriate here I believe.",
      "parentUuid": "75a720de_3dc83879",
      "range": {
        "startLine": 227,
        "startChar": 33,
        "endLine": 227,
        "endChar": 50
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "81a8531e_23c1938b",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:40:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "58f53ac3_3afcec13",
      "range": {
        "startLine": 227,
        "startChar": 24,
        "endLine": 227,
        "endChar": 30
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a30c3544_3415908d",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 247,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "nit: ignored for consistency with the codebase",
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c6a89dc2_0498e06c",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 247,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:40:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a30c3544_3415908d",
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97b0dd23_841b50a8",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-05T16:40:59Z",
      "side": 1,
      "message": "This is long running action, so it should be also recorded? May be:\n\n  try (Timer0.Context ignored \u003d groupSearchLatencyTimer.start()) {\n          for (LdapQuery.Result r : groupMemberQuery.query(ctx, params)) {\n            recursivelyExpandGroups(groupDNs, schema, ctx, r.getDN());\n          }\n        }\n\nIn that case we wouldn\u0027t differentiate, though, between group lookup and recursive group resolution. Alternatively add a dedicated metric just for that?",
      "range": {
        "startLine": 331,
        "startChar": 10,
        "endLine": 331,
        "endChar": 68
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "081bc04c_e46658f0",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:40:45Z",
      "side": 1,
      "message": "The expansion of groups does not interact with the LDAP server, hence it isn\u0027t technically part of the LDAP group query metric.\n\nLet me trace it as a separate metric as it would be potentially impacting the E2E latency for deep groups nesting.",
      "parentUuid": "97b0dd23_841b50a8",
      "range": {
        "startLine": 331,
        "startChar": 10,
        "endLine": 331,
        "endChar": 68
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "df9f3731_736f2586",
        "filename": "java/com/google/gerrit/server/auth/ldap/Helper.java",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-06T08:15:35Z",
      "side": 1,
      "message": "But it\u0027s using DirContext, so that it actually interacts with LDAP:\n\n  private void recursivelyExpandGroups(\n      final Set\u003cString\u003e groupDNs,\n      final LdapSchema schema,\n      final DirContext ctx,\n      final String groupDN) {\n  [...]",
      "parentUuid": "081bc04c_e46658f0",
      "range": {
        "startLine": 331,
        "startChar": 10,
        "endLine": 331,
        "endChar": 68
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "df0a1303_51e98134",
        "filename": "java/com/google/gerrit/server/auth/ldap/LdapGroupBackend.java",
        "patchSetId": 2
      },
      "lineNbr": 219,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-05T16:26:51Z",
      "side": 1,
      "message": "What if we measure it consistently on the caller sites and don\u0027t pass in the metric instance to query, something like:\n\n  try (Timer0.Context ignored \u003d helper.getGroupSearchLatencyTimer().start()) {\n            for (LdapQuery.Result res : query.query(ctx, params)) {\n              out.add(groupReference(schema.groupName, res));\n            }\n          }\n\nHere and in other places.",
      "range": {
        "startLine": 216,
        "startChar": 10,
        "endLine": 219,
        "endChar": 11
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "009be6f7_da41ec99",
        "filename": "java/com/google/gerrit/server/auth/ldap/LdapGroupBackend.java",
        "patchSetId": 2
      },
      "lineNbr": 219,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:23:40Z",
      "side": 1,
      "message": "We could BUT we won\u0027t measure the LDAP search latency because extra code is involved which could have added extra latency.\n\nWhen you measure you typically want to reduce the errors to the measurements to a minimum.",
      "parentUuid": "df0a1303_51e98134",
      "range": {
        "startLine": 216,
        "startChar": 10,
        "endLine": 219,
        "endChar": 11
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e26c0b9e_8823fd22",
        "filename": "java/com/google/gerrit/server/auth/ldap/LdapQuery.java",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "What happens when you call multiple time `start` on the same Timer as in this case?\n\ntimer.start() is called here and in the method caller as well.",
      "range": {
        "startLine": 72,
        "startChar": 33,
        "endLine": 72,
        "endChar": 49
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e82ec221_626a1830",
        "filename": "java/com/google/gerrit/server/auth/ldap/LdapQuery.java",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-05-05T16:01:34Z",
      "side": 1,
      "message": "nit: ignored for consistency with the codebase",
      "range": {
        "startLine": 72,
        "startChar": 24,
        "endLine": 72,
        "endChar": 30
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "761c6560_b01b7c29",
        "filename": "java/com/google/gerrit/server/auth/ldap/LdapQuery.java",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:23:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e82ec221_626a1830",
      "range": {
        "startLine": 72,
        "startChar": 24,
        "endLine": 72,
        "endChar": 30
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6b3a3ea4_a60f7d90",
        "filename": "java/com/google/gerrit/server/auth/ldap/LdapQuery.java",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-05T20:23:40Z",
      "side": 1,
      "message": "Good catch: it needs to be measured only here and NOT on the caller.\nThanks for the feedback, going to fix it in the next PS.",
      "parentUuid": "e26c0b9e_8823fd22",
      "range": {
        "startLine": 72,
        "startChar": 33,
        "endLine": 72,
        "endChar": 49
      },
      "revId": "37e5614f4505b02a28df5dee56d31151e2ce49bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}