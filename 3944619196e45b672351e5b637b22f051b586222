{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4cc51421_101f7289",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 11,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-22T17:42:26Z",
      "side": 1,
      "message": "So this will run promises, but it will not use their result. Just measure how long it took and start some usage?",
      "range": {
        "startLine": 11,
        "startChar": 35,
        "endLine": 11,
        "endChar": 36
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "02a21266_77310c8d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 11,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-22T19:03:29Z",
      "side": 1,
      "message": "Yes exactly.",
      "parentUuid": "4cc51421_101f7289",
      "range": {
        "startLine": 11,
        "startChar": 35,
        "endLine": 11,
        "endChar": 36
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "abc8fb5b_996927b9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-22T17:42:26Z",
      "side": 1,
      "message": "I am little bit out of context in this change, so I have a few questions.",
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff4de994_444b79cd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-23T07:44:29Z",
      "side": 1,
      "message": "I think this whole could be implemented better with more readable code. I am removing myself as reviewer.",
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c562361_f73ba9ad",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-10-23T08:45:04Z",
      "side": 1,
      "message": "This code send request and does nothing with result.\nIs it intended?\nEither add comments, why this code exists or remove it.",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ce9e964_c141cdcb",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-23T11:29:45Z",
      "side": 1,
      "message": "The whole purpose of the change is to make requests and not do anything with the result since we are tracking latency.\nWhy this code exists is explained in the commit message(I hoped). Anyone can look at the blame and see the purpose of this code.\nLet me know if you think that is not enough, as the comment will simply be repeating the commit message",
      "parentUuid": "7c562361_f73ba9ad",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96f537ec_d01df5a6",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-10-23T15:47:53Z",
      "side": 1,
      "message": "Could you please explain, why do you want to make a frontend change to measure latency?\nThere is another options to do it - run a separate script and measure ported comments api performance by calling endpoint multiple times for different changes.\nThen you can compare it with diff view timings and get some numbers to make some decisions.",
      "parentUuid": "0ce9e964_c141cdcb",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "59328c58_461e8851",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-26T09:57:41Z",
      "side": 1,
      "message": "Yeah this is then questioning the entire change itself and is perhaps coming a bit too late in the review cycle.\nI am not sure how the script would work but since I wanted to measure latency, I decided to make the API request.\n\nhttps://gerrit-review.googlesource.com/c/gerrit/+/281299/comment/d9838def_033dda34/ has some extra context regarding the motivation\n\nHow do you want to proceed here then?",
      "parentUuid": "96f537ec_d01df5a6",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f294628_585433e1",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-10-26T10:29:03Z",
      "side": 1,
      "message": "I am happy with measuring the real latency in the running app. That yields more robust data.\n\nBut I would recommend making the call closer to `loadAll()` in GrCommentApi. That is where all the other comments are loaded. And what we really want to know is not how long the ported comments take to load, but how much longer they take compared to loading all other comments.\n\nIs PortingCommentsDiffLatency expected to be different from PortingCommentsFileLatency? Aren\u0027t those measuring the same thing, just on different pages?",
      "parentUuid": "59328c58_461e8851",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b947153d_9cd9e4bc",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-26T11:16:54Z",
      "side": 1,
      "message": "We need a new API request every time patchNum is changed so I\u0027m not sure we can have that closer to loadAll() since that is not dependent on the patchNum.\n\nThis is how the API request will be made when loading porting comments so that is the latency number we are getting.\n\nUsing two different labels was due to https://gerrit-review.googlesource.com/c/gerrit/+/285360/comment/76ae7b99_fb830b4c/.",
      "parentUuid": "8f294628_585433e1",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c152869_662f531d",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-10-26T15:08:36Z",
      "side": 1,
      "message": "All comment loading should be done in GrCommentApi. It has a bad name, but it is actually the \"service\" for comments.\n\nFor gr-diff-view loading the ported comments is already fairly close to `this._loadComments()`. For the change-view the loading should be moved to gr-change-view, and I think it could also be close to `this._reloadComments()`.\n\nI understand that you would like to reload the ported comments also if just the patchset changes.\n\nMy most important point is that what we want to measure is the time from \"normal comments are loaded (and all other normal promises are resolved)\" until \"ported comments are loaded\". We need to understand the amount of *additional* latency that the users have to suffer.",
      "parentUuid": "b947153d_9cd9e4bc",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51ce8a10_2b17cc11",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-26T20:10:26Z",
      "side": 1,
      "message": "The comment before it said move it to gr-change-view so I made the API request observing on _changeNum and _patchRange properties of gr-change-view.\n\nThe *additional* latency does make sense and would be the ideal metric but I\u0027m not sure how it fits with porting comments being loaded per patchset.",
      "parentUuid": "3c152869_662f531d",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b16f89b8_289d4135",
        "filename": "polygerrit-ui/app/elements/change/gr-file-list/gr-file-list.ts",
        "patchSetId": 4
      },
      "lineNbr": 488,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-10-28T14:28:31Z",
      "side": 1,
      "message": "The idea was to have gr-change-view call the comment service and the comment service call the rest api service. But not so important right now. You can leave as is in that regard.\n\nWhy does it matter whether ported comments are loaded per patchset? Don\u0027t we still want the *additional* latency? I am fine with tracking both actually. But the latency of just making the rest api call you can also look up in the weblog. You don\u0027t need frontend reporting for that.\n\nMy concern is that the median of the absolute latency is maybe 300 ms, and if that is all *additional* latency, then this is too much. But maybe the additional latency median is just 100 ms, and then it is ok.\n\nBtw, it would also be interesting to track how often ported comments are requested for the latest patchset compared to earlier patchsets. If we are successful with porting comments to the latest patchset, then I would hope that looking at earlier patchsets becomes a long tail usecase. If that is true, then we could even consider not supporting ported comments to earlier patchsets. That would make loading and prefetching much easier.",
      "parentUuid": "51ce8a10_2b17cc11",
      "range": {
        "startLine": 483,
        "startChar": 0,
        "endLine": 488,
        "endChar": 9
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c191cfc4_591bf8a5",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1066,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-22T17:42:26Z",
      "side": 1,
      "message": "I am not expert in Promises, but I think you can have very different timings in this two scenarios:\n\ntime()\nportedCommentsPromise() will start running\nPromise.all(promises) will start running\n.then( TimeEnd())\n\nvs\n\ntime()\nPromise.all will start running\n.then(\n   portedCommentsPromise() will start running\n   .then (timeEnd())\n)",
      "range": {
        "startLine": 1066,
        "startChar": 24,
        "endLine": 1066,
        "endChar": 54
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "58bdcf78_669134b5",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1066,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-22T19:03:29Z",
      "side": 1,
      "message": "In the end I mainly want to measure how long does it take before we have the response in diff/change view and that will not exactly compare to the API time.\nIf it takes 200ms for the API to return but it is waiting 300ms before requesting, then the actual number I want is 500ms and not 200ms.",
      "parentUuid": "c191cfc4_591bf8a5",
      "range": {
        "startLine": 1066,
        "startChar": 24,
        "endLine": 1066,
        "endChar": 54
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d5da8831_2947e14f",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1098,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-22T15:19:14Z",
      "side": 1,
      "message": "You created this if because you expect changeNum is not set in params? But it can happen that this_changeNum is also not set.\n\n// AppElementDiffViewParam ensures _changeNum is set\nCan you explain why?",
      "range": {
        "startLine": 1098,
        "startChar": 13,
        "endLine": 1098,
        "endChar": 34
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b5f82303_7a534806",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1098,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-22T19:03:29Z",
      "side": 1,
      "message": "I created this because patchNum is not set in the params when we are loading /comment/{commentId}. In all other cases we have patchNum and changeNum in the url.\n\nAppElementDiffViewParam has changeNum as a non-optional property, hence it ensures that it is set. \n`this._changeNum \u003d value.changeNum`\nThis line is executed always before this one.\n\nI am also not sure how diff view can be loaded when there is no changeNum,",
      "parentUuid": "d5da8831_2947e14f",
      "range": {
        "startLine": 1098,
        "startChar": 13,
        "endLine": 1098,
        "endChar": 34
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "900e203a_b1f8e5d2",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1098,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-23T05:01:10Z",
      "side": 1,
      "message": "Oh, I see. On line if 1060 you could have commentLink and not patchnum (!value.patchNum \u0026\u0026 !value.commentLink).\n\nOk, but still line 1067 can be change (`if (value.changeNum \u0026\u0026 value.patchNum) {`)\nto `if (value.patchNum)`\n\nsince\nvalue.changeNum cannot be undefined, so the check doesn\u0027t make sense.",
      "parentUuid": "b5f82303_7a534806",
      "range": {
        "startLine": 1098,
        "startChar": 13,
        "endLine": 1098,
        "endChar": 34
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8d859833_7461d0e5",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1098,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-23T07:03:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "900e203a_b1f8e5d2",
      "range": {
        "startLine": 1098,
        "startChar": 13,
        "endLine": 1098,
        "endChar": 34
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76ae7b99_fb830b4c",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1107,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-10-23T08:45:04Z",
      "side": 1,
      "message": "If porting comments API is slow, you can get the following sequence of events:\nfile list reload:\n  time(PORTING_COMMENTS_LATENCY_LABEL)\n  send request A\na user clicks on a file, diff view is opened.\n  diff view _paramsChanged:\n  time(PORTING_COMMENTS_LATENCY_LABEL)\n  send request B\n\nrequest A finishes, timeEnd(PORTING_COMMENTS_LATENCY_LABEL) in gr-file-list.\n...\nrequest B finishes, timeEnd(PORTING_COMMENTS_LATENCY_LABEL) in gr-diff-view\n\nAs a result, gerrit reports time between sending request B and finishing request A.\n\nI see 2 solutions:\na) stop timer when user changes view (not sure that it is easy to do)\nb) Use different labels in diff-view and file-list\n\nAnother problem, what if a user selects different patchset while porting comments are loading? It can lead to a similar problem inside _paramsChanged method. Not sure how to solve it correctly.\n\n@milutin any ideas/solutions?",
      "range": {
        "startLine": 1107,
        "startChar": 33,
        "endLine": 1107,
        "endChar": 63
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50804d2e_878c8a04",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1107,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-10-23T08:46:31Z",
      "side": 1,
      "message": "that\u0027s nice catch. I would suggest 2 different labels.",
      "parentUuid": "76ae7b99_fb830b4c",
      "range": {
        "startLine": 1107,
        "startChar": 33,
        "endLine": 1107,
        "endChar": 63
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a196ddbf_dfd7a7bf",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.ts",
        "patchSetId": 4
      },
      "lineNbr": 1107,
      "author": {
        "id": 1083225
      },
      "writtenOn": "2020-10-23T11:29:45Z",
      "side": 1,
      "message": "Used 2 labels.\n\nRe issue of changing patchsets, I decided to store the patchset when request was made and compare it with current patchset when reporting was being done.\nIf it turns out to be different, then I do not report that time.",
      "parentUuid": "50804d2e_878c8a04",
      "range": {
        "startLine": 1107,
        "startChar": 33,
        "endLine": 1107,
        "endChar": 63
      },
      "revId": "3944619196e45b672351e5b637b22f051b586222",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}