{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "17572c5f_836094e7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2021-09-30T12:35:06Z",
      "side": 1,
      "message": "Didn\u0027t we first want to check if we the accounts cache is simply disabled/set to zero and we can enable it?",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e81578b3_71b06730",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-09-30T12:48:14Z",
      "side": 1,
      "message": "Even if it is the case, the AccountCache still fetches from All-Users on each request, for default preferences and per-user ref tip [1].\n\nI would like to have this option, to compare to be able to compare the results of different configuration runs. I want to add this first to finally have a dry run result on the stuck hosts and see if there are other blockers.\n\nhttps://gerrit.googlesource.com/gerrit/+/refs/heads/master/java/com/google/gerrit/server/account/AccountCacheImpl.java#111",
      "parentUuid": "17572c5f_836094e7",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "409d597e_515be734",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2021-10-01T07:06:03Z",
      "side": 1,
      "message": "I don\u0027t think reading All-Users takes very long, because the Wipeout Flume does this too and it finishes in ~1h very consistently. I\u0027m a bit concerned that this change is complex and it wouldn\u0027t be needed if either the cache works effectively or you prefetch all users.\n\nWouldn\u0027t it be just a few lines to enable the cache?",
      "parentUuid": "e81578b3_71b06730",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef8ca576_031055e5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-10-01T09:01:58Z",
      "side": 1,
      "message": "I think the difference is that the Wipeout Flume is doing it once, on sturtup. Here it would happen on each request to account\u0027s cache, which is multiple times per change, per project. That is why my next step is side-loading accounts instead of using accounts cache.",
      "parentUuid": "409d597e_515be734",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd84a5e3_74b55b08",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-10-01T09:04:40Z",
      "side": 1,
      "message": "Just to be clear: I am not opposed to the idea to enable the cache. I just don\u0027t think it will add much of improvement.\n\nIs the a reason why I can\u0027t both have this option and enable cache to compare the results?",
      "parentUuid": "ef8ca576_031055e5",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b482950_4d93707f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2021-10-04T08:31:27Z",
      "side": 1,
      "message": "The option (i.e. this change) adds a certain amount of complexity to the code. If enabling the cache is already sufficient, then we could avoid that. I was under the impression that enabling the cache is straightforward. Is there a reason not to try that first?\n\nAlso, if you plan to add sideloading anyway, and we know from the Wipeout job that that will be fast enough, wouldn\u0027t that make this change obsolete?\n\nMaybe I\u0027m missing something here; how about we have a quick f2f chat in the standup today?",
      "parentUuid": "fd84a5e3_74b55b08",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "630b145f_7e757818",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-10-04T11:26:36Z",
      "side": 1,
      "message": "Thanks for looking again!\n\nI indeed checked the account cache is enabled. I split the change in case it would be easier to review.\n\nI would prefer to have this option, in case side-loading is slow too or I find more edge-cases that are hard to handle with matching by name/email.",
      "parentUuid": "7b482950_4d93707f",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2d5c292_3e30310e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-10-06T09:20:24Z",
      "side": 1,
      "message": "Maria asked me to take a look at the stuck flume.\n\n\u003e Even if it is the case, the AccountCache still fetches from All-Users on each request, for default preferences and per-user ref tip [1].\n\nThis only happens for misses in the persistent cache, which ~never happen. We have to read from the persistent cache, which takes ~5ms on average per load.\n\nIt seems you prefer different solutions. I would like us to understand the problem a bit more and collect more evidence before we decide on a solution. The stack traces I saw suggest RegEx performance slows us down. Can we investigate that first and if it\u0027s not the reason run the job again and look at pprof, stack traces and metrics together? I think there might be something hiding in the bushes that we aren\u0027t yet seeing :-)",
      "parentUuid": "630b145f_7e757818",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3fb6f1f5_4b133bca",
        "filename": "java/com/google/gerrit/server/notedb/CommitRewriter.java",
        "patchSetId": 3
      },
      "lineNbr": 632,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2021-10-01T07:06:03Z",
      "side": 1,
      "message": "I\u0027m not sure if \"Removed A by B\" is correct, but \"A removed by B\" is.",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d19b3ad1_af81adb1",
        "filename": "java/com/google/gerrit/server/notedb/CommitRewriter.java",
        "patchSetId": 3
      },
      "lineNbr": 632,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-10-01T09:01:58Z",
      "side": 1,
      "message": "I would prefer to keep messages close to the originals.\n\nThey have formats:\nRemoved Verified-1 by User Account\n\nThis will either replace with\n\nRemoved Verified-1 by \u003cGERRIT_ACCOUNT_2\u003e\nor\nRemoved Verified-1\n\nSee the tests.",
      "parentUuid": "3fb6f1f5_4b133bca",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5266355a_e4e52236",
        "filename": "java/com/google/gerrit/server/notedb/CommitRewriter.java",
        "patchSetId": 3
      },
      "lineNbr": 632,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-10-04T11:26:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d19b3ad1_af81adb1",
      "revId": "39ea3f1a8c9e2faadb8dab835c39fbac8b731856",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}