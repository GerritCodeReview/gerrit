{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "af888528_cf20654d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-01T00:53:07Z",
      "side": 1,
      "message": "One more addition for making the cache configurable and then it is ready for review.",
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c87a7ac9_919226ea",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-01T01:00:49Z",
      "side": 1,
      "message": "All the AbstractChangeNotesTests are currently failing because the ref-update event isn\u0027t triggered. Need to amend the test to register the event and therefore trigger the thread-local refdb cache cleanup.",
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2eb6875_5a5e7769",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2022-04-01T07:12:14Z",
      "side": 1,
      "message": "There is still sth not correct\n\n1. when one publishes edit on a change in new UI it shows the following error:\n\n  Error 404 (Not Found): Not found: 2\n  Endpoint: /changes/*~*/revisions/*/files?reviewed\n\nbut files is saved properly\n\n2. when one gives `CR+2` it requires a page refresh before it is actually visible but only the first time when change is created (could be related to the previous error)\n\nChecked that on vanilla `stable-2.16` and it works as expected.",
      "parentUuid": "c87a7ac9_919226ea",
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a9230c6_938edde1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-02T10:33:37Z",
      "side": 1,
      "message": "\u003e There is still sth not correct\n\u003e \n\u003e 1. when one publishes edit on a change in new UI it shows the following error:\n\u003e \n\u003e   Error 404 (Not Found): Not found: 2\n\u003e   Endpoint: /changes/*~*/revisions/*/files?reviewed\n\u003e \n\u003e but files is saved properly\n\nBecause the above 404 is a result of a new REST-API call, I guess the cleanup didn\u0027t run in your case? I tried locally and worked as expected for me.\n\nCan we do a joined session on that? Have you tried to add some extra logging? Does it happen systematically or randomly?\n\n\u003e 2. when one gives `CR+2` it requires a page refresh before it is actually visible but only the first time when change is created (could be related to the previous error)\n\nThat also works for me.\n\n\u003e Checked that on vanilla `stable-2.16` and it works as expected.\n\nSure, we need to understand where the cleanup isn\u0027t working as it should.",
      "parentUuid": "a2eb6875_5a5e7769",
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0edd7f4_4a420b88",
        "filename": "java/com/google/gerrit/pgm/http/jetty/JettyServer.java",
        "patchSetId": 12
      },
      "lineNbr": 468,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2022-04-01T07:12:38Z",
      "side": 1,
      "message": "do we still need it?",
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dcba268a_7617c04b",
        "filename": "java/com/google/gerrit/pgm/http/jetty/JettyServer.java",
        "patchSetId": 12
      },
      "lineNbr": 468,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-02T10:33:37Z",
      "side": 1,
      "message": "I guess so, as we need to call the cleanup in all JettyServer-managed threads.",
      "parentUuid": "f0edd7f4_4a420b88",
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e88bee2_f4dc2d08",
        "filename": "java/com/google/gerrit/server/notedb/ThreadLocalRepoRefCache.java",
        "patchSetId": 12
      },
      "lineNbr": 42,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-02T12:55:00Z",
      "side": 1,
      "message": "This should be done once per-thread, not once per key.",
      "range": {
        "startLine": 42,
        "startChar": 14,
        "endLine": 42,
        "endChar": 92
      },
      "revId": "3c69f454084081e41e72e3577ec853163f2b5d74",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}