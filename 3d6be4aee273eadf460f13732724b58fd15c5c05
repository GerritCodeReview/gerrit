{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ca70b79b_18c09a3f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-11T16:20:12Z",
      "side": 1,
      "message": "@Han-Wen any objections?",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7fb580d2_eb9eaf5f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2022-04-11T16:32:43Z",
      "side": 1,
      "message": "I want to get another pair of eyes on this. We have a team meeting tomorrow morning, and we\u0027ll get someone to look at this.\n\nI\u0027m personally worried that code executing within a ReadonlyWindow (eg. an event listener) could execute ref updates, which would lead to confusion all around.  Is there a way such that executing a BRU or RU from here would throw an exception?\n\nIs this for some plugin, or does the firing itself trigger the ref loads?",
      "parentUuid": "ca70b79b_18c09a3f",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de393ecb_fdb83d8e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-11T20:23:00Z",
      "side": 1,
      "message": "\u003e I want to get another pair of eyes on this. We have a team meeting tomorrow morning, and we\u0027ll get someone to look at this.\n\u003e \n\u003e I\u0027m personally worried that code executing within a ReadonlyWindow (eg. an event listener) could execute ref updates, which would lead to confusion all around. \n\nLet me check if by narrowing down even further the window would be possible. Bear in mind that the caching happens only when using the Gerrit ChangeNotes class.\n\n\u003e Is there a way such that executing a BRU or RU from here would throw an exception?\n\nI am not following, can you make a real-life example?\n\n\u003e Is this for some plugin, or does the firing itself trigger the ref loads?\n\nNo, this is for Gerrit which does 22 (!) refs lookups for the /meta refs upon posting a comment or scoring a review. If each refs lookup takes 500ms, you would wait as much as 11 seconds for posting a review.",
      "parentUuid": "7fb580d2_eb9eaf5f",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d551118f_6cfa87f4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-11T20:23:00Z",
      "side": 1,
      "message": "Happy to hold this until Han-Wen get someone to review on his side.",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9c5cce3_88566989",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-11T22:11:44Z",
      "side": 1,
      "message": "I have now reduced the scope of the read-only request window to the pure generation of the event data, which was responsible for a high number of /meta refs lookups.\n\nThe execution of the event listeners is now outside the read-only window and therefore safe from any potential stale read.\n\n@Han-Wen does this address your concerns?\n\nThank you again for your review and feedback, much appreciated.",
      "parentUuid": "de393ecb_fdb83d8e",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7c85a2a_501e3a41",
        "filename": "java/com/google/gerrit/server/restapi/change/PostReview.java",
        "patchSetId": 10
      },
      "lineNbr": 948,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-11T21:52:16Z",
      "side": 1,
      "message": "Actually, not *all* the fire of the event is needed to be run inside a read-only request window: covering the creation of the Event would be good enough to provide a significant performance improvement, leaving the `listeners.runEach` out of the window.",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d9d454f0_9645c89f",
        "filename": "java/com/google/gerrit/server/restapi/change/PostReview.java",
        "patchSetId": 10
      },
      "lineNbr": 948,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-04-11T22:11:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a7c85a2a_501e3a41",
      "revId": "3d6be4aee273eadf460f13732724b58fd15c5c05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}