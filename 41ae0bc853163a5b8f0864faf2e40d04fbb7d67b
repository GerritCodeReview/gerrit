{
  "comments": [
    {
      "key": {
        "uuid": "16ca37de_461b128e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 39
      },
      "lineNbr": 16,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T12:30:36Z",
      "side": 1,
      "message": "As pointed out by Dave, this should be just:\n\n  POST /changes/\u003cid\u003e/edit\n\nand passed \n\n* path \u003d \"foo\"\n* restore \u003d true\n\nin request body. And done in follow up change.",
      "range": {
        "startLine": 16,
        "startChar": 2,
        "endLine": 16,
        "endChar": 42
      },
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16ca37de_e67f9e80",
        "filename": "/COMMIT_MSG",
        "patchSetId": 39
      },
      "lineNbr": 16,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T17:56:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "16ca37de_461b128e",
      "range": {
        "startLine": 16,
        "startChar": 2,
        "endLine": 16,
        "endChar": 42
      },
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b64deb11_e7c100ca",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEditResource.java",
        "patchSetId": 39
      },
      "lineNbr": 28,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:18:02Z",
      "side": 1,
      "message": "li doesn\u0027t work outside ol/ul",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b6a7ab22_ab5e0922",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEditResource.java",
        "patchSetId": 39
      },
      "lineNbr": 28,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T17:56:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b64deb11_e7c100ca",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b64deb11_a7d5387e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 96,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:18:02Z",
      "side": 1,
      "message": "I think it is worth repeating in the javadoc for create and post that create is for creating file contents within the edit, and post is modifying the edit itself.",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16ca37de_c6842252",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 96,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T17:56:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b64deb11_a7d5387e",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b64deb11_07766ce6",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 143,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:18:02Z",
      "side": 1,
      "message": "I\u0027m confused how this can work. If you do:\n\n PUT /changes/X/edit/path\n\nand the edit-for-X already exists, edit.isPresent() will return true, so you will always throw this error.\n\nOr am I misreading the handlers? Is this not what gets called for PUT /changes/X/edit/path?",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d6509fa6_7c8599b8",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 143,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-14T19:44:39Z",
      "side": 1,
      "message": "It\u0027s more complex then that. We have two cases:\n\nCase I: edit for change X doesn\u0027t exist, so the call:\n\n  PUT /changes/X/edit/path\n\nends up on the line 89 above and throws resource not found. RestApiServlet detects that case and as (instance of) on the collection (ChangeEdits.class) if it implements AcceptsCreate interface. We do. Then this call ends up on line 147. and edit is created. That check above is just to be sure we are not screwed. May be it is not strictly necessary? Interessting part is on line 148. Whnen path was passed to edit that doesn\u0027t exist yet, it is created first nad then immediately modified (in one REST call).\n\nCase II: edit for change X exists already, so the call:\n\n  PUT /changes/X/edit/path\n\nends up in Put handler below, line 189. That\u0027s because parse() method above find this resource and returns it back.",
      "parentUuid": "b64deb11_07766ce6",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b64deb11_e7658021",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:18:02Z",
      "side": 1,
      "message": "I\u0027m not convinced we want to do this instead of specifying restore through POST /changes/X/edit.\n\nBut on the scale of REST API decisions I\u0027m willing to defer that discussion.\n\nI do think content should be the @DefaultInput however.",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d6509fa6_1c925504",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-14T19:44:39Z",
      "side": 1,
      "message": "| I\u0027m not convinced we want to do this instead of specifying restore through POST /changes/X/edit.\n\nLet\u0027s see if we can do that with curremnt URL concept.\n\nWe have 4 use cases:\n\n* PUT /changes/X/edit/path and edit exists\n* PUT /changes/X/edit/path and edit doesn\u0027t exist\n* POST /changes/X/edit/path and edit exists\n* POST /changes/X/edit/path and edit doesn\u0027t exist\n\nWhen edit exists all is fine. But when it doesn\u0027t then the line 149 above mus decide: what should it call:\n\n* putEdit.apply()\n* postEdit.apply()\n\nUnfortunately we don\u0027t know what kind of METHOD we were calling, so we cannot decide. So we cannot do that with URL approach.",
      "parentUuid": "b64deb11_e7658021",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "164797ed_1ec24d6a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:58:15Z",
      "side": 1,
      "message": "I actually meant POST /changes/X/edit, not /edit/path (or maybe /edit_restore or whatever).\n\nBut we can save this discussion for later.",
      "parentUuid": "d6509fa6_1c925504",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f643e3df_3d4e2f4c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-14T20:51:09Z",
      "side": 1,
      "message": "Oh, i see, that makes sense. So we could create dedicated Post handler and create it above on line 105.\n\nThen we could check in Post.apply() method when the edit doesn\u0027t exist create it, and check the request body for path and restore, and when they are there then we could additionally restore the file. With this in place we could decouple restore from PUT handler as suggested above.",
      "parentUuid": "164797ed_1ec24d6a",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16ca37de_661e0e80",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T12:30:36Z",
      "side": 1,
      "message": "| But we can save this discussion for later.\n\nYes we could, but  we shouldn\u0027t postpone any discussion. This series is pending almost two years for now. And i would like to prevent to have it pending even further. I like your suggestion to decouple PUT and POST requests. So i fÂ´go for it and try to implement it and in addition extract POST handler code from this change.",
      "parentUuid": "164797ed_1ec24d6a",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f618432e_350f1054",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-15T16:59:30Z",
      "side": 1,
      "message": "I think you misunderstand what I mean by \"later\". I mean \"after the series is merged\". Postponing the discussion is intended to decrease the amount of time until it\u0027s merged :)\n\n(I think we can and should ship the feature with the caveat that the REST API is not yet stable and may change in future releases.)",
      "parentUuid": "16ca37de_661e0e80",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16ca37de_063abadf",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 191,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T17:56:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b64deb11_e7658021",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b64deb11_8757dc39",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 193,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:18:02Z",
      "side": 1,
      "message": "Boolean so it\u0027s optional?",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b6a7ab22_eb7f7180",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 193,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T17:56:54Z",
      "side": 1,
      "message": "Using in Post handler now Boolean. Done.",
      "parentUuid": "b64deb11_8757dc39",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b64deb11_2745a87e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 207,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2014-08-14T19:18:02Z",
      "side": 1,
      "message": "It\u0027s illegal to specify both content and restore, so 400 invalid cases.",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b6a7ab22_8b7a2d92",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeEdits.java",
        "patchSetId": 39
      },
      "lineNbr": 207,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-08-15T17:56:54Z",
      "side": 1,
      "message": "Not applicable any more.",
      "parentUuid": "b64deb11_2745a87e",
      "revId": "41ae0bc853163a5b8f0864faf2e40d04fbb7d67b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}