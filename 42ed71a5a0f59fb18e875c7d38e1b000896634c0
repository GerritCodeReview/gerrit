{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "05b445e0_0762d462",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "This might be better:\n\n Add extension point that allows plugins to provide destination address for outgoing emails",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 51
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "caffa23d_3bb0c4f5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Yes, this conveys the intent of the extension point in a clearer way.",
      "parentUuid": "05b445e0_0762d462",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 51
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a6694497_030f01ec",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 10,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "How about:\n\nThis new extension point is helpful when organizations want all outgoing emails from Gerrit sent to a specific address (for example, an alternate registered email) of the user rather than their preferred email.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 18
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9237d878_1bb4346e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 10,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Fixed",
      "parentUuid": "a6694497_030f01ec",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 18
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9287e789_068cd6f1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 12,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "Remove \u0027Impact\u0027 footer.\n\nAdd a \u0027Release-Notes\u0027 footer.",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 66
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d19f1897_ddd91041",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 12,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9287e789_068cd6f1",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 66
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40b24ab2_9e8a6c6b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1013267
      },
      "writtenOn": "2022-06-07T06:49:20Z",
      "side": 1,
      "message": "i suppose this indirectly addresses https://crbug.com/gerrit/2615.\nbut i think that should be core functionality, not an extension point. an XP could be provided for validating addresses at configuration time, though.",
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "30d56867_905b756a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-07T23:39:21Z",
      "side": 1,
      "message": "Thanks for pointing that issue out, I didn\u0027t realize it existed. That actually deals with the issue we want to tackle next (which identity to use for git operations). We have two needs, 1) apply server-wide policy on where emails should be sent (for us, we\u0027ll have a plugin that forces it to go to the user\u0027s LDAP address, not any other registered address), and 2) apply per-repo policy on which registered email address for a user should be used for git author/committer.\n\nThe bug you linked leads me to potentially see adding a user preference for \"Override my preferred email and use this identity for git author/committer instead\" as a core feature and as a step towards #2. I don\u0027t think it applies to #1, which is what this change is working towards.\n\nDoes that help clarify? (we\u0027ll be sure to update the commit message if it does)",
      "parentUuid": "40b24ab2_9e8a6c6b",
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b1b5fdc_b9086436",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1013267
      },
      "writtenOn": "2022-06-08T08:50:38Z",
      "side": 1,
      "message": "\u003e Does that help clarify?\n\nat a high level, it certainly does.\nat the implementation level, the patch seems backwards, as it basically subverts the configuration done in the UI. you\u0027d at least need an additional mechanism to disable/replace the UI. it appears easier to obtain a clean implementation by just relaying it entirely to the configuration (after introducing purpose-bound address settings), though your requirement to make the addresses repo-specific makes this somewhat cumbersome (unless it was a pattern like foo-${repo}@mail.dns).\n\nfwiw, the case which got me interested in this issue was a guy who contributes to qt-project as an employee and consequently needs to present himself as such in commits and the gerrit UI, but wants to use a private address for notifications, as the company\u0027s restrictive security policy makes using the company address somewhat impractical for that. he worked it around by having two gerrit accounts, which is obviously suboptimal.",
      "parentUuid": "30d56867_905b756a",
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef21af85_391158dd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-08T18:44:19Z",
      "side": 1,
      "message": "\u003e \u003e Does that help clarify?\n\u003e \n\u003e at a high level, it certainly does.\n\nglad it helped!\n\n\u003e at the implementation level, the patch seems backwards, as it basically subverts the configuration done in the UI. you\u0027d at least need an additional mechanism to disable/replace the UI.\n\nYes, that\u0027s a missing piece in this change currently and needs to be addressed before it gets +2.\n\n\u003e it appears easier to obtain a clean implementation by just relaying it entirely to the configuration (after introducing purpose-bound address settings), though your requirement to make the addresses repo-specific makes this somewhat cumbersome (unless it was a pattern like foo-${repo}@mail.dns).\n\nWe could maybe add the email sending behavior as an auth configuration setting (it would work for LDAP, not sure about others), but we\u0027d still want the UI disabling you mention above. Is that the kind of configuration you have in mind?\n\n\u003e \n\u003e fwiw, the case which got me interested in this issue was a guy who contributes to qt-project as an employee and consequently needs to present himself as such in commits and the gerrit UI, but wants to use a private address for notifications, as the company\u0027s restrictive security policy makes using the company address somewhat impractical for that. he worked it around by having two gerrit accounts, which is obviously suboptimal.\n\nYeah, that\u0027s not a great setup. I\u0027ll keep in mind when we start #2 later this month.",
      "parentUuid": "3b1b5fdc_b9086436",
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b863d110_8918912c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1013267
      },
      "writtenOn": "2022-06-08T21:02:07Z",
      "side": 1,
      "message": "\u003e Is that the kind of configuration you have in mind?\n\nthe basic UI i have in mind is to extend the current email address table by an additional column of radio buttons, so you\u0027d have \"display email\" and \"notification email\".\n\nwhich emails can be added and/or which selected for which purpose could be restricted by a plugin.\n\nthis would even work if the per-repo addresses followed a pattern, so one could specify a templated address as proposed above. (of course, such addresses could not be confirmed, so they would be inapplicable to notifications.)\n\nnow, if you want to be able to specify arbitrary per-repo addresses, the concept breaks down. instead, you\u0027d need something similar to the notifications table, possibly with support for inheritance like the project configurations. i suppose my prior use of \"cumbersome\" for that UI is a bit of an understatement. 😁\n\nso instead you\u0027d presumably go with the regular table, but have some kind of plugin-provided \"magic\" entry in there, and have the validator hook ensure that this entry is selected as the display address.",
      "parentUuid": "ef21af85_391158dd",
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "648eafb5_550e2afd",
        "filename": "Documentation/dev-plugins.txt",
        "patchSetId": 4
      },
      "lineNbr": 2902,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "How about:\n\nThis extension point allows plugins to provide a preferred destination address for all outgoing emails from Gerrit.",
      "range": {
        "startLine": 2901,
        "startChar": 0,
        "endLine": 2902,
        "endChar": 67
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "67fc2e87_360862f2",
        "filename": "Documentation/dev-plugins.txt",
        "patchSetId": 4
      },
      "lineNbr": 2902,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Fixed",
      "parentUuid": "648eafb5_550e2afd",
      "range": {
        "startLine": 2901,
        "startChar": 0,
        "endLine": 2902,
        "endChar": 67
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b32b4811_635b7c8d",
        "filename": "java/com/google/gerrit/server/email/PreferredNotificationEmailProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 22,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "How about:\n\n Extension point to provide destination address for all outgoing emails from Gerrit.",
      "range": {
        "startLine": 21,
        "startChar": 1,
        "endLine": 22,
        "endChar": 42
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "369b549f_1edbf33d",
        "filename": "java/com/google/gerrit/server/email/PreferredNotificationEmailProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 22,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Fixed",
      "parentUuid": "b32b4811_635b7c8d",
      "range": {
        "startLine": 21,
        "startChar": 1,
        "endLine": 22,
        "endChar": 42
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8c052d21_42e0e511",
        "filename": "java/com/google/gerrit/server/email/PreferredNotificationEmailProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 28,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "How about:\n\n Get preferred destination address for outgoing emails.",
      "range": {
        "startLine": 28,
        "startChar": 0,
        "endLine": 28,
        "endChar": 46
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0cf70e95_468e0afd",
        "filename": "java/com/google/gerrit/server/email/PreferredNotificationEmailProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 28,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Fixed",
      "parentUuid": "8c052d21_42e0e511",
      "range": {
        "startLine": 28,
        "startChar": 0,
        "endLine": 28,
        "endChar": 46
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6e9d7b7_0110ef1f",
        "filename": "java/com/google/gerrit/server/email/PreferredNotificationEmailProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "How about:\n\n The {@code Account} of the user whose destination address is to be obtained",
      "range": {
        "startLine": 30,
        "startChar": 20,
        "endLine": 30,
        "endChar": 89
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b4ac7ee8_5160ecb9",
        "filename": "java/com/google/gerrit/server/email/PreferredNotificationEmailProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "Fixed",
      "parentUuid": "d6e9d7b7_0110ef1f",
      "range": {
        "startLine": 30,
        "startChar": 20,
        "endLine": 30,
        "endChar": 89
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "44c99f91_01ba7ed0",
        "filename": "javatests/com/google/gerrit/acceptance/server/mail/PreferredNotificationEmailProviderIT.java",
        "patchSetId": 4
      },
      "lineNbr": 74,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2022-06-07T06:31:46Z",
      "side": 1,
      "message": "This might be more readable:\n\n ImmutableList\u003cMessage\u003e messages \u003d sender.getMessages();\n assertThat(messages).hasSize(1);\n ImmutableList\u003cAddress\u003e recipients \u003d messages.get(0).rcpt();\n assertThat(recipients.size()).isEqualTo(2);\n Set\u003cString\u003e recipient_emails \u003d recipients.stream().map(a -\u003e \n a.email()).collect(Collectors.toSet());\n assertThat(recipient_emails).contains(SET_BY_PLUGIN + admin.email());\n assertThat(recipient_emails).contains(SET_BY_PLUGIN + user.email());",
      "range": {
        "startLine": 69,
        "startChar": 1,
        "endLine": 74,
        "endChar": 61
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "144ee5fd_4b3b76df",
        "filename": "javatests/com/google/gerrit/acceptance/server/mail/PreferredNotificationEmailProviderIT.java",
        "patchSetId": 4
      },
      "lineNbr": 74,
      "author": {
        "id": 1148825
      },
      "writtenOn": "2022-06-13T18:02:37Z",
      "side": 1,
      "message": "I see how this makes the code clearer.",
      "parentUuid": "44c99f91_01ba7ed0",
      "range": {
        "startLine": 69,
        "startChar": 1,
        "endLine": 74,
        "endChar": 61
      },
      "revId": "42ed71a5a0f59fb18e875c7d38e1b000896634c0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}