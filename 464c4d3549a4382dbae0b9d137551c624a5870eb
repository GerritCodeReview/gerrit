{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8f0723ec_e8e5c076",
        "filename": "java/com/google/gerrit/server/git/receive/ReceiveCommits.java",
        "patchSetId": 5
      },
      "lineNbr": 2846,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2023-03-30T23:11:09Z",
      "side": 1,
      "message": "progress",
      "range": {
        "startLine": 2846,
        "startChar": 58,
        "endLine": 2846,
        "endChar": 65
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0932203_159f36b4",
        "filename": "java/com/google/gerrit/server/git/receive/ReceiveCommits.java",
        "patchSetId": 5
      },
      "lineNbr": 2846,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8f0723ec_e8e5c076",
      "range": {
        "startLine": 2846,
        "startChar": 58,
        "endLine": 2846,
        "endChar": 65
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bcb17982_5526b709",
        "filename": "java/com/google/gerrit/server/restapi/change/PreviewSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 123,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-03-30T14:44:32Z",
      "side": 1,
      "message": "\"... since this exception isn\u0027t thrown for dry-run submits.\"?",
      "range": {
        "startLine": 123,
        "startChar": 18,
        "endLine": 123,
        "endChar": 52
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "23b58b5d_88400cb7",
        "filename": "java/com/google/gerrit/server/restapi/change/PreviewSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 123,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "bcb17982_5526b709",
      "range": {
        "startLine": 123,
        "startChar": 18,
        "endLine": 123,
        "endChar": 52
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e6d984a_887d59c6",
        "filename": "java/com/google/gerrit/server/restapi/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 222,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2023-03-30T23:11:09Z",
      "side": 1,
      "message": "progress",
      "range": {
        "startLine": 222,
        "startChar": 56,
        "endLine": 222,
        "endChar": 63
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "164f503f_4cc3c12b",
        "filename": "java/com/google/gerrit/server/restapi/change/Submit.java",
        "patchSetId": 5
      },
      "lineNbr": 222,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0e6d984a_887d59c6",
      "range": {
        "startLine": 222,
        "startChar": 56,
        "endLine": 222,
        "endChar": 63
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38647a99_470650be",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 128,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-03-30T14:44:32Z",
      "side": 1,
      "message": "This feels like a long time for a user to wait. Personally I\u0027d prefer to get the error after a couple of seconds and try again manually.\nIf that doesn\u0027t makes sense could we make it configurable in a follow-up? Like `change.concurrentSubmitTimeout`?",
      "range": {
        "startLine": 128,
        "startChar": 62,
        "endLine": 128,
        "endChar": 64
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "876836ae_1262a009",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 128,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done.\n\nThere is only one reason to wait at all and that is when Striped tries to get a lock that is being hold by a submit of a different change, which can happen, if the computed hashes for both lock keys are the same. Waiting for a bit reduces the risk throwing the SubmitLockException, which might be confusing to users. In almost all other cases the submit either succeeds or with some issue that will require further actions by the client, e.g. resolve conflicts. Thus, I think a configuration doesn\u0027t make sense here.",
      "parentUuid": "38647a99_470650be",
      "range": {
        "startLine": 128,
        "startChar": 62,
        "endLine": 128,
        "endChar": 64
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "99e146db_8bc54c61",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 493,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2023-03-30T14:58:45Z",
      "side": 1,
      "message": "This whole method is hard to read because it tries to only have one place where it calls doMerge. If we give up that and handle dryrun first then the code will get simpler:\n\n```\n  if (dryrun) {\n    return doMerge(...)\n  }\n  \n  Lock submitLock \u003d submitLock.get(change);\n  try {\n    if (!submitLock.tryLock(...)) {\n      throw new SubmitLockFailedException(change);\n    }\n  } catch (InterruptedException e) {\n    throw new SubmitLockFailedException(change, e);\n  }\n  try {\n    return doMerge(...);\n  } finally {\n    submitLock.unlock();\n  }\n```\n\nThe code fragment which acquires the lock and handles the InterruptedException can be moved to own method which further improves readability:\n\n```\n  if (dryrun) {\n    return doMerge(...)\n  }\n  \n  Lock submitLock \u003d acquireSubmitLock(change);\n  try {\n    return doMerge(...);\n  } finally {\n    submitLock.unlock();\n  }\n  \nprivate Lock acquireSubmitLock(change) throws SubmitLockFailedException {\n  Lock submitLock \u003d submitLock.get(change);\n  try {\n    if (!submitLock.tryLock(...)) {\n      throw new SubmitLockFailedException(change);\n    }\n    return submitLock;\n  } catch (InterruptedException e) {\n    throw new SubmitLockFailedException(change, e);\n  }\n}\n\n```",
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7876ccf6_bfef6756",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 493,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "99e146db_8bc54c61",
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cb7d0524_4b0e7a56",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 562,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-03-30T14:44:32Z",
      "side": 1,
      "message": "Strange unrelated indentation.",
      "range": {
        "startLine": 559,
        "startChar": 1,
        "endLine": 562,
        "endChar": 13
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9252f0bb_5eda3bce",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 562,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cb7d0524_4b0e7a56",
      "range": {
        "startLine": 559,
        "startChar": 1,
        "endLine": 562,
        "endChar": 13
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ebb6d2e8_9f6c357d",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 610,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-03-30T14:44:32Z",
      "side": 1,
      "message": "Strange unrelated indentation",
      "range": {
        "startLine": 609,
        "startChar": 0,
        "endLine": 610,
        "endChar": 19
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2de4c0fa_ddefe78d",
        "filename": "java/com/google/gerrit/server/submit/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 610,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ebb6d2e8_9f6c357d",
      "range": {
        "startLine": 609,
        "startChar": 0,
        "endLine": 610,
        "endChar": 19
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "436084c0_4d49d804",
        "filename": "java/com/google/gerrit/server/submit/StripedSubmitLock.java",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2023-03-30T23:11:09Z",
      "side": 1,
      "message": "That\u0027s a huge factor considering that many changes are submitted individually and submits are only a small fractions of requests in flight. I think the sum of sshd and httpd thread pool sizes is already generous",
      "range": {
        "startLine": 30,
        "startChar": 79,
        "endLine": 30,
        "endChar": 83
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "435bd8f1_4484ce19",
        "filename": "java/com/google/gerrit/server/submit/StripedSubmitLock.java",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-04-04T08:37:07Z",
      "side": 1,
      "message": "From looking at the change-merged events (which doesn\u0027t account for stacks being submitted) we maxed out on 20 change-merged per second, and that was a stack being submitted.\nAs Matthias suggests SSHD-threads + HTTP-threads should be more than plenty.",
      "parentUuid": "436084c0_4d49d804",
      "range": {
        "startLine": 30,
        "startChar": 79,
        "endLine": 30,
        "endChar": 83
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "75eb0168_a65e6e96",
        "filename": "java/com/google/gerrit/server/submit/StripedSubmitLock.java",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-04T11:20:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "435bd8f1_4484ce19",
      "range": {
        "startLine": 30,
        "startChar": 79,
        "endLine": 30,
        "endChar": 83
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b208f52_14a2f5cc",
        "filename": "java/com/google/gerrit/server/submit/SubmitLockFailedException.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2023-03-30T23:11:09Z",
      "side": 1,
      "message": "progress",
      "range": {
        "startLine": 33,
        "startChar": 83,
        "endLine": 33,
        "endChar": 90
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8008d110_18e82527",
        "filename": "java/com/google/gerrit/server/submit/SubmitLockFailedException.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8b208f52_14a2f5cc",
      "range": {
        "startLine": 33,
        "startChar": 83,
        "endLine": 33,
        "endChar": 90
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f63392be_ad1baecc",
        "filename": "javatests/com/google/gerrit/acceptance/rest/change/AbstractSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 1427,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2023-03-30T14:44:32Z",
      "side": 1,
      "message": "```\n    ResourceConflictException thrown \u003d\n        assertThrows(ResourceConflictException.class, () -\u003e f2.get());\n    assertThat(thrown).hasMessageThat().isEqualTo(\"change is merged\");\n```",
      "range": {
        "startLine": 1420,
        "startChar": 0,
        "endLine": 1427,
        "endChar": 5
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f0448ca6_cff53aba",
        "filename": "javatests/com/google/gerrit/acceptance/rest/change/AbstractSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 1427,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2023-04-03T11:12:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f63392be_ad1baecc",
      "range": {
        "startLine": 1420,
        "startChar": 0,
        "endLine": 1427,
        "endChar": 5
      },
      "revId": "464c4d3549a4382dbae0b9d137551c624a5870eb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}