{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1501261542 -0400\nnonce AB2F6yCW13XnIT/QgIYi9EZXqjgVgfn9COj6Y2kMdADaJi2Oq35zN5ePPt6oz2F0jog28U4Oan4C\n\n0000000000000000000000000000000000000000 48449bc81be5b5f852fd0618e3393e476eb03f87 refs/for/master%r\u003dekempin,r\u003ddavid.ostrovsky@gmail.com\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJZe27mAAoJEF/XxZqaEoiMf+MQAMn5pP9FmudKMdfPjRvNl/pU\n1Ab0uUWYEP46sN7FkjwRYB7/31DsGAgvu7u0kvyOqMpvGBVqQOe14YHyIbotbIf/\nD5b3oarVn6v67jQ2hb/lbxbouFHYLOawnRekUiTYZVUwu2Hf4Zl80n5WMXwPc5AB\nph881QpPXv6Ij7QlYJhCUSBudb1c2/PfJBMk1VQ5+zeovP/wFRmSmnU+yhr3oUlp\n1myS0b9TKkMNYraVr1WWxuqdFUZzd4ir6uR6YuUd0bdMqw9xIbfs5Qo3WVEbXYEn\na0cfNrfU3SmFpdYc6ZHUZh9+jkC1/4DIB844EJsMntHICdnat8Q88JVBy/+5aOjy\nwLn57HYOR8uy2iXluBqo0Y9m9MvTmIUKvNDGKWp40/Zt2EGmAvKT2h67aB2WJgIq\nF2YIRiJgtYegFwYv4QODc3QkXqUfvqoe5mtXw2rWhdOxhnyW1B1UNq9ZEMDnqLPi\nEd/JVoRUCJJmPpTYq5aQMa+J6wcLeFXNBvQtWHHqYu5+b4joLMYA3CF+NAanaq/8\nnOB4P3eK8Kz8KwkoAh207oHYz8T5YmZZw8eEF8EMD3ogmHg509uMe8WANSnhS6Dr\nuJlQdM4nJHW/6NxDCIj0mAbqScCUVAaA6mGmJLfi8uYbp9GKrqXvylQdsAbyshSo\n9WiqXMMp05GbPFKhxpEd\n\u003dic6w\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "34816c1a_c4970012",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-07-28T17:19:10Z",
      "side": 1,
      "message": "Atomic batch ref updates [1] and reflog support for that: [2] wasn\u0027t upgraded in gerrit yet?\n\n* [1] https://git.eclipse.org/r/100771\n* [2] https://git.eclipse.org/r/#/q/topic:batch-ref-update-reflog",
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "97fb0a9c_28e617ff",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-07-28T17:20:05Z",
      "side": 1,
      "message": "It doesn\u0027t hurt to check the parent change before asking.",
      "parentUuid": "34816c1a_c4970012",
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "51a6bbcc_7b96e684",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-07-28T17:20:08Z",
      "side": 1,
      "message": "See the previous change in this series :)",
      "parentUuid": "34816c1a_c4970012",
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c814ab7_4c99d05d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/update/BatchUpdate.java",
        "patchSetId": 1
      },
      "lineNbr": 107,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-07-30T08:30:03Z",
      "side": 1,
      "message": "Just noteDbBatchUpdateFactory.",
      "range": {
        "startLine": 107,
        "startChar": 52,
        "endLine": 107,
        "endChar": 81
      },
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0bf429f4_a8332f3e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/update/BatchUpdate.java",
        "patchSetId": 1
      },
      "lineNbr": 107,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-07-31T11:56:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3c814ab7_4c99d05d",
      "range": {
        "startLine": 107,
        "startChar": 52,
        "endLine": 107,
        "endChar": 81
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8626ebed_a6d35c13",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-07-30T08:30:03Z",
      "side": 1,
      "message": "This should be called just noteDbBatchUpdateFactory. Fused/unfused belongs to the past. Now it is always fused, as it was set unconditionally with setPerformsAtomicTransactions(true) in all code paths.",
      "range": {
        "startLine": 54,
        "startChar": 40,
        "endLine": 54,
        "endChar": 69
      },
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fddb76a5_fbb9b64c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/update/RetryHelper.java",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-07-31T11:56:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8626ebed_a6d35c13",
      "range": {
        "startLine": 54,
        "startChar": 40,
        "endLine": 54,
        "endChar": 69
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ace408fb_1b5d5547",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/testutil/NoteDbMode.java",
        "patchSetId": 1
      },
      "lineNbr": 41,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-07-30T08:30:03Z",
      "side": 1,
      "message": "There is still one place left in GerritServer.init() in place:\n\n  assume()\n        .withMessage(\"FUSED mode not yet supported for on-disk sites\")\n        .that(NoteDbMode.get())\n        .isNotEqualTo(NoteDbMode.FUSED);\n\nhat effectively disables all test ran with: --test_env\u003dGERRIT_NOTEDB\u003dFUSED.\n\nI think this is Bazel UI-bug, that the assumption violation isn\u0027t reflected on the Bazel-UI. IIRC, Buck was reporting something like \"with ASSUMPTION violation\": [1].\n\nAt least the explanation is not valid any more and should be adjusted. This raises the question whether or not we can already now run all tests with local disk enabled and the notedb mode FUSED.\n\nI tried it here by removing the assumption in GerritServer.init() mentioned above and hard coding the return value in GerritServer.forceLocalDisk():\n\n  private static boolean forceLocalDisk() {\n    return true;\n  }\n\nAnd hard coding NoteDbMode.get() to be:\n\n  public static NoteDbMode get() {\n    //String value \u003d System.getenv(ENV_VAR);\n    String value \u003d \"FUSED\";\n    [...]\n\nNow, surprisingly, the ChangeEditIT tests (ran from eclipse) were failing with: [1]. This failures looks to me like connection pool was exhausted. Checking, reveals, that the formula was producing:\n\n  int defaultDatabasePoolLimit \u003d sshdThreads + httpdMaxThreads + 2;\n\nconnection pool equals to 28. I tweaked it to be:\n\n  int defaultDatabasePoolLimit \u003d sshdThreads + httpdMaxThreads + 256;\n\nan now the tests were successful.\n\n* [1] http://paste.openstack.org/show/616938\n* [2] http://paste.openstack.org/show/616937",
      "range": {
        "startLine": 40,
        "startChar": 2,
        "endLine": 41,
        "endChar": 37
      },
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ca7fb781_be4e69c9",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/testutil/NoteDbMode.java",
        "patchSetId": 1
      },
      "lineNbr": 41,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-07-30T09:32:28Z",
      "side": 1,
      "message": "\u003e There is still one place left in GerritServer.init() in place:\n \u003e \n \u003e assume()\n \u003e .withMessage(\"FUSED mode not yet supported for on-disk sites\")\n \u003e .that(NoteDbMode.get())\n \u003e .isNotEqualTo(NoteDbMode.FUSED);\n \u003e \n \u003e hat effectively disables all test ran with: --test_env\u003dGERRIT_NOTEDB\u003dFUSED.\n \u003e \n \u003e I think this is Bazel UI-bug, that the assumption violation isn\u0027t\n \u003e reflected on the Bazel-UI. IIRC, Buck was reporting something like\n \u003e \"with ASSUMPTION violation\": [1].\n\nI just reported this issue upstream: [3].\n\n* [3] https://github.com/bazelbuild/bazel/issues/3476",
      "parentUuid": "ace408fb_1b5d5547",
      "range": {
        "startLine": 40,
        "startChar": 2,
        "endLine": 41,
        "endChar": 37
      },
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abfb512e_0be41787",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/testutil/NoteDbMode.java",
        "patchSetId": 1
      },
      "lineNbr": 41,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-07-31T11:56:02Z",
      "side": 1,
      "message": "Just removed this check.\n\nI don\u0027t know if having Bazel report the fact that there were assumption violations would have helped us notice this; all test runs have *some* assumption violations.",
      "parentUuid": "ca7fb781_be4e69c9",
      "range": {
        "startLine": 40,
        "startChar": 2,
        "endLine": 41,
        "endChar": 37
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "48449bc81be5b5f852fd0618e3393e476eb03f87",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}