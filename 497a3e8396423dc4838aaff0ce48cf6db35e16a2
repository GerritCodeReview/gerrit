{
  "pushCert": "certificate version 0.1\npusher A0D0EF51 1473941088 +0200\nnonce AE+e84Zh7m5bmWS6zzsPCIK234L48tBM3knGJybUad3AojCLvml0DXE67nqrU47w9qP01n3rVceM\n\n0000000000000000000000000000000000000000 497a3e8396423dc4838aaff0ce48cf6db35e16a2 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJX2o5gAAoJEFG1/Zeg0O9RMFAH/RDluUDO1oov8zKWXLSglSte\n41ehRRdjvlpsC3JzR3ihiwq0JRMz8p9y7MP/p6upp4KCkjMlDb/5eqK149lZ59Nt\n9Q11R1xtMCXl/rpxyhgssd31KJiEaoe6w0yPvqXJRybMJO8fpbFpECQ9NiYTiq1A\nXOJFnw42fmnpB5xMDYzkbOPEU2ZWYJK62FPBWNqqMQS08mv6jcT1M6rF88MGwbHp\navHThNi8zXznFZ1tSJU6gx5DU5BOrm0DCxJLdEhWSKO7fF5f0SJFu6dI4jkHpLlf\nXSvwDdhmMBSNNuV+J8wbbtJL2rXN5zKI3ozmW86LabWmjdknYnVKkzmJVX/vlhs\u003d\n\u003dtiSy\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "4be70257_804e9689",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/MergeListBuilder.java",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2016-09-15T12:25:19Z",
      "side": 1,
      "message": "This is still not working in all cases.\nWhile the tests always work, it doesn\u0027t work for me when I create a merge commit on my tests site and then try to see the diff for the MERGE_LIST file while comparing the current patch set to the first or second parent (against AUTO_MERGE it works).\n\nIn this scenario there are 4 commits:\n- merge commit (44c52f1765dad3a084bc964157bf1a017dfdb597)\n- first parent (64fadd05dbbc0f86f40162bb4b9ea9da884509a7)\n- second parent (29e35b3de85f37257ae6a58c2158a6efb33fb579)\n- common ancestor (e2bf601bd5eaf119683fd11269695205295e544e)\n\nThis code is invoked 3 times with the same input parameters:\n- rev walk\n- merge commit: 44c52f1765dad3a084bc964157bf1a017dfdb597\n- uninteresting parent: 1\n\nTwice the result is correct and only the second parent is returned. Once the result is incorrect and the second parent + the common ancestor is returned.\n\nHere are the traces for a failing cases and a succeeding case:\n\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; merge [commit 44c52f1765dad3a084bc964157bf1a017dfdb597 1473780452 -----p]; uninterestingParent [1]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; uninteresting [commit 64fadd05dbbc0f86f40162bb4b9ea9da884509a7 1473780422 -----p]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; start [commit 29e35b3de85f37257ae6a58c2158a6efb33fb579 1473780397 -----p]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; commit [64fadd05dbbc0f86f40162bb4b9ea9da884509a7]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; commit [29e35b3de85f37257ae6a58c2158a6efb33fb579]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; commit [e2bf601bd5eaf119683fd11269695205295e544e]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; commit [e2bf601bd5eaf119683fd11269695205295e544e]\nthis [com.google.gerrit.server.patch.MergeListBuilder@70f80e9]; result.size [2]\n\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; merge [commit 44c52f1765dad3a084bc964157bf1a017dfdb597 1473780452 -----p]; uninterestingParent [1]\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; uninteresting [commit 64fadd05dbbc0f86f40162bb4b9ea9da884509a7 1473780422 -----p]\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; start [commit 29e35b3de85f37257ae6a58c2158a6efb33fb579 1473780397 -----p]\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; commit [64fadd05dbbc0f86f40162bb4b9ea9da884509a7]\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; commit [29e35b3de85f37257ae6a58c2158a6efb33fb579]\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; commit [e2bf601bd5eaf119683fd11269695205295e544e]\nthis [com.google.gerrit.server.patch.MergeListBuilder@17ebfe7b]; result.size [1]\n\nAs you can see, in the failing case, the rev walk finds the common ancestor twice. I debugged jgit and found the the common ancestor is correctly marked as SEEN and UNINTERESTING when it is reached via the first parent. However when it is reached via the second parent, it\u0027s another instance of the commit which is neither SEEN nor UNINTERESTING. As result this second instance of the common ancestor is returned by the rev walk, which explains the wrong result. However I have no idea why jgit behaves wrong here, and why it works in the other case. I assume the difference is the state of the RevWalk instance, but since reset is invoked on it, there should actually be no difference.",
      "revId": "497a3e8396423dc4838aaff0ce48cf6db35e16a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4be70257_c02a5ea1",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/MergeListBuilder.java",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2016-09-15T12:51:34Z",
      "side": 1,
      "message": "I was now able to reproduce this with a test, please have a look at MergeListIT#whyDoesThisNotWork in patch set 4.\n\nI believe this might be a bug in jgit, that during one rev walk one commit is returned twice.",
      "parentUuid": "4be70257_804e9689",
      "revId": "497a3e8396423dc4838aaff0ce48cf6db35e16a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4be70257_40064e2d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/MergeListBuilder.java",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2016-09-15T15:00:30Z",
      "side": 1,
      "message": "Thanks to Dave this mystery was solved!! \nThe problem was that a RevCommit was passed to the the RevWalk#mark*(...) methods that originated from another RevWalk.",
      "parentUuid": "4be70257_c02a5ea1",
      "revId": "497a3e8396423dc4838aaff0ce48cf6db35e16a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2bec8e3b_3f19a783",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/Text.java",
        "patchSetId": 3
      },
      "lineNbr": 119,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2016-09-15T15:00:30Z",
      "side": 1,
      "message": "Here is the problem!\nWe can\u0027t use the RevCommit that is passed in as it originated from another RevWalk. We must parse the commit again from our RevWalk instance.",
      "range": {
        "startLine": 117,
        "startChar": 4,
        "endLine": 119,
        "endChar": 5
      },
      "revId": "497a3e8396423dc4838aaff0ce48cf6db35e16a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}