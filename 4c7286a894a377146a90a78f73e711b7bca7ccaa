{
  "comments": [
    {
      "key": {
        "uuid": "AAAFX3///Cw\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-05-15T05:21:27Z",
      "side": 1,
      "message": "Won\u0027t this prevent subsequent plugins from loading?",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAFeX///5k\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2012-05-18T18:48:39Z",
      "side": 1,
      "message": "Yes. Throwing here should actually cause the HTTP server to fail to start correctly, resulting in all sorts of problems.\n\nI guess the question is, does a failed plugin on server startup bring down the entire server? Or just that one plugin?",
      "parentUuid": "AAAFX3///Cw\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAFhn///7A\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-05-18T20:33:11Z",
      "side": 1,
      "message": "If a bad plugin were added after server startup, it would just cause the bad plugin to fail, but not the server right?  In that case I would expect the same on startup (that a bad plugin cannot prevent the server from starting up).",
      "parentUuid": "AAAFeX///5k\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAFjH///9k\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2012-05-20T03:52:20Z",
      "side": 1,
      "message": "Correct. If a bad plugin is installed after the server has already begun serving, the error is reported and the plugin is unloaded and discarded, and the server carries on as though the plugin was never there at all.\n\nI happen to agree with you, a plugin failing on server startup should just be logged, unloaded and skipped. We should continue startup, and the admin risks running without the plugin.\n\nHowever in Luca\u0027s case for example an audit plugin might be really critical. If it doesn\u0027t start, he may want the server to go down hard to ensure monitoring alarms fire, and more importantly, that the user can\u0027t do something that the plugin misses. To support these cases I think the admin should name the required plugins in gerrit.config or something, e.g.:\n\n  [plugins]\n    required \u003d audit\n    required \u003d replication\n\nIf a required plugin fails on startup, the server crashes. Required plugins should also not be able to be uninstalled, and a required plugin that crashes during a hot reload or a restart should either re-install the old version, or crash the server with a hard shutdown as quickly as possible.\n\nNon-required plugins shouldn\u0027t take the server down. And I think the default should be \"non-required\", but there are cases where its really important the plugin is there and we should ensure that.\n\nLuca, do you agree with me about this required plugin concept? Do you want to work on it since the required nature of your audit plugins applies to the audit plugins?\n\nAnother way to handle this might be a \"Gerrit-PluginRequired: true\" in the manifest. But I don\u0027t like this as much, because some admins might determine the replication plugin to be required, and others it might be more optional. But I can still see a sane argument for it being in the manifest and would entertain a change adding this required-ness as either in the config file, or in the manifest.",
      "parentUuid": "AAAFhn///7A\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAFi3///+0\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-05-20T06:14:54Z",
      "side": 1,
      "message": "Hmm, ok, but should a required.plugin even be able to be reloaded then?  And if it can, and it it fails to reload, should it take the server down on a reload?  I would say no, a required plugin should not be reloadable or restartable.",
      "parentUuid": "AAAFjH///9k\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAFrX///9k\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2012-05-22T17:31:51Z",
      "side": 1,
      "message": "Not necessarily: Shawn has already implement a very good logic on the reload of plugins.\n\nI would say:\n- reload: yes, why not ?\n- disable: no (a mandatory plug-in should never be disabled)\n\n@Martin: what do you think ?",
      "parentUuid": "AAAFi3///+0\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAFrX///9o\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2012-05-22T17:31:51Z",
      "side": 1,
      "message": "Yes, agreed. Required should be defined by the Gerrit admin based on the company policies.\n\nOne valid example is the audit (if you start the server but without respecting the Enterprise Security Policies, you may have big problems and risks in terms of traceability of what happened).\n\nAnother valid example is commit validations: once again a company may define them as plug-in and they would then need to be loaded during start-up. If plug-in fails to load, then you may have a Gerrit instance that doesn\u0027t validate and enforce commits Enterprise policies.\n\nWhat about the configuration ? The one suggested by Shawn looks good to me: simple and clear.\n\n@Martin ?",
      "parentUuid": "AAAFjH///9k\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAF53///68\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/plugins/HttpPluginServlet.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-05-27T00:18:27Z",
      "side": 1,
      "message": "Yeah I agree, if I had read Shawn\u0027s reply properly the first time I wouldn\u0027t have commented about the reload.  Luca, feel free to skip the \"required\" stuff here and put it in another change if you want.",
      "parentUuid": "AAAFrX///9o\u003d",
      "revId": "4c7286a894a377146a90a78f73e711b7bca7ccaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}