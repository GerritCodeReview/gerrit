{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "33ff1f54_ecfa3a64",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 11,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-02-03T19:17:22Z",
      "side": 1,
      "message": "I think you updated the inline comments and a section below to clarify this 10k number. Improve it here too?",
      "range": {
        "startLine": 10,
        "startChar": 40,
        "endLine": 11,
        "endChar": 7
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bd645430_6d5bfbe3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 11,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-02-03T19:30:29Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "33ff1f54_ecfa3a64",
      "range": {
        "startLine": 10,
        "startChar": 40,
        "endLine": 11,
        "endChar": 7
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b26858ca_5d8d2a69",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 25,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-02-03T19:17:22Z",
      "side": 1,
      "message": "This should come earlier and unless there\u0027s a documented way of running vanilla Gerrit with reftable, should probably clarify that this is specific to \"googlesource\" too.",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 25,
        "endChar": 48
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b2bc7576_e15202bd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 25,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-02-03T19:30:29Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b26858ca_5d8d2a69",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 25,
        "endChar": 48
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "56eaa8b3_55b66216",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-02-03T19:17:22Z",
      "side": 1,
      "message": "Call visible() instead (and probably undo the refactor above)?",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a59a6cb9_e96a4648",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-02-03T19:30:29Z",
      "side": 1,
      "message": "Done.\nWhat\u0027s wrong with the refactor above? Looks much better now.",
      "parentUuid": "56eaa8b3_55b66216",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d931a523_c70c53c9",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-02-03T20:18:33Z",
      "side": 1,
      "message": "Most importantly, it takes a \u0027repo\u0027 as an arg, but ignores it on any subsequent calls. That\u0027s just asking for someone to make a mistake. Granted, that\u0027s already a problem with visible(), but that should get fixed, not built upon.\n\nI also misread lines 200 and 385 before (I didn\u0027t realize you were using the method vs the field), so I didn\u0027t see another caller of visibleChanges(). Line 409 also tricked me because it\u0027s using a local field that\u0027s shadowing the instance variable.\n\nHonestly the more I look at this code (not yours specifically, just this whole class), the worse I feel about it. ðŸ˜ž Specific to your changes in this file, I have a hard time saying the code is easier to read (and therefore maintain) than it was before.",
      "parentUuid": "a59a6cb9_e96a4648",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3db078c_585e2fa1",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-02-03T21:35:30Z",
      "side": 1,
      "message": "the \"takes \u0027repo\u0027 as an arg and later ignores it\" was that way before my change, so I\u0027ll ack this comment. I agree it doesn\u0027t look great.\nI\u0027ll put myself a bug internally to take a look later and reformat this class when I have time, no promises though :-)",
      "parentUuid": "d931a523_c70c53c9",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c24edb8_1118d3b6",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-02-03T21:50:42Z",
      "side": 1,
      "message": "I think this part of my comment was not ACKed: \"Specific to your changes in this file, I have a hard time saying the code is easier to read (and therefore maintain) than it was before.\"",
      "parentUuid": "e3db078c_585e2fa1",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9334cdb_3b526fa5",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-02-03T22:11:20Z",
      "side": 1,
      "message": "I\u0027m not sure what else I can do about that, ack that code-health hasn\u0027t improved in this class, but I was not aiming to make the code easier to read or maintain, I\u0027m just adding a new feature. Hopefully, I didn\u0027t make the code *worse* with my feature (I think I didn\u0027t).\n\nIf you\u0027re interested I am happy to review reformat changes in this area.",
      "parentUuid": "7c24edb8_1118d3b6",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a34e566b_d52e32be",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-02-03T23:24:51Z",
      "side": 1,
      "message": "It\u0027s a small difference, but I do think the 3 extra conditions make the code harder to read. They don\u0027t shortcut or simplify any other logic, they just add to it, so you have more code total to follow for any given path.\n\nI also don\u0027t know an easy way to solve that for your change. Most of your added code is in the filter() method, and I haven\u0027t spent enough time with this code to suggest a way to reduce the complexity there. The plethora of log statements makes it a bit harder to read too (and I think speaks to the complexity). Maybe it would be improved if the refs.size()\u003d\u003d1 shortcut moves into a helper method (probably would return an Optional\u003cCollection\u003cRef\u003e\u003e)? I don\u0027t know if you can do the same trick with the \"do all the work\" path.\n\nAs a thought, I *think* it would help this class overall to refactor the visibleChanges stuff into its own class. But your changes there aren\u0027t my concern.\n\nMy overall concern is that classes like this aren\u0027t going to get any easier to maintain if we\u0027re just focused on adding \"our feature\".",
      "parentUuid": "c9334cdb_3b526fa5",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dbf5f62f_cc2026ca",
        "filename": "java/com/google/gerrit/server/permissions/DefaultRefFilter.java",
        "patchSetId": 5
      },
      "lineNbr": 381,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-02-04T09:16:33Z",
      "side": 1,
      "message": "I made some reformatting in a follow-up, but for some reason tests are failing. If I have time I\u0027ll look at it later, WIP For now.",
      "parentUuid": "a34e566b_d52e32be",
      "range": {
        "startLine": 381,
        "startChar": 8,
        "endLine": 381,
        "endChar": 44
      },
      "revId": "4d53aa69260d9ab017f0e9fd78ebba1f5bdacbae",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}