{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "82919cf6_ae653dd9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2022-06-07T15:04:46Z",
      "side": 1,
      "message": "I think it should work together with a recommendation about the default value for enum - it is recommended to have an \"UNSPECIFIED\" value as a default value (and in proto3 it was changed and a special UNRECOGNIZED value is added to all enums) - see\nhttps://developers.google.com/protocol-buffers/docs/style#enums\n\nIn gerrit, enums don\u0027t have an UNSPECIFIED/UNRECOGNIZED item. Using the first item looks dangerous, because this can lead to an unexpected behaviour when old code reads a new data.\n\nI think code should explicitly handle new values depending on the context. One possible solution - return Optional\u003cT\u003e from SafeEnumStringConverter.convert, so the caller have to process unexpected value (and a developer have to think how to handle it).",
      "range": {
        "startLine": 16,
        "startChar": 56,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "4e4041d79788e1bc2f05c8867b0a1f08c0c95151",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6de0283f_363a0331",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-06-08T12:12:05Z",
      "side": 1,
      "message": "mmm, you\u0027re right. That\u0027s not optimal but we are trying to mitigate the effect of unknown enum values instead of failing.\n\nI reworked the change such that each of the serialized enums implement a \"DefaultEnum\" interface and provide the default value. I did my guesses to the best possible defaults. The SafeEnumStringConverter will then fallback to the default.\n\nNote that ideally developers should manage their changes as not to fall into the compatibility traps. The SafeEnum is there to guard against any cases that slip.\n\nI also merged the next change - https://gerrit-review.googlesource.com/c/gerrit/+/338377/5 - into this: such that we migrate all enums altogether in this change.",
      "parentUuid": "82919cf6_ae653dd9",
      "range": {
        "startLine": 16,
        "startChar": 56,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "4e4041d79788e1bc2f05c8867b0a1f08c0c95151",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8fd15144_8f63ac72",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2022-06-08T16:39:15Z",
      "side": 1,
      "message": "\u003e but we are trying to mitigate the effect of unknown enum values instead of failing\n\nYes, I understand. But we should be very careful about each enum. There is a risk that reading X instead of NEW_Y can hide some information from a reviewer or can lead to a data leakage or allows to submit a change without an appropriate approval, etc....\n\nI.e. from my point of view - failing is bad, but \"unpredictable\" behavior can lead to unobvious outcomes. \"Unpredictable\" - here I mean, that if a new value is added to enum, it shouldn\u0027t be processed as one of the existing values.\nI would prefer to have a separate \"Unrecognized\" values in enum and code should process it explicitly. Maybe display error in a change, make change unsubmittable, etc... I understand that this requires significant amount of work.\n\nBtw, let\u0027s ask for a third opinion.\n\nEdwin - WDYT? Is it ok to replace unknown enum values with some default values? (I personally don\u0027t see in many enums, why some value is selected as default).",
      "parentUuid": "6de0283f_363a0331",
      "range": {
        "startLine": 16,
        "startChar": 56,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "4e4041d79788e1bc2f05c8867b0a1f08c0c95151",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6cf9a03_6cddd05d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-06-13T14:31:09Z",
      "side": 1,
      "message": "@Edwin, friendly ping. Could yo please check this change?",
      "parentUuid": "8fd15144_8f63ac72",
      "range": {
        "startLine": 16,
        "startChar": 56,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "4e4041d79788e1bc2f05c8867b0a1f08c0c95151",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c25a250b_72cf372c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-06-21T08:28:42Z",
      "side": 1,
      "message": "\u003e I.e. from my point of view - failing is bad, but \"unpredictable\" behavior can lead to unobvious outcomes.\n\nYou\u0027re right. What I could do is revisit all enums for which I\u0027ve added default values in this change, and for each enum, add a comment how falling back to the default value is safe and won\u0027t lead to serious problems.\n\n\u003e I would prefer to have a separate \"Unrecognized\" values in enum and code should process it explicitly\n\nmmm I think that\u0027s a lot of work and will require both front/back end adaptation. For example, a patch type (file modification) is either {ADD, RENAME, MODIFY, etc...}. Adding another un-recognized will require front-end to handle this case and display something in the UI accordingly.\n\nI think it\u0027s fine if you prefer we fail instead of falling back to a default. Failing is the current behaviour anyway but IMO it\u0027s better to fallback to a default as mitigation.\n\nLet me know what you think about revisiting the enum defaults as per my suggestion above. I can re-check them all and upload another PS with comments on defaults.\n\nI will also bring for discussion to get others\u0027 opinion in the team meeting.",
      "parentUuid": "e6cf9a03_6cddd05d",
      "range": {
        "startLine": 16,
        "startChar": 56,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "4e4041d79788e1bc2f05c8867b0a1f08c0c95151",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}