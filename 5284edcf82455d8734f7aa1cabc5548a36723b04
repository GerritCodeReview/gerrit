{
  "comments": [
    {
      "key": {
        "uuid": "c6cf2edb_827417c4",
        "filename": "java/com/google/gerrit/server/change/EmailReviewComments.java",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-09-02T08:04:14Z",
      "side": 0,
      "message": "I wonder why it\u0027s using user.getRealUser() here?\nWith the new code we seem to use just user now (see ExecuteAsyncPostUpdates), so this seems to be a change in behaviour.",
      "range": {
        "startLine": 158,
        "startChar": 11,
        "endLine": 158,
        "endChar": 29
      },
      "revId": "5284edcf82455d8734f7aa1cabc5548a36723b04",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ae8f044_55d7f2a7",
        "filename": "java/com/google/gerrit/server/change/EmailReviewComments.java",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-09-02T16:24:55Z",
      "side": 0,
      "message": "Verified that past behavior is the same. getUser() is only used in very specific places and this class is not one of them.\nOne example is DeleteReviewerOp which injects Provider\u003cIdentifiedUser\u003e. There, calling getUser will use this overridden method (which is why I implemented it in ExecuteAsyncPostUpdates).\nSince current behavior is just to use \"user\" (e.g l114 in this class), I\u0027m going to stick with it.",
      "parentUuid": "c6cf2edb_827417c4",
      "range": {
        "startLine": 158,
        "startChar": 11,
        "endLine": 158,
        "endChar": 29
      },
      "revId": "5284edcf82455d8734f7aa1cabc5548a36723b04",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7109c7df_1598a3a3",
        "filename": "java/com/google/gerrit/server/config/SysExecutorModule.java",
        "patchSetId": 3
      },
      "lineNbr": 57,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-09-02T08:04:14Z",
      "side": 0,
      "message": "If this parameter is no longer used, please also remove its documentation from config-gerrit.txt",
      "range": {
        "startLine": 57,
        "startChar": 33,
        "endLine": 57,
        "endChar": 68
      },
      "revId": "5284edcf82455d8734f7aa1cabc5548a36723b04",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "728f64bb_13e3d723",
        "filename": "java/com/google/gerrit/server/config/SysExecutorModule.java",
        "patchSetId": 3
      },
      "lineNbr": 57,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-09-02T16:24:55Z",
      "side": 0,
      "message": "Id8177b374 still looks relevant. I think it\u0027s best if I keep @SendEmailExecutor, because of this bug.\nOne minor problem is the fact that asyncPostUpdate is limited by sendemail.threadPoolSize.\nI think this is fine since we currently only send emails with asyncPostUpdates. The problem is that I can\u0027t just rename a config. I documented that in AsyncPostUpdateOp, though.",
      "parentUuid": "7109c7df_1598a3a3",
      "range": {
        "startLine": 57,
        "startChar": 33,
        "endLine": 57,
        "endChar": 68
      },
      "revId": "5284edcf82455d8734f7aa1cabc5548a36723b04",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "be905f3e_8a71b05a",
        "filename": "java/com/google/gerrit/server/submit/EmailMerge.java",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-09-02T08:04:14Z",
      "side": 0,
      "message": "This seems to be lost with the new code?",
      "range": {
        "startLine": 116,
        "startChar": 4,
        "endLine": 118,
        "endChar": 5
      },
      "revId": "5284edcf82455d8734f7aa1cabc5548a36723b04",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2bd9d3e6_c24a7fe5",
        "filename": "java/com/google/gerrit/server/submit/EmailMerge.java",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-09-02T16:24:55Z",
      "side": 0,
      "message": "Thanks for pointing this out!\n\nsubmitter \u003d\u003d user, so I don\u0027t see a problem. I concluded that this code is unused, and the one that is actually used is in l76 (so we don\u0027t really use getRealUser). See other comment for more details.\n\n---------------\n\nOptional below: This is a part of my investigation of this RequestContext as a whole and getUser specifically. I don\u0027t think you need to spend time on reading that, I just put it here so it doesn\u0027t get lost if we need it later.\n\n---------------\n\ngetUser() is required to be overridden if we want to implement RequestContext.\nIt seems however, this is not used anywhere. The submitter is written in l76. Anyway I verified that the email looks the same.\n\nHere is the change that added RequestContext Ifd7745be. I still don\u0027t understand how this is related to email sendings, and I think it\u0027s possible that it\u0027s not needed even in ExecuteAsyncPostUpdates. Apparently only needed when we use Provider\u003cIdentifiedUser\u003e which calls this getUser.\n\nIn Iee7b4dca currentUser is being overridden to be \"null\", too...\nIn Ib48792b5, there is no explanation to why we\u0027re using requestContext.setContext(this), but as I see there, calling currentUser will throw an exception anyway, so it was not used there at all.\nSame in Idbeb0d0f6.",
      "parentUuid": "be905f3e_8a71b05a",
      "range": {
        "startLine": 116,
        "startChar": 4,
        "endLine": 118,
        "endChar": 5
      },
      "revId": "5284edcf82455d8734f7aa1cabc5548a36723b04",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}