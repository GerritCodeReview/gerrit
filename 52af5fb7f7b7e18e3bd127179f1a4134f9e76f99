{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "0bb00b0b_38e69998",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-12-10T09:12:24Z",
      "side": 1,
      "message": "Dmitrii, can you also have a look and +2 if you are ok with this approach?",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1de2bc51_663fdff2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-12-10T09:27:25Z",
      "side": 1,
      "message": "Why can\u0027t we have ordinary .ts file instead .d.ts?\nAs I know, the manually written .d.ts file is used for .js code.",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7561e66e_633a4eef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-12-10T09:29:58Z",
      "side": 1,
      "message": "Any technical reason to split the common.ts file?\nI.e. I see the point to split types by usages, but depending on common.ts doesn\u0027t increase the size of .js file until you execute some code from this file - but there are no code in this file.",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "510ccc36_7385c5de",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1070860
      },
      "writtenOn": "2020-12-10T09:49:54Z",
      "side": 1,
      "message": "It\u0027s a way to ensure that there are only types in the file.\n\nI could use a regular ts file and a regular ts_library, but that would allow people to import Values such as constants/constants.ts - and that defeats the idea that this is only types - the API of gr-diff, to be pulled into a separately compiled bundle.\n\nd.ts can be used to describe the type shape of other code, and one important use case is describing the types of a JS file, but I don\u0027t think that is the only way it should be used.",
      "parentUuid": "1de2bc51_663fdff2",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ca4295d6_b6ddc1cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1070860
      },
      "writtenOn": "2020-12-10T09:54:07Z",
      "side": 1,
      "message": "It just makes it easier to find the types that are relevant to folks embedding gr-diff, and to ensure they are not renamed (by adding the declare keyword) in bundles that do use property renaming.\nIt also makes it easier for the Gerrit team to know which types they can change at will (because they are sort of internal to the Gerrit repository) and which types make up the API of the embedable gr-diff and should not be changed unless when versioned etc.",
      "parentUuid": "7561e66e_633a4eef",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3fc92a31_2ef2c825",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-12-10T10:15:21Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ca4295d6_b6ddc1cb",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bbe38046_a7b3fe6c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-12-10T10:15:21Z",
      "side": 1,
      "message": "\u003e\u003eIt\u0027s a way to ensure that there are only types in the file.\nYes, I remember we discussed it. I\u0027ve read about it and made some tests. If a file A.ts has a code and types and another B.ts file imports type only, the generated B.js file doesn\u0027t import A.js file. \nSo, if we add a code into the file, the code shouldn\u0027t affect others in any way.\n\nDoes it work for you (i.e. do not use .d.ts files) ?",
      "parentUuid": "510ccc36_7385c5de",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7df1d5e8_c3d12fd5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1070860
      },
      "writtenOn": "2020-12-10T10:34:17Z",
      "side": 1,
      "message": "For enums, I would have to use `import type` to be sure as the type and the value has the same name, but I guess I could do that, otherwise decide that I don\u0027t mind having the enum values imported in both packages.\n\nOne more thing this makes a bit more tricky is setting up build rules: Code bases that embed gr-diff need a separate build target to depend on which has only the types. I could potentially achieve this by creating a build target that has types/ and constants/ as sources, and exclude those two folders from the main build target, adding a dep on the types/constants build target instead. Right now I do something similar by excluding d.ts files and having a separate build target for the d.ts files. The current approach has the advantage that we could decide to put the relevant API files together with he source code, e.g. into elements/diff/gr-diff-api/ or something like that. I was not sure if that would not eventually be desirable to avoid having a parallel hierarchy of files.\n\nAsking the other way around: What is the benefit of using ts only files? \nIn the end, I think we could make both approaches work - so if you have a strong preference for having only *.ts files, I can rename them back and try to adjust the build rules accordingly.",
      "parentUuid": "bbe38046_a7b3fe6c",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "274fb34a_352cb2f8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2020-12-10T11:47:14Z",
      "side": 1,
      "message": "I would say this is a non-standard way of sharing types in the npm ecosystem.\nThe traditional way is to write all code as .ts files, then compile the code to .js and .d.ts file and distribute only .js + .d.ts files.\n\nAnother issue - it is impossible to define enums in .d.ts files. You made a workaround with union types instead of enum, but this is not good - we have to write string literals everywhere.\n\nI can suggest the following: let\u0027s commit this change but don\u0027t make more changes until it really necessary. And then let\u0027s together invest time in updating build rules (I am ready to spend some time on it together with someone from you team).\n\nWDYT?",
      "parentUuid": "7df1d5e8_c3d12fd5",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd8bb9ae_8d62d581",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1070860
      },
      "writtenOn": "2020-12-10T11:57:05Z",
      "side": 1,
      "message": "I would prefer to spend the time to find the good solution now - I am not in a rush with this change - it\u0027s a cleanup that is not urgent, but has been on my backburner for a while already.\n\nOne small remark regarding enums: You don\u0027t actually have to change your code to use string literals - so long as the interfaces I plan to introduce use string literals which are compatible with your enums, this works in TS: https://www.typescriptlang.org/play?#code/PTAEHUFMBsGMHsC2lQBd5oBYoCoE8AHSAZVgCcBLA1UABWgEM8BzM+AVwDsATAGiwoBnUENANQAd0gAjQRVSQAUCEmYKsTKGYUAbpGF4OY0BoadYKdJMoL+gzAzIoz3UNEiPOofEVKVqAHSKymAAmkYI7NCuqGqcANag8ABmIjQUXrFOKBJMggBcISGgoAC0oACCoASMFmgY7p7ehCTkVOle4jUMdRLYTqCc8LEZzCZmoNJODPHFZZXVtZYYkAAeRJTInDQS8po+rf40gnjbDKv8LqD2jpbYoACqAEoAMsK7sUmxkGSCc+VVQQuaTwVb1UBrDYULY7PagbgUZLJH6QbYmJAECjuMigZEMVDsJzCFLNXxtajBBCcQQ0MwAUVWDEQNUgADVHBQGNJ3KAALygABEAAkYNAMOB4GRogLFFTBPB3AExcwABT0xnM9zsyhc9wASmCKhwDQ8ZC8iElzhB7Bo3zcZmY7AYzEg-Fg0HUiS58D0Ii8AoZTJZggFSRxAvADlQAHJhAA5SASAVBFQAeW+ZF2gldWkgx1QjgUrmkeFATgtOlGWH0KAQiBhwiudokkuiIgMHBx3RYbC43CCwVQLVArIoiYAsvBuJADnzQNHiABJAAidIA+gAhUJrper6MAH2jDzji4AYou6cvowBuYKo9iIEdjiST6egADeihKJV3663O5XOk5wXQDN23X9o14L9v2PM8L2XYDYPPS9o0UABfYJZXgakaErCcp0gfIn3wt9+VHEjIACX8wIA1dbzlXDn1fSAXnkH4GGgIjyJfAjZ35PCeOnW8SkURFQBVATmNYhQyA4vleTIpiCKo0D-1-PUP2gko5QVSjlRVaM6wIfEKG5SBoz1W8MNE7YfmSHoUAAcTIZdEWSWdPxKSSCK4pTpwOKzKUYQRhGc1ykRETVIAbUAwrcjytNAbzp18ii5245iVNXGjfysoA\n\nBut you are right, it does add some duplication in that you have to create those string literals and keep them up to date.\n\nMaybe can we first discuss the question of where we want these files to live long term (in a separate types/ hierarchy or along side the implementations in the main hierarchy)? I find in the main hierarchy slightly cleaner, but can live with either.  Once we have an agreement on that, I think we can revisit the d.ts files - I am okay to move to ts files, just want to make sure we have a good solution for the build targets.",
      "parentUuid": "274fb34a_352cb2f8",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f1239382_06798b97",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1070860
      },
      "writtenOn": "2021-02-05T07:47:00Z",
      "side": 1,
      "message": "We have decided to move everything into a folder named api/ and into .ts files that must only contain types and enums.",
      "parentUuid": "cd8bb9ae_8d62d581",
      "revId": "52af5fb7f7b7e18e3bd127179f1a4134f9e76f99",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}