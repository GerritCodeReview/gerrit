{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8933ae6a_2603ffd9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-01-26T07:38:24Z",
      "side": 1,
      "message": "Thanks Luca! LGTM. I am currently running some manual tests of offline and online reindexing and if everything works will give CR+2.",
      "revId": "566bc3c221db9fcac55b2610546d3eda29b53ddb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7e7bb59_b474b279",
        "filename": "java/com/google/gerrit/server/index/change/AllChangesIndexer.java",
        "patchSetId": 3
      },
      "lineNbr": 260,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-01-26T08:15:09Z",
      "side": 1,
      "message": "In case of online reindexing, even between two schema versions (tested Gerrit 3.8.3 -\u003e 3.9.1, change index 82 -\u003e 84), this is always the same as newestIndex and thus the feature to skip changes during reindexing will never be used.\n\nThe reason is in line 418, where the changeIndexer will be created and given just the index that is supposed to be reindexed and not the complete index collection.\n\nThis means that the name `newestIndex` was already badly chosen and the `getNewestIndex()` method unnecessary.\n\nSo reverting the change causing this issue would have the same effect and I would the n prefer that (less complexity). However, I will think and try a different solution.\n\nFor example, how about committing the deletion of all documents in the index before starting to index during offline reindex? That would essentially also force indexing.",
      "range": {
        "startLine": 260,
        "startChar": 44,
        "endLine": 260,
        "endChar": 68
      },
      "revId": "566bc3c221db9fcac55b2610546d3eda29b53ddb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "208622a1_f44fc2de",
        "filename": "java/com/google/gerrit/server/index/change/AllChangesIndexer.java",
        "patchSetId": 3
      },
      "lineNbr": 260,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-26T08:51:21Z",
      "side": 1,
      "message": "\u003e In case of online reindexing, even between two schema versions (tested Gerrit 3.8.3 -\u003e 3.9.1, change index 82 -\u003e 84), this is always the same as newestIndex and thus the feature to skip changes during reindexing will never be used.\n\u003e \n\u003e The reason is in line 418, where the changeIndexer will be created and given just the index that is supposed to be reindexed and not the complete index collection.\n\nI need to re-check why the forcing did not happen then for online reindex due to an upgrade.\n\n\u003e This means that the name `newestIndex` was already badly chosen and the `getNewestIndex()` method unnecessary.\n\nðŸ˜ž\n\n\u003e So reverting the change causing this issue would have the same effect and I would the n prefer that (less complexity). However, I will think and try a different solution.\n\u003e \n\u003e For example, how about committing the deletion of all documents in the index before starting to index during offline reindex? That would essentially also force indexing.\n\nI would just revert the change on stable-3.9 then (safest choice) and do a proper solution on master.\n\nCommitting the delete before starting to reindex would end up destroying the whole index if the reindexing is stopped in the middle.",
      "parentUuid": "c7e7bb59_b474b279",
      "range": {
        "startLine": 260,
        "startChar": 44,
        "endLine": 260,
        "endChar": 68
      },
      "revId": "566bc3c221db9fcac55b2610546d3eda29b53ddb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb008fbc_6d6c2608",
        "filename": "java/com/google/gerrit/server/index/change/AllChangesIndexer.java",
        "patchSetId": 3
      },
      "lineNbr": 260,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-26T08:54:13Z",
      "side": 1,
      "message": "Revert created: Change 404817",
      "parentUuid": "208622a1_f44fc2de",
      "range": {
        "startLine": 260,
        "startChar": 44,
        "endLine": 260,
        "endChar": 68
      },
      "revId": "566bc3c221db9fcac55b2610546d3eda29b53ddb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}