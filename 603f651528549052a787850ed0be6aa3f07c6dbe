{
  "comments": [
    {
      "key": {
        "uuid": "8ca74488_ce4e040e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "from",
      "range": {
        "startLine": 26,
        "startChar": 10,
        "endLine": 26,
        "endChar": 13
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c764d6c1_ca743b00",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8ca74488_ce4e040e",
      "range": {
        "startLine": 26,
        "startChar": 10,
        "endLine": 26,
        "endChar": 13
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b511d9a6_e1ebb0be",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "drop this word",
      "range": {
        "startLine": 44,
        "startChar": 16,
        "endLine": 44,
        "endChar": 21
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8598585_b1b0b380",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b511d9a6_e1ebb0be",
      "range": {
        "startLine": 44,
        "startChar": 16,
        "endLine": 44,
        "endChar": 21
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "907f6dcf_eac8e440",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "We",
      "range": {
        "startLine": 59,
        "startChar": 3,
        "endLine": 59,
        "endChar": 6
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c09ac479_0e252b6a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "907f6dcf_eac8e440",
      "range": {
        "startLine": 59,
        "startChar": 3,
        "endLine": 59,
        "endChar": 6
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e005a7c3_dedf4131",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-31T13:08:21Z",
      "side": 1,
      "message": "Uploaded as abandoned RFC for visibility: https://gerrit-review.googlesource.com/c/gerrit/+/261256",
      "range": {
        "startLine": 61,
        "startChar": 2,
        "endLine": 61,
        "endChar": 27
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c9dea1f_e1919622",
        "filename": "java/com/google/gerrit/acceptance/AbstractNotificationTest.java",
        "patchSetId": 1
      },
      "lineNbr": 342,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "reindexAndCopy",
      "range": {
        "startLine": 342,
        "startChar": 24,
        "endLine": 342,
        "endChar": 36
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b168f5e5_ed7281f3",
        "filename": "java/com/google/gerrit/acceptance/AbstractNotificationTest.java",
        "patchSetId": 1
      },
      "lineNbr": 342,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5c9dea1f_e1919622",
      "range": {
        "startLine": 342,
        "startChar": 24,
        "endLine": 342,
        "endChar": 36
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f780ad0_37417f5d",
        "filename": "java/com/google/gerrit/acceptance/ProjectResetter.java",
        "patchSetId": 1
      },
      "lineNbr": 370,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "reindexAccount",
      "range": {
        "startLine": 370,
        "startChar": 15,
        "endLine": 370,
        "endChar": 37
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ac78cdd_ff265022",
        "filename": "java/com/google/gerrit/acceptance/ProjectResetter.java",
        "patchSetId": 1
      },
      "lineNbr": 370,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0f780ad0_37417f5d",
      "range": {
        "startLine": 370,
        "startChar": 15,
        "endLine": 370,
        "endChar": 37
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "762bec11_4d0a60e2",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 128,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-03T08:56:19Z",
      "side": 1,
      "message": "Would it be better to use Config?\nThe caller in AccountCacheImpl converts the Config to text, and in this class we convert the text back into a Config. This conversion seems unneeded.",
      "range": {
        "startLine": 128,
        "startChar": 36,
        "endLine": 128,
        "endChar": 42
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52592c72_66085895",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 128,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Config isn\u0027t thread safe and it is mutable, so we can\u0027t store it in a cache and it\u0027d be better to also not store it in an the AccountState AutoValue (we could and at the same time document that the class isn\u0027t thread safe).\n\nBut I agree with you, it\u0027s not great either way, that is why I tried going with the refactoring referenced in an earlier comment. But that didn\u0027t seem worth it for now.\n\nFrom my perspective the fact that Config cleanly serializes and deserializes into a string makes storing strings in immutable objects shared across threads a good compromise.\n\nThe only smell are the ~10 LOC in AccountState that parse the string first into a Config and then into a *PreferenceInfo.\n\nFrom the cache perspective, I thought it\u0027s easier to pass on the string\n\nGit storage (string), Serialized cache (string), in-mem cache (string), caller (*PreferenceInfo as needed).\n\nI found that easier compared to:\nGit storage (string), Serialized cache (string), in-mem cache (config, defensive copy), caller (*PreferenceInfo as needed)\n\nAlso because the latter would mean that the serialzier/deserializer has to deal with Config#toString and #fromString as well as with ConfigInvalidExceptions while the former approach just has to deal with this in a single place.\n\nIf you have other ideas or more thoughts on this, please let me know.",
      "parentUuid": "762bec11_4d0a60e2",
      "range": {
        "startLine": 128,
        "startChar": 36,
        "endLine": 128,
        "endChar": 42
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc575a81_abdfd073",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-04-01T13:38:01Z",
      "side": 1,
      "message": "I understand that you combined the general/edit/diff preferences here into a single raw preference. Is this for easier serialization?\nI feel it would have been better to add a comment explaining why we did that, or maybe moving it to a separate change prior to this one to reduce the clutter.\nUpdate: I saw your comments in StoredPreferences.",
      "range": {
        "startLine": 210,
        "startChar": 38,
        "endLine": 210,
        "endChar": 53
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "117219e0_d0c9a9f0",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "\u003e  Is this for easier serialization?\n\nFor serialization we wouldn\u0027t care much, but the Git storage stores them in a single file and here we are just serializing this file. The file contains all preferences (this is true for the cache and Git).\n\n\u003e I feel it would have been better to add a comment explaining why we did that\n\nFrom the storage\u0027s perspective, it\u0027s actually strange to split up preferences into separate objects. In the end, preferences are just key/value pairs. The splitup is done by \u0027category\u0027 (general, diff, edit) but that\u0027s rather arbitrary.\n\nThere is a comment here on both members that references the stored file. Besides that, what do you think would help the reader of this code piece here?",
      "parentUuid": "dc575a81_abdfd073",
      "range": {
        "startLine": 210,
        "startChar": 38,
        "endLine": 210,
        "endChar": 53
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39424c0a_e5ab6840",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 227,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-30T08:04:43Z",
      "side": 1,
      "message": "Talked to Edwin, the current behavior is to just return defaults for broken configs. Will adapt this part to do the same.",
      "range": {
        "startLine": 226,
        "startChar": 1,
        "endLine": 227,
        "endChar": 36
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bda52ee5_4c159c56",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 227,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-03T08:56:19Z",
      "side": 1,
      "message": "If you represent the configs as Config objects rather than as Strings, this exception cannot happen here. This means the cache cannot contain invalid config preferences, but since we anyway would not use them, that seems fine.",
      "parentUuid": "39424c0a_e5ab6840",
      "range": {
        "startLine": 226,
        "startChar": 1,
        "endLine": 227,
        "endChar": 36
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f491055_89e483fe",
        "filename": "java/com/google/gerrit/server/account/AccountState.java",
        "patchSetId": 1
      },
      "lineNbr": 227,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Please see my other comment.",
      "parentUuid": "bda52ee5_4c159c56",
      "range": {
        "startLine": 226,
        "startChar": 1,
        "endLine": 227,
        "endChar": 36
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "53a9d476_aaaf8024",
        "filename": "java/com/google/gerrit/server/account/CachedAccountDetails.java",
        "patchSetId": 1
      },
      "lineNbr": 84,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-03T08:56:19Z",
      "side": 1,
      "message": "Would it be better to make this a JGit Config object?",
      "range": {
        "startLine": 84,
        "startChar": 11,
        "endLine": 84,
        "endChar": 17
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7fbfc5e7_23910ab8",
        "filename": "java/com/google/gerrit/server/account/CachedAccountDetails.java",
        "patchSetId": 1
      },
      "lineNbr": 84,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Please see my other comment about thread safety any mutability.",
      "parentUuid": "53a9d476_aaaf8024",
      "range": {
        "startLine": 84,
        "startChar": 11,
        "endLine": 84,
        "endChar": 17
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a3aaa130_ba070505",
        "filename": "java/com/google/gerrit/server/account/CachedAccountDetails.java",
        "patchSetId": 1
      },
      "lineNbr": 112,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-03T08:56:19Z",
      "side": 1,
      "message": "Do we need to persist the meta ID in the value, when it is already part of the key?\nI guess we do, because we do not know the cache key when deserializing?",
      "range": {
        "startLine": 112,
        "startChar": 13,
        "endLine": 112,
        "endChar": 64
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7042bb08_5edcecec",
        "filename": "java/com/google/gerrit/server/account/CachedAccountDetails.java",
        "patchSetId": 1
      },
      "lineNbr": 112,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Yes, exactly. The Cache serializer interface only knows about the value.",
      "parentUuid": "a3aaa130_ba070505",
      "range": {
        "startLine": 112,
        "startChar": 13,
        "endLine": 112,
        "endChar": 64
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "60403bd4_59714e36",
        "filename": "java/com/google/gerrit/server/account/StoredPreferences.java",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-03T08:56:19Z",
      "side": 1,
      "message": "I think things would be simpler, if we would return Config here.",
      "range": {
        "startLine": 188,
        "startChar": 2,
        "endLine": 188,
        "endChar": 8
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a64d144f_b8cf2516",
        "filename": "java/com/google/gerrit/server/account/StoredPreferences.java",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Let\u0027s discuss this in the other comment.",
      "parentUuid": "60403bd4_59714e36",
      "range": {
        "startLine": 188,
        "startChar": 2,
        "endLine": 188,
        "endChar": 8
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5087e262_7f0f9116",
        "filename": "javatests/com/google/gerrit/acceptance/ProjectResetterTest.java",
        "patchSetId": 1
      },
      "lineNbr": 257,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "These tests are all testing evicting from the account cache. Are they still needed if eviction is no longer done?",
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a75a386d_9e7736d3",
        "filename": "javatests/com/google/gerrit/acceptance/ProjectResetterTest.java",
        "patchSetId": 1
      },
      "lineNbr": 257,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Good point. Removed.",
      "parentUuid": "5087e262_7f0f9116",
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1cb27e4_d81f60b0",
        "filename": "javatests/com/google/gerrit/acceptance/api/accounts/AccountIndexerIT.java",
        "patchSetId": 1
      },
      "lineNbr": 97,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-04-02T15:01:11Z",
      "side": 1,
      "message": "Maybe better drop the whole test. If now the SHA1 is the cache key, the cache cannot be stale anymore.",
      "range": {
        "startLine": 88,
        "startChar": 2,
        "endLine": 97,
        "endChar": 3
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1b4bfbb8_887c6d01",
        "filename": "proto/cache.proto",
        "patchSetId": 1
      },
      "lineNbr": 304,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-04-01T13:38:01Z",
      "side": 1,
      "message": "nit: next ID 3",
      "range": {
        "startLine": 304,
        "startChar": 3,
        "endLine": 304,
        "endChar": 13
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1374880c_c8600621",
        "filename": "proto/cache.proto",
        "patchSetId": 1
      },
      "lineNbr": 304,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-04-03T13:25:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1b4bfbb8_887c6d01",
      "range": {
        "startLine": 304,
        "startChar": 3,
        "endLine": 304,
        "endChar": 13
      },
      "revId": "603f651528549052a787850ed0be6aa3f07c6dbe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}