{
  "comments": [
    {
      "key": {
        "uuid": "7fec56ce_8d22c1b3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-10-14T12:24:46Z",
      "side": 1,
      "message": "Add link to https://code.google.com/p/gerrit/issues/detail?id\u003d3602 ?",
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7fec56ce_cd1cc980",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-10-14T12:28:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7fec56ce_8d22c1b3",
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7fec56ce_ad25fdbf",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-10-14T12:22:03Z",
      "side": 1,
      "message": "I know this was like this before, but I\u0027m wondering if it is really correct to use the account ID of the committer here.\n\nIf I understood the commit message correctly, this is about applying approvals that were specified on push. So I would expect that the approvals would be done in the name of the uploader and not in the name of the committer (which can be different in case you are allowed to forge the committer identity). I think it would be very wrong if I can add votes in the name of another user just because I\u0027m allowed to forge the committer on upload.\n\nAnd I believe that an uploader always must have an email address to be able to push successful.",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f3e16ee_3d8f6f01",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-10-14T14:00:43Z",
      "side": 1,
      "message": "Yes. I agree, it was always broken. Looking at PostReview code, the current user is used:\n\n c \u003d new PatchSetApproval(new PatchSetApproval.Key(\n                rsrc.getPatchSet().getId(),\n                rsrc.getAccountId(),\n                lt.getLabelId()),\n            ent.getValue(), TimeUtil.nowTs());\n\nso the fix would be to switch to using the uploader instead, like:\n\n  cells.add(new PatchSetApproval(new PatchSetApproval.Key(\n            ps.getId(),\n            ps.getUploader(),\n            lt.getLabelId()),\n            vote.getValue(),\n            ts));\n\nThis would solve both problems:\n\n* never ps.getUploader() null, as it\u0027s populated from currentUser.getAccountId()\n* uploader can not vote on behalf of another account\n\nright?",
      "parentUuid": "7fec56ce_ad25fdbf",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f3e16ee_7d99f749",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-10-14T14:05:23Z",
      "side": 1,
      "message": "Yes, I think this would be the correct thing to do :-)\n\nIf it turns true that at the moment you could vote like this on behalf of another account then I would say the fix is important enough to be included in 2.11 (haven\u0027t tried that yet).",
      "parentUuid": "7f3e16ee_3d8f6f01",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f3e16ee_9d9fa32c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-10-14T14:31:17Z",
      "side": 1,
      "message": "I just verified this, and like this you actually can vote in the name of another user :(\n\nAlthough this requires the forge-committer access right I would rate this bug as rather critical.",
      "parentUuid": "7f3e16ee_7d99f749",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7fec56ce_cdb329d0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-10-14T14:43:23Z",
      "side": 1,
      "message": "@davido: Are you making the fix or should I start with it. I think we should also cover this by a test.",
      "parentUuid": "7f3e16ee_9d9fa32c",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f3e16ee_dda92b51",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-10-14T14:47:55Z",
      "side": 1,
      "message": "Edwin, your help is most appreciated. I cannot work on this until today evening. I completely agree with you: this is very critical bug, and we should consider to fix 2.10 series as well. Test would be more than welcome.",
      "parentUuid": "7fec56ce_cdb329d0",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7fec56ce_6ddaf500",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/ApprovalsUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-10-14T14:50:38Z",
      "side": 1,
      "message": "Ok, then I will look into this.",
      "parentUuid": "7f3e16ee_dda92b51",
      "range": {
        "startLine": 247,
        "startChar": 12,
        "endLine": 247,
        "endChar": 15
      },
      "revId": "6093f55933857effc11953d14e91931478139270",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}