{
  "comments": [
    {
      "key": {
        "uuid": "770d3bbb_c764deb2",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 10
      },
      "lineNbr": 1893,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "Nit: missing new line.",
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_ab81a995",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 10
      },
      "lineNbr": 1893,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "770d3bbb_c764deb2",
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_cb57559a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ActionJson.java",
        "patchSetId": 10
      },
      "lineNbr": 28,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "@Singleton",
      "range": {
        "startLine": 28,
        "startChar": 13,
        "endLine": 28,
        "endChar": 23
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "770d3bbb_0700b6a1",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ActionJson.java",
        "patchSetId": 10
      },
      "lineNbr": 28,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f7df6b54_cb57559a",
      "range": {
        "startLine": 28,
        "startChar": 13,
        "endLine": 28,
        "endChar": 23
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_6b67418b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ActionJson.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "Revisions is singleton itself. So this class doesn\u0027t have any state and can be also singleton.",
      "range": {
        "startLine": 29,
        "startChar": 16,
        "endLine": 29,
        "endChar": 25
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_8b86eda9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ActionJson.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f7df6b54_6b67418b",
      "range": {
        "startLine": 29,
        "startChar": 16,
        "endLine": 29,
        "endChar": 25
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_ab5c09bf",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "All new REST endpoints (and the new code generally) should be test covered. With acceptance test framework it\u0027s only 11 LoC:\n\n  public class ActionsIT extends AbstractDaemonTest {\n  @Test\n  public void revisionActions() throws Exception {\n    assertThat(getActions(createChange().getChangeId())).hasSize(1);\n  }\n  private Map\u003cString, ActionInfo\u003e getActions(String changeId)\n      throws IOException {\n    return newGson().fromJson(\n        adminSession.get(\"/changes/\"\n            + changeId\n            + \"/revisions/1/actions\").getReader(),\n        new TypeToken\u003cMap\u003cString, ActionInfo\u003e\u003e() {}.getType());\n  }\n  [...]\n\nThis test is failing: expected only one action: cherry-pick, but in fact two actions are returned: submit + cherry-pick. That\u0027s because Submit.getDescription() was broken in this series. On stable-2.9 the code is:\n\n  return new UiAction.Description()\n      .setTitle(String.format(\n          \"Submit patch set %d into %s\",\n          resource.getPatchSet().getPatchSetId(),\n          resource.getChange().getDest().getShortName()))\n      .setVisible(!resource.getPatchSet().isDraft()\n          \u0026\u0026 resource.getChange().getStatus().isOpen()\n          \u0026\u0026 resource.getPatchSet().getId().equals(current)\n          \u0026\u0026 resource.getControl().canSubmit());\n\n\nWhile in this series true just set directly:\n\n  return new UiAction.Description()\n      .setLabel(label)\n      .setTitle(...)\n      .setVisible(true);",
      "range": {
        "startLine": 27,
        "startChar": 13,
        "endLine": 27,
        "endChar": 31
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "770d3bbb_e7b6c2bb",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "Nit: Unneeded space.",
      "range": {
        "startLine": 27,
        "startChar": 43,
        "endLine": 27,
        "endChar": 44
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d73267d2_cad0c354",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Thanks a lot for pointing out how to test this. I will include a test in the next revision of this change.\n\nI do not quite understand how the UiAction.Description() broke down by that change. I\u0027ll try to play around with that and understand it. Are you hinting at the .setVisible(true);\nas opposed to .setVisible(\u003cvariable\u003e) being different there?",
      "parentUuid": "f7df6b54_ab5c09bf",
      "range": {
        "startLine": 27,
        "startChar": 13,
        "endLine": 27,
        "endChar": 31
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "770d3bbb_e72b622a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "770d3bbb_e7b6c2bb",
      "range": {
        "startLine": 27,
        "startChar": 43,
        "endLine": 27,
        "endChar": 44
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "972c6f7c_88edf718",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T19:36:52Z",
      "side": 1,
      "message": "I think what you\u0027re trying to say is this. When querying a  newly created change, you\u0027d get\n\n)]}\u0027\n{\n  \"submit\": {\n    \"method\": \"POST\",\n    \"label\": \"Submit whole topic\",\n    \"title\": \"Other changes in this topic are not ready\"\n  },\n  \"cherrypick\": {\n    \"method\": \"POST\",\n    \"label\": \"Cherry Pick\",\n    \"title\": \"Cherry pick change to a different branch\",\n    \"enabled\": true\n  }\n}\n\nThe submit should not be there (it\u0027s missing an enabled:true, but that\u0027s not what it used to be historically), so you\u0027d rather expect:\n\n)]}\u0027\n{\n  \"cherrypick\": {\n    \"method\": \"POST\",\n    \"label\": \"Cherry Pick\",\n    \"title\": \"Cherry pick change to a different branch\",\n    \"enabled\": true\n  }\n}\n\nand that\u0027s it.",
      "parentUuid": "d73267d2_cad0c354",
      "range": {
        "startLine": 27,
        "startChar": 13,
        "endLine": 27,
        "endChar": 31
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d73267d2_6af997d5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T20:06:38Z",
      "side": 1,
      "message": "Thinking about it further, why would we not send disabled but visible actions via the rest API? The action being disabled is a valuable information to have, though it may be harder for the client to check what is allowed to be done, i.e. in a script. Though as I\u0027d plan to use this feature in the web UI and want to give feedback to the users why you cannot submit, this is really needed to be exposed in the call.",
      "parentUuid": "972c6f7c_88edf718",
      "range": {
        "startLine": 27,
        "startChar": 13,
        "endLine": 27,
        "endChar": 31
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "972c6f7c_88497779",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-04T07:34:22Z",
      "side": 1,
      "message": "What I was trying to say is that if someone with ACL+2 would use new REST endpoint for new change (that wasn\u0027t approved yet) with topic assigned, then different results are returned dependend on `wholeTopicEnabled` being set or not:\n\n\n* without `wholeTopicEnabled` option submit action is  returned as visible and enabled:\n\n  \"submit\": {\n    \"method\": \"POST\",\n    \"label\": \"Submit\",\n    \"title\": \"Submit patch set 1 into master\",\n    \"enabled\": true\n  },\n  \"cherrypick\": {\n    \"method\": \"POST\",\n    \"label\": \"Cherry Pick\",\n    \"title\": \"Cherry pick change to a different branch\",\n    \"enabled\": true\n  }\n\n\n* with `wholeTopicEnabled` option submit action is returned without enabled being set\n\n\n  \"submit\": {\n    \"method\": \"POST\",\n    \"label\": \"Submit whole topic\",\n    \"title\": \"Other changes in this topic are not ready\"\n  },\n  \"cherrypick\": {\n    \"method\": \"POST\",\n    \"label\": \"Cherry Pick\",\n    \"title\": \"Cherry pick change to a different branch\",\n    \"enabled\": true\n  }\n\n\nBut you are right, historically it was always that way. Sorry for the confusion here, this series didn\u0027t break it. Submit action was always returned as enabled for users with ACL+2 and UI decided on its own if submit action should be hidden or not, dependend on votes. This logic is pretty complex, so may be we just want to leave it as is for now.\n\nOTOH: When revision actions were returned as part of the GET /changes/\u003cid\u003e/detail request, it was possible for the caller to induce the fact if submit button should be hidden or not, dependend on labels that were returned as part of the detail REST endpoint. Now, when only revision actiosn are returned in this new isolated form, there is no way for the caller to decide if submit action should be hidden or not. It would always need to call detail REST endpoint to figure it out.",
      "parentUuid": "d73267d2_6af997d5",
      "range": {
        "startLine": 27,
        "startChar": 13,
        "endLine": 27,
        "endChar": 31
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d73267d2_ca18c375",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 27,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-04T21:25:51Z",
      "side": 1,
      "message": "Yeah I address that in Ief2d4677208900143a67db7b06882e24d1bf2a5d\n\nWhat you can see on the web UI and what you are told by the REST API are different. So I want to make the REST API the one and only truth and rip out the additional logic in the change screen for the web UI.\n\nThat change is addressing your concern such that you only need to ask for /changes/\u003cid\u003e/revisions/\u003cid\u003e/actions and you\u0027re all set, no further thinking required. \nUnfortunately this will also slightly change the  /changes/\u003cid\u003e/detail request.",
      "parentUuid": "972c6f7c_88497779",
      "range": {
        "startLine": 27,
        "startChar": 13,
        "endLine": 27,
        "endChar": 31
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_eb5211ac",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 28,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "Just ActionJson, after ActionJson was changed to singleton. The rest of this file should be adjusted correspndingly.",
      "range": {
        "startLine": 28,
        "startChar": 16,
        "endLine": 28,
        "endChar": 36
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "770d3bbb_a7256a55",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 28,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f7df6b54_eb5211ac",
      "range": {
        "startLine": 28,
        "startChar": 16,
        "endLine": 28,
        "endChar": 36
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7df6b54_8b614d79",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 37,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-02-03T10:43:08Z",
      "side": 1,
      "message": "All these exceptions are unsed. \"Exception\" is never used in real code, only in unit tests.",
      "range": {
        "startLine": 36,
        "startChar": 52,
        "endLine": 37,
        "endChar": 63
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "770d3bbb_c7305e99",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/GetRevisionActions.java",
        "patchSetId": 10
      },
      "lineNbr": 37,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-02-03T18:06:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f7df6b54_8b614d79",
      "range": {
        "startLine": 36,
        "startChar": 52,
        "endLine": 37,
        "endChar": 63
      },
      "revId": "64cc829f5548aff69e99a4feb3319a559959f98f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}