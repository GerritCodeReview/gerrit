{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "bd1727b6_b52bd35a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2022-09-06T07:56:11Z",
      "side": 1,
      "message": "Are we confident that we are not going to roll back the experiment (i.e. due to the increased latency)?",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "81b2ecca_2b8d089c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-09-06T08:30:13Z",
      "side": 1,
      "message": "We know the root cause b/244740368 and it\u0027s a KI in RefDatabase\u0027s prefix scan. With the root cause fixed I expect us back to normal latencies.\nWith the delta slowness, the experiment is live for nearly a month, so yes I\u0027m confident we are OK to proceed.",
      "parentUuid": "bd1727b6_b52bd35a",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b3025922_176cea72",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-09-06T09:33:51Z",
      "side": 1,
      "message": "Hi Edwin, would you please approve this change?\n\n@ekempin@google.com",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbd8319c_cc56c975",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-09-06T21:04:32Z",
      "side": 1,
      "message": "\u003e We know the root cause b/244740368 and it\u0027s a KI in RefDatabase\u0027s prefix scan. With the root cause fixed I expect us back to normal latencies.\n\nWhat about for non-Google sites? Are you confident they won\u0027t have performance problems due to this change?",
      "parentUuid": "81b2ecca_2b8d089c",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c5890fd_55a4e1eb",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 2
      },
      "lineNbr": 4657,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-09-06T09:48:10Z",
      "side": 1,
      "message": "[optional] Should we add a similar test to verify that posting a draft comment no longer triggers indexing the change?",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b6086d62_e151c89a",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 2
      },
      "lineNbr": 4657,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-09-06T12:31:39Z",
      "side": 1,
      "message": "Update: I wrote a test and it failed (even with the follow up change). It seems like something else is indexing the change when drafts are created.",
      "parentUuid": "0c5890fd_55a4e1eb",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aaad51ff_5b0aedec",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 2
      },
      "lineNbr": 4657,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-09-06T13:01:01Z",
      "side": 1,
      "message": "[comment for self]\n\nAfter debugging, the call to \"put star\" does not go through the indexing in BatchUpdate:L634 (see [1]). The call to put a draft comment goes through that code.\n\nStars is bound in AccountRestApiModule. \"Put Star\" is implemented in \"StarredChanges.Create\". This calls starredChangesUtil.star() which opens the repo directly and adds the star, and it does not go through BatchUpdate.\n\nIt seems like we **always** reindex changes for all BatchUpdate(s), including updates with draft comments only. Maybe we need to tweak the logic there and exclude reindexing in such case.  \n\n[1] https://gerrit.googlesource.com/gerrit/+/5077d22696b1d1e2e2224ee06aeab897e87c2bbe/java/com/google/gerrit/server/update/BatchUpdate.java#635",
      "parentUuid": "b6086d62_e151c89a",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a9118a78_797f7e73",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 2
      },
      "lineNbr": 4657,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2022-09-06T14:00:57Z",
      "side": 1,
      "message": "Fixed separately in https://gerrit-review.googlesource.com/c/gerrit/+/344876/1",
      "parentUuid": "aaad51ff_5b0aedec",
      "revId": "64df5ae23920a42a73e9812e2335194e27912b67",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}