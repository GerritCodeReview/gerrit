{
  "comments": [
    {
      "key": {
        "uuid": "72dfed7f_a2e8fe2f",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/InitModule.java",
        "patchSetId": 16
      },
      "lineNbr": 36,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-04T21:28:57Z",
      "side": 1,
      "message": "Doesn\u0027t work for me to set up Gerrit with auto site initialization in Tomcat from scratch, using instructions from the comments to ps 13:\n\n* get that change \u0026 create gerrit.war\n* installed apache-tomcat-7.0.42\n* copy dependent library (h2-1.3.168.jar) to $TOMCAT_HOME/lib\n* defined `jdbc/ReviewDb` JNDI property and point to the non existent site_path: /home/davido/projects/test_site_auto\n* copy gerrit.war to $TOMCAT_HOME/webapps\n* add export CATALINA_OPTS\u003d\"-Dgerrit.init -Dgerrit.init_path\u003d/home/davido/projects/test_site_auto\" in custom start script\n* start container\n\nResult:\n\n* site path was created, with only db directory with ReviewDB files:\n\n davido@linux-ucwl:~/projects/test_site_auto$ ls -R\n .:\n db\n ./db:\n ReviewDB.h2.db  ReviewDB.trace.db\n\n* in Tomcat log was this:\n\n [2013-09-05 00:58:09,369] INFO  com.google.gerrit.httpd.SiteInitializer : Initializing site at /home/davido/projects/test_site_auto\n[2013-09-05 00:58:09,603] ERROR com.google.gerrit.httpd.SiteInitializer : Site init failed\ncom.google.gerrit.pgm.util.Die: Guice creation errors:\n\n1) No implementation for java.util.List\u003cjava.lang.String\u003e annotated with @com.google.gerrit.pgm.init.InstallPlugins() was bound.\n  while locating java.util.List\u003cjava.lang.String\u003e annotated with @com.google.gerrit.pgm.init.InstallPlugins()\n    for parameter 1 at com.google.gerrit.pgm.init.InitFlags.\u003cinit\u003e(InitFlags.java:44)\n  at com.google.gerrit.pgm.init.InitModule.configure(InitModule.java:36)\n\n1 error\n\tat com.google.gerrit.pgm.util.AbstractProgram.die(AbstractProgram.java:87)\n\tat com.google.gerrit.pgm.BaseInit.createSiteInit(BaseInit.java:156)\n\tat com.google.gerrit.pgm.BaseInit.run(BaseInit.java:68)\n\tat com.google.gerrit.httpd.SiteInitializer.init(SiteInitializer.java:60)\n\tat com.google.gerrit.httpd.WebAppInitializer.init(WebAppInitializer.java:119)\n\tat com.google.gerrit.httpd.WebAppInitializer.getInjector(WebAppInitializer.java:322)\n\tat com.google.inject.servlet.GuiceServletContextListener.contextInitialized(GuiceServletContextListener.java:47)\n\tat com.google.gerrit.httpd.WebAppInitializer.init(WebAppInitializer.java:328)\n\tat org.apache.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:281)\n\tat org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:262)\n\tat org.apache.catalina.core.ApplicationFilterConfig.\u003cinit\u003e(ApplicationFilterConfig.java:107)\n\tat org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:4775)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5452)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:976)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1653)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n Caused by: java.lang.RuntimeException: InitInjector failed\n\t... 23 more\n Caused by: com.google.inject.CreationException: Guice creation errors:\n\n 1) No implementation for java.util.List\u003cjava.lang.String\u003e annotated with @com.google.gerrit.pgm.init.InstallPlugins() was  \nbound.\n  while locating java.util.List\u003cjava.lang.String\u003e annotated with @com.google.gerrit.pgm.init.InstallPlugins()\n    for parameter 1 at com.google.gerrit.pgm.init.InitFlags.\u003cinit\u003e(InitFlags.java:44)\n  at com.google.gerrit.pgm.init.InitModule.configure(InitModule.java:36)\n\n1 error\n\tat com.google.inject.internal.Errors.throwCreationExceptionIfErrorsExist(Errors.java:448)\n\tat com.google.inject.internal.InternalInjectorCreator.initializeStatically(InternalInjectorCreator.java:155)\n\tat com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:107)\n\tat com.google.inject.Guice.createInjector(Guice.java:96)\n\tat com.google.gerrit.pgm.BaseInit.createSiteInit(BaseInit.java:138)\n\t... 22 more",
      "revId": "67aebb9381e66e98cf8cd2dcabee2d4191318f72",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a75045a5_fc5c492d",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/InitModule.java",
        "patchSetId": 16
      },
      "lineNbr": 36,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2013-09-13T08:59:31Z",
      "side": 1,
      "message": "The patch-set was broken at several places. All issues should be fixed in the PS-17.\n\nNow about your test:\n\n\u003e defined `jdbc/ReviewDb` JNDI property and point to the non existent site_path: /home/davido/projects/test_site_auto\n\nThis was wrong. The jdbc/ReviewDb JNDI should define a DataSource that provides connection to a database. An example from my Tomcat test instance:\n\n  $ cat conf/context.xml\n  \u003cContext\u003e\n    ...\n    \u003cResource name\u003d\"jdbc/ReviewDb\" auth\u003d\"Container\" type\u003d\"javax.sql.DataSource\"\n        maxActive\u003d\"100\" maxIdle\u003d\"30\" maxWait\u003d\"10000\"\n        username\u003d\"postgres\" password\u003d\"postgres\" driverClassName\u003d\"org.postgresql.Driver\"\n        url\u003d\"jdbc:postgresql://localhost/reviewdb\"/\u003e\n    ...\n  \u003c/Context\u003e",
      "parentUuid": "72dfed7f_a2e8fe2f",
      "revId": "67aebb9381e66e98cf8cd2dcabee2d4191318f72",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "874d0112_7b491f65",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/InitModule.java",
        "patchSetId": 16
      },
      "lineNbr": 36,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-13T09:50:50Z",
      "side": 1,
      "message": "\"This was wrong\":\n\nI quoted your \"Example 3\". If it is wrong, why not to fix the commit message? I think it is misleading formulated and i proposed to explain it in more details, in this comment:\n\n https://gerrit-review.googlesource.com/#/c/46171/13/Documentation/config-auto-site-initialization.txt\n\nAgain my test case is:\n\n* get the last ps from that change \u0026 build gerrit.war\n* install apache-tomcat-7.0.42\n* copy dependent library (h2-1.3.168.jar) to $TOMCAT_HOME/lib\n* define `jdbc/ReviewDb` dara source and point it to the non existent site_path: /home/davido/projects/test_site_auto:\n\nAdd to $TOMCAT_HOME/conf/context.xml something like that\n \u003cResource\n    name\u003d\"jdbc/ReviewDb\"\n    type\u003d\"javax.sql.DataSource\"\n    username\u003d\"\"\n    driverClassName\u003d\"org.h2.Driver\"\n    password\u003d\"\"\n    url\u003d\"jdbc:h2:file:/home/davido/projects/test_site_auto/db/ReviewDB\"\n    maxActive\u003d\"100\"\n    maxIdle\u003d\"20\"/\u003e\n\n* copy gerrit.war to $TOMCAT_HOME/webapps\n* add export CATALINA_OPTS\u003d\"-Dgerrit.init -Dgerrit.init_path\u003d/home/davido/projects/test_site_auto\" in custom start script\n* start container via custom script",
      "parentUuid": "a75045a5_fc5c492d",
      "revId": "67aebb9381e66e98cf8cd2dcabee2d4191318f72",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a75045a5_1c46d554",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/InitModule.java",
        "patchSetId": 16
      },
      "lineNbr": 36,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2013-09-13T11:10:48Z",
      "side": 1,
      "message": "\u003e I quoted your \"Example 3\". If it is wrong, why not to fix the commit message? I think it is misleading formulated and i proposed to explain it in more details, in this comment:\n...\n\nThere are a lot of comments from you in that file. Which one did you refer to?\nWhich exactly part of the commit message should be fixed? Maybe comment directly on that part of the commit message?\n\n\u003e copy dependent library (h2-1.3.168.jar) to $TOMCAT_HOME/lib\n\nI don\u0027t think you need to do that as h2 jdbc driver is packed in the gerrit.war.\n\n\u003e define `jdbc/ReviewDb` dara source and point it to the non existent site_path: /home/davido/projects/test_site_auto\n\nAs said, jdbc/ReviewDb should be a DataSource, not a file path.\n\nThe rest of your test case looks OK.",
      "parentUuid": "874d0112_7b491f65",
      "revId": "67aebb9381e66e98cf8cd2dcabee2d4191318f72",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a75045a5_dc862d6a",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/InitModule.java",
        "patchSetId": 16
      },
      "lineNbr": 36,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-09-13T11:47:05Z",
      "side": 1,
      "message": "\u003eAs said, jdbc/ReviewDb should be a DataSource, not a file path.\n\nNow i understand the problem: i meant H2 DataSource, that is file based, and need a path inside DataSource definition. That path doesn\u0027t exist. Just to make it clear.\n\n\u003eMaybe comment directly on that part of the commit message?\n\nGood suggestion. Actually commit message is duplicated in config-auto-site-initialization.txt. So i am going to comment it there.",
      "parentUuid": "a75045a5_1c46d554",
      "revId": "67aebb9381e66e98cf8cd2dcabee2d4191318f72",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}