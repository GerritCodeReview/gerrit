{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "96922442_f31f0dbc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-12-15T23:50:04Z",
      "side": 1,
      "message": "We use https://github.com/quic/lockers for this as it has cluster support (with both bare metal and k8s). I think the repo on github is slightly out of date, so I\u0027ll see if I can push the recent updates tomorrow.",
      "range": {
        "startLine": 9,
        "startChar": 4,
        "endLine": 9,
        "endChar": 9
      },
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c97547f5_6b373f1d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2022-12-16T10:56:16Z",
      "side": 1,
      "message": "I prefer the simpler setup using flock, didn\u0027t try on NFS but according to several SO articles that should work at least on NFSv4.",
      "parentUuid": "96922442_f31f0dbc",
      "range": {
        "startLine": 9,
        "startChar": 4,
        "endLine": 9,
        "endChar": 9
      },
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a874a71f_d081c986",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2022-12-16T13:41:43Z",
      "side": 1,
      "message": "let\u0027s try this like that",
      "parentUuid": "c97547f5_6b373f1d",
      "range": {
        "startLine": 9,
        "startChar": 4,
        "endLine": 9,
        "endChar": 9
      },
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e2c85200_17f754cd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 9,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-12-16T19:08:16Z",
      "side": 1,
      "message": "Sure. I also saw you had a comment about handling stale lock cleanup in a follow up change and I wanted to point out that the quic/lockers do that already, including safely for k8s where you could have split brain scenarios.",
      "parentUuid": "a874a71f_d081c986",
      "range": {
        "startLine": 9,
        "startChar": 4,
        "endLine": 9,
        "endChar": 9
      },
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7505e01c_fccf00e1",
        "filename": "contrib/git-gc-preserve",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-12-16T07:41:27Z",
      "side": 1,
      "message": "nit: trailing whitespace",
      "range": {
        "startLine": 38,
        "startChar": 51,
        "endLine": 38,
        "endChar": 52
      },
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2f025476_ba52b130",
        "filename": "contrib/git-gc-preserve",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2022-12-16T08:49:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7505e01c_fccf00e1",
      "range": {
        "startLine": 38,
        "startChar": 51,
        "endLine": 38,
        "endChar": 52
      },
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ad0f4bc_804c7927",
        "filename": "contrib/git-gc-preserve",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-12-16T07:40:07Z",
      "side": 1,
      "message": "This will not work for `kill -9`, the same should be the case if the machine crashes. Thus, we should take care of stale locks. This can be done in a followup change.",
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d886f2c5_3ed82112",
        "filename": "contrib/git-gc-preserve",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2022-12-16T08:49:39Z",
      "side": 1,
      "message": "This will still unlock since `kill -9` on the process holding the lock closes the open file handle. It will not delete the lock file. But the next run of `git-gc-preserve` will do if it\u0027s not killed forcefully again.\n\nTried that and it works:\n\nacquire an exclusive lock in terminal 1:\n\n`flock -nx ~/tmp/test.lock sleep infinity`\n\ntry to get the same lock from another terminal:\n\n`flock test.lock echo \"doit\"`\n\nthis second process will hang since it can\u0027t acquire the lock held by the first process. `kill -9` on the first process closes the open file handle and the second process proceeds by printing `doit`.",
      "parentUuid": "3ad0f4bc_804c7927",
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "58503082_30656c5b",
        "filename": "contrib/git-gc-preserve",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2022-12-16T10:56:16Z",
      "side": 1,
      "message": "this works",
      "parentUuid": "d886f2c5_3ed82112",
      "revId": "67ebcf1e0c7aa5710af3f91f76f5cb3314d0820e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}