{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2dbc5f7e_f60e1b34",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 7,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-09-07T11:48:09Z",
      "side": 1,
      "message": "Sorry I still have some concerns/questions about this change.\n\nCurrently accounts are indexed when:\n1. the account or its external IDs are updated via AccountsUpdate\n2. the account is updated by push to refs/users/ (via ReindexAfterRefUpdate)\n\nBut not when the external IDs are updated by push to refs/meta/external-ids.\n\nIIUC this change is about indexing accounts in the latter case (push to refs/meta/external-ids)? If yes, please add a test for this (push to refs/meta/external-ids and verify that the account is reindexed) and consider changing the subject line to something like \"Index account when its ext IDs are updated by git push\".\n\nWhat is not clear to me yet, why indexing the affected accounts on push to refs/meta/external-ids is (more) important now? Only admins should have access to refs/meta/external-ids and they should be able to index the affected accounts manually when they do manual updates in refs/meta/external-ids. It\u0027s surely nice to have automatic indexing in this case, but I\u0027m not sure if this change actually improves the situation. Instead of manually indexing the account after updating external IDs by push to refs/meta/external-ids, admins now need to do an artificial update in the refs/users/ refs which is no easier than doing an reindex account call. Actually it\u0027s more difficult since the SHA1 of the refs/meta/external-ids branch needs to be included and if you do the refs/users/ update manually there may be races with updating it. \n\nI\u0027m also not sure that adding the SHA1 in refs/users/ is a good idea if there are is no actual use case for reading it.",
      "revId": "67efbc5d3771ba8427d392757c6ceab5c299ec8f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4ce0d70f_abd48930",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 7,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-09-07T11:52:07Z",
      "side": 1,
      "message": "\u003e IIUC this change is about indexing accounts in the latter case (push to refs/meta/external-ids)?\n\nUps, actually this change doesn\u0027t help with this. The account is only indexed when the refs/users/ ref is updated. So I\u0027m still confused what\u0027s the benefit of this change.",
      "parentUuid": "2dbc5f7e_f60e1b34",
      "revId": "67efbc5d3771ba8427d392757c6ceab5c299ec8f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "709ecb05_280b91d5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 7,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-09-07T11:56:05Z",
      "side": 1,
      "message": "Basically what I don\u0027t understand is this:\nAccountsUpdate takes care to index the account. Now AccountsUpdate updates refs/users/ when external IDs are updated, so that the account can be indexed by listening to ref update events on refs/users/. Why is this needed if AccountsUpdate already triggers account indexing explicitly?",
      "parentUuid": "4ce0d70f_abd48930",
      "revId": "67efbc5d3771ba8427d392757c6ceab5c299ec8f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bfa223d1_1a1b4378",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 7,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2022-09-07T13:51:29Z",
      "side": 1,
      "message": "See [1]. Previously, the account reindexing for externalIds-only update was requested from externalIdsNotes explicitly.\nNow the reindexing in this line will not be triggered.\n\nThe change is needed for the indexing fallback path in our index implementation. I will send you a link outside of this change.\n\n\n[1]https://gerrit.googlesource.com/gerrit/+/67efbc5d3771ba8427d392757c6ceab5c299ec8f/java/com/google/gerrit/server/account/AccountsUpdate.java#544",
      "parentUuid": "709ecb05_280b91d5",
      "revId": "67efbc5d3771ba8427d392757c6ceab5c299ec8f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}