{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1d056133_d2c57b46",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "allows",
      "range": {
        "startLine": 13,
        "startChar": 38,
        "endLine": 13,
        "endChar": 43
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4f7616b1_73717328",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "I think referring to external IDs as \"case insensitive\" or \"case sensitive\" is a bit misleading.\n\nThis flag changes _how_ the SHA-1 of the username is computed, by either preserving the case of the external ID or not, but there is no such a thing as \"case insensitive\" or \"case sensitive\" external ID.\n\nI think it would benefit to rephrase it so that this is clear.",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 32
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7913dec7_627affc9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-11-08T18:24:13Z",
      "side": 1,
      "message": "this how it was expressed in the original change so I want to keep the convention:\nhttps://gerrit-review.googlesource.com/q/topic:case-insensitive-usernames",
      "parentUuid": "4f7616b1_73717328",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 32
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3eb65f95_74a459c4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T18:56:37Z",
      "side": 1,
      "message": "Which part of those changes you refer to?\nI think the official documentation[1], explains it properly:\n\n```\nBy default, the SHA-1 sum is computed preserving the case of the external ID. If auth.userNameCaseInsensitive` is set to true, the SHA-1 sum of external IDs in the gerrit: and username: schemes are computed from the all lowercase external ID. This enables case insensitive username handling. The case of the external ID is however preserved by using the original capitalization in the note content.```\n\n[1]https://gerrit-review.googlesource.com/Documentation/config-accounts.html",
      "parentUuid": "7913dec7_627affc9",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 32
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "423619f7_b6b49372",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 13,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "The documentation is more accurate, but Marcin is right, in some places like the migration tool, I used similar wording, which is not accurate.\nUsernames will become case insensitive. The external ID will be computed from the lowercase username instead of the mixedCase username.\nAlso, not all external IDs are converted, only the ones in the GERRIT: and USERNAME: scheme.\nIn my experience, it is really hard to be accurate AND concise, when describing what is happening here.\nMaybe use: `Adding migration mode allows to fallback to case sensitive behavior if the migrated external ID cannot be found.`",
      "parentUuid": "3eb65f95_74a459c4",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 32
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1ada17b_e2a16d77",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 14,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "consider: while Gerrit process is running?",
      "range": {
        "startLine": 14,
        "startChar": 5,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74069f47_6f82ea84",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-09T14:12:23Z",
      "side": 1,
      "message": "Adding Thomas who developed the case-insensitive username feature: I believe that adding the migration trial mode to the ExternalId key is spilling off complexity everywhere.\n\n@Thomas to do see a better way?",
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae846d5a_7a64ecae",
        "filename": "java/com/google/gerrit/pgm/init/ExternalIdsOnInit.java",
        "patchSetId": 4
      },
      "lineNbr": 71,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "Apologies if this has been covered already, but I coulnd\u0027t find any discussion about this.\nI don\u0027t fully understand the difference and overlapping between \n\nthis.isUserNameCaseInsensitive\n\nand\n\nauthConfig.isUserNameCaseInsensitiveMigrationMode\n\nWhat would it mean for example if the migrationMode was on and the auth.userNameCaseInsensitive was false?",
      "range": {
        "startLine": 71,
        "startChar": 0,
        "endLine": 71,
        "endChar": 69
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d357bfc_4ebeb5d1",
        "filename": "java/com/google/gerrit/pgm/init/ExternalIdsOnInit.java",
        "patchSetId": 4
      },
      "lineNbr": 71,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-11-08T18:18:57Z",
      "side": 1,
      "message": "if you set isUserNameCaseInsensitive this means that all external id sha1 are calculated with lower case. If you set isUserNameCaseInsensitive to true without running the migration duplicate accounts will be created. With this change and setting isUserNameCaseInsensitiveMigrationMode to true we notify the system that we are during the migration to the lower case sha1 so part of the accounts can be already migrated but some of them might not be. That\u0027s why if Gerrit is not able to find external id with lower case sha1 it should try with sha1 which preserves the case sensivity.",
      "parentUuid": "ae846d5a_7a64ecae",
      "range": {
        "startLine": 71,
        "startChar": 0,
        "endLine": 71,
        "endChar": 69
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97111493_ff64248d",
        "filename": "java/com/google/gerrit/pgm/init/ExternalIdsOnInit.java",
        "patchSetId": 4
      },
      "lineNbr": 71,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "There should be no duplicate account, if the migration was not done, but isUserNameCaseInsensitive is true, because the email of that user would already exist and thus Gerrit would complain about that the email is already registered for an account with a different username. The user would see an error during login in this case.",
      "parentUuid": "2d357bfc_4ebeb5d1",
      "range": {
        "startLine": 71,
        "startChar": 0,
        "endLine": 71,
        "endChar": 69
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04b58a56_102d6262",
        "filename": "java/com/google/gerrit/server/account/AccountManager.java",
        "patchSetId": 4
      },
      "lineNbr": 149,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-09T14:12:23Z",
      "side": 1,
      "message": "What the value of looking up the legacy one for migration mode here *IF* you are going to create a new one anyway?\n\nDo you need instead two different if() conditions instead?",
      "range": {
        "startLine": 149,
        "startChar": 8,
        "endLine": 149,
        "endChar": 21
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f31dedf_6a8a1740",
        "filename": "java/com/google/gerrit/server/account/AccountManager.java",
        "patchSetId": 4
      },
      "lineNbr": 149,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-11-09T14:19:48Z",
      "side": 1,
      "message": "Not sure if I understand. externalIds.get() will check the lower case sha1 and if cannot find external id and isUserNameCaseInsensitiveMigrationMode is set to true it will try with the old(case sensitive sha1) only when both cannot be found it will create new one",
      "parentUuid": "04b58a56_102d6262",
      "range": {
        "startLine": 149,
        "startChar": 8,
        "endLine": 149,
        "endChar": 21
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e6f27fe_4409c1a1",
        "filename": "java/com/google/gerrit/server/account/externalids/AllExternalIds.java",
        "patchSetId": 4
      },
      "lineNbr": 98,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "What\u0027s the benefit of saving the migration mode in the serialized cache Key?\nIsn\u0027t the sha1 enough to load the key?",
      "range": {
        "startLine": 98,
        "startChar": 0,
        "endLine": 98,
        "endChar": 57
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e1060b7_da2a324f",
        "filename": "java/com/google/gerrit/server/account/externalids/AllExternalIds.java",
        "patchSetId": 4
      },
      "lineNbr": 98,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-09T14:12:23Z",
      "side": 1,
      "message": "@Marcin Is it possibly for storing the \"migration status\" of the accounts? Are you planning to get rid of it afterwards?",
      "parentUuid": "0e6f27fe_4409c1a1",
      "range": {
        "startLine": 98,
        "startChar": 0,
        "endLine": 98,
        "endChar": 57
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97bfe597_a264ff52",
        "filename": "java/com/google/gerrit/server/account/externalids/AllExternalIds.java",
        "patchSetId": 4
      },
      "lineNbr": 98,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-11-09T14:19:48Z",
      "side": 1,
      "message": "I don\u0027t think we need to store it, same as we don\u0027t need to store the proto.getIsCaseInsensitive(), I\u0027m checking why it\u0027s done in that way.",
      "parentUuid": "5e1060b7_da2a324f",
      "range": {
        "startLine": 98,
        "startChar": 0,
        "endLine": 98,
        "endChar": 57
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c51a0dc8_e070ec30",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalId.java",
        "patchSetId": 4
      },
      "lineNbr": 182,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "Do we really need to store this value in the object? Wouldn\u0027t it be enough to use the configuration in the ExternalIdKeyFactory and set the isCaseInsensitive value accordingly?",
      "range": {
        "startLine": 182,
        "startChar": 59,
        "endLine": 182,
        "endChar": 97
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e79bdd98_1f9a99bb",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdFactory.java",
        "patchSetId": 4
      },
      "lineNbr": 264,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "Not only the case sensitive, but also the case insensitive SHA1 does not match the note ID in this case. The error message is thus a bit misleading and should be improved.",
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54218120_d6338875",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdKeyFactory.java",
        "patchSetId": 4
      },
      "lineNbr": 80,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "To reduce code duplication, just call `create(String scheme, String id, boolean isUserNameCaseInsensitive)` in this method.",
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77c3c4be_ba087d4a",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdNotes.java",
        "patchSetId": 4
      },
      "lineNbr": 211,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "authConfig",
      "range": {
        "startLine": 211,
        "startChar": 19,
        "endLine": 211,
        "endChar": 25
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50241552_61a889ae",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdNotes.java",
        "patchSetId": 4
      },
      "lineNbr": 515,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "If you follow my suggestion to not store `isUserNameCaseInsensitiveMigrationMode` in the ExternalId.Key object, you could create a method in ExternalIdKeyFactory that takes an existing key and returns a key with switched case sensitivity, which could be used here.",
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b352a205_6492b997",
        "filename": "java/com/google/gerrit/server/account/externalids/testing/ExternalIdTestUtil.java",
        "patchSetId": 4
      },
      "lineNbr": 72,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "nit: consider naming this boolean?",
      "range": {
        "startLine": 72,
        "startChar": 58,
        "endLine": 72,
        "endChar": 63
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52cf5305_31aaf8b9",
        "filename": "java/com/google/gerrit/server/config/AuthConfig.java",
        "patchSetId": 4
      },
      "lineNbr": 250,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T17:18:36Z",
      "side": 1,
      "message": "This gives the idea that a migration is actively in progress, but that\u0027s not the case right?\n\nAs I understand it just shows whether we gerrit should _fallback_ checking usernames insensitively rather than checking them by preserving the case.",
      "range": {
        "startLine": 250,
        "startChar": 0,
        "endLine": 250,
        "endChar": 68
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1bab866a_7ce56b97",
        "filename": "java/com/google/gerrit/server/config/AuthConfig.java",
        "patchSetId": 4
      },
      "lineNbr": 250,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-11-08T18:24:13Z",
      "side": 1,
      "message": "It actually means that the migration is in progress. This means that some of the accounts can be already migrated and some not. To handle this situation if Gerrit is not able to find external id with case insensitive sha1 it should fallback to case sensitive one",
      "parentUuid": "52cf5305_31aaf8b9",
      "range": {
        "startLine": 250,
        "startChar": 0,
        "endLine": 250,
        "endChar": 68
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ec3246a_c1579a18",
        "filename": "java/com/google/gerrit/server/config/AuthConfig.java",
        "patchSetId": 4
      },
      "lineNbr": 250,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-08T18:56:37Z",
      "side": 1,
      "message": "What happens to this setting when the migration is finished?",
      "parentUuid": "1bab866a_7ce56b97",
      "range": {
        "startLine": 250,
        "startChar": 0,
        "endLine": 250,
        "endChar": 68
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5a246eb_7a8d797d",
        "filename": "java/com/google/gerrit/server/config/AuthConfig.java",
        "patchSetId": 4
      },
      "lineNbr": 250,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-11-09T13:08:53Z",
      "side": 1,
      "message": "It depends, on a node where the migration is happening this property will be set to false on other nodes needs to be done manually",
      "parentUuid": "0ec3246a_c1579a18",
      "range": {
        "startLine": 250,
        "startChar": 0,
        "endLine": 250,
        "endChar": 68
      },
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01f53163_0108777f",
        "filename": "javatests/com/google/gerrit/server/account/externalids/ExternalIDCacheLoaderTest.java",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-11-09T15:11:49Z",
      "side": 1,
      "message": "Seems to be an unrelated addition of the import.",
      "revId": "6814a62cc8c6f8b4068503f471d4cd37fa3fb8a6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}