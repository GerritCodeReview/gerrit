{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "6528e3a5_c42a1936",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-01-19T16:56:02Z",
      "side": 1,
      "message": "can you say something about why it\u0027s OK to do this now? What instrumentation did you add?\n\n",
      "revId": "69cf745119ae344c472a7713062673c62600fb82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "913e831f_e9bbe7cd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-01-19T17:49:27Z",
      "side": 1,
      "message": "I didn\u0027t add any instrumentation yet. I did a manual inspection before but couldn\u0027t find anything. I was thinking to:\n  1) Debug again the execution in prd and look at metrics.\n  2) Add more tests in google3.\n\nWe can hold on submitting this change until I add more tests first.",
      "parentUuid": "6528e3a5_c42a1936",
      "revId": "69cf745119ae344c472a7713062673c62600fb82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e509faf9_301ce2cc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-01-19T18:03:03Z",
      "side": 1,
      "message": "if we reverted this change the first time it went in, we\u0027ll probably revert the second time too, so submitting as is won\u0027t yield progress.\n\nHow about having both code paths at the same time, and verifying that you get the same keys or the same values?\n\nOr use a gerrit config to switch which flavor to use, and so you can debug both code paths in real-time using a setting on canary.\n\nHow does the fetch/hit metric work for the getAll() end point? If you do getAll() for 1,000 accounts does that add 1000 lookup counts, or 1 count?",
      "parentUuid": "913e831f_e9bbe7cd",
      "revId": "69cf745119ae344c472a7713062673c62600fb82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cc542a2d_6e067a52",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-01-19T18:22:47Z",
      "side": 1,
      "message": "I Haven\u0027t thought about switching between implementations with a config. I like the idea, thanks for the suggestion. I can do that.\n\nThe operation will increment hit counts by 1000, but we don\u0027t differentiate between get() and getAll() here. But we also include a PerformanceLog with a special event BATCH_READ. Patrick and I were able to find those when I was looking at the misses before.",
      "parentUuid": "e509faf9_301ce2cc",
      "revId": "69cf745119ae344c472a7713062673c62600fb82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "34a8b28a_6260989a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-01-19T19:15:10Z",
      "side": 1,
      "message": "I would add to this, can you leave this change unsubmitted? It doesn\u0027t feel right to submit experimental code just for testing purposes.",
      "parentUuid": "cc542a2d_6e067a52",
      "revId": "69cf745119ae344c472a7713062673c62600fb82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9950e6fb_cf643634",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-01-20T10:18:55Z",
      "side": 1,
      "message": "Thanks Nasser. To clarify: this change is a no/op in the open source project; it just replaces multiple cache get() with a single getAll() call.\n\nI reverted this change previously because in google3 we use different bindings for MemoryCacheFactory, which rely on different storage instead of h2 for persisted caches. In this implementation, I did override getAll / getAllPresent and added some optimizations that seemingly did not work well. I added a change in google3 to gate this optimization with a config so that I can test it in our testing environment, etc... I\u0027ll also see if I can add more tests in google3.\n\n@Hanwen, @Nasser, since the optimization is now gated with a config, I think it\u0027s safe to submit this change. Please +2 or let me know your opinion.",
      "parentUuid": "34a8b28a_6260989a",
      "revId": "69cf745119ae344c472a7713062673c62600fb82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}