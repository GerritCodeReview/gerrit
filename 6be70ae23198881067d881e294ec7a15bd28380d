{
  "comments": [
    {
      "key": {
        "uuid": "AAAB1n////w\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 918,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2012-01-05T03:19:14Z",
      "side": 1,
      "message": "This feels wrong to me. Why are we copying all approvals in this change onto the most recent patch set? Shouldn\u0027t we copy only the approvals of the patch set we are cherry-picking?\n\nThat is, assume:\n\n  patch set 1:  Bob +2, Sally: no-vote\n  patch set 2:  Bob 0, Sally: +2, Submit\n\nWhen we create patch set 3 here, we should show Sally +2, Submit on patch set 3, and nothing about Bob. Yet this loop is going to copy Bob\u0027s +2 on patch set 1 forward to patch set 3.",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAB2H////4\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 918,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2012-01-05T04:13:37Z",
      "side": 1,
      "message": "Ugh, you are exactly right.  I\u0027m disappointed I missed this... I\u0027ll upload a fixed patch set tomorrow.  Edwin, maybe this is a good test for me to add once your test stuff gets in?\n\nBy the same token, is it odd to have the submit approval on patch set 2 and the cherry-picked patch set 3?  I can remove that approval from ps n-1 during the same loop if that makes sense.",
      "parentUuid": "AAAB1n////w\u003d",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAB1n////0\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 920,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2012-01-05T03:19:14Z",
      "side": 1,
      "message": "This is a really inefficient loop, but I agree we should at least make sure we copy over everything. So lets apply this change and worry about improving the performance of this loop later.\n\n(FWIW loops like this are probably why submit on gerrit-review.googlesource.com are so slow. Each iteration takes on the order of 200+ milliseconds. Copy 5 approvals and its suddenly a full second.)",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAB2H////0\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 920,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2012-01-05T04:13:37Z",
      "side": 1,
      "message": "Is there much we can do to improve this within the current orm?  I believe none of the projects on gerrit-review.googlesource.com uses cherry-pick merge strategy, so this particular loop shouldn\u0027t be impacting performance there, right?",
      "parentUuid": "AAAB1n////0\u003d",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABwn///y4\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 1266,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2011-12-30T21:40:26Z",
      "side": 1,
      "message": "It\u0027d be nice to just call this rather than re-implement the loop at line 1343...",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABwn///zA\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 1345,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2011-12-30T21:40:26Z",
      "side": 1,
      "message": "If we don\u0027t add the submit category when cherry-picking, we never find the submitter here.  So submitter stays as null, which causes an NPE lower down.\n\nOne option I considered - this code is nearly identical to the private getSubmitter() method on line 1267, except getSubmitter() doesn\u0027t match up the patch set IDs, and it also doesn\u0027t call a.cache(c).  I\u0027d like to remove the duplication and just call getSubmitter() here, but I\u0027m not sure what the a.cache(c) call does.",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABwn///yw\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 1345,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2011-12-31T19:31:55Z",
      "side": 1,
      "message": "I believe that approvals cache the state of a change in them (open/merged...).  I guess this is for dashboards: someone recently had a dashboard which claimed the change was merged, but it showed up in their dash in the middle section as if it were open, this was because the approval change status did not match what the change said, he filed an issue for it last week I think.  So, I suspect the a.cache(c) simply updates the change merged status in the approval, but I haven\u0027t looked at the code, I just thought it might help you figure it out to have that background info.\n\nAs for the patchset Id, note that 1279 searches by patchset, whereas 1339 grabs all the approvals for the entire change.",
      "parentUuid": "AAABwn///zA\u003d",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABwn///y8\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 1
      },
      "lineNbr": 1386,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2011-12-30T21:40:26Z",
      "side": 1,
      "message": "We get an NPE here when using cherry-pick mode.",
      "revId": "6be70ae23198881067d881e294ec7a15bd28380d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}