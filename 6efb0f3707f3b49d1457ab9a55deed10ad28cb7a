{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4445873e_8c78bb00",
        "filename": "java/com/google/gerrit/server/project/SubmitRequirementsAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 136,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-09-21T12:21:26Z",
      "side": 1,
      "message": "Should this only be set for the MAX case? \n\nI think the ignoreSelfApproval flag should not affect vetos.\nIf I read the new condition correctly, submit would wrongly be possible if there is a veto from the uploader (aka self veto)?",
      "range": {
        "startLine": 133,
        "startChar": 11,
        "endLine": 136,
        "endChar": 94
      },
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23da35c3_3a8d49ac",
        "filename": "java/com/google/gerrit/server/project/SubmitRequirementsAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 136,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-09-21T12:50:04Z",
      "side": 1,
      "message": "MAX_WITH_BLOCK is translated to:\n  label:$label\u003dMAX,user\u003dnon_uploader -label:$label\u003dMIN,user\u003dnon_uploader\n  \nThe non_uploader arg in both min/max predicates means that uploader votes will be filtered out. But still a MAX from non-uploaders is required, **and** a MIN from non-uploaders is blocking. Same goes for ANY_WITH_BLOCK.\n\n\n\n\u003e label:$label\u003dMIN,user\u003dnon_uploader\n\nmeans: match with changes having a min vote from a non_uploader. Hence negation means match with changes that don\u0027t have a min vote from a non_uploader.\nIf a non_uploader voted -2, `label:$label\u003dMIN,user\u003dnon_uploader` will be true, \u0027-label:$label\u003dMIN,user\u003dnon_uploader\u0027 will be false for this change and the change will be blocked.\n\nUpdate: If uploader votes -2, their vote is going to be filtered out and will not override the second part of the expression. Am I missing something?\n\nI can try this scenario with an IT to make sure it works as I want it to be.",
      "parentUuid": "4445873e_8c78bb00",
      "range": {
        "startLine": 133,
        "startChar": 11,
        "endLine": 136,
        "endChar": 94
      },
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32f299be_02e64985",
        "filename": "java/com/google/gerrit/server/project/SubmitRequirementsAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 136,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-09-21T13:16:15Z",
      "side": 1,
      "message": "\u003e **and** a MIN from non-uploaders is blocking. \n\nExactly. I think that a MIN from the uploader should also be blocking (even if ignoreSelfApproval is true, as the name ignoreSelfApproval says this is only about ignoring self approvals, but not about ignoring self vetos, is it?).",
      "parentUuid": "23da35c3_3a8d49ac",
      "range": {
        "startLine": 133,
        "startChar": 11,
        "endLine": 136,
        "endChar": 94
      },
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f2465670_8c7391c3",
        "filename": "java/com/google/gerrit/server/project/SubmitRequirementsAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 136,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-09-21T13:24:15Z",
      "side": 1,
      "message": "OK, now I understand your point. I think you\u0027re right. Current IgnoreSelfApprovalRule [1] shows that we filter out positive approvals of uploader, but not negative ones. Hence a MIN vote from uploader should not be ignored and should still be blocking.\n\nWill do.\n\n[1] https://gerrit.googlesource.com/gerrit/+/eac146867589d183f03cd53fde7655f7a0af8ca2/java/com/google/gerrit/server/rules/IgnoreSelfApprovalRule.java#125",
      "parentUuid": "32f299be_02e64985",
      "range": {
        "startLine": 133,
        "startChar": 11,
        "endLine": 136,
        "endChar": 94
      },
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4cc2df2d_62e8b615",
        "filename": "java/com/google/gerrit/server/project/SubmitRequirementsAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 136,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-09-22T09:56:04Z",
      "side": 1,
      "message": "Done. \n\n  * I removed the \"user\u003dnon_uploader\" from the min predicate.\n  * Updated the commit message.\n  * Added an IT in ChangeIT to assert the behaviour when expression is equivalent to the max with block case.",
      "parentUuid": "f2465670_8c7391c3",
      "range": {
        "startLine": 133,
        "startChar": 11,
        "endLine": 136,
        "endChar": 94
      },
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "faf64dfe_f13844a2",
        "filename": "javatests/com/google/gerrit/server/project/SubmitRequirementsAdapterTest.java",
        "patchSetId": 2
      },
      "lineNbr": 157,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2021-09-21T12:21:26Z",
      "side": 1,
      "message": "nit: too long line, here and in l. 177 below, can you please wrap at 100 chars?",
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5ef9f9fc_6ce4f41f",
        "filename": "javatests/com/google/gerrit/server/project/SubmitRequirementsAdapterTest.java",
        "patchSetId": 2
      },
      "lineNbr": 157,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-09-22T09:56:04Z",
      "side": 1,
      "message": "Done. No longer long.",
      "parentUuid": "faf64dfe_f13844a2",
      "revId": "6efb0f3707f3b49d1457ab9a55deed10ad28cb7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}