{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "f205d485_6a1096dc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 17
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-11-27T17:57:26Z",
      "side": 1,
      "message": "@david.ostrovsky@gmail.com I have done some tests (in a docker container gerritforge/gerrit-release-bazel:debian-bullseye)\n\n- Test 1:\n\n```\nbazelisk  test //javatests/... --config\u003dremote_bb --remote_header\u003dx-buildbuddy-api-key\u003dXXXXX\n```\n\nResult: Succesful\n\n- Test 2:\n\n```\nbazelisk  test //javatests/... --config\u003dremote11_bb --remote_header\u003dx-buildbuddy-api-key\u003dXXXXX\n```\n\nResult: Succesful\n\n- Test 3:\n\n```\nbazelisk  test \\\n--config\u003dremote_bb \\\n--remote_header\u003dx-buildbuddy-api-key\u003dXXXXX \\\n--flaky_test_attempts 3 \\\n--test_timeout 3600 \\\n--test_tag_filters\u003d-flaky,-elastic,-no_rbe \\\n//...\n```\n\nResult: Failed 3 times in the same test:\n\n```\nThere was 1 failure:\n1) invalidTargetArchiveFolder(com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest)\nexpected: /buildbuddy/remotebuilds/9812aa4d-4b39-405e-bc45-6662fc6d7b28/_tmp/1a603f63979fdbf7741d14f4152518a3/junit8509788577984914603/data\nbut was : /\\\\\\\n    at com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest.invalidTargetArchiveFolder(ConfigurationTest.java:127)\n\nFAILURES!!!\nTests run: 45,  Failures: 1\n```\n\n- Test 4:\n\n```\nbazelisk  test \\\n--config\u003dremote11_bb \\\n--remote_header\u003dx-buildbuddy-api-key\u003dXXXXX \\\n--flaky_test_attempts 3 \\\n--test_timeout 3600 \\\n--test_tag_filters\u003d-flaky,-elastic,-no_rbe \\\n//...\n```\n\n\nResult: Failed 3 times in the same test:\n```\nThere was 1 failure:\n1) invalidTargetArchiveFolder(com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest)\nexpected: /buildbuddy/remotebuilds/b32ea687-69a4-4aa5-9398-c06cefd8cdfe/_tmp/1a603f63979fdbf7741d14f4152518a3/junit14292937447987984095/data\nbut was : /\\\\\\\n    at com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest.invalidTargetArchiveFolder(ConfigurationTest.java:127)\n\nFAILURES!!!\nTests run: 45,  Failures: 1\n\n```\n\n\nI think I am missing something when I execute the test remotely against the target `//...`",
      "revId": "6f0979980f916199a5065cea2d3c6fca4a66466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "923fda08_eeed899f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 17
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2023-11-28T09:02:56Z",
      "side": 1,
      "message": "The difference between javatests/... and //...:  also plugin tests are executed.\n\nCan you take RBE-BB out of the picture, start their docker image directly and run delete-plugin test there like this:\n\n```bash\n  $ bazel test plugins/delete-project/...\n```",
      "parentUuid": "f205d485_6a1096dc",
      "revId": "6f0979980f916199a5065cea2d3c6fca4a66466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ccd9bd93_9c90bdb0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 17
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-11-28T10:47:44Z",
      "side": 1,
      "message": "- Local tests:\n```\n$ bazelisk test plugins/delete-project/...\n```\n\n**Tests pass**\n\n\n- Remote tests:\n```\n$bazelisk test --flaky_test_attempts 3 --config\u003dremote_bb  --remote_header\u003dx-buildbuddy-api-key\u003dXXXX plugins/delete-project/...\n```\n\n**Tests fail**\n\n```\nThere was 1 failure:\n1) \ninvalidTargetArchiveFolder(com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest)\nexpected: /buildbuddy/remotebuilds/1d9f2dcf-1db8-4ee4-82c2-94c5f3519f10/_tmp/1a603f63979fdbf7741d14f4152518a3/junit16069211931322936868/data\nbut was : /\\\\\\\n        at com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest.invalidTargetArchiveFolder(ConfigurationTest.java:127)\nFAILURES!!!\nTests run: 45,  Failures: 1\n```\n\nAny thought? Could it be the docker image used by BuildBuddy for running the sandboxed environment? Apologies for my lack of accuracy in the Bazel terminology.",
      "parentUuid": "923fda08_eeed899f",
      "revId": "6f0979980f916199a5065cea2d3c6fca4a66466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ffa2c605_cd0e22bc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 17
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-11-30T14:06:08Z",
      "side": 1,
      "message": "I have been analysing the test [1] when I run it locally (the test passes) there is an exception raised [2]:\n\n```\njava.nio.file.FileSystemException: /\\\\\\: Operation not permitted\n\tat java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:100)\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:106)\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.createDirectory(UnixFileSystemProvider.java:397)\n\tat java.base/java.nio.file.Files.createDirectory(Files.java:700)\n\tat java.base/java.nio.file.Files.createAndCheckIsDirectory(Files.java:807)\n\tat java.base/java.nio.file.Files.createDirectories(Files.java:793)\n\tat com.googlesource.gerrit.plugins.deleteproject.Configuration.getArchiveFolderFromConfig(Configuration.java:107)\n\tat com.googlesource.gerrit.plugins.deleteproject.Configuration.\u003cinit\u003e(Configuration.java:67)\n\tat com.googlesource.gerrit.plugins.deleteproject.ConfigurationTest.invalidTargetArchiveFolder(ConfigurationTest.java:125)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n\tat org.mockito.internal.runners.DefaultInternalRunner$1$1.evaluate(DefaultInternalRunner.java:55)\n\tat org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)\n\tat org.junit.rules.RunRules.evaluate(RunRules.java:20)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat org.mockito.internal.runners.DefaultInternalRunner$1.run(DefaultInternalRunner.java:100)\n\tat org.mockito.internal.runners.DefaultInternalRunner.run(DefaultInternalRunner.java:107)\n\tat org.mockito.internal.runners.StrictRunner.run(StrictRunner.java:42)\n\tat org.mockito.junit.MockitoJUnitRunner.run(MockitoJUnitRunner.java:163)\n\tat org.junit.runners.Suite.runChild(Suite.java:128)\n\tat org.junit.runners.Suite.runChild(Suite.java:27)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat com.google.testing.junit.runner.internal.junit4.CancellableRequestFactory$CancellableRunner.run(CancellableRequestFactory.java:108)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:115)\n\tat com.google.testing.junit.runner.junit4.JUnit4Runner.run(JUnit4Runner.java:116)\n\tat com.google.testing.junit.runner.BazelTestRunner.runTestsInSuite(BazelTestRunner.java:145)\n\tat com.google.testing.junit.runner.BazelTestRunner.main(BazelTestRunner.java:76)\n```\n\nHowever when the test is executed with BuildBuddy RBE that exception is not raised and as a consequence of that the test ends up failing. It looks that the folder `/\\\\\\` is created in the remote executor.\n\n@david.ostrovsky@gmail.com, wdyt?\nReferences:\n[1] https://gerrit.googlesource.com/plugins/delete-project/+/refs/heads/master/src/test/java/com/googlesource/gerrit/plugins/deleteproject/ConfigurationTest.java#119\n[2]",
      "parentUuid": "ccd9bd93_9c90bdb0",
      "revId": "6f0979980f916199a5065cea2d3c6fca4a66466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "92e64d45_1d0ea787",
        "filename": "tools/remote-bazelrc",
        "patchSetId": 17
      },
      "lineNbr": 63,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2023-11-28T09:02:56Z",
      "side": 1,
      "message": "Nit: blank after # character, like in all comment lines below.",
      "range": {
        "startLine": 63,
        "startChar": 0,
        "endLine": 63,
        "endChar": 14
      },
      "revId": "6f0979980f916199a5065cea2d3c6fca4a66466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9b16b1e8_a870a073",
        "filename": "tools/remote-bazelrc",
        "patchSetId": 17
      },
      "lineNbr": 63,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-11-28T10:47:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "92e64d45_1d0ea787",
      "range": {
        "startLine": 63,
        "startChar": 0,
        "endLine": 63,
        "endChar": 14
      },
      "revId": "6f0979980f916199a5065cea2d3c6fca4a66466b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}