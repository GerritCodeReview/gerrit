{
  "comments": [
    {
      "key": {
        "uuid": "af33c57d_82eb5a19",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-14T22:43:14Z",
      "side": 1,
      "message": "Good news: plugins are installed. Bad news: Gerrit doesn\u0027t start on tomcat-7 (not sure if it is related to this change, or if -Dgerrit.init was already broken before). My steps:\n\n* buck build release\n* deploy buck-out/gen/release.war to $tomcat-7/webapps\n* set -Dgerrit.init -Dgerrit.init_path\u003d/non-existing-path\n* start tomcat\n\nLog:\n\n http://paste.openstack.org/show/65586\n\nInit site seems to be uncomplete, for example index directory is missing:\n\n http://paste.openstack.org/show/65589/\n\nHowever if i call init manually, all is fine, Gerrit starts and index directory is there:\n\n http://paste.openstack.org/show/65588/\n\nDoes it work for you to initialize site from scratch, example 3 in your original change [1]?\n\n [1] https://gerrit-review.googlesource.com/#/c/46171",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 60
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf7b9935_4b1ca57f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-17T10:25:33Z",
      "side": 1,
      "message": "For me it works, the index folder is created and populated and Gerrit starts successfully.\nI am testing with a local postgres server.\n\nWhat have you configured as your jdbc/ReviewDb JNDI resource in your Tomcat?",
      "parentUuid": "af33c57d_82eb5a19",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 60
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af6ae563_6a14f75f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-17T10:41:09Z",
      "side": 1,
      "message": "More or less the same steps as described in the comment Sep 13 11:50 AM change:\n\n https://gerrit-review.googlesource.com/#/c/46171/16/gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/InitModule.java\n\nCan you try it with non existing H2 Database:\n\n \u003cResource\n    name\u003d\"jdbc/ReviewDb\"\n    type\u003d\"javax.sql.DataSource\"\n    username\u003d\"\"\n    driverClassName\u003d\"org.h2.Driver\"\n    password\u003d\"\"\n    url\u003d\"jdbc:h2:file:/home/davido/projects/test_site_auto/db/ReviewDB\"\n    maxActive\u003d\"100\"\n    maxIdle\u003d\"20\"/\u003e",
      "parentUuid": "cf7b9935_4b1ca57f",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 60
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af6ae563_8a312b09",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-19T13:39:28Z",
      "side": 1,
      "message": "OK, I finally understood why it doesn\u0027t work with the embedded H2 database.\n\nThe problem is that SitePaths.isNew will be false for a H2 based new site because as soon as the first DB connection is open the site folder will be created (because it is the parent folder for the \u0027db\u0027 folder). therefore isNew \u003d false and this cause the InitIndex (line 82) to skip lucene index creation.\n\nHowever, if you want to use embedded H2 then there is no need to specify -Dgerrit.init_path plus the ReviewDb JNDI resource (which you have to point to the correct folder...). It is easier and more natural to specify -Dgerrit.site_path\u003d... and let Gerrit create H2 database under that folder. JNDI resource is not needed. However, auto init with -Dgerrit.site_path was broken (was probably never working. This is fixed in [1].\n\n[1] https://gerrit-review.googlesource.com/54730",
      "parentUuid": "af6ae563_6a14f75f",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 60
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af6ae563_ca9e4354",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-19T14:18:27Z",
      "side": 1,
      "message": "\u003e  JNDI resource is not needed\n\nHow that?",
      "parentUuid": "af6ae563_8a312b09",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 60
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2f8fd5ae_9e029d26",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-20T08:32:49Z",
      "side": 1,
      "message": "When gerrit.site_path is defined then Gerrit startup first looks at that path and then uses etc/gerrit.config (database section) in order to find the database. So, in that case JNDI is not used to locate the database.\n\nIf gerrit.site_path is not defined then Gerrit startup first connects to the database defined via JNDI, looks in the system_config table and its site_path column in order to find the review site folder.",
      "parentUuid": "af6ae563_ca9e4354",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 60
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af33c57d_62ee562c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-02-14T22:43:14Z",
      "side": 1,
      "message": "We may want to install also foreign plugins with gerrit.init  option, not packaged in release.war, i. e. delete-project, for example by putting it in some directory and passing this directory to gerrit.init with system property? Dariusz made it possible in this change with --with-secure-store-plugin option [1].\n\n [1] https://gerrit-review.googlesource.com/#/c/48180",
      "range": {
        "startLine": 11,
        "startChar": 21,
        "endLine": 12,
        "endChar": 13
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af6ae563_ca02c327",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-17T10:25:33Z",
      "side": 1,
      "message": "I agree, this should also be supported... but in a follow up change.",
      "parentUuid": "af33c57d_62ee562c",
      "range": {
        "startLine": 11,
        "startChar": 21,
        "endLine": 12,
        "endChar": 13
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f8a112f_0d03512c",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/BaseInit.java",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-02-14T16:07:00Z",
      "side": 1,
      "message": "\"Couldn\u0027t find distribution archive location.\" ?",
      "range": {
        "startLine": 139,
        "startChar": 16,
        "endLine": 139,
        "endChar": 55
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af6ae563_ea078734",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/BaseInit.java",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-17T10:25:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0f8a112f_0d03512c",
      "range": {
        "startLine": 139,
        "startChar": 16,
        "endLine": 139,
        "endChar": 55
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ef969d57_ccf78ffe",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/GerritDistributionLocator.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-02-14T16:07:00Z",
      "side": 1,
      "message": "the",
      "range": {
        "startLine": 29,
        "startChar": 15,
        "endLine": 29,
        "endChar": 16
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf7b9935_6b19618e",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/GerritDistributionLocator.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-17T10:25:33Z",
      "side": 1,
      "message": "Thanks.\nProper usage of articles in english (and german too) is something that I am always struggling with.\n\nDone.",
      "parentUuid": "ef969d57_ccf78ffe",
      "range": {
        "startLine": 29,
        "startChar": 15,
        "endLine": 29,
        "endChar": 16
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ef969d57_ecf44bfc",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/GerritDistributionLocator.java",
        "patchSetId": 1
      },
      "lineNbr": 31,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-02-14T16:07:00Z",
      "side": 1,
      "message": "of the",
      "range": {
        "startLine": 31,
        "startChar": 26,
        "endLine": 31,
        "endChar": 29
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af6ae563_8afccbde",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/init/GerritDistributionLocator.java",
        "patchSetId": 1
      },
      "lineNbr": 31,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2014-02-17T10:25:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ef969d57_ecf44bfc",
      "range": {
        "startLine": 31,
        "startChar": 26,
        "endLine": 31,
        "endChar": 29
      },
      "revId": "70c6edc848c61785892616d38d9b09dd5e059187",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}