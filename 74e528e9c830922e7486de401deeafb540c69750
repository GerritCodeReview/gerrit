{
  "comments": [
    {
      "key": {
        "uuid": "9b7ce22a_a6ed0f6c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:04Z",
      "side": 1,
      "message": "nit: capital T\n\nnit: \"Disallow topics that contain a quotation mark\"",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 1
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bcbd4d78_9022dfbc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-03-24T08:10:12Z",
      "side": 1,
      "message": "\"not allowed\" or \"disallowed\"\n\nor rewrite as suggested by Patrick",
      "range": {
        "startLine": 7,
        "startChar": 18,
        "endLine": 7,
        "endChar": 32
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "055ead19_119ffe35",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9b7ce22a_a6ed0f6c",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 1
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04cbb88f_e059bc08",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bcbd4d78_9022dfbc",
      "range": {
        "startLine": 7,
        "startChar": 18,
        "endLine": 7,
        "endChar": 32
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da78b20f_3aa5e08b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2020-03-23T18:40:35Z",
      "side": 1,
      "message": "test2",
      "range": {
        "startLine": 10,
        "startChar": 20,
        "endLine": 10,
        "endChar": 24
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cde5ed60_73427eeb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "da78b20f_3aa5e08b",
      "range": {
        "startLine": 10,
        "startChar": 20,
        "endLine": 10,
        "endChar": 24
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f783ed7_c298bf89",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T15:04:15Z",
      "side": 1,
      "message": "I\u0027m afraid this covers only one of the places where a topic is set (other places that I have in my mind are: setting topic on push, setting topic via the CreateChange REST endpoint, setting topic via the Revert REST endpoint, but there may be more). So I\u0027m wondering it there is a better place to do this kind of validation in a lower layer that makes this work consistently across all cases.",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "363d41a6_9407f900",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:07:21Z",
      "side": 1,
      "message": "Ah, comments raced, but we had the same thought :-)",
      "parentUuid": "9f783ed7_c298bf89",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a962906_5f8e8733",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-23T16:05:30Z",
      "side": 1,
      "message": "Thanks you both for the quick review :)\n\nThis is more complicated than what I thought.\nI\u0027ve been looking into RestApiServlet and I think I can come up with a way to convert the request body into a string and look for \"topic:\". If the subsequent string has a \", it means it\u0027s a bad request.",
      "parentUuid": "363d41a6_9407f900",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51f5f5dc_bee44130",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T16:19:10Z",
      "side": 1,
      "message": "Maybe it would be better to check this in ChangeUpdate.setTopic?",
      "parentUuid": "0a962906_5f8e8733",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b3bac79_ad7d2430",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2020-03-23T18:38:55Z",
      "side": 1,
      "message": "the check should be closer to the storage layer, I think. You should check in the place that writes the topic string into notedb.",
      "parentUuid": "0a962906_5f8e8733",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dfcb58bf_e5da19d3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "Yep,ChangeUpdate is the storage layer.",
      "parentUuid": "0b3bac79_ad7d2430",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa66b5dd_f1ecca65",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 2
      },
      "lineNbr": 894,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:04Z",
      "side": 1,
      "message": "I think we\u0027ve been way too generous with what we allow in a topic. Instead of blocking chars one by one that we don\u0027t like, can we work with a whitelist instead?\n\nFor example, just allow: [0-9A-Za-z\\-] (upper case, lower case, numbers and a dash).\n\nWe\u0027d need to check what topics currently look like to make sure this isn\u0027t overly restrictive.",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5802e95_dbcd862c",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 2
      },
      "lineNbr": 894,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-03-24T08:10:12Z",
      "side": 1,
      "message": "What will happen to any existing topics that don\u0027t conform to this whitelist?",
      "parentUuid": "aa66b5dd_f1ecca65",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "00c59a7f_d02c3ceb",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 2
      },
      "lineNbr": 894,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "All current topics that don\u0027t conform to the whitelist will stay the same.\n\nI\u0027m not sure if there is a need to do this whitelist: What reason do we have to block so many characters?\nI think users can reasonably use _, %, ^, (,), and maybe Russian characters as far as I\u0027m concerned.\nI think we should just stick with blocking the character that makes bugs like \".\n\nAlso, I\u0027ve ensured that (almost) nobody used topics with a quotation mark in the past few months, but there are plenty of topics that don\u0027t conform to the whitelist.\n\nIf necessary, in the future this is an easy change to make.\nWDYT?",
      "parentUuid": "b5802e95_dbcd862c",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c685525_3c1b96ae",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 2
      },
      "lineNbr": 894,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-24T11:32:51Z",
      "side": 1,
      "message": "\u003e All current topics that don\u0027t conform to the whitelist will stay the same.\n\nI believe this could cause issues. E.g. if we would disallow the invalid characters for topics on NoteDb level, trying to revert an old change that has a topic that is now invalid will fail, as we try to set the topic of the reverted change on the newly created revert change (where it would get rejected). It\u0027s possible there are more such cases where the topic of an existing change is applied to a new change.",
      "parentUuid": "00c59a7f_d02c3ceb",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "018471df_357a3054",
        "filename": "java/com/google/gerrit/server/restapi/change/PutTopic.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:45Z",
      "side": 1,
      "message": "IIRC topics can also be set using a git push option. Can you check that that code path (and maybe others) are accurately protected as well?",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3817e62a_984eee1e",
        "filename": "java/com/google/gerrit/server/restapi/change/PutTopic.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "I\u0027ve manually ensured that Revert and Create have the same code path, and it\u0027s kind of clear that they do since the code was added in the NoteDb layer.\nI think it\u0027s not necessary to write a test for all of those different code paths since it would just be a duplicate test.",
      "parentUuid": "018471df_357a3054",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d01cf8d3_0a1f6985",
        "filename": "java/com/google/gerrit/server/restapi/change/PutTopic.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:04Z",
      "side": 1,
      "message": "nit: reuse checks:\n\nif (input !\u003d null \u0026\u0026 input.topic !\u003d null) {\nif(input.topic.length() \u003e ChangeUtil.TOPIC_MAX_LENGTH) {\n      throw new BadRequestException(\n          String.format(\"topic length exceeds the limit (%s)\", ChangeUtil.TOPIC_MAX_LENGTH));\n}\nif(input.topic.contains(\"\\\"\")) {\nthrow new BadRequestException(\"topic can\u0027t contain the character \\\".\");\n}\n}",
      "range": {
        "startLine": 51,
        "startChar": 1,
        "endLine": 60,
        "endChar": 5
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b21b13b_cee16349",
        "filename": "java/com/google/gerrit/server/restapi/change/PutTopic.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-24T11:16:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d01cf8d3_0a1f6985",
      "range": {
        "startLine": 51,
        "startChar": 1,
        "endLine": 60,
        "endChar": 5
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}