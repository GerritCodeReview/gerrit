{
  "comments": [
    {
      "key": {
        "uuid": "9b7ce22a_a6ed0f6c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:04Z",
      "side": 1,
      "message": "nit: capital T\n\nnit: \"Disallow topics that contain a quotation mark\"",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 1
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "da78b20f_3aa5e08b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2020-03-23T18:40:35Z",
      "side": 1,
      "message": "test2",
      "range": {
        "startLine": 10,
        "startChar": 20,
        "endLine": 10,
        "endChar": 24
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f783ed7_c298bf89",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T15:04:15Z",
      "side": 1,
      "message": "I\u0027m afraid this covers only one of the places where a topic is set (other places that I have in my mind are: setting topic on push, setting topic via the CreateChange REST endpoint, setting topic via the Revert REST endpoint, but there may be more). So I\u0027m wondering it there is a better place to do this kind of validation in a lower layer that makes this work consistently across all cases.",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "363d41a6_9407f900",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:07:21Z",
      "side": 1,
      "message": "Ah, comments raced, but we had the same thought :-)",
      "parentUuid": "9f783ed7_c298bf89",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a962906_5f8e8733",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-23T16:05:30Z",
      "side": 1,
      "message": "Thanks you both for the quick review :)\n\nThis is more complicated than what I thought.\nI\u0027ve been looking into RestApiServlet and I think I can come up with a way to convert the request body into a string and look for \"topic:\". If the subsequent string has a \", it means it\u0027s a bad request.",
      "parentUuid": "363d41a6_9407f900",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51f5f5dc_bee44130",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T16:19:10Z",
      "side": 1,
      "message": "Maybe it would be better to check this in ChangeUpdate.setTopic?",
      "parentUuid": "0a962906_5f8e8733",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b3bac79_ad7d2430",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2020-03-23T18:38:55Z",
      "side": 1,
      "message": "the check should be closer to the storage layer, I think. You should check in the place that writes the topic string into notedb.",
      "parentUuid": "0a962906_5f8e8733",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa66b5dd_f1ecca65",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 2
      },
      "lineNbr": 894,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:04Z",
      "side": 1,
      "message": "I think we\u0027ve been way too generous with what we allow in a topic. Instead of blocking chars one by one that we don\u0027t like, can we work with a whitelist instead?\n\nFor example, just allow: [0-9A-Za-z\\-] (upper case, lower case, numbers and a dash).\n\nWe\u0027d need to check what topics currently look like to make sure this isn\u0027t overly restrictive.",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "018471df_357a3054",
        "filename": "java/com/google/gerrit/server/restapi/change/PutTopic.java",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:45Z",
      "side": 1,
      "message": "IIRC topics can also be set using a git push option. Can you check that that code path (and maybe others) are accurately protected as well?",
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d01cf8d3_0a1f6985",
        "filename": "java/com/google/gerrit/server/restapi/change/PutTopic.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-23T15:06:04Z",
      "side": 1,
      "message": "nit: reuse checks:\n\nif (input !\u003d null \u0026\u0026 input.topic !\u003d null) {\nif(input.topic.length() \u003e ChangeUtil.TOPIC_MAX_LENGTH) {\n      throw new BadRequestException(\n          String.format(\"topic length exceeds the limit (%s)\", ChangeUtil.TOPIC_MAX_LENGTH));\n}\nif(input.topic.contains(\"\\\"\")) {\nthrow new BadRequestException(\"topic can\u0027t contain the character \\\".\");\n}\n}",
      "range": {
        "startLine": 51,
        "startChar": 1,
        "endLine": 60,
        "endChar": 5
      },
      "revId": "74e528e9c830922e7486de401deeafb540c69750",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}