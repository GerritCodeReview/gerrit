{
  "comments": [
    {
      "key": {
        "uuid": "b1855fa9_5042b2aa",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2018-03-13T23:52:04Z",
      "side": 1,
      "message": "Shouldn\u0027t these also throw PermissionBackendException for the case where the backend has failed?",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44d387d5_6a552ea1",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-03-14T08:17:56Z",
      "side": 1,
      "message": "Actually here the problem is not that the backend has failed, but that the user should not see at all that resource.\n\nPermissionBackendException is more *IF* there is a fatal error on the resolution of the permissions, at least this is my understanding from the review of this change :-)",
      "parentUuid": "b1855fa9_5042b2aa",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb19142b_768aba80",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2018-03-14T08:25:06Z",
      "side": 1,
      "message": "That\u0027s what I mean.  In the case you\u0027re describing, were the user should not see that resource, it should throw AuthException.\n\nBut in the case where checking the permission fails, then the method should still be able to throw PermissionBackendException.\n\nIn other words, should this change rather add AuthException to the throws declaration in addition to PermissionBackendException, instead of replacing it?",
      "parentUuid": "44d387d5_6a552ea1",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57ecbe63_8028c764",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2018-03-14T10:27:20Z",
      "side": 1,
      "message": "I think this change would also throw AuthExceptions in a case where we want to throw a PBE as we have an internal failure.\n\nConsider DefaultPermissionBackend l.88\n\n    @Override\n    public ForProject project(Project.NameKey project) {\n      try {\n        ProjectState state \u003d projectCache.checkedGet(project);\n        if (state !\u003d null) {\n          return projectControlFactory.create(user, state).asForProject().database(db);\n        }\n        return FailedPermissionBackend.project(\"not found\", new NoSuchProjectException(project));\n      } catch (IOException e) {\n        return FailedPermissionBackend.project(\"unavailable\", e);\n      }\n    }\n\nIn the case of an IOException, we want to throw a PBE upon calling check. In the case of \u0027not found\u0027 we probably want to throw an AuthException (that will get converted to \u0027not found\u0027 later up in the call hierarchy so that we don\u0027t leak the existence of resources.\n\nSo I think we need to throw AuthE or PBE depending on the use-case. For a simple fix, we could just check if the cause is a NoSuchProjectException and throw an AuthException in that case and a PBE in all other cases.\n\nWhen I look at all the callers of FailedPermissionBackend, it seems this is pretty much the only case where we do not want to throw a PBE.",
      "parentUuid": "fb19142b_768aba80",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48b8bc5d_2ff2c6b2",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-03-14T12:39:19Z",
      "side": 1,
      "message": "To be honest the name \"FailedPermissionBackend\" is misleading as well: do we want to simulate a persistent failure of evaluating the permissions or just a consistent permission denied?\n\nLet me split the class into two, so that reading the code and understanding what it does it will be so much easier :-)",
      "parentUuid": "57ecbe63_8028c764",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ea9cb40_799820f5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2018-03-14T12:43:10Z",
      "side": 1,
      "message": "\u003e Let me split the class into two, so that reading the code and understanding what it does it will be so much easier :-)\n\n+1 thanks!",
      "parentUuid": "48b8bc5d_2ff2c6b2",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1cd4a060_f7019b63",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/permissions/FailedPermissionBackend.java",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-03-14T15:24:32Z",
      "side": 1,
      "message": "@Patrick all concerns should be addressed now :-)",
      "parentUuid": "9ea9cb40_799820f5",
      "revId": "766bf51302aeeed8bed93e73acfda1e563ee31f3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}