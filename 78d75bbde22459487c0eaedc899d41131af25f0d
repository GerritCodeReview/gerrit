{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ab2edec5_05a5e0ad",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-03-04T08:47:42Z",
      "side": 1,
      "message": "We usually use Gerrit configs for this type of testing. Would that be a better fit here as well?\n\nYou could flip the config for a single host in staging, then the Gerrit host in prd and instantly flip back if it doesn\u0027t work.",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "72bbd9c4_75651946",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-03-04T09:42:15Z",
      "side": 1,
      "message": "I prefer using a request parameter here. This is easier for testing, for example I\u0027d like to look at the response of the same request one time using the old diff implementation then another with the new one.\nHaving a Gerrit config for this will be much more tedious.",
      "parentUuid": "ab2edec5_05a5e0ad",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3ae699a4_3ddc8496",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-03-04T11:51:30Z",
      "side": 1,
      "message": "didn\u0027t maria add support for experiments? (not sure if it\u0027s already available)",
      "parentUuid": "72bbd9c4_75651946",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e4a25b06_924edfda",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-03-04T12:05:49Z",
      "side": 1,
      "message": "We can do this with the existing only implementation: https://gerrit.googlesource.com/gerrit/+/refs/changes/02/296102/8/java/com/google/gerrit/server/experiments/ConfigExperimentFeatures.java,\n\nthough we would need to temporary bind it internally too.",
      "parentUuid": "3ae699a4_3ddc8496",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e182c367_1accd70e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-03-04T12:06:15Z",
      "side": 1,
      "message": "Thanks. I checked https://gerrit-review.googlesource.com/c/gerrit/+/296102 which seems to support experiments as part of the Gerrit Config (Maria can confirm). I can use it for subsequent launches.\n\nFor this change I\u0027d still prefer to use a request parameter as it would make it easier to me for testing (details in my previous comment). Differences are also that a request parameter would only allow me to trigger the new logic, and users will be unaffected.\n\nCurrently I rolled out a dark launch, and the new logic is run async, so I\u0027d use this for inspection and debugging.\n\nIf we don\u0027t want to have this kind of testing I\u0027ll rework this change :-)",
      "parentUuid": "3ae699a4_3ddc8496",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7daced1b_63481506",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-03-04T12:12:51Z",
      "side": 1,
      "message": "i\u0027m fine to go ahead with this way for now. For the frontend, we can switch on/off experiments with a ?experiment\u003d paramater. Maybe we should add this to the backend support for that too?",
      "parentUuid": "e182c367_1accd70e",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "241cea5e_aa65a484",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-03-04T12:22:59Z",
      "side": 1,
      "message": "Sorry for the naive question, if you test it this way, wouldn\u0027t it mean there is a chance that the diff get\u0027s cached (and persisted) with the new implementation (or old), with each subsequent request getting the persisted cached value (regardless of the option?)",
      "parentUuid": "7daced1b_63481506",
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ba0c1a8_0ae6adf5",
        "filename": "java/com/google/gerrit/extensions/client/DiffPreferencesInfo.java",
        "patchSetId": 2
      },
      "lineNbr": 64,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-03-04T08:47:42Z",
      "side": 1,
      "message": "Do we serialize this object into user/project preferences and would that temporary parameter affect that?",
      "range": {
        "startLine": 64,
        "startChar": 16,
        "endLine": 64,
        "endChar": 35
      },
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "72e2dfef_20b2db92",
        "filename": "java/com/google/gerrit/extensions/client/DiffPreferencesInfo.java",
        "patchSetId": 2
      },
      "lineNbr": 64,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-03-04T09:42:15Z",
      "side": 1,
      "message": "Well, I found one occurrence in \"AccountState\" which is using this entity. This has a lot of references, e.g. in AccountCache.\n\nThough this new field can just be neglected (we don\u0027t care about serializing it), I\u0027d better keep it outside of DiffPreferenceInfo.\n\nI updated this change accordingly.",
      "parentUuid": "1ba0c1a8_0ae6adf5",
      "range": {
        "startLine": 64,
        "startChar": 16,
        "endLine": 64,
        "endChar": 35
      },
      "revId": "78d75bbde22459487c0eaedc899d41131af25f0d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}