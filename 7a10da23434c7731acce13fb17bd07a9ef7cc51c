{
  "comments": [
    {
      "key": {
        "uuid": "f6159672_16a2adfd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-03-09T15:11:35Z",
      "side": 1,
      "message": "Can you explain this just a tiny bit more? Why does the query fail in this case? (it\u0027s probably something obvious, but I\u0027m not sure ElasticSearch yet, so it\u0027s not clear to me)",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fde90fbf_3407186e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-10T02:07:52Z",
      "side": 1,
      "message": "Thank you for your questions.\n\nIt\u0027s described at: \n   https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html\n   https://www.elastic.co/guide/en/elasticsearch/reference/7.2/search-request-from-size.html\n\n\"index.max_result_window\nThe maximum value of from + size for searches to this index. Defaults to 10000. Search requests take heap memory and time proportional to from + size and this limits that memory. See Scroll or Search After for a more efficient alternative to raising this.\"\n\n\"Note that from + size can not be more than the index.max_result_window index setting which defaults to 10,000. See the Scroll or Search After API for more efficient ways to do deep scrolling.\"\n\nThe relative ElasticSearch Code is at: \n\nhttps://github.com/elastic/elasticsearch/blob/b2ea32959103b93c03cc487ce475adde792f21e3/server/src/main/java/org/elasticsearch/search/DefaultSearchContext.java#L201\n\nYou can find the exception throws in it when \"if (resultWindow \u003e maxResultWindow) \" is matched. The Exception message is same as the problem i had met described on issue ï¼š\n\n    https://bugs.chromium.org/p/gerrit/issues/detail?id\u003d12444#c_ts1583748039\n\n\nI don\u0027t know whether answer your unclear poinit? Does it make sense to you?",
      "parentUuid": "f6159672_16a2adfd",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6cef72d0_7a29a2c8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-03-10T14:02:21Z",
      "side": 1,
      "message": "That helps, but it doesn\u0027t tell me how Gerrit encounters that issue. This ties into the line above with \"some relative functions such as the front pages and APIs will become unusable\". Are those pages triggering execution of an ES query with a requested result count \u003e max_result_window? If yes, why?",
      "parentUuid": "fde90fbf_3407186e",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78516b45_d909db84",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-10T14:27:01Z",
      "side": 1,
      "message": "Gerrit has 4 types of index : accounts,projects,changes,groups.\n\nIf the index.type is set to elasticsearch, Gerrit will use elasticsearch to index the 4 types documents.\n\nWhen gerrit execute a query on the index(Such as the user is searching on the  Gerrit front pages, The front is make an request to the  Gerrit backend API), then Gerrit will execute an HTTP request to the ElasticSearch API to query the relative data and return the data back to the front user to view the data they want. \n\nBut the result set exists in the index is greater than default value 10000, Gerrit will encounter this issue because the default of ElasticSearch max_result_window is 10000, if the search result is too big on the relative index, ElasticSearch API will return an error response to tip the invoker that the result window is exceeded with the query.\n\n \nThe exception of stack of Gerrit err_log is in :\n    https://bugs.chromium.org/p/gerrit/issues/detail?id\u003d12444\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Err Log from Gerrit Runtime  \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n{\"type\":\"query_phase_execution_exception\",\"reason\":\"Result window is too large, from + size must be less than or equal to: [10000] but was [100000]. See the scroll api for a more efficient way to request large data sets. This limit can be set by changing the [index.max_result_window] index level setting.\"}}]},\"status\":500}\n        com.google.gerrit.server.query.account.InternalAccountQuery.byPreferredEmail(InternalAccountQuery.java:104)\n        at com.google.gerrit.server.account.Emails.lambda$getAccountFor$0(Emails.java:75)\n        at com.github.rholder.retry.AttemptTimeLimiters$NoAttemptTimeLimit.call(AttemptTimeLimiters.java:78)\n        at com.github.rholder.retry.Retryer.call(Retryer.java:160)\n        at com.google.gerrit.server.update.RetryHelper.executeWithTimeoutCount(RetryHelper.java:303)\n        at com.google.gerrit.server.update.RetryHelper.executeWithAttemptAndTimeoutCount(RetryHelper.java:281)\n        at com.google.gerrit.server.update.RetryHelper.execute(RetryHelper.java:217)\n        at com.google.gerrit.server.update.RetryHelper.execute(RetryHelper.java:207)\n        at com.google.gerrit.server.account.Emails.executeIndexQuery(Emails.java:107)\n        at com.google.gerrit.server.account.Emails.getAccountFor(Emails.java:75)\n        at com.google.gerrit.server.patch.PatchSetInfoFactory.toUserIdentity(PatchSetInfoFactory.java:103)\n        at com.google.gerrit.server.patch.PatchSetInfoFactory.get(PatchSetInfoFactory.java:63)\n        at com.google.gerrit.server.patch.PatchSetInfoFactory.get(PatchSetInfoFactory.java:84)com.google.gerrit.server.query.account.InternalAccountQuery.byPreferredEmail(InternalAccountQuery.java:104)\n        at com.google.gerrit.server.account.Emails.lambda$getAccountFor$0(Emails.java:75)\n        at com.github.rholder.retry.AttemptTimeLimiters$NoAttemptTimeLimit.call(AttemptTimeLimiters.java:78)\n        at com.github.rholder.retry.Retryer.call(Retryer.java:160)\n        at com.google.gerrit.server.update.RetryHelper.executeWithTimeoutCount(RetryHelper.java:303)\n        at com.google.gerrit.server.update.RetryHelper.executeWithAttemptAndTimeoutCount(RetryHelper.java:281)\n        at com.google.gerrit.server.update.RetryHelper.execute(RetryHelper.java:217)\n        at com.google.gerrit.server.update.RetryHelper.execute(RetryHelper.java:207)\n        at com.google.gerrit.server.account.Emails.executeIndexQuery(Emails.java:107)\n        at com.google.gerrit.server.account.Emails.getAccountFor(Emails.java:75)\n        at com.google.gerrit.server.patch.PatchSetInfoFactory.toUserIdentity(PatchSetInfoFactory.java:103)\n        at com.google.gerrit.server.patch.PatchSetInfoFactory.get(PatchSetInfoFactory.java:63)\n        at com.google.gerrit.server.patch.PatchSetInfoFactory.get(PatchSetInfoFactory.java:84)\n        ... 10 more\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d Err Log from Gerrit Runtime(end)\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n\n\"{\"type\":\"query_phase_execution_exception\",\"reason\":\"Result window is too large, from + size must be less than or equal to: [10000] but was [100000]. See the scroll api for a more efficient way to request large data sets. This limit can be set by changing the [index.max_result_window] index level setting.\"}}]},\"status\":500}\"\n\nThe message above is actually the response body of ElasticSeach Search API, it tolds us why it fails on the API Invoke. The next error log is the invoke stack of Gerrit Java thread proves what encount the issue.",
      "parentUuid": "6cef72d0_7a29a2c8",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4510bf3c_713e34d7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-03-10T14:35:43Z",
      "side": 1,
      "message": "\u003e Gerrit has 4 types of index : accounts,projects,changes,groups.\n\u003e \n\u003e If the index.type is set to elasticsearch, Gerrit will use elasticsearch to index the 4 types documents.\n\u003e \n\u003e When gerrit execute a query on the index(Such as the user is searching on the  Gerrit front pages, The front is make an request to the  Gerrit backend API), then Gerrit will execute an HTTP request to the ElasticSearch API to query the relative data and return the data back to the front user to view the data they want. \n\u003e \n\u003e But the result set exists in the index is greater than default value 10000, Gerrit will encounter this issue because the default of ElasticSearch max_result_window is 10000, if the search result is too big on the relative index, ElasticSearch API will return an error response to tip the invoker that the result window is exceeded with the query.\n\u003e \n\u003e  \n\nThanks! Can you include some of this text (the part I quoted above) in the commit message please?",
      "parentUuid": "78516b45_d909db84",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78931d5c_6a40a09e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-10T15:11:20Z",
      "side": 1,
      "message": "Sure!\n\nThanks for your suggestion.",
      "parentUuid": "4510bf3c_713e34d7",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92ddcf5a_50bfebfa",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 17,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-10T15:20:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "78931d5c_6a40a09e",
      "range": {
        "startLine": 16,
        "startChar": 10,
        "endLine": 17,
        "endChar": 15
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b3164271_b853a179",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 58,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-03-09T11:15:04Z",
      "side": 1,
      "message": "This would be a good justification for dropping support for old versions.",
      "range": {
        "startLine": 57,
        "startChar": 20,
        "endLine": 58,
        "endChar": 51
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fd616ae2_20b3a153",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 58,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-09T11:25:39Z",
      "side": 1,
      "message": "haha.\n\nI think so too.\n\nI will try to upload a change about it recently",
      "parentUuid": "b3164271_b853a179",
      "range": {
        "startLine": 57,
        "startChar": 20,
        "endLine": 58,
        "endChar": 51
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e0795b7a_b249efbc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 58,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-03-10T01:48:20Z",
      "side": 1,
      "message": "I\u0027m not sure if we should drop support for those older versions on stable-2.16 though.  Let\u0027s move this change as-is to stable-2.16 and then follow up later regarding dropping older versions.",
      "parentUuid": "fd616ae2_20b3a153",
      "range": {
        "startLine": 57,
        "startChar": 20,
        "endLine": 58,
        "endChar": 51
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "edb7984d_7f290b2b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 58,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-10T02:18:19Z",
      "side": 1,
      "message": "As I known, ES 5.6 is a very stable and widely used release until now. \n\nI think it\u0027s stable to keep support for 5.6 in historical release for a period of time rather than drop it directly.",
      "parentUuid": "e0795b7a_b249efbc",
      "range": {
        "startLine": 57,
        "startChar": 20,
        "endLine": 58,
        "endChar": 51
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6741c56d_38096d7c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 58,
      "author": {
        "id": 1089199
      },
      "writtenOn": "2020-03-10T15:20:15Z",
      "side": 1,
      "message": "Should I upload another change for stable-2.16 or just keep this one is OK?",
      "parentUuid": "edb7984d_7f290b2b",
      "range": {
        "startLine": 57,
        "startChar": 20,
        "endLine": 58,
        "endChar": 51
      },
      "revId": "7a10da23434c7731acce13fb17bd07a9ef7cc51c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}