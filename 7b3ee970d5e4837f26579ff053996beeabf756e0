{
  "pushCert": "certificate version 0.1\npusher Stefan Beller \u003csbeller@google.com\u003e 1467853686 -0700\nnonce ALCdEosDBjCmQt8UbqSf33LGCcaLiswUIuOL1QCKqTS5nKmom5FyVN9dwD3R8C87WndtU41bY4Bw\n\n0000000000000000000000000000000000000000 7b3ee970d5e4837f26579ff053996beeabf756e0 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJXfat2AAoJEGt7+xNJsB0bUa4H/AhPvLkWhi4qkvYfVxRUWbLY\nVOU/0dxRhgBxbcIMP+pkAx/Wlc9YZrJuiCf95DNAyVMD1QIhpZ40TfMtHfnAPTXc\n1Fm2sTXrfczVp3YLlp6eYu6Vf7o/C6LPzsSSKZEFANYfkCs10czNwCcD3Ed25CM8\nM5ttAsy/TLyNCgRQ1iAIXQFjYpdbfTjbqz5CR9sikCVWLMsRh0FPxuTP5E/4+d5m\nXSJhvRwH5ASuFEPj3blW+XNnLDor0Dkj/tIlF4hPQC9TdkLTPXgEi+7RXBLqdh0v\naqjXoyFtxmyKc6bJ0PqcWpnZQ36Qgi8KtQMrHjA8BDgQZzrsMbXn4BWZ3eYD4Bk\u003d\n\u003dh9ja\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "7dd7227f_aaa72fbb",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-07-07T12:29:35Z",
      "side": 1,
      "message": "I\u0027m not the biggest fan of this as it encourages injecting a whole MergeUtil, which brings in a bunch of dependencies, just for a caller to avoid calling Submit.wholeTopicEnabled themselves.\n\nBut it is less work at the call site if they already inject a MergeUtil but not a Config. So I guess we\u0027ll just see if it becomes a problem.",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9d6db6b6_13204cef",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1010516
      },
      "writtenOn": "2016-07-07T10:50:36Z",
      "side": 1,
      "message": "What if some of the chain has the same topic, but it is not continuous?\n\nFor example:\n\na - topic\n|\nb - topic\n|\nc - other (or no) topic\n|\nd - topic",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dd9c8eda_4d9cd973",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-07-07T12:29:35Z",
      "side": 1,
      "message": "Is the intended behavior in this case to (dry-run) pick D, B, A; or is it D, C, B, A?",
      "parentUuid": "9d6db6b6_13204cef",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd47da3d_6c49bba5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1010516
      },
      "writtenOn": "2016-07-07T15:13:11Z",
      "side": 1,
      "message": "D,B,A. C doesn\u0027t have the same topic.",
      "parentUuid": "dd9c8eda_4d9cd973",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7dd7227f_4ae5d3d3",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2016-07-07T17:50:14Z",
      "side": 1,
      "message": "It depends how the cherry pick strategy is defined.\n\nCurrently we only dry run A, with this current patch we\u0027d dry run B, A.\n\nBut I think we want to test at least D B A, maybe include C.\n\nFor cherry-pick with no submitWholeTopic enabled, the submit button is labeled \"Submit including parents\" and has a tool tip of \"Submit Patchset 1 and ancestors (4 changes altogether) into master\".\nWhen it is enabled, we\u0027d have a tool tip of \"Submit all ${topicSize} changes of the same topic (${submitSize} changes including ancestors and other changes related by topic)\" and a label of \"Submit whole topic\", so the expectation is to submit D B A at least and C optionally.\n\nSo a regular submission should integrate all 4 changes with cherry pick, but because it is cherry-pick it is allowed to fail C in this case. (Cherry-pick keeps going when an error occurs, so we can ignore C)\n\nBut we should fail if there are failures in the same topic, as the submitWholeTopic promises to, well, submit the *whole* topic and not just partially.\n\nSo ideally the dry run would test for both D C B A and D B A and if at least one succeeds, we\u0027re good?",
      "parentUuid": "bd47da3d_6c49bba5",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fad95870_ce81a36d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1011624
      },
      "writtenOn": "2016-07-13T13:56:19Z",
      "side": 1,
      "message": "\u003e For cherry-pick with no submitWholeTopic enabled, the submit button\n \u003e is labeled \"Submit including parents\" and has a tool tip of \"Submit\n \u003e Patchset 1 and ancestors (4 changes altogether) into master\".\n\nReally? I tested it on latest master, and I get just a plain submit for this case.\nThat\u0027s also what I would expect. \nThe Submit including parents is there only if I switch to any other strategy.\n\n \u003e When it is enabled, we\u0027d have a tool tip of \"Submit all\n \u003e ${topicSize} changes of the same topic (${submitSize} changes\n \u003e including ancestors and other changes related by topic)\" and a\n \u003e label of \"Submit whole topic\", so the expectation is to submit D B\n \u003e A at least and C optionally.\n \u003e \n Agreed here.",
      "parentUuid": "7dd7227f_4ae5d3d3",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ad9cc3e_df581b12",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-07-13T20:38:05Z",
      "side": 1,
      "message": "This discussion is mostly academic. Dry run needs to mimic the actual behavior of submit. My question is actually: what is the current behavior of submit?",
      "parentUuid": "fad95870_ce81a36d",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a348866_e27fc6f0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2016-07-13T23:20:47Z",
      "side": 1,
      "message": "Which leads me to questioning why we have different code path for dry run and the actual thing to begin with. And the answer might be performance related.\n\nConceptually dry run and the real run should be only different whether to apply any changes (i.e. ref updates, closing the change)\n\nJonathan and I had a discussion with the Android folks and one possible scenario we came up with there was allowing the submit REST endpoint to pass in a prefix, such that you could do a real run in Gerrit as a dry run for them, e.g.\n\nsubmit (with prefix \"/refs/continous/integration/1234\")\nwould make a ref at /refs/continous/integration/1234/refs/heads/master\nthat points to the result. (And with submitWholeTopic, you\u0027d span across projects/branches, such that the idea with a prefix doesn\u0027t lead to collisions in the different branches). Then you could inspect the whole exact process that happens in submit after the fact. (Different submit stategies, how JGit merged things etc) and run CI on that observation before doing the real merge. We deemed this to be too expensive though.\n\nHowever with that way we could have implemented the dry run with the special /dev/null prefix. ;)\n\nTo answer your original question:\n\u003e Is the intended behavior in this case to (dry-run) pick D, B, A; or is it D, C, B, A?\n\nAs the non-dry run implementation, tries DCBA but allows any prior commit to fail, the test for A would include testing if at least one of \"DCBA, DCA, DBA, CBA, DA, CA, BA, A\" works. (All include A, but all others are optional.)\nIIUC the cherry pick code. \n\nThis in fact violates the submitWholeTopic assertion, so I think cherry-pick with submitWholeTopic enabled is broken\nas it doesn\u0027t deliver its promise, but can only be used in a degraded form of \"submitting things together across branches and hope it works\" in a best effort way.",
      "parentUuid": "1ad9cc3e_df581b12",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a4cdc15_3b9b977d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/CherryPick.java",
        "patchSetId": 3
      },
      "lineNbr": 232,
      "author": {
        "id": 1011624
      },
      "writtenOn": "2016-07-14T07:04:40Z",
      "side": 1,
      "message": "The current behaviour for cherry-pick is (at least what I observe on our 2.12 install where we only run cherry-pick):\n\n1) no topic or submit-whole-topic not set:\n really cherry-pick only a single change.\n\n -\u003e A only\n\n2) submit whole topic set and a topic:\n\n submit all changes with the topic (and only those!) in order.\n \n -\u003e D, B, A\n\nThat behaviuor is what differs cherry-pick from all the other strategies: You can pick single changes that where pushed in a longer sequence. Quite handy if you have lots of non-experienced users pushing from a single working branch.",
      "parentUuid": "7a348866_e27fc6f0",
      "revId": "7b3ee970d5e4837f26579ff053996beeabf756e0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}