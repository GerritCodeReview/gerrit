{
  "comments": [
    {
      "key": {
        "uuid": "b77173c9_3949ef73",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-28T17:30:39Z",
      "side": 1,
      "message": "Have you noticed my comment on another change concerning caching of GET /changes/\u003cid\u003e/detail request (and that action info map with submit button and friends are part of) in browser and that no re-evaluation actually happens until SHA-1 of the change was changed? So if you open first change from specific topic first time in browser, it doesn\u0027t really matter what happened to other changes from the same topic, there is no re-evaluation of submitability of the first change.",
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "174cff89_24369213",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-01-28T17:43:47Z",
      "side": 1,
      "message": "I did notice it and was confused by it. So you are saying I need to examine the caching code as it totally did not have this use case in mind?",
      "parentUuid": "b77173c9_3949ef73",
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d76c27f3_ba54110a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-28T17:59:36Z",
      "side": 1,
      "message": "Yes. The caching code relies on SHA-1 of one change. Current ETag computation completely ignores the chain of changes that belong to same topic: [1].\n\nWhen topic T has two changes A and B. Say A is approved, but B is not. When Bob loads change A in change screen, it is not submittable. Now when Alice approved change B and Bob again reloaded change A: SHA-1 of change A wasn\u0027t changed and thus Submit.apply() isn\u0027t called. For Bob, change A is still (erroneously) not submittable. To solve: Bob has has to clear browser cache and reload change A again, now it is submittable.\n\n* [1] https://gerrit.googlesource.com/gerrit/+/master/gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeResource.java#61",
      "parentUuid": "174cff89_24369213",
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "174cff89_64636a03",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-01-28T18:05:58Z",
      "side": 1,
      "message": "That\u0027s a good point. I don\u0027t know that we want to include all other changes in the same ETag.\n\nWhat about just moving the submit button UiAction out of the actions map and into a separate REST API call? Submit is already treated specially in the UI in a lot of places.",
      "parentUuid": "d76c27f3_ba54110a",
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "174cff89_a4e4c234",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 3
      },
      "lineNbr": 253,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-01-28T17:02:27Z",
      "side": 1,
      "message": "Merge this with the loop above. You can still return false on a ResourceConflictException. Any OrmException should still be logged, though you should change log message to be a little more generic.",
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "174cff89_a4fba2ce",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 3
      },
      "lineNbr": 253,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-01-28T17:13:16Z",
      "side": 1,
      "message": "ok, probably it\u0027s best to merge this change with the next change as the code in the next change will make use of this code here and remove the TODOs.",
      "parentUuid": "174cff89_a4e4c234",
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "174cff89_84e1c624",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 3
      },
      "lineNbr": 516,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-01-28T17:02:27Z",
      "side": 1,
      "message": "Just pass in the ChangeControl, then you avoid having to call changeDataFactory.create at all the call sites.",
      "range": {
        "startLine": 516,
        "startChar": 45,
        "endLine": 516,
        "endChar": 58
      },
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "174cff89_44686edd",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 3
      },
      "lineNbr": 516,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-01-28T18:20:48Z",
      "side": 1,
      "message": "Then we would need to construct the ChangeData here from the ChangeControl for `new SubmitRuleEvaluator`.",
      "parentUuid": "174cff89_84e1c624",
      "range": {
        "startLine": 516,
        "startChar": 45,
        "endLine": 516,
        "endChar": 58
      },
      "revId": "7d37ac25895d18692109263086b6538260e99a6c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}