{
  "comments": [
    {
      "key": {
        "uuid": "92154a31_5955e315",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/raw/ProjectDocServlet.java",
        "patchSetId": 11
      },
      "lineNbr": 167,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-01-17T13:22:14Z",
      "side": 1,
      "message": "[Optional] make eTag computation conditional: we only need it, if header contains HttpHeaders.IF_NONE_MATCH. Otherwise we don\u0027t.",
      "range": {
        "startLine": 163,
        "startChar": 8,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "82318a183f2a704008529db011c1b679e42c81c6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92154a31_d940d352",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/raw/ProjectDocServlet.java",
        "patchSetId": 11
      },
      "lineNbr": 167,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2014-01-17T15:12:30Z",
      "side": 1,
      "message": "We also need the eTag for the first request since we include it into the response so that the client can send it with the next request. So the eTag computation needs to be done in any case.",
      "parentUuid": "92154a31_5955e315",
      "range": {
        "startLine": 163,
        "startChar": 8,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "82318a183f2a704008529db011c1b679e42c81c6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f2a0465c_9c0fc549",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/raw/ProjectDocServlet.java",
        "patchSetId": 11
      },
      "lineNbr": 167,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-01-20T08:07:38Z",
      "side": 1,
      "message": "Sure, but then and only then the resource could be actually retrieved. This is however not always the case, that fact that you can\u0027t know at this time (lines 163-167).\n\nParticularly, that call on line 175 below:\n\n Resource rsc \u003d docCache.getUnchecked(\n     new ProjectDocResourceKey(projectName, file, revId));\n\ncan fail, because the resource that was requested doesn\u0027t exist: line ProjectDocLoader.java:92. In this case you have still computed the above ETag in vain (performance) and you even set ETAG header for a resource that doesn\u0027t exist.\n\nJust postpone the computation to take place later as suggested in my original comment and make sure, you do it and set it only if resource was found:\n\n  if (rsc !\u003d Resource.NOT_FOUND) {\n      // compute and set ETAG\n  }",
      "parentUuid": "92154a31_d940d352",
      "range": {
        "startLine": 163,
        "startChar": 8,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "82318a183f2a704008529db011c1b679e42c81c6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f2a0465c_7c2e79a8",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/raw/ProjectDocServlet.java",
        "patchSetId": 11
      },
      "lineNbr": 167,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2014-01-20T08:35:42Z",
      "side": 1,
      "message": "Ok, now I see what you mean. Thanks for pointing this out.\n\nDone.",
      "parentUuid": "f2a0465c_9c0fc549",
      "range": {
        "startLine": 163,
        "startChar": 8,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "82318a183f2a704008529db011c1b679e42c81c6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "720a9615_b82639c7",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/raw/ProjectDocServlet.java",
        "patchSetId": 11
      },
      "lineNbr": 170,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-01-17T13:22:14Z",
      "side": 1,
      "message": "It is never contained on the first request, so no need to compute eTag above.",
      "range": {
        "startLine": 170,
        "startChar": 24,
        "endLine": 170,
        "endChar": 36
      },
      "revId": "82318a183f2a704008529db011c1b679e42c81c6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}