{
  "comments": [
    {
      "key": {
        "uuid": "10c70467_553cecd6",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 174,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T20:37:21Z",
      "side": 1,
      "message": "InternalChangeQuery is not a singleton, inject a Provider.\n\n(Yes, ProjectControl is also not a singleton, so this approach will end up with multiple InternalChangeQuery instances. But ICQ is also not reusable, and it\u0027s possible to make multiple canReadCommit calls from a single ProjectControl instance.)",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10c70467_9555a416",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 174,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-18T21:14:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "10c70467_553cecd6",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f0bfd0bf_54c30c28",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 534,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T20:37:21Z",
      "side": 1,
      "message": "Also limit this to the current project. It\u0027s theoretically possible for a commit that is present in changes across multiple projects to be visible in some but not others. (For example a fork of a project used for reviewing security fixes.)",
      "range": {
        "startLine": 534,
        "startChar": 52,
        "endLine": 534,
        "endChar": 60
      },
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70a120aa_f03500ee",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 534,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T20:37:21Z",
      "side": 1,
      "message": "Spacing",
      "range": {
        "startLine": 534,
        "startChar": 30,
        "endLine": 534,
        "endChar": 32
      },
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10c70467_b552a029",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 534,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-18T21:14:47Z",
      "side": 1,
      "message": "I am not sure about limit to the same project. It is a valid requirement to check if a commit from a forked project is readable from current project. Which is quite normal when user is trying to merge something back.\n\nBut take your suggestion for now, will confirm with customer to see if there is such a requirement.",
      "parentUuid": "f0bfd0bf_54c30c28",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10c70467_955cc43a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 534,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T21:26:31Z",
      "side": 1,
      "message": "It must be limited to the same project; the definition of a ProjectControl is it\u0027s scoped to the one project.",
      "parentUuid": "10c70467_b552a029",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70a120aa_30ab08c0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 534,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-19T00:08:42Z",
      "side": 1,
      "message": "yes, I realized that even the old solution of looking through visible refs is within a single project scope.",
      "parentUuid": "10c70467_955cc43a",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f0bfd0bf_74c80844",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T20:37:21Z",
      "side": 1,
      "message": "It\u0027ll be more efficient to do controlFor(db, change) to avoid recreating a ProjectControl and various RefControls each time; you already have a ProjectControl available (i.e. this). This suggestion only works when the search results are limited to this project like I suggested above.\n\n(If you didn\u0027t have a ProjectControl already available, I would recomment using internalChangeQuery.enforceVisibility(true) to have the query system take care of this. But in this case I suspect reusing the ProjectControl \u0026 RefControls is a win.)",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10c70467_55730cc6",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-18T21:14:47Z",
      "side": 1,
      "message": "Done.\n\nIf we put a visibility filter in the query, we can not distinguish between no changes associate with the commit and there are changes associate with the commit, but none of them are visible. \nIf it is the former case, we will fallback to search for visible ref, if it is the later case, we return false immediately.",
      "parentUuid": "f0bfd0bf_74c80844",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70a120aa_503c0cd7",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-18T21:14:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f0bfd0bf_74c80844",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70a120aa_b0529829",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T21:26:31Z",
      "side": 1,
      "message": "Regardless of how you choose to do the visibility check, you need to fall back anyway.\n\nA commit could be *both*:\n\n* A patch set of a change that is not visible to the user\n* Reachable from a branch that is visible to the user",
      "parentUuid": "10c70467_55730cc6",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10c70467_150d141f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-19T00:08:42Z",
      "side": 1,
      "message": "Yes, that\u0027s possible. I was making an assumption that the possibility of such situation is extremely low, and added change.isEmpty() \u0026\u0026 check before falling back the the refs check. Do you think I better remove that?",
      "parentUuid": "70a120aa_b0529829",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90893441_c99f713a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 543,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-11-18T20:37:21Z",
      "side": 1,
      "message": "Does this need to be public?",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70a120aa_70411056",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ProjectControl.java",
        "patchSetId": 3
      },
      "lineNbr": 543,
      "author": {
        "id": 1026258
      },
      "writtenOn": "2016-11-18T21:14:47Z",
      "side": 1,
      "message": "Currently there is no need to be public, change to private.",
      "parentUuid": "90893441_c99f713a",
      "revId": "82a7cc48a53f70e83d23d70e501417bdcd111466",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}