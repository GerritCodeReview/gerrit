{
  "comments": [
    {
      "key": {
        "uuid": "AAABEX//65U\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/ReceiveCommits.java",
        "patchSetId": 3
      },
      "lineNbr": 1253,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2011-07-28T05:21:27Z",
      "side": 1,
      "message": "If there is a chance of discrepancy, do we not want it to be a draft?  If change says draft, but not the ps, then not a draft?  This begs the question, should there really be a draft flag on a change, or should the lack of a non-draft ps indicate that the change is still in draft mode?  In other words, what would it mean for a Change to be new, but to not have any published patch sets?",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABEX//62w\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/ReceiveCommits.java",
        "patchSetId": 3
      },
      "lineNbr": 1253,
      "author": {
        "id": 1006632
      },
      "writtenOn": "2011-07-28T20:57:31Z",
      "side": 1,
      "message": "The intent is to make it impossible to have a non-draft PS and a draft change. The publishing of a draft PS or submitting a non-draft PS to a draft change irreversibly upgrades the change\u0027s status from draft to new. In other words, draft changes should only consist of draft patchsets.\n\nThe idea of doing a draft change status is to prevent the need to constantly check every single patch set in every single change to see if the change consists of only draft patch sets. That way, it\u0027s easier to hide an entire change from the list of changes if that change consists of only draft patchsets and the user doesn\u0027t have access.",
      "parentUuid": "AAABEX//65U\u003d",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABEn////c\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/ReceiveCommits.java",
        "patchSetId": 3
      },
      "lineNbr": 1253,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2011-07-28T21:33:34Z",
      "side": 1,
      "message": "Yeah, that\u0027s what I figured. Your data is not normalised this way, and I am worried about discrepancies slipping in.  The fact that you are testing both here seems to indicate that you might think so too?  But you don\u0027t really provide a \"fix\" (or workaround) if a discrepancy happens, so why bother testing both?\n\nI guess another question comes up out of this, how will you deal with numbering PSes?  What happens if there are 2 draft PSes, and someone publishes the second one?  Does that PS now become PS1 and the other draft one become PS2?\n\nWhat about currentPatchSetId on a change, when will that get updated? I suspect that should only get updated when a PS is published?  So perhaps that could be your change draft indicator instead?  That might be a bit easier to ensure synchonization since that already needs to stay synced.",
      "parentUuid": "AAABEX//62w\u003d",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABEn///9M\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/ReceiveCommits.java",
        "patchSetId": 3
      },
      "lineNbr": 1253,
      "author": {
        "id": 1006632
      },
      "writtenOn": "2011-07-29T04:24:33Z",
      "side": 1,
      "message": "I think there are two questions here. \n\nThe first one is about this particular check. In this case, checking both is necessary because this is handling the case of adding an additional draft patchset to a draft change. A draft patchset being added to a non-draft change keeps the change in new status. The three other cases (draft patch set + new change and non-draft patch set + draft/new change) result in a new change.\n\nThe second is about discrepancies in general between patchset status and change status. If a non-draft patchset is uploaded to a draft change and the change status does not upgrade to new for whatever reason, then yes, I don\u0027t think there\u0027s a workaround to manually change the status from draft. Should there be? How possible is that situation?\n\nI agree that numbering is a mess. Unfortunately, I don\u0027t really know what to do about it. I chose to ignore it and just let gaps in the numbering appear because when I was talking to Shawn about it he told me that patchset numbering will probably eventually go away as patchsets move towards a more Git-like branching mechanism.\n\nA change sets the current patch set to whatever is the most current, draft or not. My reasoning for this is that a change needs to know what the most current patchset is, draft or not. Otherwise, there might be cases like an admin submitting an older, visible patchset when there\u0027s a newer draft patchset being worked on that the admin cannot see.",
      "parentUuid": "AAABEn////c\u003d",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABEX//65Y\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ChangeControl.java",
        "patchSetId": 3
      },
      "lineNbr": 249,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2011-07-28T05:21:27Z",
      "side": 1,
      "message": "I think that these error messages need to take visibility of the drafts into account.  If the user making the submit request cannot see the draft, I am not sure we want to reveal that a ps is indeed a draft?  Or perhaps we don\u0027t care?",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABEX//624\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ChangeControl.java",
        "patchSetId": 3
      },
      "lineNbr": 249,
      "author": {
        "id": 1006632
      },
      "writtenOn": "2011-07-28T20:57:31Z",
      "side": 1,
      "message": "If the user cannot see the draft, I don\u0027t think they can actually get to this point because the patchset has been prefiltered out.",
      "parentUuid": "AAABEX//65Y\u003d",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAABEn////Y\u003d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/ChangeControl.java",
        "patchSetId": 3
      },
      "lineNbr": 249,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2011-07-28T21:33:34Z",
      "side": 1,
      "message": "If they are guessing at IDs, they can likely attempt to submit it (and get this far) from the ssh review command.",
      "parentUuid": "AAABEX//624\u003d",
      "revId": "83d748f3b04ed1f5b6fc7305c8072d6cdaaf0887",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}