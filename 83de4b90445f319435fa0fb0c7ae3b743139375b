{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1701cfd8_3c24208a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-25T23:23:20Z",
      "side": 1,
      "message": "Good job, David.",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9a4031e6_d5712cc9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1100310
      },
      "writtenOn": "2020-11-25T23:33:52Z",
      "side": 1,
      "message": "And what if a git client sends a different User-Agent header?",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1a8124a1_ae5be7cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1011602
      },
      "writtenOn": "2020-11-25T23:39:19Z",
      "side": 1,
      "message": "Apologies if I\u0027m beating the same dead horse from the original bug report, but why do HTP-over-Git and the WebApp need to coexist at the same paths at all? Why not just deprecate serving Git-over-HTTP from the root URL and make it possible to use a non-conflicting subpath for it instead? It seems like that sidesteps all the possibly invalid assumptions about arbitrary user agent strings, or postulating what project names people might choose.",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "62cfe28a_d46c8c9f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-25T23:51:55Z",
      "side": 1,
      "message": "Thomas raised a very valid point: can we make this change more robust by NOT checking the User-Agent and instead the pattern of the requests?",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd3b48cb_bc09bc89",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-25T23:53:43Z",
      "side": 1,
      "message": "\u003e Apologies if I\u0027m beating the same dead horse from the original bug report, but why do HTP-over-Git and the WebApp need to coexist at the same paths at all?\n\nYou can do that already now, by simply having a different path on the reverse proxy and have an headless Gerrit serving the Git protocol.\nThat solution is already implemented in many other sites and it works already today.\n\n@David\u0027s change is more for all of those who don\u0027t want to change the existing URLs.",
      "parentUuid": "1a8124a1_ae5be7cb",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd6f5a63_cfcf48d4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1011602
      },
      "writtenOn": "2020-11-26T14:28:31Z",
      "side": 1,
      "message": "I understand you can work around the problem by running an entire extra Gerrit, I was hoping there was a possibility to simply prefix the Git-over-HTTP path unambiguously so that we could serve refs to our CI system without risk that stream-events might race replication lag or filesystem flush delays, without worrying whether all Git clients have consistent behaviors, but also particularly without needing more than one Gerrit.",
      "parentUuid": "cd3b48cb_bc09bc89",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b465d67b_1c620dbe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-17T13:13:52Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bd6f5a63_cfcf48d4",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "941a42e0_124299cc",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1100310
      },
      "writtenOn": "2020-11-25T23:33:52Z",
      "side": 1,
      "message": "Clients can override the user-agent header, and [1] even mentions something about it sometimes being necessary to change it to look like a browser to pass through firewalls. Someone using JGit as a library in his own product might well give it a completely different User-Agent. And finally the slash is only a convention.\n\nThere are a few other ways one could try to distinguish git and web requests.\n\nFor POSTs in smart HTTP, I think one could rely on the Content-Type. C git *requires* the application/x-git-\u003cservice\u003e-request content type, so that could be taken as a more precise determination whether the client is a browser or a git client.\n\nFor GETs in smart HTTP: if the URL path ends in info/refs and there\u0027s one parameter service\u003d, and the value matches a known service, it\u0027s a git request.\n\nThat leaves only dumb HTTP GETs that cannot be unambiguously identified. But they\u0027d all end in /info/refs or /info/packs and the like, and the part before the /info/ would have to map to a known repository.\n\n[1] https://git-scm.com/docs/git-config#Documentation/git-config.txt-httpuserAgent",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "755dd95f_203addc4",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1026270
      },
      "writtenOn": "2020-11-25T23:58:20Z",
      "side": 1,
      "message": "I don\u0027t want to pile on ... I\u0027d just also say that the failure case for the points above is also just about the worst for a developer; most of your clones work except some, and the only way you\u0027ll figure it out is having to dig through the gerrit source code to find this switching.  \n\nI\u0027m afraid I don\u0027t have much of a solution to offer.  Maybe calling it out in documentation that might come up in a web search, or perhaps even adding a X- header on these endpoints that you might see in a verbose dump.",
      "parentUuid": "941a42e0_124299cc",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7ac130b_3c8a3aeb",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1100310
      },
      "writtenOn": "2020-11-26T07:44:44Z",
      "side": 1,
      "message": "For GET, there\u0027s also the protocol V2 header: if the request has the Git-Protocol: version\u003d2 header, it\u0027s a git request. An Accept header containing application/x-git-\u003cservice\u003e-advertisement is another indicator.",
      "parentUuid": "755dd95f_203addc4",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "55929b43_3aa043fd",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2020-11-26T14:50:42Z",
      "side": 1,
      "message": "isn\u0027t there a way to treat URLs that have ?service\u003dgit-{send,receive-pack} differently, regardless of the prefix where they are found?\n\nI agree that the UserAgent switching is hacky and confusing.",
      "parentUuid": "c7ac130b_3c8a3aeb",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "acd26640_93c3f90b",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1013267
      },
      "writtenOn": "2020-11-26T16:04:32Z",
      "side": 1,
      "message": "now that you mention it, yes, i\u0027ve actually set up just that for code.qt.io. i think i used https://git-scm.com/docs/gitweb as the template (see \"Single URL for gitweb and for fetching\" near bottom).",
      "parentUuid": "55929b43_3aa043fd",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "864f7269_264d882e",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-12-02T10:13:54Z",
      "side": 1,
      "message": "+1 to Han-Wen\u0027s proposal.\n\nFWIW we make internal routing decision for cache affinity based on the request URL (service\u003d...) and that has been working fairly well.",
      "parentUuid": "acd26640_93c3f90b",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5367af0b_410e5909",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-12-09T23:42:50Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "864f7269_264d882e",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "29e4826c_7dbb49b7",
        "filename": "java/com/google/gerrit/httpd/UserAgentUtil.java",
        "patchSetId": 3
      },
      "lineNbr": 30,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-17T13:07:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5367af0b_410e5909",
      "revId": "83de4b90445f319435fa0fb0c7ae3b743139375b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}