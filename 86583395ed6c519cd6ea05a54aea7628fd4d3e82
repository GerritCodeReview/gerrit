{
  "comments": [
    {
      "key": {
        "uuid": "a8dc3955_ab6a514b",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-15T10:35:37Z",
      "side": 1,
      "message": "This implements a new variant for parsing request IDs that we already have a parser for. Each collection (Change, Project) can parse out it\u0027s respective ID from an IdString which the RestApiServlet is capable of parsing out of the URL. I think we should reuse this.",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d45e1ec_3fdcc03a",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-07-15T10:48:14Z",
      "side": 1,
      "message": "The problem is that we need the RequestIds at the very beginning of the request and RestApiServlet parses URL segments one by one. This way the project name is discovered too late for our purpose. Of course we could do all the parsing upfront, but I would rather not want to touch/rewrite the parsing logic of this class. Also the parse methods of the collection classes check the visibility of the resources which we don\u0027t want for computing the RequestIds, so I\u0027m not sure they are a good fit for this use case. WDYT?",
      "parentUuid": "a8dc3955_ab6a514b",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4826103e_728c1f30",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-07-15T10:59:51Z",
      "side": 1,
      "message": "OK, I think we could pull up the splitting of the path (l. 358) to before the trace context is opened, then check if the first entry in the list is \"projects\" or \"changes\" and then use the second entry as project name or change ID. Does this sound good?",
      "parentUuid": "4d45e1ec_3fdcc03a",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "02c70296_73100433",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-15T11:10:12Z",
      "side": 1,
      "message": "Yeah, I know :-(\n\nI think it would be OK to do some simple parsing based on regexes (in a separate, unit-tested class).\n\nIn any case though, I would use ChangeFinder to resolve from String to Change(.id) because it is well tested and cached.",
      "parentUuid": "4d45e1ec_3fdcc03a",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f84ef913_23cc267c",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-07-15T11:21:02Z",
      "side": 1,
      "message": "\u003e In any case though, I would use ChangeFinder to resolve from String to Change(.id) because\n\u003e it is well tested and cached.\n\nThis can be done. I didn\u0027t do it because this means we will do an index query even if the project name is already part of the change ID. But if we are not concerned about an unnecessary index query I can use ChangeFinder.",
      "parentUuid": "02c70296_73100433",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9342442a_3a406291",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-15T11:23:23Z",
      "side": 1,
      "message": "ChangeFinder should do an index query only if the project is not already in the URL. What makes you think it is not doing that?",
      "parentUuid": "f84ef913_23cc267c",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9b6348db_a0dae6d3",
        "filename": "java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 1449,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-07-15T11:49:55Z",
      "side": 1,
      "message": "Oh, you are right. Don\u0027t know how I came to this conclusion.",
      "parentUuid": "9342442a_3a406291",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "399d7b16_99d3604c",
        "filename": "java/com/google/gerrit/server/RequestInfo.java",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-15T10:35:37Z",
      "side": 1,
      "message": "What about requests that are neither of these?\n\nFor example, one implements a plugin with a GraphQL API and uses the Java API to call out to Gerrit?\n\nOr RPC for usage inside of Google?",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f91b330_5f2b15d0",
        "filename": "java/com/google/gerrit/server/RequestInfo.java",
        "patchSetId": 2
      },
      "lineNbr": 28,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-07-15T10:48:14Z",
      "side": 1,
      "message": "Good point. What do you suggest? Should request type be a string or do you prefer an additional enum value like OTHER?",
      "parentUuid": "399d7b16_99d3604c",
      "revId": "86583395ed6c519cd6ea05a54aea7628fd4d3e82",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}