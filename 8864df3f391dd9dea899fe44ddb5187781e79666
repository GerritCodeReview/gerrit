{
  "comments": [
    {
      "key": {
        "uuid": "d802aa8c_06e8baef",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 1
      },
      "lineNbr": 121,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-07-16T22:10:28Z",
      "side": 1,
      "message": "Use Provider\u003cReviewDb\u003e to get the per-request autoconnection.",
      "revId": "8864df3f391dd9dea899fe44ddb5187781e79666",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d802aa8c_26ebb6f0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-07-16T22:00:05Z",
      "side": 1,
      "message": "You shouldn\u0027t have to make a new database connection here; there should already a database connection available in the HTTP request context.",
      "revId": "8864df3f391dd9dea899fe44ddb5187781e79666",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "581ddaf5_7aeef900",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-07-16T22:10:28Z",
      "side": 1,
      "message": "Then the try block goes away.",
      "parentUuid": "d802aa8c_26ebb6f0",
      "revId": "8864df3f391dd9dea899fe44ddb5187781e79666",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "581ddaf5_5af1b5dd",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2015-07-16T22:10:31Z",
      "side": 1,
      "message": "As said in IM, if this were to replaced by `dbProvider.get()`, you\u0027d get about 92 failing tests such as: (The others are similar)\n\njava.lang.NullPointerException\n\tat com.google.gwtorm.jdbc.JdbcAccess.prepareStatement(JdbcAccess.java:93)\n\tat com.google.gerrit.reviewdb.client.PatchSet_Access_patchSets_GwtOrm$$53.get(Unknown Source)\n\tat com.google.gerrit.server.change.Revisions.parse(Revisions.java:76)\n\tat com.google.gerrit.server.api.changes.ChangeApiImpl.revision(ChangeApiImpl.java:154)\n\tat com.google.gerrit.server.api.changes.ChangeApiImpl.current(ChangeApiImpl.java:142)\n\tat com.google.gerrit.acceptance.AbstractDaemonTest.revision(AbstractDaemonTest.java:455)\n\tat com.google.gerrit.acceptance.server.project.LabelTypeIT.merge(LabelTypeIT.java:331)\n\nbecause nowhere the database is actually opened.\nWe need to open the database somewhere.",
      "parentUuid": "d802aa8c_26ebb6f0",
      "revId": "8864df3f391dd9dea899fe44ddb5187781e79666",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d802aa8c_66faceb4",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-07-16T23:03:07Z",
      "side": 1,
      "message": "Yes, that\u0027s a head-scratcher.\n\nBut many other Rest{Read,Modify}Views[1] manage to get by with injecting a Provider\u003cReviewDb\u003e. They open it using Guice magic. It might be that there\u0027s something special about Submit/MergeOp that makes this impossible, but we need to understand what that is.\n\n\u003e nowhere the database is actually opened.\n\nNaively, this cannot be the problem. dbProvider.get() works just fine on l. 186 of the LHS.\n\n[1] find g* -name \\*.java | xargs grep -l \u0027Rest.*View\u0027 | xargs grep \u0027^\\s*Provider\u003cReviewDb\u003e\u0027",
      "parentUuid": "581ddaf5_5af1b5dd",
      "revId": "8864df3f391dd9dea899fe44ddb5187781e79666",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d802aa8c_e6059e4d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/Submit.java",
        "patchSetId": 1
      },
      "lineNbr": 190,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-07-16T22:10:28Z",
      "side": 1,
      "message": "and this becomes db.get().",
      "range": {
        "startLine": 190,
        "startChar": 35,
        "endLine": 190,
        "endChar": 36
      },
      "revId": "8864df3f391dd9dea899fe44ddb5187781e79666",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}