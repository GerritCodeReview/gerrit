{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6dc145eb_1483db0a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 45
      },
      "lineNbr": 24,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "You can leave out some of the details of the existing API. Maybe summarize as:\n\n This is similar to the existing API of `fixes/{fix-id}/apply` where\n a `fix-id` is generated on the server via a robot comment and then\n later applied to the patch set. That existing API is suitable in a\n flow where fixes are suggested by linters, CI systems, or other\n non-interactive tools.\n \nAnd then you can skip including the full existing signature.",
      "range": {
        "startLine": 17,
        "startChar": 0,
        "endLine": 24,
        "endChar": 72
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "511124dc_f8513417",
        "filename": "/COMMIT_MSG",
        "patchSetId": 45
      },
      "lineNbr": 24,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6dc145eb_1483db0a",
      "range": {
        "startLine": 17,
        "startChar": 0,
        "endLine": 24,
        "endChar": 72
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5c2e58b_8983abf3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 45
      },
      "lineNbr": 27,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "\"New REST API for applying a fix from the request body to a patch set\"",
      "range": {
        "startLine": 27,
        "startChar": 15,
        "endLine": 27,
        "endChar": 50
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f50cd9ea_5f23b921",
        "filename": "/COMMIT_MSG",
        "patchSetId": 45
      },
      "lineNbr": 27,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f5c2e58b_8983abf3",
      "range": {
        "startLine": 27,
        "startChar": 15,
        "endLine": 27,
        "endChar": 50
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7f5083d3_10a9b3d6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 45
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "Almost there ðŸ˜Š Just need to figure out the ChangeEdit and patchSet perm check. The rest are nits.",
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c4290f23_5575c83d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 45
      },
      "lineNbr": 0,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "\u003e Almost there ðŸ˜Š Just need to figure out the ChangeEdit and patchSet perm check. The rest are nits.\n\nThanks!!\n\nAll those checks are because Patrick asked them. I have added the relevant comments on your comments.",
      "parentUuid": "7f5083d3_10a9b3d6",
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3f48f2e_206aa0c7",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 45
      },
      "lineNbr": 5386,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "The existing API also has this text: \", or the fix refers to the\npatch set on which the change edit is based\". I think we want that true for this new API too?",
      "range": {
        "startLine": 5386,
        "startChar": 6,
        "endLine": 5386,
        "endChar": 7
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e1dc716_c0e2c594",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 45
      },
      "lineNbr": 5386,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Copying two of Patrick\u0027s comment on Patchset 17 on May 06 at file javatests/com/google/gerrit/acceptance/api/revision/RobotCommentsIT.java:\n1) \"remove change edit requirement. I think we should disallow applying direct fixes to old patch sets in general.\"\n2) \"Hm, I think this should not be possible: (1) Don\u0027t allow applying direct fixes to old patch sets and (2) don\u0027t allow applying direct fixes if there already is a change edit.\"\n\nI did this change because Patrick asked to. What are your thoughts?",
      "parentUuid": "c3f48f2e_206aa0c7",
      "range": {
        "startLine": 5386,
        "startChar": 6,
        "endLine": 5386,
        "endChar": 7
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dff9e7bb_d63912ed",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 45
      },
      "lineNbr": 5386,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T22:37:25Z",
      "side": 1,
      "message": "\u003e Copying two of Patrick\u0027s comment on Patchset 17 on May 06 at file javatests/com/google/gerrit/acceptance/api/revision/RobotCommentsIT.java:\n\u003e 1) \"remove change edit requirement. I think we should disallow applying direct fixes to old patch sets in general.\"\n\u003e 2) \"Hm, I think this should not be possible: (1) Don\u0027t allow applying direct fixes to old patch sets and (2) don\u0027t allow applying direct fixes if there already is a change edit.\"\n\u003e \n\u003e I did this change because Patrick asked to. What are your thoughts?\n\nI\u0027m also considering Patrick\u0027s comment on this file in PS17: \"The fact that we are using change edits for that is an implementation detail. I think before the operation, we should check if the user already has a change edit and fail with a BadRequestException if so. That should be documented here.\"\n\nTo me, \"old patch sets\" doesn\u0027t mean in-progress change edits. I agree there isn\u0027t a good use case for allowing fixes to old patch sets.\n\nFor in-progress change edits, I think if the other apply fix API allows that, we should here too. I also think if you disallow it, you\u0027re going to have a usability problem (as soon as you apply one fix, you can\u0027t apply more). If your FE plugin has a UI with a \"apply fix\" button near each suggested fix, you\u0027ll only be able to click the first button and any additional attempts to apply a fix will fail because there\u0027s now an in-progress edit created by the first one.",
      "parentUuid": "9e1dc716_c0e2c594",
      "range": {
        "startLine": 5386,
        "startChar": 6,
        "endLine": 5386,
        "endChar": 7
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45ae8c9e_c951197e",
        "filename": "Documentation/rest-api-changes.txt",
        "patchSetId": 45
      },
      "lineNbr": 5386,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-23T17:52:01Z",
      "side": 1,
      "message": "I have made changes so that the fixes can only be applied on current patchset, irrespective of whether a change-edit exists or not. The reason to not care for existing chang edit, as pointed by you, is the user will click \u0027Apply Fix\u0027 button one after the other.\n\nMy thoughts for not allowing fixes on previous patchsets or previous patchsets with change edit is:\nSince, automated tool will suggest fixes whenever a new patchset is uploaded, it is not useful to allow old suggestions to be applied. They may run the risk of pointing to code blocks that may have moved from its original location or may have become orphaned.",
      "parentUuid": "dff9e7bb_d63912ed",
      "range": {
        "startLine": 5386,
        "startChar": 6,
        "endLine": 5386,
        "endChar": 7
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "08a4defe_5af03dba",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 93,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "nit: We try not to have types in variable names: s/fixReplacementList/fixReplacements/\n\nBut see below, because you probably don\u0027t need to create this List here.",
      "range": {
        "startLine": 93,
        "startChar": 25,
        "endLine": 93,
        "endChar": 43
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aff1c528_cee6b6c1",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 93,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "08a4defe_5af03dba",
      "range": {
        "startLine": 93,
        "startChar": 25,
        "endLine": 93,
        "endChar": 43
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "55ee82aa_3d6ef7b1",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 99,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "ApplyStoredFix doesn\u0027t have this limitation. Do we need to restrict it here?",
      "range": {
        "startLine": 95,
        "startChar": 4,
        "endLine": 99,
        "endChar": 5
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4525a038_37d359eb",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 99,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Copying Patrick\u0027s comment on Patchset 17 on May 06 on file Documentation/rest-api-changes.txt:\n\"The fact that we are using change edits for that is an implementation detail. I think before the operation, we should check if the user already has a change edit and fail with a BadRequestException if so. That should be documented here.\"\n\nWhat are your thoughts?",
      "parentUuid": "55ee82aa_3d6ef7b1",
      "range": {
        "startLine": 95,
        "startChar": 4,
        "endLine": 99,
        "endChar": 5
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f13e465_b7a57496",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 99,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T22:37:25Z",
      "side": 1,
      "message": "Replied on this in the doc since there\u0027s more context there.",
      "parentUuid": "4525a038_37d359eb",
      "range": {
        "startLine": 95,
        "startChar": 4,
        "endLine": 99,
        "endChar": 5
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "58cbf195_2efafa72",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 99,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-23T17:52:01Z",
      "side": 1,
      "message": "Done.\nLet\u0027s discuss this is in the comment there only. I have removed this condition.",
      "parentUuid": "7f13e465_b7a57496",
      "range": {
        "startLine": 95,
        "startChar": 4,
        "endLine": 99,
        "endChar": 5
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b6fdfd1_b8d9d0ab",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 101,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "ApplyStoredFix isn\u0027t doing this check. Is that a bug there or is it unnecessary here?",
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cb63d2d6_c20b76fd",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 101,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Copying Patrick\u0027s comment on Patchset 28 on May 19 at file java/com/google/gerrit/server/restapi/change/ApplyDirectFix.java\n\n\"Please check if the user has \"ADD_PATCH_SET\" permission (via PermissionBackend)\n\nAnd add a test that the operation fails in case the user lacks that permission.\"\n\nWhat are your thoughts?",
      "parentUuid": "8b6fdfd1_b8d9d0ab",
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e774df60_7b4e4e2c",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 101,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T22:37:25Z",
      "side": 1,
      "message": "\u003e \"Please check if the user has \"ADD_PATCH_SET\" permission (via PermissionBackend)\n\u003e \n\u003e And add a test that the operation fails in case the user lacks that permission.\"\n\nIf you add a version of that test adapted to the `fixes/{fix-id}/apply` API, does it pass or fail? Or if you remove this check here, does your test still behave as desired (I expect it will)?\n\nThe ChangeEdits APIs all seem to end up calling ChangeEditModifier.assertCanEdit() and your call to combineWithModifiedPatchSetTree() calls that as well, so I think explicitly checking for ADD_PATCH_SET here is duplicate work and unnecessary.",
      "parentUuid": "cb63d2d6_c20b76fd",
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bfcfaef8_0970c86d",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 101,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-23T17:52:01Z",
      "side": 1,
      "message": "You are right, even without the highlighted text, the test `applyProvidedFixRestWithoutAddPatchSetPermissionCannotBeApplied` passes.\n\nRemoved the check",
      "parentUuid": "e774df60_7b4e4e2c",
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d288211_5d117582",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 108,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-22T19:13:02Z",
      "side": 1,
      "message": "nit: You can use a stream API to do all this concisely and avoiding single-use variables\n\n List\u003cFixReplacement\u003e fixReplacements \u003d applyProvidedFixInput.fixReplacementInfos.stream().map(\n   fix -\u003e new FixReplacement(fix.path, new Range(fix.range), fix.replacement))\n   .collect(Collectors.toList());\n   \nAnd since you\u0027re not using `repository`, do this before you enter the try{}.",
      "range": {
        "startLine": 104,
        "startChar": 6,
        "endLine": 108,
        "endChar": 7
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d45625f4_7189ada3",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyProvidedFix.java",
        "patchSetId": 45
      },
      "lineNbr": 108,
      "author": {
        "id": 1091592
      },
      "writtenOn": "2022-06-22T20:20:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1d288211_5d117582",
      "range": {
        "startLine": 104,
        "startChar": 6,
        "endLine": 108,
        "endChar": 7
      },
      "revId": "889d456281ee0a84f78e43ff5cc50f90668ca477",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}