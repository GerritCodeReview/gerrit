{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1502383431 -0400\nnonce AHIDc+PNY+ObHncAmQJaxJ8i2NJjR7Rm8Bn6fwE8U+zyaR3yUMEJ8PnyYIOzq2u0Uvaxf+UT9YtA\n\n0000000000000000000000000000000000000000 d5d032be3f5f4662bbae4e2805f08fe486f4cb33 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJZjI1HAAoJEF/XxZqaEoiMVdcQAKqNJLBxrOrlqDMxs6qi81hx\n8g6e7+p5i3yWbL9HtZplrY4JBIqyyqs0g5vAGxXN62TJ2Wv5HWP3bcUbNR7W5brH\nMJwiBrrRwo/X1jXE1qjyaXeZNtQbWfVcOOrDKCZXrYkTRqc9RPNpyxZaPiFXvvC3\nLXKVUOHEIpu05aXkZIiABtcArlQgh6GOl2V1eZC8DQ98hWqG2Vebq3200E3DxXK3\n+nWfp7gVIVK4rhtnKq9iE09yLsUiH71hctne90cj3uYs/3BYHoNvQhuHqGL9fivR\nNMzlcflpMJoSJP5YN5vtrW7+Ulj11/1Q5HkU87dycdGnTafe5yUd6C0jAcsnsRyO\nopvTXdJ6lBJbtjb7OOxDIN/tGL4JOaFlPwdLXxrNhfpaAiDJvc+ZHhZ1w6fJ6l1l\nhRgnNKWn29DDQzDW0yuZ3eY/Bo8PXt1+4+Uifs4ollExxSzaf429DlN0rBjlwcdB\n1qeW20igCMgaYq2fM5MrsrFqM4i6sp/b1TLNmgWzaDqULJd4M7tvNcJ1Incq+BqJ\nGyy5NtF3kj6fbz/RheMkpRfcFvEd1OAS0MSS1EYyS4s46Akn1nIWG0nhfyTV+DP0\n9vLuDMKIgmvxprN9KhuHnoJRRko/G8EXaHjmdAacNYfKIEM2AglYOJX8Qxplcj1H\ndKy56aS3dfdnumZsNFB4\n\u003dqwyv\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "f916c57e_dcb59252",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/query/account/AccountQueryProcessor.java",
        "patchSetId": 8
      },
      "lineNbr": 62,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-08-10T19:54:26Z",
      "side": 1,
      "message": "There is a very subtle bug on this line, and I\u0027m glad we have a test that caught it!\n\nRemoving the call to updateQueryLimit and leaving only \"userProvider.get()\" is enough to trigger the bug.\n\nI think the problem is that InternalAccountQuery is used by AccountCacheImpl.ByNameLoader. Somehow, when calling accountQueryProvider.get() from #load, the Provider\u003cCurrentUser\u003e returns an empty user with no capabilities, and then this empty user is stored in the cache, poisoning it. This results in the check on CacheOperationsIT.java:41 failing because the user doesn\u0027t have the Maintain Server capability. And this only happens in this particular test, because it happens immediately after flushing all caches.\n\nI think this eager call to userProvider.get() needs to be replaced with a thunk that basically replicates the limitsFactory call chain in QueryProcessor that I was trying to get rid of. Hopefully this results in less confusing changes to the interface as well.",
      "revId": "89902ab6ef1bb03bd3406d9218bc335b8dd7debc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}