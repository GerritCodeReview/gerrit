{
  "comments": [
    {
      "key": {
        "uuid": "4d119541_5a54b5d9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeJson.java",
        "patchSetId": 2
      },
      "lineNbr": 421,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-05-08T09:13:12Z",
      "side": 1,
      "message": "This check was already performed inside the loadPatchSets() method: why is this patch (with the check repeated again here) is going to make any difference?\n\n  private Map\u003cPatchSet.Id, PatchSet\u003e loadPatchSets(ChangeData cd,\n      Optional\u003cPatchSet.Id\u003e limitToPsId) throws OrmException {\n    Collection\u003cPatchSet\u003e src;\n    if (has(ALL_REVISIONS) || has(MESSAGES)) {\n      src \u003d cd.patches();\n    }",
      "range": {
        "startLine": 419,
        "startChar": 4,
        "endLine": 421,
        "endChar": 6
      },
      "revId": "89c43fda4a0fbedde5be37ecd484d47986475a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4d119541_bafe312f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeJson.java",
        "patchSetId": 2
      },
      "lineNbr": 421,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-05-08T12:36:12Z",
      "side": 1,
      "message": "| This check was already performed inside the loadPatchSets() method: why is this patch (with the check repeated again here) is going to make any difference?\n\nYes, it is different. When you check the other part of loadPatchSets() method, you can see, that in any case currentPatchSet() is eagerly loaded:\n\n  } else {\n      PatchSet ps;\n      if (limitToPsId.isPresent()) {\n        ps \u003d cd.patch(limitToPsId.get());\n        if (ps \u003d\u003d null) {\n          throw new OrmException(\"missing patch set \" + limitToPsId.get());\n        }\n      } else {\n        ps \u003d cd.currentPatchSet();\n        if (ps \u003d\u003d null) {\n          throw new OrmException(\n              \"missing current patch set for change \" + cd.getId());\n        }\n      }\n      src \u003d Collections.singletonList(ps);\n    }\n\nThe line that we don\u0027t want in this context is:\n\n  ps \u003d cd.currentPatchSet();\n\nWhy? Because that\u0027s how ChangeData.currentPatchSet() is implemented:\n\n  public PatchSet currentPatchSet() throws OrmException {\n     if (currentPatchSet \u003d\u003d null) {\n       Change c \u003d change();\n       if (c \u003d\u003d null) {\n         return null;\n       }\n       for (PatchSet p : patches()) {\n         if (p.getId().equals(c.currentPatchSetId())) {\n           currentPatchSet \u003d p;\n           return p;\n         }\n       }\n     }\n     return currentPatchSet;\n  }\n\nIOW we would still eagerly load patch sets for every (!) change.",
      "parentUuid": "4d119541_5a54b5d9",
      "range": {
        "startLine": 419,
        "startChar": 4,
        "endLine": 421,
        "endChar": 6
      },
      "revId": "89c43fda4a0fbedde5be37ecd484d47986475a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4d119541_5a1f1516",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeJson.java",
        "patchSetId": 2
      },
      "lineNbr": 421,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-05-08T13:20:07Z",
      "side": 1,
      "message": "Oh, yes. Thanks for pointing that out. The name \"currentPatchSet()\" did not suggest me any loading operation ... but I was just reading the name and not looking at its implementation :-)\n\nIMHO would be best to rename it \"lazyLoadCurrentPatchSet()\" or something that suggest that is currently loading something :-) \n\nBut that\u0027s another change ;-)",
      "parentUuid": "4d119541_bafe312f",
      "range": {
        "startLine": 419,
        "startChar": 4,
        "endLine": 421,
        "endChar": 6
      },
      "revId": "89c43fda4a0fbedde5be37ecd484d47986475a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0d0b1d19_58f03d91",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ChangeJson.java",
        "patchSetId": 2
      },
      "lineNbr": 421,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-05-08T17:13:25Z",
      "side": 1,
      "message": "\u003e IMHO would be best to rename it \"lazyLoadCurrentPatchSet()\" or something that suggest that is currently loading something :-) \n\nThe default for methods in ChangeData is to be lazy loading, literally the only field that is guaranteed to be set at creation is the change ID.",
      "parentUuid": "4d119541_5a1f1516",
      "range": {
        "startLine": 419,
        "startChar": 4,
        "endLine": 421,
        "endChar": 6
      },
      "revId": "89c43fda4a0fbedde5be37ecd484d47986475a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}