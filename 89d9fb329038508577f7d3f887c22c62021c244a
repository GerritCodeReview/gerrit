{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "71fc373f_bccfd330",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-06-23T23:47:09Z",
      "side": 1,
      "message": "Is there a better description of the overall goal of this change? Notably, this line doesn\u0027t give me any indication that we\u0027re going to get the benefit described in the release notes. I\u0027m not sure this is what you\u0027re doing, but I think I\u0027m looking for something like \"Prevent indexing changes with incorrect serverId\" or \"Fix imported changes appearing as duplicates in index\".",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7ea1cba8_0f2ae6a4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-24T11:42:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "71fc373f_bccfd330",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1be88c16_c3a110d4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 13,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-06-23T23:47:09Z",
      "side": 1,
      "message": "What performance impact(s) will it cause to always need a ChangeNotes object instead of a Change object for indexing? How are those being addressed in this change?",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0b8a37df_6fa2982c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 13,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-24T11:42:06Z",
      "side": 1,
      "message": "True, I\u0027ve posted a comment on the REST-API side of the change and will address that in the next PS.",
      "parentUuid": "1be88c16_c3a110d4",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc1e818c_bb6b7fbc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-06-23T23:47:09Z",
      "side": 1,
      "message": "Does this mean that the serverId is not (currently) a required field in the index?\n\nIf yes, should that be changed on master (with a new index version) to avoid this problem being perpetuated?",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "38fe8bbc_068d3367",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-24T11:42:06Z",
      "side": 1,
      "message": "ServerId isn\u0027t a required field in the index, but it is a required field in change notes, which are needed to generate Document for the index.\n\nAll identities in change notes have the form \u003caccountId@serverId\u003e",
      "parentUuid": "bc1e818c_bb6b7fbc",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21057737_e6b547d0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-06-27T15:18:38Z",
      "side": 1,
      "message": "Can you answer this question too please?\n\n\u003e If yes, should that be changed on master (with a new index version) to avoid this problem being perpetuated?",
      "parentUuid": "38fe8bbc_068d3367",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3510facb_610bc1e2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-27T18:52:39Z",
      "side": 1,
      "message": "\u003e Can you answer this question too please?\n\u003e \n\u003e \u003e If yes, should that be changed on master (with a new index version) to avoid this problem being perpetuated?\n\nThe answer is `no`, it isn\u0027t needed in the index and it is already stored in change notes.",
      "parentUuid": "21057737_e6b547d0",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fabf09a2_0b83ad1a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-06-28T15:02:56Z",
      "side": 1,
      "message": "\u003e \u003e Can you answer this question too please?\n\u003e \u003e \n\u003e \u003e \u003e If yes, should that be changed on master (with a new index version) to avoid this problem being perpetuated?\n\u003e \n\u003e The answer is `no`, it isn\u0027t needed in the index and it is already stored in change notes.\n\nBut if we required it in the index, does that help solve the challenge you have with deprecating the API? I think it also solves the challenge of searching by a change # and getting duplicate results (it looks like the virtual id isn\u0027t used consistently)? Related, I just noticed the `TODO: To be reverted on master and stable-3.8` lines for the virtual id algo were included in `18b18957476f56c019e1f39ab6df445292d58f2c` (the cherry-pick to stable-3.8) and are still on master. It seems like the work for master isn\u0027t complete yet, so I\u0027m trying to understand what\u0027s left there (if it\u0027s not adding a new required serverId field to the index).",
      "parentUuid": "3510facb_610bc1e2",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8a228bc_d9d3dfc3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 18,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-28T18:10:19Z",
      "side": 1,
      "message": "\u003e \u003e \u003e Can you answer this question too please?\n\u003e \u003e \u003e \n\u003e \u003e \u003e \u003e If yes, should that be changed on master (with a new index version) to avoid this problem being perpetuated?\n\u003e \u003e \n\u003e \u003e The answer is `no`, it isn\u0027t needed in the index and it is already stored in change notes.\n\u003e \n\u003e But if we required it in the index, does that help solve the challenge you have with deprecating the API?\n\nThere are multiple reasons why it wouldn\u0027t help:\n\n1. This API creates an index record from in-memory data that doesn\u0027t contain any server-id: having it in the index won\u0027t resolve the fact that the Change object in memory doesn\u0027t have a server-id.\n\n2. Adding the server-id to the Change entity would help, but again this is a stable branch and we won\u0027t like to change entities with additional mandatory fields.\n\n3. Gerrit did not really need to reindex based on Change, because in all the points there is already a ChangeNote or ChangeData available, which already contains the server-id.\n\nBottom line: the only ones that could have used that API are plugins.\n\n\u003e I think it also solves the challenge of searching by a change # and getting duplicate results (it looks like the virtual id isn\u0027t used consistently)?\n\nThis problem isn\u0027t about finding multiple results with a change number, but the actual duplication of documents in the index.\n\n\u003e Related, I just noticed the `TODO: To be reverted on master and stable-3.8` lines for the virtual id algo were included in `18b18957476f56c019e1f39ab6df445292d58f2c` (the cherry-pick to stable-3.8) and are still on master. It seems like the work for master isn\u0027t complete yet, so I\u0027m trying to understand what\u0027s left there (if it\u0027s not adding a new required serverId field to the index).\n\nGood point, worth discussing in the relevant Change 354234, which is (my bad) still WIP.",
      "parentUuid": "fabf09a2_0b83ad1a",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "22da8a5a_09ff74c3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2023-06-23T23:47:09Z",
      "side": 1,
      "message": "I have a few high-level questions on the change (posted on the commit message) before I get into reviewing the code too closely.",
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97d793f8_938f1986",
        "filename": "java/com/google/gerrit/server/restapi/change/Index.java",
        "patchSetId": 6
      },
      "lineNbr": 45,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-24T11:42:06Z",
      "side": 1,
      "message": "This may have a performance implication because the change notes are read again from NoteDb, whilst they are already present in ChangeResource.",
      "range": {
        "startLine": 45,
        "startChar": 4,
        "endLine": 45,
        "endChar": 51
      },
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09d49899_bae25676",
        "filename": "java/com/google/gerrit/server/restapi/change/Index.java",
        "patchSetId": 6
      },
      "lineNbr": 45,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-06-24T21:01:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "97d793f8_938f1986",
      "range": {
        "startLine": 45,
        "startChar": 4,
        "endLine": 45,
        "endChar": 51
      },
      "revId": "89d9fb329038508577f7d3f887c22c62021c244a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}