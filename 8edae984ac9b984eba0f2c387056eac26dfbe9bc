{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7112693d_f52709d8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-05-30T20:43:47Z",
      "side": 1,
      "message": "gracefulStopTimeout",
      "range": {
        "startLine": 13,
        "startChar": 42,
        "endLine": 13,
        "endChar": 62
      },
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2c0dc92d_3c7e551a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-06-08T21:00:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7112693d_f52709d8",
      "range": {
        "startLine": 13,
        "startChar": 42,
        "endLine": 13,
        "endChar": 62
      },
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0cc31f1_436d2113",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 18,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2021-05-29T04:27:07Z",
      "side": 1,
      "message": "Just taking the timeout values configured in gerrit.config might not help in every case. Consider the case that the timeout is reached without all requests finished. In that case Gerrit will continue the shutdown after closing all connections. However, gerrit.sh would in this case still forcefully kill Gerrit at around this time. Thus, gerrit.sh would have to get some buffer on top of the configured value.",
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9bd51b19_3ab73e63",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 18,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-05-30T20:43:47Z",
      "side": 1,
      "message": "This is a tradeoff between\n- being able to finish shutdown within a reasonable time\n- avoid killing requests in flight\n\nCloning a large repository can take half an hour, using a timeout of 30min would mean that a rolling restart of a 3 node cluster could take up to 90min hence I\u0027d go for a timeout of something like 5min and expect clients to retry failed requests.",
      "parentUuid": "d0cc31f1_436d2113",
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76077500_50dad4c6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 18,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-06-08T21:00:40Z",
      "side": 1,
      "message": "Killing an in-flight clone isn\u0027t a problem, but killing an in-flight push *IS* a big problem because it may left behind locks on the filesystem.\n\nThere is already tolerance of a few seconds in the gerrit.sh script before killing, but are you suggesting yet another timeout configuration in gerrit.config for the graceful stop of the forced shutdown? I believe it would be a bit overkill for that.\n\nWDYT?",
      "parentUuid": "9bd51b19_3ab73e63",
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "816abdbf_1641be24",
        "filename": "resources/com/google/gerrit/pgm/init/gerrit.sh",
        "patchSetId": 5
      },
      "lineNbr": 352,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-05-31T06:05:47Z",
      "side": 1,
      "message": "nit: this could be moved to a DEFAULT_TIMEOUT variable",
      "range": {
        "startLine": 352,
        "startChar": 91,
        "endLine": 352,
        "endChar": 93
      },
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "77b8c7b0_6d4176e2",
        "filename": "resources/com/google/gerrit/pgm/init/gerrit.sh",
        "patchSetId": 5
      },
      "lineNbr": 352,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-06-08T21:00:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "816abdbf_1641be24",
      "range": {
        "startLine": 352,
        "startChar": 91,
        "endLine": 352,
        "endChar": 93
      },
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ad84546_2dab6c4a",
        "filename": "resources/com/google/gerrit/pgm/init/gerrit.sh",
        "patchSetId": 5
      },
      "lineNbr": 354,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2021-05-30T20:43:47Z",
      "side": 1,
      "message": "What\u0027s the purpose of having two separate options for configuring timeout for ssh and http ? It seems a single one would be sufficient since both http and ssh daemon run in the same process.",
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c53dd04b_bfd73f45",
        "filename": "resources/com/google/gerrit/pgm/init/gerrit.sh",
        "patchSetId": 5
      },
      "lineNbr": 354,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-06-08T21:02:24Z",
      "side": 1,
      "message": "That is a very good point, nevertheless we have two options at the moment.\nCan you raise this as a separate bug so that we can trace it and fix it on master?\n\nOn stable-3.2 I wouldn\u0027t change the current configuration settings, but on master I am more than happy to review it.",
      "parentUuid": "1ad84546_2dab6c4a",
      "revId": "8edae984ac9b984eba0f2c387056eac26dfbe9bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}