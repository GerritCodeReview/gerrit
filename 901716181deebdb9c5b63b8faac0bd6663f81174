{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1497532090 -0400\nnonce AH5c86Bb83BiDNrGPL8fPBXBaRP418av+da2moJgBlDMOhvYdlgpm/YjDYQ3Ma141hkcim7BsTby\n\n0000000000000000000000000000000000000000 901716181deebdb9c5b63b8faac0bd6663f81174 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJZQoa6AAoJEF/XxZqaEoiMbYAQALYwGC7OfXIqmlaK1Q2ZFV5j\nuuhvln8ZFUnliWDbGyOiUgeBWtKhNa9gqm8/VrPaKni0zu6i9a0tqJ/bpLC9CBjT\n3h8vpDaeEYczW4hSSAd3Ep+7MDN4tMQ99IaZIJAU5hZrqnjLAP86Xg+oy8ctmipy\nALH045UeXcvZEF2EfjzFZGrhcMJg5BWU+zzWta7fF/7BUcUAgjO7l3bfuJzs6dVx\nf6BSg2JCDCzD0rRS5zlu0tehBqtN5ahPUIFkXPEdNnh8shK8LY4bAMhXRcJkDKhn\nF2t6xbdQbV5V9GR/SkigR/PRSexAO1PYUmkiOEK+OENcWgG+8sDk5MmtTnLvNGEq\n2sUxBcRtpldYJb5a6WUflvfSGAJsdMX1QXq8hqxXNm6vFynzO8NGnkImj/6/Gb0l\nS/dMycIz6gbUY3uTztP8bvhTVJKLTwwSwnNF9eojwoSrD2Rh7Jibbb1wQIYR0KAn\n9lkTXFlzOIhyC94XW8tuUBwbH+0cXUwMLRw2VjGkFruzOTxYZb77ZYvgTXGI1I+s\n4/n0DT0nrDOsGrhpzWzLKL+u0YS1KMjJRkiO2b8M4WRyQsCnD+2XX+OEJ3A0QzuI\n05M2KcCA1kqhgFDDex3bpTVK4zkiDAewlUtLNwYKccNprPJKI/KRoGlEDfuF2hpU\nC67lT24nBGUI1vvsCSlg\n\u003dz0Ia\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "0bf04979_31e9bfe2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 23,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "Do we have a test which ensures that this works?",
      "range": {
        "startLine": 20,
        "startChar": 25,
        "endLine": 23,
        "endChar": 21
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1387cd4e_73e32db8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 23,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T14:54:29Z",
      "side": 1,
      "message": "Yes, the tests I added in this change.",
      "parentUuid": "0bf04979_31e9bfe2",
      "range": {
        "startLine": 20,
        "startChar": 25,
        "endLine": 23,
        "endChar": 21
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f719ba4e_d6522df0",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/git/SubmoduleSubscriptionsWholeTopicMergeIT.java",
        "patchSetId": 5
      },
      "lineNbr": 787,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "nit: changeId1",
      "range": {
        "startLine": 787,
        "startChar": 22,
        "endLine": 787,
        "endChar": 53
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "68f8c6f5_08189b2e",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/git/SubmoduleSubscriptionsWholeTopicMergeIT.java",
        "patchSetId": 5
      },
      "lineNbr": 787,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T17:12:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f719ba4e_d6522df0",
      "range": {
        "startLine": 787,
        "startChar": 22,
        "endLine": 787,
        "endChar": 53
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "96c7ff9b_99ec1452",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/git/SubmoduleSubscriptionsWholeTopicMergeIT.java",
        "patchSetId": 5
      },
      "lineNbr": 812,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "optional: Can\u0027t we rely on the default remote being origin?",
      "range": {
        "startLine": 812,
        "startChar": 9,
        "endLine": 812,
        "endChar": 28
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4043eb7d_3c42016f",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/git/SubmoduleSubscriptionsWholeTopicMergeIT.java",
        "patchSetId": 5
      },
      "lineNbr": 812,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T17:12:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "96c7ff9b_99ec1452",
      "range": {
        "startLine": 812,
        "startChar": 9,
        "endLine": 812,
        "endChar": 28
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd97c0c5_42a8af07",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/git/SubmoduleSubscriptionsWholeTopicMergeIT.java",
        "patchSetId": 5
      },
      "lineNbr": 816,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "What are those two calls for? Is it an implicit check that getAdvertisedRef(\"refs/heads/master\") doesn\u0027t return null?",
      "range": {
        "startLine": 814,
        "startChar": 8,
        "endLine": 816,
        "endChar": 0
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41dcef74_13376d5c",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/git/SubmoduleSubscriptionsWholeTopicMergeIT.java",
        "patchSetId": 5
      },
      "lineNbr": 816,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T17:12:49Z",
      "side": 1,
      "message": "I just pasted this from elsewhere in the file, I clearly should have thought about it a little more.\n\nI think you\u0027re right, it\u0027s checking that fetching updated origin/master. But this fetch call doesn\u0027t actually touch origin/master, because expectToHaveSubmoduleState already called fetch. So this is really just doing ls-remote by looking at the advertised ref set of a no-op fetch.\n\nThere is no harm in just skipping this whole fetch call. If one of the implicit fetches from expectToHaveSubmoduleState didn\u0027t update origin/master, then the next assertion about origin/master^ will also fail as expected.",
      "parentUuid": "bd97c0c5_42a8af07",
      "range": {
        "startLine": 814,
        "startChar": 8,
        "endLine": 816,
        "endChar": 0
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1eb5cb03_098f13ee",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/change/AbstractSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 880,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "Do we have a test which tries to submit a new change which has a topic which is already submitted?",
      "range": {
        "startLine": 880,
        "startChar": 2,
        "endLine": 880,
        "endChar": 7
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db05c416_dfccb4ac",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/change/AbstractSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 880,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T14:54:29Z",
      "side": 1,
      "message": "Sorry, I\u0027m not sure what you mean by \"a new change which has a topic which is already submitted\"\n\nDo you mean:\n\n* Create change 1 with topic foo\n* Submit change 1\n* Create change 2 with same topic foo as change 1\n* Submit change 2\n\n?\n\n(I don\u0027t think we have a test that does that. It seems mostly unrelated to this change, but then again I suppose I could see where a bug in this implementation would cause that to start failing.)",
      "parentUuid": "1eb5cb03_098f13ee",
      "range": {
        "startLine": 880,
        "startChar": 2,
        "endLine": 880,
        "endChar": 7
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d9ae9da_da9b8aca",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/change/AbstractSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 880,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T15:30:27Z",
      "side": 1,
      "message": "Yes, that\u0027s the scenario I was thinking of. When I first read the description of the issue and the chosen solution, I was wondering whether that scenario would be influenced by this change. After taking a look at the code, I saw that it should be unrelated but still would feel better if we had a test documenting the expected behavior.",
      "parentUuid": "db05c416_dfccb4ac",
      "range": {
        "startLine": 880,
        "startChar": 2,
        "endLine": 880,
        "endChar": 7
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aca19854_ca15a86f",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/change/AbstractSubmit.java",
        "patchSetId": 5
      },
      "lineNbr": 880,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T17:13:19Z",
      "side": 1,
      "message": "Done in https://gerrit-review.googlesource.com/110693",
      "parentUuid": "8d9ae9da_da9b8aca",
      "range": {
        "startLine": 880,
        "startChar": 2,
        "endLine": 880,
        "endChar": 7
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "751a4c64_574a7d25",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 554,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "Do we mind that retries influence this metric?",
      "range": {
        "startLine": 554,
        "startChar": 6,
        "endLine": 554,
        "endChar": 48
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef9956b8_8c50b1ce",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 554,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T14:54:29Z",
      "side": 1,
      "message": "Good point, this should be hoisted out of the retry loop.",
      "parentUuid": "751a4c64_574a7d25",
      "range": {
        "startLine": 554,
        "startChar": 6,
        "endLine": 554,
        "endChar": 48
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "69068caf_ae9f44cc",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeOp.java",
        "patchSetId": 5
      },
      "lineNbr": 554,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T17:12:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ef9956b8_8c50b1ce",
      "range": {
        "startLine": 554,
        "startChar": 6,
        "endLine": 554,
        "endChar": 48
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abd51d14_82397dc1",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/SubmitStrategy.java",
        "patchSetId": 5
      },
      "lineNbr": 261,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "nit: id",
      "range": {
        "startLine": 261,
        "startChar": 15,
        "endLine": 261,
        "endChar": 33
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64b4fde0_3317fe37",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/SubmitStrategy.java",
        "patchSetId": 5
      },
      "lineNbr": 261,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T17:12:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "abd51d14_82397dc1",
      "range": {
        "startLine": 261,
        "startChar": 15,
        "endLine": 261,
        "endChar": 33
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4baad795_82bb878b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/SubmitStrategyOp.java",
        "patchSetId": 5
      },
      "lineNbr": 503,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "Aren\u0027t all refs updated before postUpdate() is called and hence a LockFailureException will result in postUpdate() never being called for all involved BatchUpdateOps? If so, couldn\u0027t we just execute this method?",
      "range": {
        "startLine": 502,
        "startChar": 26,
        "endLine": 503,
        "endChar": 97
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "63d9afe1_e23850d9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/SubmitStrategyOp.java",
        "patchSetId": 5
      },
      "lineNbr": 503,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T14:54:29Z",
      "side": 1,
      "message": "I didn\u0027t quite explain the issue clearly here.\n\nThe proximate problem is that short-circuiting on line 235 means that the submitter field (and possibly other fields) isn\u0027t set by updateChange, which causes an NPE later in this method when it attempts to read submitter. Short-circuiting here in the changeAlreadyMerged case is certainly the easiest way to avoid this NPE.\n\nBut suppose I tried harder to untangle the control flow of updateChange so we could proceed here. Then the issue with sending emails twice is not due to retries, it\u0027s due to racing with another submit process, where both batches succeed without lock failure, but the second one sees the change as merged in updateChange.\n\nIt may be worth trying to figure out how to support this case correctly, but I would rather fix the problem to reduce error rates first, and hone emails later.",
      "parentUuid": "4baad795_82bb878b",
      "range": {
        "startLine": 502,
        "startChar": 26,
        "endLine": 503,
        "endChar": 97
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d16de27_921c4723",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/SubmitStrategyOp.java",
        "patchSetId": 5
      },
      "lineNbr": 503,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T15:30:27Z",
      "side": 1,
      "message": "\u003e It may be worth trying to figure out how to support this case correctly, but I would rather fix the problem to reduce error rates first, and hone emails later.\n\nSure. Instead of the emails, I was rather concerned about not triggering ChangeMergedListeners but fixing the immediate issue should come first.",
      "parentUuid": "63d9afe1_e23850d9",
      "range": {
        "startLine": 502,
        "startChar": 26,
        "endLine": 503,
        "endChar": 97
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce1892db_ca25a53d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/TestHelperOp.java",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-06-20T14:22:20Z",
      "side": 1,
      "message": "nit: Insert a delimiter between submissionId and msg?",
      "range": {
        "startLine": 55,
        "startChar": 16,
        "endLine": 55,
        "endChar": 34
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86231ee1_fc7cac2e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/strategy/TestHelperOp.java",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-20T14:54:29Z",
      "side": 1,
      "message": "This is identical to SubmitStrategyOp, and the submissionId ends with \u0027]\u0027 so there is a visual distinction.",
      "parentUuid": "ce1892db_ca25a53d",
      "range": {
        "startLine": 55,
        "startChar": 16,
        "endLine": 55,
        "endChar": 34
      },
      "revId": "901716181deebdb9c5b63b8faac0bd6663f81174",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}