{
  "comments": [
    {
      "key": {
        "uuid": "ebca5a38_6be6c191",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2016-04-12T13:01:45Z",
      "side": 1,
      "message": "The instance of the ReviewDb is provided by RequestScopedReviewDbProvider for the entire context of the request, we should not have to manually close this db, it will be done at the end of the request.\n\nIf I look at other usage of Provider\u003cReviewDb\u003e, we never close the db.\n\nAm I missing something, why do we need to close them in this class? Is this change really fixing you connection leak?",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abbea28e_29352dcf",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1022287
      },
      "writtenOn": "2016-04-12T13:16:50Z",
      "side": 1,
      "message": "Actually,there was a connection leak which was caused by the command \"suexec --as\" in Gerrit.\nWhen the \"--as\" is assigned a EMAIL address which is inaccurate (maybe not case-sensitive or imcomplete) but existed,the connection leak will occur.\nAnd after I closed the db manually in the class,the connection leak was fixed.",
      "parentUuid": "ebca5a38_6be6c191",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2bc47260_f5ab3898",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1012758
      },
      "writtenOn": "2016-04-12T17:21:52Z",
      "side": 1,
      "message": "The test failures seem to suggest that manually closing the db might not be the correct fix.",
      "parentUuid": "abbea28e_29352dcf",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2b89d23a_8dcbc170",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-04-13T00:40:50Z",
      "side": 1,
      "message": "\u003e If I look at other usage of Provider\u003cReviewDb\u003e, we never close the db\n\nHmm, yes, I think this is correct.  Let\u0027s try to fix this another way.",
      "parentUuid": "ebca5a38_6be6c191",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0b988e84_4c163f92",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-04-13T09:30:07Z",
      "side": 1,
      "message": "I agree, closing request scoped ReviewDb here is wrong.\n\nMy feeling is that, if there is a bug, then it is likely in the SuExec.start method which switches guice contexts.",
      "parentUuid": "2b89d23a_8dcbc170",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0b988e84_4c91df3e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-04-13T09:53:57Z",
      "side": 1,
      "message": "Can you provide more details on how to reproduce the connection leak?\nIs it enough to repeat the:\n\n suexec ... --as EMAIL_1\n\nN times (with the same wrong email) in order to leak N connections?\nOr do you need to change the email in order to leak yet another connection?",
      "parentUuid": "abbea28e_29352dcf",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2bc47260_75f2c8b8",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1022287
      },
      "writtenOn": "2016-04-13T12:55:45Z",
      "side": 1,
      "message": "Yes,I think so.Maybe we should find another way to fix it.",
      "parentUuid": "2bc47260_f5ab3898",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2b89d23a_0de351f1",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1022287
      },
      "writtenOn": "2016-04-13T12:55:45Z",
      "side": 1,
      "message": "Yes,I think so,too.",
      "parentUuid": "2b89d23a_8dcbc170",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0b988e84_2c82d3c7",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1022287
      },
      "writtenOn": "2016-04-13T12:55:45Z",
      "side": 1,
      "message": "For example,if your email_address is aa000@@gmail.com,you just execute command \"suexec ... --as aA000\"(not case-sensitive) or \"suexec ... --as aa0\"(imcomplete),it will be reproduced.",
      "parentUuid": "0b988e84_4c91df3e",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0b988e84_2c69f3c7",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/account/AccountResolver.java",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-04-13T15:29:48Z",
      "side": 1,
      "message": "\u003e For example,if your email_address is aa000@@gmail.com,you just execute command \"suexec ... --as aA000\"(not case-sensitive) or \"suexec ... --as aa0\"(imcomplete),it will be reproduced.\n\nWhat happens if you keep repeating the same command with the same wrong email? Do you see further connections being leaked?\nCan you exhaust the whole connection pool by just repeating the same command again and again?",
      "parentUuid": "0b988e84_2c82d3c7",
      "range": {
        "startLine": 119,
        "startChar": 23,
        "endLine": 119,
        "endChar": 35
      },
      "revId": "9201e95bbe3373115a003bc0dc15464e19b4e858",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}