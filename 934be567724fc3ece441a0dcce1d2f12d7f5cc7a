{
  "comments": [
    {
      "key": {
        "uuid": "42cb45e2_46b1520d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 24,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-03-03T21:31:50Z",
      "side": 1,
      "message": "ntS",
      "range": {
        "startLine": 24,
        "startChar": 20,
        "endLine": 24,
        "endChar": 22
      },
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a27fa14b_a1be5eda",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 24,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2016-03-04T18:32:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "42cb45e2_46b1520d",
      "range": {
        "startLine": 24,
        "startChar": 20,
        "endLine": 24,
        "endChar": 22
      },
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "42cb45e2_86c34a56",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 30,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-03-03T21:31:50Z",
      "side": 1,
      "message": "In the GerritGlobalModule I see two DynamicSets, lines 283 and 285",
      "range": {
        "startLine": 29,
        "startChar": 65,
        "endLine": 30,
        "endChar": 67
      },
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2bfd930_e306726c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 30,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2016-03-04T18:32:31Z",
      "side": 1,
      "message": "You are right, I wanted to say: Hold UserScopedEventListeners in a DynamicSet same way EventListeners are.\n\nBut holding both type of Listeners in the same DynamicSet is possible, the dispatcher would need to iterate on only one set and do visibility check on listener that are an instance of UserScopedEventListener. Do you prefer to hold them in the same DynamicSet?\n\nExample:\n\n private void fireEvent(Change change, ChangeEvent event, ReviewDb db)\n        throws OrmException {\n      for (EventListener listener : listeners) {\n        if (listener instanceof UserScopedEventListener \u0026\u0026 !isVisibleTo(change,\n            ((UserScopedEventListener) listener).getUser(), db)) {\n          continue;\n        }\n        listener.onEvent(event);\n      }\n    }\n\ninstead of\n\nprivate void fireEventForUnrestrictedListeners(com.google.gerrit.server.events.Event event) {\n      for (EventListener listener : unrestrictedListeners) {\n        listener.onEvent(event);\n      }\n    }\n\n    private void fireEvent(Change change, ChangeEvent event, ReviewDb db)\n        throws OrmException {\n      for (UserScopedEventListener listener : listeners) {\n        if (isVisibleTo(change, listener.getUser(), db)) {\n          listener.onEvent(event);\n        }\n      }\n\n      fireEventForUnrestrictedListeners( event );\n    }",
      "parentUuid": "42cb45e2_86c34a56",
      "range": {
        "startLine": 29,
        "startChar": 65,
        "endLine": 30,
        "endChar": 67
      },
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a236c1c5_a9363d3a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 30,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-03-07T14:03:52Z",
      "side": 1,
      "message": "\u003e I wanted to say: Hold UserScopedEventListeners in a DynamicSet same way EventListeners are.\n\nOK, I see. In that case I would remove this sentence altogether, because using DynamicSet for keeping extension points is just how we do it.\n\n\u003e  Do you prefer to hold them in the same DynamicSet?\n\nLooking at both code samples I see no advantage in keeping them both in a single DynamicSet because, in the loop, we must check for the type and downcast if necessary. If we would be able to process all event listeners polymorphically then keeping them in one set would make sense. Without polymorphism I would just keep the code as it is.",
      "parentUuid": "e2bfd930_e306726c",
      "range": {
        "startLine": 29,
        "startChar": 65,
        "endLine": 30,
        "endChar": 67
      },
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "62684971_4aaa539c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 35,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-03-03T21:31:50Z",
      "side": 1,
      "message": "nit: useless empty line :-)",
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2bfd930_c30b7672",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 35,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2016-03-04T18:32:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "62684971_4aaa539c",
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "42cb45e2_e6b83ef0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/common/ChangeHookRunner.java",
        "patchSetId": 6
      },
      "lineNbr": 906,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-03-03T21:31:50Z",
      "side": 1,
      "message": "Is it expected that a listener returns a different user every time it is called? If no, the listener.getUser() can be done once before the loop.\n\nSame in few more cases below.",
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2bfd930_e3b832f0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/common/ChangeHookRunner.java",
        "patchSetId": 6
      },
      "lineNbr": 906,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-03-04T01:41:56Z",
      "side": 1,
      "message": "It\u0027s only calling getUser() once per listener.  Since each listener may be scoped to a different user, this is correct.",
      "parentUuid": "42cb45e2_e6b83ef0",
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a236c1c5_69dfe51d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/common/ChangeHookRunner.java",
        "patchSetId": 6
      },
      "lineNbr": 906,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2016-03-07T08:23:30Z",
      "side": 1,
      "message": "Correct... my mistake.",
      "parentUuid": "e2bfd930_e3b832f0",
      "revId": "934be567724fc3ece441a0dcce1d2f12d7f5cc7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}