{
  "comments": [
    {
      "key": {
        "uuid": "50d76e7e_aae9efb2",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-05-04T13:17:42Z",
      "side": 1,
      "message": "Needed to change from Provider\u003cReviewDb\u003e to the request scoped ReviewDb injection due to a strange bug: when using dbProvider.get().close() then the closed ReviewDb instance is (re)used by the request scoped injection and is giving a NPE when trying to fetch something from the database. I am puzzled about this and am not sure if this is a bug in guice or in Gerrit.",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "50d76e7e_6ad89719",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-05-04T13:50:55Z",
      "side": 1,
      "message": "How you reproduce this? Stack trace?",
      "parentUuid": "50d76e7e_aae9efb2",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30dafaa9_29a98d5d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-05-04T14:51:33Z",
      "side": 1,
      "message": "This can be reproduced even without this change. Checkout the stable-2.11 then add the following fragment:\n\n  ReviewDb reviewDb \u003d dbProvider.get();\n  reviewDb.close();\n\nto the SuggestReviewers class at the line 185.\nRun the SuggestReviewersIT and check the server log. There will be many NPEs.",
      "parentUuid": "50d76e7e_6ad89719",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30dafaa9_a97bbd76",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-05-04T15:00:34Z",
      "side": 1,
      "message": "Interesting. I will look into it.",
      "parentUuid": "30dafaa9_29a98d5d",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "50d76e7e_ca7a6370",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-05-04T15:12:04Z",
      "side": 1,
      "message": "It turns out that the SuggestReviewers.dbProvider is a request scoped Provider\u003cReviewDb\u003e and will always return the same ReviewDb instance from its get() method. Means, I could still have used the Provider\u003cReviewDb\u003e here but make sure NOT to close the ReviewDb instance.",
      "parentUuid": "30dafaa9_a97bbd76",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "50d76e7e_0a8d9b03",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-05-04T15:15:19Z",
      "side": 1,
      "message": "Yes. Why you was trying to close it? We never do this.",
      "parentUuid": "50d76e7e_ca7a6370",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30dafaa9_c94c3154",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/change/ReviewerSuggestionCache.java",
        "patchSetId": 7
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-05-05T08:22:31Z",
      "side": 1,
      "message": "Because I was (wrongly) believing that dbProvider.get() opens a new connection, always...",
      "parentUuid": "50d76e7e_0a8d9b03",
      "revId": "963c69423cc0376e41d807747506a0e60cf8145e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}