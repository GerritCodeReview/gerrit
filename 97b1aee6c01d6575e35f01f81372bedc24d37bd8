{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "70277444_9bd4fc67",
        "filename": "java/com/google/gerrit/server/approval/ApprovalCacheImpl.java",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-06-04T11:35:01Z",
      "side": 1,
      "message": "Is that refs/changes/meta or refs/meta/config?\n\nThe name was a bit confusing to me. I assume that\u0027s refs/meta/config that\u0027s storing configs of copyIf?",
      "range": {
        "startLine": 82,
        "startChar": 69,
        "endLine": 82,
        "endChar": 86
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9b0d2b70_a6d6741b",
        "filename": "java/com/google/gerrit/server/approval/ApprovalCacheImpl.java",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-06-04T11:42:53Z",
      "side": 1,
      "message": "refs/changes/.../meta.\n\nWe can\u0027t tie ties to the state in refs/meta/config because that would mean that when you vote on a change the cache does not get invalidated, hence, your vote is not showing.",
      "parentUuid": "70277444_9bd4fc67",
      "range": {
        "startLine": 82,
        "startChar": 69,
        "endLine": 82,
        "endChar": 86
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "788ffad1_93904911",
        "filename": "java/com/google/gerrit/server/approval/ApprovalCacheImpl.java",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-06-04T13:11:17Z",
      "side": 1,
      "message": "Thanks for discussing this on GVC: We discussed including refs/meta/config in the cache key as well.\n\nSince refs/meta/config is not part of the cache key, changing copyCondition in project.config will not cause a re-evaluation of the copied labels that are already cached. This behaviour is different from what we have today: the copied label scores are evaluated on the fly every time the change page is loaded, so if the label.copyAllScoresOn* has changed, any previous labels can still be copied for opened changes.\n\nStoring refs/meta/config in the cache key will require storing ref IDs for all parent projects as well, since labels can be inherited.\n\nWe agreed that the current change is fine: changing copyIf won\u0027t result in updating open changes (unless refs/changes/../meta was updated due to an added comment, etc...). This behaviour is also undocumented in our docs.\n\nAlso as per the commit message: as a future enhancement, we\u0027d like to persist copied labels in NoteDb on patchset creation time to avoid re-evaluating this logic.",
      "parentUuid": "9b0d2b70_a6d6741b",
      "range": {
        "startLine": 82,
        "startChar": 69,
        "endLine": 82,
        "endChar": 86
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "209c55f5_194dd521",
        "filename": "java/com/google/gerrit/server/restapi/change/PostReview.java",
        "patchSetId": 6
      },
      "lineNbr": 1425,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-06-04T11:35:01Z",
      "side": 1,
      "message": "Javadocs need to be fixed.",
      "range": {
        "startLine": 1422,
        "startChar": 92,
        "endLine": 1425,
        "endChar": 51
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d01989c_d54aac4b",
        "filename": "java/com/google/gerrit/server/restapi/change/PostReview.java",
        "patchSetId": 6
      },
      "lineNbr": 1425,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-06-04T11:42:53Z",
      "side": 1,
      "message": "Ha :-) Done.",
      "parentUuid": "209c55f5_194dd521",
      "range": {
        "startLine": 1422,
        "startChar": 92,
        "endLine": 1425,
        "endChar": 51
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "401dc028_37804717",
        "filename": "proto/cache.proto",
        "patchSetId": 6
      },
      "lineNbr": 691,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2021-06-04T11:35:01Z",
      "side": 1,
      "message": "nit: 5",
      "range": {
        "startLine": 691,
        "startChar": 12,
        "endLine": 691,
        "endChar": 13
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6ab09034_a97488fb",
        "filename": "proto/cache.proto",
        "patchSetId": 6
      },
      "lineNbr": 691,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2021-06-04T11:42:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "401dc028_37804717",
      "range": {
        "startLine": 691,
        "startChar": 12,
        "endLine": 691,
        "endChar": 13
      },
      "revId": "97b1aee6c01d6575e35f01f81372bedc24d37bd8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}