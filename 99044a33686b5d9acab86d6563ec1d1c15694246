{
  "comments": [
    {
      "key": {
        "uuid": "e1c75626_beb85397",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 16,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "What happens during the online reindexing process when search results return a serialized Change object that contains a Status enum value that no longer exists? I am ok with showing slightly wonky search results in this case, but a 500 is probably not ok.",
      "range": {
        "startLine": 15,
        "startChar": 23,
        "endLine": 16,
        "endChar": 66
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4ba671e2_a2b0b8d9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 16,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:45:46Z",
      "side": 1,
      "message": "Right, you have suggested during last hackathon, that we might be able to tweak index deserialisation code? Basically, change status \u0027d\u0027 could not be read any more.",
      "parentUuid": "e1c75626_beb85397",
      "range": {
        "startLine": 15,
        "startChar": 23,
        "endLine": 16,
        "endChar": 66
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d85da04_c0c461c8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 16,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T16:25:52Z",
      "side": 1,
      "message": "Actually, it\u0027s not as bad as I thought. The status is a char, which means that we wouldn\u0027t get an exception during deserialization, only when calling Status#forCode via Change#getStatus. That means we can override the ProtobufCodec to replace \u0027d\u0027 with \u0027n\u0027 before returning the Change to the caller.",
      "parentUuid": "4ba671e2_a2b0b8d9",
      "range": {
        "startLine": 15,
        "startChar": 23,
        "endLine": 16,
        "endChar": 66
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6424d982_078f0ccb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 16,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-14T20:39:57Z",
      "side": 1,
      "message": "I figured, we could even go one step further on the call stack and fix Change.getStatus(), that uses Status.forCode() and map value \u0027d\u0027 to Status.NEW. Done.",
      "parentUuid": "5d85da04_c0c461c8",
      "range": {
        "startLine": 15,
        "startChar": 23,
        "endLine": 16,
        "endChar": 66
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a6ae11f5_6df04e73",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 16,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-27T11:54:24Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "6424d982_078f0ccb",
      "range": {
        "startLine": 15,
        "startChar": 23,
        "endLine": 16,
        "endChar": 66
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9dd85473_4864c9a4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 19,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "Should this followup block 2.15?",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 17
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7289dbcb_a491dfd6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 19,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:45:46Z",
      "side": 1,
      "message": "Right! I entirely forgot this. I will create an issue, and start to work on it. I looked into it, it is not too much work. (Thous, a lot of UI tests involved here).",
      "parentUuid": "9dd85473_4864c9a4",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 17
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95a2db4d_1c85bb6d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 19,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:57:50Z",
      "side": 1,
      "message": "I just wrote this issue: [1].\n\n* [1] https://bugs.chromium.org/p/gerrit/issues/detail?id\u003d7210",
      "parentUuid": "7289dbcb_a491dfd6",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 17
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d1f55af2_0fa3935e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 19,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-27T11:54:24Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "95a2db4d_1c85bb6d",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 17
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cc325421_60012109",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 21,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:45:46Z",
      "side": 1,
      "message": "branches",
      "range": {
        "startLine": 21,
        "startChar": 5,
        "endLine": 21,
        "endChar": 12
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f863679e_45d0d555",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 22,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "This one should probably happen before 2.15.",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 22,
        "endChar": 61
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66a6fcb7_2270e823",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 22,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:45:46Z",
      "side": 1,
      "message": "This would be probably a schema migration?",
      "parentUuid": "f863679e_45d0d555",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 22,
        "endChar": 61
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93360908_75cefd2d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 22,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T16:25:52Z",
      "side": 1,
      "message": "Yes, that\u0027s fine, we have used ReviewDb schema migrations in the past to edit permissions, this is a similar thing.\n\n(Still kicking the can down the road for how to do schema migrations post-3.0.)",
      "parentUuid": "66a6fcb7_2270e823",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 22,
        "endChar": 61
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c31a09c7_a2700e2a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 22,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-27T11:54:24Z",
      "side": 1,
      "message": "Still unresolved, but not part of this change.",
      "parentUuid": "93360908_75cefd2d",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 22,
        "endChar": 61
      },
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7622cf7_c987cad4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 24,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "This one it\u0027s ok if it doesn\u0027t happen before 2.15, it\u0027s not really hurting anything, but probably it\u0027s not a hard migration to write.",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fbeb0588_816bb167",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 24,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:45:46Z",
      "side": 1,
      "message": "Ack.",
      "parentUuid": "d7622cf7_c987cad4",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7101fccb_4a37c021",
        "filename": "/COMMIT_MSG",
        "patchSetId": 67
      },
      "lineNbr": 24,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-27T11:54:24Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "fbeb0588_816bb167",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6bf525d6_2633a8db",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 67
      },
      "lineNbr": 668,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "This is going to throw if this ever encounters a \"(draft)\" in NoteDb. I think we decided that that\u0027s ok:\n\n* Anybody using NoteDb pre-2.15, we already tell them they will have to rebuild everything (and this is why we disrecommended it for production use)\n* This will never happen on googlesource.com because we will run the migration internally first.",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7b7e4f1_0256e50c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 40,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "Curious...do most people run init with --batch when upgrading Gerrit? If so, do we need to mention in the release notes that they might not want to do that because there are migration-related questions that they might want to answer?",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "71d23bf6_1bec1051",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 40,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:57:50Z",
      "side": 1,
      "message": "We should start writing the 2.15 release notes to not forget all this.",
      "parentUuid": "d7b7e4f1_0256e50c",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa466047_adfda83c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 48,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-13T15:33:22Z",
      "side": 1,
      "message": "For our internal migration, we set NEW changes to private if they have any draft patch sets, even though the change is not currently DRAFT. Do we want to replicate that logic here?",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eec89b0a_7df2244e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 48,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-13T15:45:46Z",
      "side": 1,
      "message": "Good idea.\n\n+1 to replicate this logic.",
      "parentUuid": "aa466047_adfda83c",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "034b2bc9_2162d2b9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 48,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-14T12:40:52Z",
      "side": 1,
      "message": "I believe this SQL statement should do the job (untested):\n\n  UPDATE changes SET private \u003d \u0027Y\u0027 WHERE status \u003d \u0027d\u0027\n  or EXISTS (SELECT * FROM patch_sets WHERE\n  patch_sets.change_id \u003d changes.change_id and patch_sets.draft \u003d \u0027Y\u0027);",
      "parentUuid": "eec89b0a_7df2244e",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "382132c7_5525c4a4",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 48,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-09-14T20:39:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "aa466047_adfda83c",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3f4e546_5dc57141",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_159.java",
        "patchSetId": 67
      },
      "lineNbr": 48,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-09-27T11:54:24Z",
      "side": 1,
      "message": "You also tested it, right?",
      "parentUuid": "382132c7_5525c4a4",
      "revId": "99044a33686b5d9acab86d6563ec1d1c15694246",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}