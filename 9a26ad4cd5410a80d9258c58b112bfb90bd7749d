{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e4301978_d0deab4a",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 145,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2022-10-18T11:50:11Z",
      "side": 1,
      "message": "should this say \"patch:apply\" , same for other messages.",
      "range": {
        "startLine": 145,
        "startChar": 13,
        "endLine": 145,
        "endChar": 26
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "095c3daf_b31dd85a",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 145,
      "author": {
        "id": 1146706
      },
      "writtenOn": "2022-10-21T12:15:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e4301978_d0deab4a",
      "range": {
        "startLine": 145,
        "startChar": 13,
        "endLine": 145,
        "endChar": 26
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "56aa7124_9b0c0360",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2022-10-11T14:01:59Z",
      "side": 1,
      "message": "should this check for forgeAuthor/forgeCommitter permission? What about addPatchSet?",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96be87e9_8fc1a04d",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1146706
      },
      "writtenOn": "2022-10-12T19:55:11Z",
      "side": 1,
      "message": "\u003e should this check for forgeAuthor/forgeCommitter permission? \n\nAdded permission checks (extracted from CreateChange).\n\n\u003e What about addPatchSet?\n\nI\u0027ve looked on the usages of PatchSetInserter, and each sets different fields. Some (like CherryPickChange) even add more updates the the BatchUpdater. I think extracting a method here will only cause confusion.",
      "parentUuid": "56aa7124_9b0c0360",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6d83e53_6204a9a2",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2022-10-18T08:21:52Z",
      "side": 1,
      "message": "I think those checks are unnecessary, since they are already covered by the existing logic, see [1] @hanwen@google.com, do you think they should be explicit in this API?\n\n[1]https://gerrit-review.googlesource.com/c/gerrit/+/347054/comment/53e31979_2f86416b/",
      "parentUuid": "96be87e9_8fc1a04d",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ece322e6_1046d7e0",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2022-10-18T11:50:11Z",
      "side": 1,
      "message": "Marija is correct: the patchinserter already handles it, so we don\u0027t have to check again here. Is there a test that asserts the correct behavior?",
      "parentUuid": "a6d83e53_6204a9a2",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ab3f090_efe93500",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1146706
      },
      "writtenOn": "2022-10-21T12:15:01Z",
      "side": 1,
      "message": "I tried to add a test for no ADD_PATCH_SET permission - `checkPermissionsForAddingPatchSet`, but it seem to have no permission issues.\n\nI\u0027ve verified that both of the checks, in `PatchSetUtil::checkPermissionsForAddingPatchSet` and in [`PatchSetInserter::validate`](https://gerrit.googlesource.com/gerrit/+/refs/changes/54/347054/13/java/com/google/gerrit/server/change/PatchSetInserter.java#395) are reached for this test (and passed).\n\nThe blocking block was copied from [`applyProvidedFixRestAPIcallWithoutAddPatchSetPermissionCannotBeApplied`](https://gerrit.googlesource.com/gerrit/+/refs/changes/54/347054/13/javatests/com/google/gerrit/acceptance/api/revision/ApplyProvidedFixIT.java#260).\n\n\nCould any of you please advice why the test fails? (I\u0027ll remove the extra checks once the issue is resolved).\n\nThanks!",
      "parentUuid": "ece322e6_1046d7e0",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "182bad82_19ca973e",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2022-10-24T09:48:04Z",
      "side": 1,
      "message": "Digging into your test, addPatchSet is always allowed for a change owner [1], and the permissions is granted on \u0027refs/for/*\u0027 on allProjects.\n\nSo you need to revoke permissions on allProjects and also issue an operation from a different user. You can do this like:\n\n```\n projectOperations\n     .project(allProjects)\n     .forUpdate()\n     .remove(permissionKey(Permission.ADD_PATCH_SET)\n     .ref(\"refs/for/*\").group(REGISTERED_USERS).build())\n     .update();\n     \n   \n requestScopeOperations.setApiUser(user.id());\n\n```\n\n\n[1]https://gerrit.googlesource.com/gerrit/+/refs/changes/54/347054/13/java/com/google/gerrit/server/permissions/ChangeControl.java#108",
      "parentUuid": "0ab3f090_efe93500",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b1d16c2_1c2276aa",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 167,
      "author": {
        "id": 1146706
      },
      "writtenOn": "2022-10-25T09:53:39Z",
      "side": 1,
      "message": "Thanks for the references!\nDone.",
      "parentUuid": "182bad82_19ca973e",
      "range": {
        "startLine": 166,
        "startChar": 4,
        "endLine": 167,
        "endChar": 31
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "229ff8f9_4eabc4f5",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 170,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2022-10-11T14:01:59Z",
      "side": 1,
      "message": "as mentionned on the other change, the patch already contains author and commit message, and I think the intended use case is to download a patch from one gerrit instance and insert into another instance, which would mean respecting that? It would be good to doublecheck if that is the intended use case.",
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dab46d45_9187a576",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 170,
      "author": {
        "id": 1146706
      },
      "writtenOn": "2022-10-12T19:55:11Z",
      "side": 1,
      "message": "Discussed in the other thread. Will support that as a followup.",
      "parentUuid": "229ff8f9_4eabc4f5",
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "18223917_f29dfa09",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 170,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2022-10-17T12:57:06Z",
      "side": 1,
      "message": "Nitzan\u0027s arguments on requiring author in input make sense. \nSince there are multiple ways to create the patch, it might be confusing for the users that the patch set author is not taken from commit, so I would suggest to make the field mandatory, to resolve any possible questions. We could skip the FORGE_CHECK if author matches the calling user.",
      "parentUuid": "dab46d45_9187a576",
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3bc97f3_7d9381e2",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 173,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2022-10-18T11:50:11Z",
      "side": 1,
      "message": "this is now input.commitMessage, right? I guess the change must be rebased?",
      "range": {
        "startLine": 173,
        "startChar": 20,
        "endLine": 173,
        "endChar": 28
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5308bd01_fa405533",
        "filename": "java/com/google/gerrit/server/restapi/change/ApplyPatch.java",
        "patchSetId": 10
      },
      "lineNbr": 173,
      "author": {
        "id": 1146706
      },
      "writtenOn": "2022-10-21T12:15:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b3bc97f3_7d9381e2",
      "range": {
        "startLine": 173,
        "startChar": 20,
        "endLine": 173,
        "endChar": 28
      },
      "revId": "9a26ad4cd5410a80d9258c58b112bfb90bd7749d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}