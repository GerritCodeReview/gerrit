{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1497644221 -0400\nnonce AH5c86Db/KBfn5surcqZ4K00i2/XHXhOKINceIoxdgL4TKVXjMc5AodJnWNna6vY6Z/oi8Ou0ORA\n\n0000000000000000000000000000000000000000 6f1cd75a45f8013b3b81895237d706add27abcca refs/for/master%topic\u003dmigrate-to-note-db,r\u003dekempin,r\u003daliceks\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJZRDy9AAoJEF/XxZqaEoiM1BsP/3q+efs10O5A/cvWj1rYFsQh\nDmOhVxlaG3B9CTuEND4C4vC305R7BjZbBFKASRYaLRpKNpvAIfWqi+iGiw9QuToi\nxTHnAWCtg51exiQne+t+4KOKQa934vM1yzKNVuKdKLAezWRMh8Tz7ZEX6DKZqtNK\nD5bxEwATMUtnvk1vqK3S6JfCa1osZ22IE6i4uDWSUzPDPtfAsVsZ6CFfrms+eKdc\nKYBKKvrUsXoZN8CJkps0sxq6nDGXAWTQdYDtezvRkAflQhtnMm6Vzguq604dNeie\nYZEV1ERVp41iveffV1tKfi+rnMjOXw83KOm6s7mn8BXdG9FyJfIhobS2WdWbXXod\ncmPwHisyRHCre8wFwxdSUfFCxdgD6DMTfT7+YMa3N2bAyh/xTD6UixJiHUMCPAgS\nJy0zz4SVqxRQCLHD3x1liDEFpITBNKVnazyosZ6H6OlWtMZgQUwuCAwzpaZ6jK2D\ndXzGhpmdcF7+Zu26DgLxBEnzgieqwrJjf0aOktwO29W0u+cvOP1kxLBd/wsQpVGD\n0at6UOo4POD54Zw0HgA7WzvVncnq8ycQ9wXhdlfVg2s9bB4BDsWL2PK3Q2r54JcN\nRc2YNmc04XGR/76nr7z3LRCG2HG1lz/3OqoB1hRbOoDtePwDINcQKWMJvkKbPkgp\nhqIRs10LdHfr9q8m7wu1\n\u003dloaK\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "b6179803_32aecab2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-06-18T05:45:29Z",
      "side": 1,
      "message": "Optional: Mention \"option is mutually exclusive with --other\" for both options in RebuildNoteDb site program.",
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1fe909c9_447714b8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-06-18T14:35:22Z",
      "side": 1,
      "message": "I noticed, it was added later in this series.",
      "parentUuid": "b6179803_32aecab2",
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "db5aaf95_a5ad7006",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/rebuild/SiteRebuilder.java",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-06-18T07:20:47Z",
      "side": 1,
      "message": "I tried to verify that use case and noticed two issues:\n\n* 1. No reasons are given in addition to ISE why it\u0027s failed: http://paste.openstack.org/show/612966. I see, that it\u0027s fixed in the follow-up change, so that\u0027s fine.\n* 2. Probably not primary caused by this change, but in error case the process doesn\u0027t exit. I noticed this by chance, by running it from the console, and without noticing, that the process wasn\u0027t terminated, i tried to start yet another debugger session from the IDE and it was failing to start, because the database was locked. This is annoying. I applied quick and dirty patch, and that fixed it: http://paste.openstack.org/show/612967. Seems like ISE is not the right exception here? IIRC, I never saw, that the other site programs hung if some errors occured.",
      "range": {
        "startLine": 157,
        "startChar": 8,
        "endLine": 157,
        "endChar": 38
      },
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c9778f5_72bfd50a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/rebuild/SiteRebuilder.java",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-19T13:52:33Z",
      "side": 1,
      "message": "\u003e * 1. No reasons are given in addition to ISE why it\u0027s failed: http://paste.openstack.org/show/612966. I see, that it\u0027s fixed in the follow-up change, so that\u0027s fine.\n\nRight, I didn\u0027t want to overthink it in this change.\n\n\u003e * 2. Probably not primary caused by this change, but in error case the process doesn\u0027t exit.\n\nInteresting. You\u0027re right that this is probably an issue for other programs as well. But it probably also indicates a problem with this code, my first idea being that maybe there is a threadpool holding some non-daemon threads that are still open. SiteRebuilder#close was supposed to take care of this but I might have missed something.\n\nI will take a look with jstack to see what\u0027s keeping the process alive",
      "parentUuid": "db5aaf95_a5ad7006",
      "range": {
        "startLine": 157,
        "startChar": 8,
        "endLine": 157,
        "endChar": 38
      },
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32be0807_933c0ccf",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/rebuild/SiteRebuilder.java",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-19T14:29:46Z",
      "side": 1,
      "message": "The offending non-daemon thread is DiskCache-Store-0. This is explicitly not set to daemon so we can wait for pending writes in H2CacheFactory#stop. The problem is we don\u0027t stop the LifecycleManager on shutdown.\n\nDaemon, as well as a few other standalone programs, accomplish this by using RuntimeShutdown. The way SiteProgram is structured now, it is the responsibility of each program to do this, because SiteProgram doesn\u0027t have any LifecycleManagers in scope.\n\nI will add another change in this series to fix shutdown. Thanks for noticing.",
      "parentUuid": "6c9778f5_72bfd50a",
      "range": {
        "startLine": 157,
        "startChar": 8,
        "endLine": 157,
        "endChar": 38
      },
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "59c15928_c3f8916a",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/rebuild/SiteRebuilder.java",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-06-19T14:33:23Z",
      "side": 1,
      "message": "\u003e I will add another change in this series to fix shutdown.\n\nTo avoid pain on rebasing, this will go towards the end. RebuildNoteDb was already broken, this series doesn\u0027t introduce a regression, so it\u0027s ok to hold off on a fix",
      "parentUuid": "32be0807_933c0ccf",
      "range": {
        "startLine": 157,
        "startChar": 8,
        "endLine": 157,
        "endChar": 38
      },
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f6ad50d0_e31c263c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/rebuild/SiteRebuilder.java",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-06-19T14:35:54Z",
      "side": 1,
      "message": "+1.",
      "parentUuid": "59c15928_c3f8916a",
      "range": {
        "startLine": 157,
        "startChar": 8,
        "endLine": 157,
        "endChar": 38
      },
      "revId": "9a4a05696daeeb0e40ae31cc14c7f6b8ba49f4c2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}