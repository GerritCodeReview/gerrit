{
  "comments": [
    {
      "key": {
        "uuid": "70f3261b_df130132",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 6
      },
      "lineNbr": 409,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-06-22T08:19:46Z",
      "side": 1,
      "message": "I was rather thinking of calling\n\n  this.$.jsAPI.disposeOfAllDiffLayers();\n\nhere. And implementing disposeOfAllDiffLayers in gr-js-api-interface-element.js:\n\n   for (const annotationApi of\n      this._getEventCallbacks(EventType.ANNOTATE_DIFF)) {\n      annotationApi.removeLayers();\n   }\n\nAnd implementing removeLayers() in gr-annotation-actions-js-api.js:\n\n  this._annotationLayers \u003d [];\n\nNot sure whether you would also want to call destroy() on all layers?",
      "revId": "9b70f6eda0f0785184f0e89a16cf64fdcc9f91a1",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4632c0c_efbdf072",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 6
      },
      "lineNbr": 409,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-06-23T12:40:47Z",
      "side": 1,
      "message": "The problem is that `annotationApi` holds layers for all opened files and all gr-diff-host. Closing one diff in change page - I don\u0027t want to remove layers for all other diffs. I would need to implement `removeLayers(path, changeNum, patchNum)` with new `equal` method on `AnnotationLayer`.\n\nI don\u0027t see any benefit for this complexity. We might consider to rewrite whole annotationAPI but I don\u0027t have such intention in this memory leaks fix.\n\nFor destroy - I call destroy only on layers that implements destroy.",
      "parentUuid": "70f3261b_df130132",
      "revId": "9b70f6eda0f0785184f0e89a16cf64fdcc9f91a1",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6aaa07a6_36b7e56b",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 6
      },
      "lineNbr": 409,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-06-24T08:23:13Z",
      "side": 1,
      "message": "notify() just does a path check. So yes, my suggested methods would need to get a `path` parameter and only remove those.\n\nI would hope that this will be much *less* complex, because:\n- No change required in gr-diff-builder.js\n- No change required in gr-diff-builder-element.js\n- No change required in gr-ranged-comment-layer.js\n- No change required to AnnotationLayer.\n- More symmetry with who calls getLayer() and removeLayers().\n\nWDYT?",
      "parentUuid": "e4632c0c_efbdf072",
      "revId": "9b70f6eda0f0785184f0e89a16cf64fdcc9f91a1",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "406ccc6a_5db86530",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 6
      },
      "lineNbr": 414,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2020-06-22T08:19:46Z",
      "side": 1,
      "message": "Maybe add this here?\n\n  this._layers \u003d [];",
      "revId": "9b70f6eda0f0785184f0e89a16cf64fdcc9f91a1",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aac413ae_b5a4d045",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 6
      },
      "lineNbr": 414,
      "author": {
        "id": 1085182
      },
      "writtenOn": "2020-06-23T12:40:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "406ccc6a_5db86530",
      "revId": "9b70f6eda0f0785184f0e89a16cf64fdcc9f91a1",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}