Making a Release of a Gerrit Subproject / Core Plugin
=====================================================

[[make-snapshot]]
Make a Snapshot
---------------

* Only for plugins: in the `pom.xml` update the Gerrit version under
`properties` > `Gerrit-ApiVersion` to the version of the new Gerrit
release
* Build the latest snapshot and install it into the local Maven
repository:
+
====
  mvn clean install
====

* Test Gerrit with this snapshot


[[prepare-release]]
Prepare the Release
-------------------

* link:#make-snapshot[First create (and test) the latest snapshot for
the subproject/plugin]

* Update the top level `pom.xml` in the subproject/plugin to reflect
the new project version (the exact value of the tag you will create
below)

* Create the Release Tag
+
====
 git tag -a -m "prolog-cafe 1.3" v1.3
====

* Build and install into local Maven repository:
+
====
  mvn clean install
====


[[publish-release]]
Publish the Release
-------------------

* Make sure you have done the link:#deploy-configuration[configuration
needed for deployment]

* Deploy the new release:
+
====
  mvn deploy
====

* Push the pom change(s) to the project's repository
`refs/for/<master|stable>`

* Push the Release Tag
+
====
  git push gerrit-review refs/tags/v1.3:refs/tags/v1.3
====


[[deploy-configuration]]
Configuration for Deployment
----------------------------

* You will need to have the following in the `pom.xml` to make it
  deployable to the `gerrit-maven` storage bucket:

----
  <distributionManagement>
    <repository>
      <id>gerrit-maven</id>
      <name>gerrit Maven Repository</name>
      <url>s3://gerrit-maven@commondatastorage.googleapis.com</url>
      <uniqueVersion>true</uniqueVersion>
    </repository>
  </distributionManagement>
----


* Add this to the `pom.xml` to enable the wagon provider:

----
  <build>
    <extensions>
      <extension>
        <groupId>net.anzix.aws</groupId>
        <artifactId>s3-maven-wagon</artifactId>
        <version>3.2</version>
      </extension>
    </extensions>
  </build>
----


* Add your username and password to your `~/.m2/settings.xml` file.
  These need to come from the link:https://code.google.com/apis/console/[API Console].

----
  <settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">
    <servers>
      <server>
        <id>gerrit-maven</id>
        <username>GOOG..EXAMPLE.....EXAMPLE</username>
        <password>EXAMPLE..EXAMPLE..EXAMPLE</password>
      </server>
    </servers>
  </settings>
----


GERRIT
------
Part of link:index.html[Gerrit Code Review]
