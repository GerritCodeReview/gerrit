{
  "comments": [
    {
      "key": {
        "uuid": "3bff402b_d4909d51",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 77,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "I think you probably want a rw.reset() call here first. I don\u0027t think anything in VersionedMetaData marks or walks anything prior to calling onLoad, but nor do I think that\u0027s a guarantee.",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0bde970e_a2454249",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 77,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "Done. We probably should do the same for AccountConfig (in a separate change) as I took that code from there.",
      "parentUuid": "3bff402b_d4909d51",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1921dfd6_78c00af5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 77,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-10-30T14:33:30Z",
      "side": 1,
      "message": "Done in:\n  https://gerrit-review.googlesource.com/137430",
      "parentUuid": "0bde970e_a2454249",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2c4b1d61_6f8127fb",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 83,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "Is the idea that these are not currently stored in NoteDb, but will be in a future change in this series?",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6850044d_1b132155",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 83,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "Yes, see Ic61d4a08 and the other changes in this topic. I didn\u0027t want to create one huge change and hence created several changes which depend on each other and are combined in a topic. It\u0027s important that all of the changes in this topic are submitted at once. I added a corresponding warning to the commit message.",
      "parentUuid": "2c4b1d61_6f8127fb",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "54a6d0a3_0a71f95f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfigEntry.java",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "I have no objection at all to the way you\u0027ve written this and I think it\u0027s fine for this change.\n\nBut I can\u0027t help but notice we already have another general facility for parsing parts of a config file in NoteDb into a Java object: ConfigUtil#loadSection, which is used to load account preferences (TBH I\u0027m not a fan of all the reflection, but I digress). And then there is JGit\u0027s native SectionParser thing which for some reason we don\u0027t use much in Gerrit.\n\nI think in the long term it would be nice to come through and consolidate some of the common NoteDb Java \u003c-\u003e JGit Config code so we have fewer different implementations.\n\nBut not today.",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f92499c_8fc1e77f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfigEntry.java",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "I agree, we should use a common (but flexible/clean/readable way) to map properties between config files and Java objects. We also shouldn\u0027t forget parts of our code where we do the mapping even manually (e.g. AccountConfig).",
      "parentUuid": "54a6d0a3_0a71f95f",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba322150_d653a512",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfigEntry.java",
        "patchSetId": 3
      },
      "lineNbr": 27,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "Wow, I didn\u0027t even know this was valid syntax :)",
      "range": {
        "startLine": 27,
        "startChar": 75,
        "endLine": 27,
        "endChar": 88
      },
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1e92d2d_554a8e97",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfigEntry.java",
        "patchSetId": 3
      },
      "lineNbr": 33,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "Why a no-op instead of throwing?\n\nReading further, I think this is so that GroupConfig#updateGroupProperties can call updateConfigValue for each entry, is that right?\n\nThat makes sense in the context of that method, but this still feels a little wrong. Imagine if someone tried to implement an endpoint to change group IDs, and they called GroupConfigEntry.ID.updateConfigValue(...), expecting it to work. They might prefer \"IllegalStateException: updating ID not supported\" to being a silent no-op.\n\nBut I guess since this enum is package-private, it limits the surface. I could go either way.",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07403f13_11b6021f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupConfigEntry.java",
        "patchSetId": 3
      },
      "lineNbr": 33,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "Yes, we need a no-op here to automatically call this method for all values of this enum.\n\nThis enum is meant to be used only by GroupConfig. All other classes have to use InternalGroupUpdate to update properties. That\u0027s why I deliberately made this enum package-private. I added a corresponding note to the Javadoc-Todo.\n\nActually, I tried to make the addition of further group properties or allowing them to be changed as easy/guided as possible while reducing the source of errors. If a new group property is added, you have to make deliberate decisions about the implementation of readFromConfig(), updateConfigValue(), and initNewConfig(). This leads to possible further adjustments of InternalGroupUpdate, InternalGroupCreation, or InternalGroup. Everything else should just work.\n\nIf we wanted to throw an UnsupportedOperationException here, we would have to completely change the way this enum is used in GroupConfig. That means, we would have to add explicit calls for each property for each of the three methods of this enum (currently two but a follow-up change adds another one). That\u0027s something I wanted to avoid (as it\u0027s error-prone) and is one of the reasons I introduced this enum. With explicit calls, I probably would remove this enum.\n\nI would prefer to keep it as it is. Are you fine with this?",
      "parentUuid": "f1e92d2d_554a8e97",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af55a11f_dae0e4e0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 3
      },
      "lineNbr": 191,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "I see that in AccountsUpdate all the arguments are Consumer\u003cAccount\u003e rather than the declarative type you have here. I\u0027m not thrilled with the inconsistency, but I\u0027m guessing you\u0027d be in favor of producing an InternalAccountUpdate class as a later cleanup.",
      "range": {
        "startLine": 191,
        "startChar": 68,
        "endLine": 191,
        "endChar": 99
      },
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7c654278_564d335b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 3
      },
      "lineNbr": 191,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "I deliberately decided to have InternalGroup deeply immutable. For this reason, I couldn\u0027t use a Consumer\u003cInternalGroup\u003e. I would like to keep InternalGroup immutable and (as you guessed) would rather introduce an InternalAccountUpdate. I\u0027ll start a list of things I should clean up after the main work for the migration is done.",
      "parentUuid": "af55a11f_dae0e4e0",
      "range": {
        "startLine": 191,
        "startChar": 68,
        "endLine": 191,
        "endChar": 99
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "86c30a2f_5b3fc3b6",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 3
      },
      "lineNbr": 316,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "This method reopens the repository which was already opened by loadFor immediately beforehand. It feels like we should be able to open it only once, for example by pushing the openRepository into the top of updateGroupInNoteDb.\n\nIt might be that this would require more refactoring to the MetaDataUpdateFactory thing, in which case it might not be worth it. Opening repositories in the same thread is cheap.",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2516ccd1_4d099a84",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 3
      },
      "lineNbr": 316,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "That probably answers my question in https://gerrit-review.googlesource.com/c/gerrit/+/136051/2/gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java#320.\n\nI don\u0027t know how much effort it would be. After the migration, I intend to refactor the MetaDataUpdateFactory as indicated by my TODO in line 122 of this class. I added a further note to the TODO requesting support for passing in the repository. As we lived without that in AccontsUpdate so far, it\u0027s probably not a pressing issue.",
      "parentUuid": "86c30a2f_5b3fc3b6",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "626d4226_0c512fe0",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-26T16:34:31Z",
      "side": 1,
      "message": "Optional: IMO, the additional boilerplate of an @AutoValue.Builder is only a win vs. a static create method when either:\n\n* some arguments are optional\n* there are multiple arguments of the same type that could be confusing as positional arguments\n\nNeither of these is the case here (at least within this class in this change).\n\nBut I don\u0027t feel too strongly, you can leave it like this if you prefer.",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "46cb3cde_ad571622",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 3
      },
      "lineNbr": 536,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-10-27T18:24:41Z",
      "side": 1,
      "message": "The follow-up change I4e8de7f01 of this topic adds an optional argument.",
      "parentUuid": "626d4226_0c512fe0",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "a155edc6f274dd61a793c7181d8aed1884dc3f48",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}