{
  "comments": [
    {
      "key": {
        "uuid": "ff3a988d_e6e883c1",
        "filename": "java/com/google/gerrit/server/notedb/rebuild/NoteDbMigrator.java",
        "patchSetId": 5
      },
      "lineNbr": 719,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-09-09T12:54:22Z",
      "side": 1,
      "message": "Can this be tested similar to this [1]?\n\n[1] https://gerrit-review.googlesource.com/c/gerrit/+/166191/2/gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/server/notedb/OnlineNoteDbMigrationIT.java",
      "revId": "a2dbc9b15d9bb7488e63dd6f723f3ff95472f1b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "424f6949_6852815c",
        "filename": "java/com/google/gerrit/server/notedb/rebuild/NoteDbMigrator.java",
        "patchSetId": 5
      },
      "lineNbr": 719,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-09-09T13:10:19Z",
      "side": 1,
      "message": "Good point, that the test is missing for this use case. I was not sure if we can easily remove git respoitory in test, after creating a change?",
      "parentUuid": "ff3a988d_e6e883c1",
      "revId": "a2dbc9b15d9bb7488e63dd6f723f3ff95472f1b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0317df31_9fc03cab",
        "filename": "java/com/google/gerrit/server/notedb/rebuild/NoteDbMigrator.java",
        "patchSetId": 5
      },
      "lineNbr": 719,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-09-09T13:18:00Z",
      "side": 1,
      "message": "Good question. Could you cast the injected repoManager to InMemoryRepositoryManager and then call the InMemoryRepositoryManager#deleteRepository(Project.NameKey) method?",
      "parentUuid": "424f6949_6852815c",
      "revId": "a2dbc9b15d9bb7488e63dd6f723f3ff95472f1b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c537e81_76619398",
        "filename": "java/com/google/gerrit/server/notedb/rebuild/NoteDbMigrator.java",
        "patchSetId": 5
      },
      "lineNbr": 719,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-09-09T20:54:35Z",
      "side": 1,
      "message": "No, because this class is annotated with @UseLocalDisk, and thus the Repository manager is LocalDiskRepositoryManager that doesn\u0027t support removal of repositories. I ended up with this hack, that worked.\n\n    MoreFiles.deleteRecursively(\n        FileKey.lenient(\n                sitePaths\n                    .resolve(cfg.getString(\"gerrit\", null, \"basePath\"))\n                    .resolve(p2.get())\n                    .toFile(),\n                FS.DETECTED)\n            .getFile()\n            .toPath(),\n        RecursiveDeleteOption.ALLOW_INSECURE);",
      "parentUuid": "0317df31_9fc03cab",
      "revId": "a2dbc9b15d9bb7488e63dd6f723f3ff95472f1b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17f280f8_80c45149",
        "filename": "java/com/google/gerrit/server/notedb/rebuild/NoteDbMigrator.java",
        "patchSetId": 5
      },
      "lineNbr": 719,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2019-09-10T08:40:34Z",
      "side": 1,
      "message": "Ack, I missed that this test required @UseLocalDisk",
      "parentUuid": "0c537e81_76619398",
      "revId": "a2dbc9b15d9bb7488e63dd6f723f3ff95472f1b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}