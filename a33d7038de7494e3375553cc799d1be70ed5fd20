{
  "pushCert": "certificate version 0.1\npusher Stefan Beller \u003csbeller@google.com\u003e 1465259533 -0700\nnonce AD0XjTX+dEgompkd0t7ylKgISXNdG1z7oFJo6vzBZ9O1UE/GTiy8FEgcRjPpTIIstv44nMZFAQg7\n\n0000000000000000000000000000000000000000 a33d7038de7494e3375553cc799d1be70ed5fd20 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJXVhYNAAoJEGt7+xNJsB0bxHIH/jdUghuzzbicE4rM68Za5EMa\n60ajNLq7cva8pjd2esIze1s7xWNhcxZzyUxotETQy20TuNgXl9oG9n8GhYy4+elk\nU3whl7W74gpOLFIWd8L3Jmsq2ir+pOiw+B0+exBvka482dQtLXlESBIoKSiA5PbB\nnYxkU9MTBxxL/KFaJWLsX0BwLfEBmJFT8Odle3nYekSLVy5f63Dyue0+AJnu5TJa\nl2s7E+wrJsth/T1kuYjTtuoyrtf4RYSMN+BPBZ2vP0XAKw3R2vY6RsDXWbfN/hcE\nXd2iR+7CGTqK0l0b4DInnFf5StSe/IPjI7LuaxEBpD3xxBhINNZ9S/KkVmviWL4\u003d\n\u003dH5u2\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "03c40060_953f640e",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeSuperSet.java",
        "patchSetId": 3
      },
      "lineNbr": 121,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-06-07T16:04:56Z",
      "side": 1,
      "message": "This is not the right check, it could be a draft that is visible to the user. That is not \"hidden\".\n\nI think the check should be cd.changeControl().isVisible(db, cd).\n\nThat raises another question: why are drafts special? Wouldn\u0027t we see the same behavior if a change brought in via topic were on a branch that the user can\u0027t read?",
      "revId": "a33d7038de7494e3375553cc799d1be70ed5fd20",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "43a518c6_ff877f1f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeSuperSet.java",
        "patchSetId": 3
      },
      "lineNbr": 121,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2016-06-07T16:35:44Z",
      "side": 1,
      "message": "\u003e I think the check should be cd.changeControl().isVisible(db, cd).\n\nmakes sense.\n\n\u003e why are drafts special?\n\ndrafts were producing 500s unlike other invisible changes. So special in that sense. ;)\n\nI think a more general solution (such as covering the change brought in via topic) is desired.",
      "parentUuid": "03c40060_953f640e",
      "revId": "a33d7038de7494e3375553cc799d1be70ed5fd20",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "43a518c6_9f96334f",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeSuperSet.java",
        "patchSetId": 3
      },
      "lineNbr": 121,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-06-07T16:38:44Z",
      "side": 1,
      "message": "\u003e drafts were producing 500s unlike other invisible changes.\n\nBut why? :)\n\n\u003e I think a more general solution (such as covering the change brought in via topic) is desired.\n\nI would suggest not doing any visibility checks in MergeSuperSet, and inspecting each change in the resulting ChangeSet with isVisible()",
      "parentUuid": "43a518c6_ff877f1f",
      "revId": "a33d7038de7494e3375553cc799d1be70ed5fd20",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "03a7a0d2_7d9c976d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeSuperSet.java",
        "patchSetId": 3
      },
      "lineNbr": 121,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2016-06-07T18:00:57Z",
      "side": 1,
      "message": "\u003e\u003e drafts were producing 500s unlike other invisible changes.\n\u003e But why? :)\n\nThe `!str.isOk()` condition is true for draft, leading to that logErrorAndThrow which throws an OrmException, which is turned into a 500.\n\nThe `cd.changeControl(user);` in line 118 currently prohibits including a permission induced invisible change.\n\n\u003e I would suggest not doing any visibility checks in MergeSuperSet, and inspecting each change in the resulting ChangeSet with isVisible()\n\nThat makes sense. So instead `logErrorAndThrow` we just continue at \n    // Get the underlying git commit object\n    PatchSet ps \u003d cd.currentPatchSet();\n\nand then do all checks for hidden stuff in the ChangeSet?",
      "parentUuid": "43a518c6_9f96334f",
      "revId": "a33d7038de7494e3375553cc799d1be70ed5fd20",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "63af7c90_381a09be",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeSuperSet.java",
        "patchSetId": 3
      },
      "lineNbr": 123,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-06-07T16:04:56Z",
      "side": 1,
      "message": "Continuing here might be surprising.\n\nSuppose we have changes A\u003c-B*\u003c-C where B* is a draft. Why would we want to exclude A?\n\nWorse, if you take my suggestion above to use isVisible() for the check, you would actually produce a different set of changes depending on whether or not B is a draft. Possibly vastly different if A brings in a new topic.",
      "revId": "a33d7038de7494e3375553cc799d1be70ed5fd20",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "43a518c6_df8cbb44",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/MergeSuperSet.java",
        "patchSetId": 3
      },
      "lineNbr": 123,
      "author": {
        "id": 1017837
      },
      "writtenOn": "2016-06-07T16:35:44Z",
      "side": 1,
      "message": "right, we would need to continue with\n\n    // Get the underlying git commit object\n    PatchSet ps \u003d cd.currentPatchSet();\n    ...\n\nbelow",
      "parentUuid": "63af7c90_381a09be",
      "revId": "a33d7038de7494e3375553cc799d1be70ed5fd20",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}