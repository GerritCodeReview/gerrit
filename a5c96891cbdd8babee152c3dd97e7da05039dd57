{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f8a00499_78226842",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-06-09T16:47:32Z",
      "side": 1,
      "message": "I am a bit puzzled by this change: shouldn\u0027t be something internal to the elasticsearch implementation? Why Gerrit has to know about it?",
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e20c5e7a_34ad0a1f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2022-06-09T17:03:57Z",
      "side": 1,
      "message": "I think it should be an optional even for ES and enabled in Gerrit but disabled during the offline re-indexing, as the consistency doesn\u0027t really matter.\n\nI assume there is a significant performance improvement for offline reindexing?",
      "parentUuid": "f8a00499_78226842",
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "34688471_94f1b323",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-09T18:14:14Z",
      "side": 1,
      "message": "\u003e I am a bit puzzled by this change: shouldn\u0027t be something internal to the elasticsearch implementation? Why Gerrit has to know about it?\n\nGerrit knows if we\u0027re operating online or offline and should have a means for adjusting policy for index consistency in each. That\u0027s generic to indexing and not specific to one index implementation.\n\n\u003e I think it should be an optional even for ES and enabled in Gerrit but disabled during the offline re-indexing, as the consistency doesn\u0027t really matter.\n\nFor us, we want strong consistency in online mode. However, this change opens the possibility of adding a config in ES that sets it to false so that you could adjust the behavior to be what you want.\n\u003e \n\u003e I assume there is a significant performance improvement for offline reindexing?\n\nYes, it\u0027s huge. We can add the perf stat to https://gerrit-review.googlesource.com/c/modules/index-elasticsearch/+/339115 but it probably doesn\u0027t make sense here.",
      "parentUuid": "e20c5e7a_34ad0a1f",
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cca83b72_f2338335",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2022-06-10T09:07:18Z",
      "side": 1,
      "message": "\u003e Yes, it\u0027s huge. We can add the perf stat to https://gerrit-review.googlesource.com/c/modules/index-elasticsearch/+/339115 but it probably doesn\u0027t make sense here.\n\nCan you add some statistics? Here or in modules/index-elasticsearch change to better understand motivation and justification.",
      "parentUuid": "34688471_94f1b323",
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ac1b7ca2_95ba9163",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-10T18:06:38Z",
      "side": 1,
      "message": "\u003e \u003e Yes, it\u0027s huge. We can add the perf stat to https://gerrit-review.googlesource.com/c/modules/index-elasticsearch/+/339115 but it probably doesn\u0027t make sense here.\n\u003e \n\u003e Can you add some statistics? Here or in modules/index-elasticsearch change to better understand motivation and justification.\n\nYes, will do.",
      "parentUuid": "cca83b72_f2338335",
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5815cfcc_e9d73847",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2022-06-11T08:23:59Z",
      "side": 1,
      "message": "Added perf stats here: Ic454d7cffc00c93",
      "parentUuid": "ac1b7ca2_95ba9163",
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6944f87_8e33242f",
        "filename": "java/com/google/gerrit/server/index/options/EnsureReadsConsistentWithWrite.java",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-06-09T16:45:14Z",
      "side": 1,
      "message": "This looks like a boolean isn\u0027t it? Do we really need to redefine the type as an Enum?",
      "range": {
        "startLine": 21,
        "startChar": 12,
        "endLine": 21,
        "endChar": 42
      },
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc615ea5_670a67ec",
        "filename": "java/com/google/gerrit/server/index/options/EnsureReadsConsistentWithWrite.java",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-09T18:09:05Z",
      "side": 1,
      "message": "This is a best practice Matthias encouraged. I can\u0027t recall the reference he shared on it, but it shows up in Clean Code [1]. booleans are not self-documenting, so it\u0027s better to use a class with a name. It also allows for a future with more than 2 allowed values (not sure if that exists for this case, but we\u0027re safe just in case).\n\n[1] https://www.informit.com/articles/article.aspx?p\u003d1392524",
      "parentUuid": "e6944f87_8e33242f",
      "range": {
        "startLine": 21,
        "startChar": 12,
        "endLine": 21,
        "endChar": 42
      },
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b88b8e98_496b4591",
        "filename": "java/com/google/gerrit/server/index/options/EnsureReadsConsistentWithWrite.java",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-06-14T21:26:07Z",
      "side": 1,
      "message": "\u003e This is a best practice Matthias encouraged. I can\u0027t recall the reference he shared on it, but it shows up in Clean Code [1]. booleans are not self-documenting, so it\u0027s better to use a class with a name. \n\nShould this be then changed to:\n\n```\npublic enum ReadConsistency {\n  READ_AFTER_WRITE,\n  NONE\n}\n```\n\nWhat do you think?\n\n\u003e It also allows for a future with more than 2 allowed values (not sure if that exists for this case, but we\u0027re safe just in case).\n\u003e [1] https://www.informit.com/articles/article.aspx?p\u003d1392524",
      "parentUuid": "dc615ea5_670a67ec",
      "range": {
        "startLine": 21,
        "startChar": 12,
        "endLine": 21,
        "endChar": 42
      },
      "revId": "a5c96891cbdd8babee152c3dd97e7da05039dd57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}