{
  "comments": [
    {
      "key": {
        "uuid": "fb384786_fa62efed",
        "filename": "java/com/google/gerrit/server/schema/GrantRevertPermission.java",
        "patchSetId": 4
      },
      "lineNbr": 75,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T14:38:28Z",
      "side": 1,
      "message": "nit: for",
      "range": {
        "startLine": 75,
        "startChar": 43,
        "endLine": 75,
        "endChar": 45
      },
      "revId": "abc200eb04855b3b67748692ed4b78ff62964c30",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6e61179d_e171cb18",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersion.java",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T14:38:28Z",
      "side": 1,
      "message": "These are arguments that are injected into every schema migration. GrantRevertPermission implements one particular schema migration, hence it should not be injected into all the other schema migrations (none of the other migrations will ever need it).\n\nI think, you should drop the GrantRevertPermission class and instead copy its code into the Schema_183 class, even if this means that we cannot reuse this code for our internal migration. For our internal migration it is okay to just copy and duplicate this code since we run it only once and then we will delete it again (hence we have the code duplicated only temporarily).\n\nI would even squash this change into [1] as for upstream there is no reason to have this separated into 2 changes. In think the order of steps should be:\n\n1. squash this into [1] so that this change is ready for submission\n2. write an internal migration that contains a copy of the code from the migration that you have implemented here\n3. run the internal migration on all our host\n4. delete the internal migration\n5. submit [1]\n\n[1] https://gerrit-review.googlesource.com/c/gerrit/+/251435",
      "revId": "abc200eb04855b3b67748692ed4b78ff62964c30",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7e77b62f_ff04eaa8",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersion.java",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-03-23T15:04:51Z",
      "side": 1,
      "message": "Even if I don\u0027t inject GrantRevertPermission, I will somehow have to inject the necessary parameters used by the migration code:  private final ProjectConfig.Factory, SystemGroupBackend, PersonIdent.\n\nIs it really better to inject those 3 parameters instead of just GrantRevertPermission?\n\nEither way, when injecting those 3 parameters I can keep the GrantRevertPermission class (no need to inject it).",
      "parentUuid": "6e61179d_e171cb18",
      "revId": "abc200eb04855b3b67748692ed4b78ff62964c30",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "171a9cb4_4417ba28",
        "filename": "java/com/google/gerrit/server/schema/NoteDbSchemaVersion.java",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-03-23T15:13:14Z",
      "side": 1,
      "message": "\u003e Is it really better to inject those 3 parameters instead of just GrantRevertPermission?\n\nYes, it is okay to inject those. Those are generic enough to be useful for other migrations too.\n\n\u003e Either way, when injecting those 3 parameters I can keep the GrantRevertPermission class (no need to inject it).\n\nFine with me, if you prefer that.",
      "parentUuid": "7e77b62f_ff04eaa8",
      "revId": "abc200eb04855b3b67748692ed4b78ff62964c30",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}