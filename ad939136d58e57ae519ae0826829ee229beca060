{
  "comments": [
    {
      "key": {
        "uuid": "c0251a91_a63d86cd",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Reindex.java",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-05-23T12:32:43Z",
      "side": 1,
      "message": "This implies that we are always going to use the index as a secondary index and not as a primary database?\n\nFor example, to add a \"tag a change with an arbitrary tag\" feature to Gerrit, we would have to:\n\n 1. extend data base\n 2. persist the map \"change\" -\u003e \"list of tags\" in the data base \n 3. include tag field in the document\n 4. rebuild the index\n\nIn contrary using the index as a primary data base would mean\n\n 1. user add/replace a tag to the change: document replaced in the index with new field added/replaced\n 2. user read a change, to show the tags, we would need to search the index.\n 3. we can not drop/rebuild the index without the data corruption.",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "005e52fd_f8c2d17a",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Reindex.java",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-05-23T17:51:35Z",
      "side": 1,
      "message": "I don\u0027t think we want to use the index as a primary data source, at the very least until we have more experience with Lucene and can trust that it won\u0027t get corrupted. It should always be able to be rebuilt from the sources of truth.\n\nBeyond that, we already have *tons* of places where there\u0027s potential data corruption because we\u0027re doing a bunch of sequential, non-atomic writes to git and the db. Adding a third data source that needs to be in sync will only make this worse. I\u0027d much rather move away from the db and have only one source of truth (git data).\n\nAnd I don\u0027t think the extra step of rebuilding the index is a big deal. It\u0027s a few lines of code change to ChangeField to get it indexed, and I\u0027m working on an index schema versioning change that will take care of reindexing on an upgrade in the same way we do for the db.",
      "parentUuid": "c0251a91_a63d86cd",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "801fa244_04a3b6eb",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/index/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-05-23T12:32:43Z",
      "side": 1,
      "message": "Why not to add it hard coded to ALL and do it with reflection? Because we are lazy to exend it every time we add a new field ;-)",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "601c6e52_e35e9229",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/index/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-05-23T17:51:35Z",
      "side": 1,
      "message": "It was Shawn\u0027s idea? :)",
      "parentUuid": "801fa244_04a3b6eb",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "801fa244_e49dbaae",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/index/ChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 24,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-05-23T12:32:43Z",
      "side": 1,
      "message": "More generic interface:\n Index\u003cI, R\u003e\n\nwhere I is a Input type and R result type?\n\nFor example to have an index for the Gerrit documentation we would want to have something like\n\n DocumentationIndex\u003cDocumentData, DocumentDataSource\u003e",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "005e52fd_18b86500",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/index/ChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 24,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-05-23T17:51:35Z",
      "side": 1,
      "message": "I agree, but we can punt on this for now.\n\nThough with your example for documentation, I\u0027m not sure we would be using the same query language and data source object hierarchy for that.",
      "parentUuid": "801fa244_e49dbaae",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "801fa244_a493c2a2",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/index/ChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-05-23T12:32:43Z",
      "side": 1,
      "message": "What about \n\n public void delete(ChangeData cd);\n\nOne option for index partitioning on open and closed changes is to have two change indexes \"active change index\" and \"closed change index\". Once a change is closed (merged or abandoned) it get deleted from the \"active change index\" and added to the \"closed change index\" index.",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "601c6e52_23518a17",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/index/ChangeIndex.java",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-05-23T17:51:35Z",
      "side": 1,
      "message": "Yes, this will probably happen. Keeping the interface simple for now but we will add to it as necessary.",
      "parentUuid": "801fa244_a493c2a2",
      "revId": "ad939136d58e57ae519ae0826829ee229beca060",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}