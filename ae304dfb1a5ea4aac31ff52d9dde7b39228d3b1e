{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1462535102 -0400\nnonce AD0XjTXhEOMLL+RmVkFZ46NDeBMcSP5LvwIiOHlMzuWanyWTXadxVOmkmMUfr/85yzDXR183MBsm\n\n0000000000000000000000000000000000000000 ae304dfb1a5ea4aac31ff52d9dde7b39228d3b1e refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXLIO+AAoJEF/XxZqaEoiM7zMP/jog+DTcRUDVzbFqhaQCZIc4\nmkXI7bYRhn6u+dDKg7x1sYu+HuwStOHJcwPcqCy6HTF9wVMbleuEX8WkmHE1AvtK\nKRMXFxP562MIaMme/QFM05Vk/cshk/o6cCCvN0MtG/tKjhfSGHApc7lRtD60FN+b\nhOwbk+rRIKfxZ7OGinIm1ObsZ0euivweUfwQNVEdyWbAvJQl0fyTwJ6nLf4261zx\njrMKmSLxfOWZVBoKKjEFHCHddHxl5k+UP2WkvBkHqnFVH3z+UmneIIs0f6K8P8ga\njmT6jGEHeDEs6K5n7Ni7EZwlYby2hz/ArI87JrTp1/JAMrt2V2E9BEtUsXkUHb6H\n4J0rRDNc7P7Cs8R4apBsgivTUaIpFvTWXCGvRcQMBs7Zl6GYeIprQ8SOiivLfRwe\nUEj0pn2BFy4SVKzWXv+5AaAOoyry/3jlqlGA1MQE1T2zA10FdjGOAu9GP7S3zmzq\nPApsbX5tUv4ZcCsKEJgBqSYgXbXM0oI/bAB+g3z5ptHIRYu0SRVqIYKZ4kpR3nE5\ntRoAyNexpO4pAhYpCyQX6KAJbvvZOXTg/gRrglEpzkMQLZEUCmEQvkCVlNkr/T9w\nY1YLbIsjffQNZDpV8midPWJfXu0ciHUcuPTeDa9/LTJv7pNrtXLO/VCNxjEsapUF\n0ppEUMc0/kqMaoQ+aeR8\n\u003dJCyU\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "b2c1bc6e_3aabc189",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/AbstractChangeNotes.java",
        "patchSetId": 3
      },
      "lineNbr": 127,
      "author": {
        "id": 1019407
      },
      "writtenOn": "2016-05-09T18:23:51Z",
      "side": 1,
      "message": "I\u0027m having trouble understanding the change in state here. onLoad() is the path that can rebuild the DB, and previously that would occur if migration.readChanges\u003d\u003dtrue. Now here it is avoided if neither migration read or write is enabled, and below again only issue onLoad() if read is enabled, independent of write, which is not what the change description claims.",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 39
      },
      "revId": "ae304dfb1a5ea4aac31ff52d9dde7b39228d3b1e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "72f024dd_f08c4042",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/AbstractChangeNotes.java",
        "patchSetId": 3
      },
      "lineNbr": 127,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-05-09T19:21:40Z",
      "side": 1,
      "message": "\u003e onLoad() is the path that can rebuild the DB\n\nI think this is the source of your confusion. The rebuild path is openHandle, not onLoad.\n\nBefore: proceed to openHandle only if readChanges \u003d true\n\nAfter: proceed to openHandle if either readChanges \u003d true or writeChanges \u003d true\n\nThe additional if/else on l. 139 below ensures onLoad, which actually reads \u0026 parses the meta graph, is only called if readChanges \u003d true.\n\nOtherwise, if writeChanges \u003d true, on l. 143, we call loadDefaults(). This populates the same fields as l. 124 on the LHS. The difference, as I mentioned, is that on the RHS we call loadDefaults *after* openHandle rebuilds the change.",
      "parentUuid": "b2c1bc6e_3aabc189",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 39
      },
      "revId": "ae304dfb1a5ea4aac31ff52d9dde7b39228d3b1e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d2de305a_abff6974",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/AbstractChangeNotes.java",
        "patchSetId": 3
      },
      "lineNbr": 127,
      "author": {
        "id": 1019407
      },
      "writtenOn": "2016-05-09T23:08:31Z",
      "side": 1,
      "message": "Ok, the description \"Auto-rebuild changes when only writes are enabled\" is a bit misleading then, if it auto-rebuilds when reads and/or writes are enabled.\"",
      "parentUuid": "72f024dd_f08c4042",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 39
      },
      "revId": "ae304dfb1a5ea4aac31ff52d9dde7b39228d3b1e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f2ced4a2_74a148a7",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/AbstractChangeNotes.java",
        "patchSetId": 3
      },
      "lineNbr": 137,
      "author": {
        "id": 1019407
      },
      "writtenOn": "2016-05-09T18:23:51Z",
      "side": 1,
      "message": "Do you need a tracking bug to remove this when migration is over? How long will this code live? It the performance impact enough to make it worth adding a flag to disable it for known migrated repos?",
      "range": {
        "startLine": 136,
        "startChar": 0,
        "endLine": 137,
        "endChar": 79
      },
      "revId": "ae304dfb1a5ea4aac31ff52d9dde7b39228d3b1e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "32da2c65_ee8c5f42",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/AbstractChangeNotes.java",
        "patchSetId": 3
      },
      "lineNbr": 137,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-05-09T19:21:40Z",
      "side": 1,
      "message": "A \"complete\" migration means that we are reading from NoteDb, which means we have to open the repo and read the ref. Doing an extra read when we are in write-only mode just enables that read a little earlier than we would otherwise.\n\nSomewhere down the line we will also enable turning off writes to ReviewDb, at which point we can stop worrying about rebuilding. But we haven\u0027t written any of that code; that is still a few months away.",
      "parentUuid": "f2ced4a2_74a148a7",
      "range": {
        "startLine": 136,
        "startChar": 0,
        "endLine": 137,
        "endChar": 79
      },
      "revId": "ae304dfb1a5ea4aac31ff52d9dde7b39228d3b1e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}