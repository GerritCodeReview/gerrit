{
  "comments": [
    {
      "key": {
        "uuid": "PC9eNPIw",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-01-30T21:13:14Z",
      "side": 1,
      "message": "\u003d\u003d null here?",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "PIoAedmg",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 106,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-01-30T21:24:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "PC9eNPIw",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "PC7eKyHA",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-01-30T21:13:14Z",
      "side": 1,
      "message": "I don\u0027t think you want to give every callback every failure. I think you want to give a callback only its own failure and just stop processing. Most callbacks will show an error message to the user, and that\u0027s that.",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "PIsAjHqk",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-01-30T21:24:27Z",
      "side": 1,
      "message": "Remember the use case is:\n\n  .add(RPC callback A)\n  ...(more RPC callbacks)...\n  .add(RPC callback B is a ScreenLoadCallback)\n\nIf you\u0027re suggesting we call B.onSuccess() even if A failed, that won\u0027t work. In order to display either the screen or an error message, we must guarantee that either B.onSuccess() or B.onFailure() is called. If A fails but B succeeds, we would call B.onSuccess(), which will display a partially-filled-in screen. Not good.\n\nWhat I meant here (and hopefully I communicated in the javadoc) is to give _every_ callback the _first_ failure. This means if A fails, we call B.onFailure(A\u0027s exception). The point is we need to call B.onFailure() with _some_ exception to get the error dialog. We could try a little harder to match up callbacks to exceptions in the case of multiple successes and multiple failures, but that seemed like more effort than it\u0027s worth.\n\nObviously what I have here does do every failure to every callback, which is not what I meant. Fixed.",
      "parentUuid": "PC7eKyHA",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "PC-fZYH4",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-01-31T00:44:42Z",
      "side": 1,
      "message": "My suggestion was to call only a single onFailure(). Not all of them.\n\nUnder the assumption that every onFailure() is basically \"show the dialog and do nothing else\". Because almost all of them are coded that way.\n\nIf you call onFailure() for 2 callbacks, you\u0027ll get 2 dialogs up. One on top of the other. It looks pretty hideous.",
      "parentUuid": "PIsAjHqk",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "PIgAzRvM",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2013-01-31T00:58:04Z",
      "side": 1,
      "message": "I think what you mean is ScreenLoadCallback is coded that way. No matter what we do about failures here, you can\u0027t have multiple ScreenLoadCallbacks in a group, because of the implementation of onSuccess:\n\n  public final void onSuccess(final T result) {\n    if (screen.isAttached()) {\n      preDisplay(result);\n      screen.display();\n      postDisplay();\n    }\n  }\n\nCalling preDisplay/display/postDisplay multiple times is no good. That\u0027s what I meant in the commit message about ScreenLoadCallback \"owning\" the screen.\n\nSo the pattern instead is to use N-1 generic AsyncCallbacks and 1 ScreenLoadCallback:\n\n  private Result1 result1;\n  ...\n  CallbackGroup cbs \u003d new CallbackGroup();\n  cbs.add(new AsyncCallback\u003cResult1\u003e() {\n      @Override\n      public void onSuccess(Result1 r) {\n        result1 \u003d r;\n      }\n\n      @Override\n      public void onFailure(Throwable caught) {\n        // Do nothing, ScreenLoadCallback.onFailure handles.\n      }\n    });\n  cbs.add(new ScreenLoadCallback\u003cResult2\u003e(this) {...});\n\nIf everything succeeds, the ScreenLoadCallback\u0027s display1 gets called, and result1 is guaranteed to have been set. If either RPC fails, ScreenLoadCallback.onFailure gets called.\n\nThis is what I have now.\n\nNow, we could still do what you said and short-circuit on the first onFailure. But because of the onSuccess issue we can still only have one ScreenLoadCallback. So the various onFailures would just be:\n\n  @Override\n  public void onFailure(Throwable caught) {\n    myScreenLoadCallback.onFailure(caught);\n  }\n\nThen no matter which one gets called, we do the normal ScreenLoadCallback behavior of displaying an error message.\n\nI don\u0027t care too strongly here, but it seems easier to have N-1 empty onFailure methods than N-1 delegate calls.",
      "parentUuid": "PC-fZYH4",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "PDHZrELE",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/rpc/CallbackGroup.java",
        "patchSetId": 1
      },
      "lineNbr": 123,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-01-31T01:03:10Z",
      "side": 1,
      "message": "OK, now I agree with you. I\u0027ll go read the latest patch set...",
      "parentUuid": "PIgAzRvM",
      "revId": "af0f91df65a360222b87361b5d2cc59075c821d4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}