{
  "comments": [
    {
      "key": {
        "uuid": "36a09886_46806c25",
        "filename": "java/com/google/gerrit/lucene/LuceneChangeIndex.java",
        "patchSetId": 9
      },
      "lineNbr": 137,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-04-25T07:12:54Z",
      "side": 1,
      "message": "nit: only used once, could be inlined",
      "range": {
        "startLine": 137,
        "startChar": 2,
        "endLine": 137,
        "endChar": 37
      },
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a97f5e67_b2409575",
        "filename": "java/com/google/gerrit/lucene/LuceneChangeIndex.java",
        "patchSetId": 9
      },
      "lineNbr": 137,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-05-17T11:02:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "36a09886_46806c25",
      "range": {
        "startLine": 137,
        "startChar": 2,
        "endLine": 137,
        "endChar": 37
      },
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "87f4d3e7_7646916d",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-04-25T07:12:54Z",
      "side": 1,
      "message": "How do these changes work with online reindexing?\n\nSpecifically: We get the ID in Lucene*Index#fromDocument. The new code will assume this is a string, while it is a legacy ID int field. From the JavaDoc for #stringValue which we call on IndexedField [1] I think we would get null for as long as we are on the old index.\n\nThis issue isn\u0027t limitted to Lucene, but also affects other index backends (like ours and elastic search). Can we make this modification only for the Lucene index? It seems undesirable also to force other index backends to use String as identifier because Lucene needs that.\n\n[1] http://lucene.apache.org/core/6_5_1/core/org/apache/lucene/index/IndexableField.html?is-external\u003dtrue",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2302e6d0_0bf0743c",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-05-17T11:02:47Z",
      "side": 1,
      "message": "Yes, you are right, online reindexing doesn\u0027t work. We need to add new string ID field.\n\nAs discussed in person, the decision is to go with string type for all index backends.",
      "parentUuid": "87f4d3e7_7646916d",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ba06782_a6888006",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-09-29T16:42:15Z",
      "side": 1,
      "message": "\u003e Yes, you are right, online reindexing doesn\u0027t work. We need to add new string ID field.\n\nDone. Online reindexing is fixed now. \n\nCan you review this ASAP, so that the new index schema types for all three indexes can make it in 3.1 release? That way we can remove the usage of legacy type and the deprecated code altogether in upcoming 3.2 release.\n\nIt would be also great, if someone could help to review and validate this series on Elastic Search.",
      "parentUuid": "2302e6d0_0bf0743c",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75a751ae_377721e3",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2019-09-30T20:48:02Z",
      "side": 1,
      "message": "\u003e It would be also great, if someone could help to review and validate this series on Elastic Search.\n\nI\u0027m running the elastic tests now locally, with this change and up to I0ff2500f included.\n\nI should be able to review some more myself later on this week.",
      "parentUuid": "9ba06782_a6888006",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "652bdce6_16b3c4fc",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2019-10-01T01:15:11Z",
      "side": 1,
      "message": "\u003e \u003e It would be also great, if someone could help to review and validate this series on Elastic Search.\n\u003e \n\u003e I\u0027m running the elastic tests now locally, with this change and up to I0ff2500f included.\n\nMost of the \u0027elastic\u0027 tests fail for me; will check the details out tomorrow.",
      "parentUuid": "75a751ae_377721e3",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d72528b5_14a5a7f5",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2019-10-01T19:55:21Z",
      "side": 1,
      "message": "\u003e \u003e \u003e It would be also great, if someone could help to review and validate this series on Elastic Search.\n\u003e \u003e \n\u003e \u003e I\u0027m running the elastic tests now locally, with this change and up to I0ff2500f included.\n\u003e \n\u003e Most of the \u0027elastic\u0027 tests fail for me; will check the details out tomorrow.\n\nNo mapping found for [legacy_id] in order to sort on (...) is the error I get as trailing /failed ES tests mostly. That error comes in various exception stack traces.",
      "parentUuid": "652bdce6_16b3c4fc",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "18029ed3_4891d626",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-10-01T20:00:00Z",
      "side": 1,
      "message": "Hmm, right, we must differentiate between integer: legacy_id and string: legacy_id2 depending on the schema version, (old or new), like it is done in Lucene.",
      "parentUuid": "d72528b5_14a5a7f5",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d68616a_bdb4a3ee",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 9
      },
      "lineNbr": 107,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-10-05T17:27:56Z",
      "side": 1,
      "message": "\u003e No mapping found for [legacy_id] in order to sort on (...) is the error I get as trailing /failed ES tests mostly.\n\nThanks. I am able to reproduce ES breakage. I missed one place to selectively use legacy_id vs. legacy_id2 in ElasticChangeIndex#getSortArray:\n\n  private JsonArray getSortArray() {\n  [...]\n    addNamedElement(schema.useLegacyNumericFields()\n        ? ChangeField.LEGACY_ID.getName()\n        : ChangeField.LEGACY_ID2.getName(), properties, sortArray);\n  [...]",
      "parentUuid": "18029ed3_4891d626",
      "revId": "b7080034f292c0b0db8f3efee45a624a36c7cb8a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}