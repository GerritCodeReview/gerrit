{
  "comments": [
    {
      "key": {
        "uuid": "AAADXn////s\u003d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-02-29T17:30:34Z",
      "side": 1,
      "message": "Tiny nit: s/compare/compares/",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADnX////o\u003d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2012-03-07T08:17:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "AAADXn////s\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADQ3////M\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2012-02-28T17:13:01Z",
      "side": 1,
      "message": "This looks much better. Now it really seems these two new methods would fit better in PatchList. Then on line 122 you could call toPatchList with both patchset ids (and perhaps the change or controlFactory). That would allow other users of PatchList in the future to use these new functions that aren\u0027t specific to the UI.",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADXH////8\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2012-02-29T05:41:15Z",
      "side": 1,
      "message": "besides  \u0027both patchset ids\u0027, \n it would also need  \u0027patchListCache\u0027 ,\u0027db\u0027, and \u0027changeControlFactory\u0027.\n but please reference Line 124 , Line 211 and Line194, I am a bit confused  as I \n think these 3 lines related business logic should be in current Class.\n If I am right , PatchList should not provide business logic related method, \n at least it looks like that  by far.",
      "parentUuid": "AAADQ3////M\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADXn////8\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-02-29T17:26:15Z",
      "side": 1,
      "message": "The problem you are really trying to solve is to take the intersection of 2 PatchLists.  In my opinion, getting the intersection is business logic that only the PatchLists (or below) should understand, this should not be exposed outside (above) of the PatchLists.  On the other hand, getting those PatchLists from the DB or cache does not belong inside PatchLists, and I believe that this is what you are (rightly so) concerned with.\n\nIf you look closely, you are creating/getting 3 PatchLists, the first one on line 121, the 2nd and 3rd are gotten on the two passes through getFileListBy() on line 210.  But, aren\u0027t the first one and second one almost the same (not sure how the keyFor(diffPrefs.getIgnoreWhitespace()) affects things)?  In the first case, you go to the DB and validate with controls on line 104-110, then again on line 209-211, mostly the same logic.\n\nSo, why not start by getting the 2 PatchLists (you can get the second on inside the if on 115 in PatchSetDetailFactory), and then somehow telling the PatchLists to intersect?  Perhaps this is as simple as having a toPatchList(PatchSet.Id, PatchList) method on PatchList?  \n\nThis approach seems like it might also help set the stage for doing what you are doing on the hunk level eventually instead of just at the file level (if anyone wanted to tackle that in the future)?",
      "parentUuid": "AAADXH////8\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADXH////w\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2012-03-01T02:02:44Z",
      "side": 1,
      "message": "Hi Martin\n your idea make my heart thrilled, very good resolution! I will create a new patch set accordingly .\n\nBy the way, about \u0027aren\u0027t the first one and second one almost the same ?\u0027\n answer is no. in short , see a case:\n a change have a 3 patch sets. Rebase happens between set 3 and patch set 2 .\n now let\u0027s diff patch set 3 and patch set 2 . \n here \n  -\u0027the first one\u0027     is diff 3 and 2 , \n  -\u0027the second one\u0027    is diff 3 and \u0027Base\u0027, \n  -\u0027the third one\u0027     is diff 2 and \u0027Base\u0027.",
      "parentUuid": "AAADXn////8\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADiX////s\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2012-03-03T16:53:16Z",
      "side": 1,
      "message": "Thanks for clarifying that, it should have been obvious, but I missed it. Unfortunately, the more I understand this, the more I think that this is being done at the wrong place. The first one is really what we want, and the first one should probably be fixed to return the proper file list in the first place! I think that you should likely push this logic further down into the stack so that it needn\u0027t be worked around on every display here.  To do this, the cache piece which fetches a PatchList should probably be modified.",
      "parentUuid": "AAADXH////w\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADj3////4\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2012-03-05T02:16:32Z",
      "side": 1,
      "message": "exactly right ! \n I plan to modify the get() method of  PatchListCacheImpl class \n\n  public PatchList get(final PatchListKey key) {\n     return fileCache.get(key);\n   }\n\n and hope we can reach an identity of views there. :)",
      "parentUuid": "AAADiX////s\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAADnX////g\u003d",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/rpc/changedetail/PatchSetDetailFactory.java",
        "patchSetId": 2
      },
      "lineNbr": 197,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2012-03-07T08:17:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "AAADj3////4\u003d",
      "revId": "b9d4ba63ec69da53f2867f1f92749aea9812dbac",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}