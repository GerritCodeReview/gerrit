{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "097085f2_c222cee0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-27T09:34:02Z",
      "side": 1,
      "message": "Would it be plausible that we keep the old events interface and only add a separate Listener for GitReferencesUpdated?\nFor consumers everything would work as before the only difference is that you can also listen to the batch-ref-update event by itself in parallel to the old event-stream?\nThat way the only consumers that would need to change are those that really are interested in the batch-ref-update event.",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c0b39be_6c409d36",
        "filename": "java/com/google/gerrit/acceptance/ExtensionRegistry.java",
        "patchSetId": 7
      },
      "lineNbr": 81,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "refsUpdatedListener",
      "range": {
        "startLine": 81,
        "startChar": 57,
        "endLine": 81,
        "endChar": 76
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "908db435_0212c4b6",
        "filename": "java/com/google/gerrit/acceptance/ExtensionRegistry.java",
        "patchSetId": 7
      },
      "lineNbr": 81,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7c0b39be_6c409d36",
      "range": {
        "startLine": 81,
        "startChar": 57,
        "endLine": 81,
        "endChar": 76
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ee51388_00123657",
        "filename": "java/com/google/gerrit/acceptance/ExtensionRegistry.java",
        "patchSetId": 7
      },
      "lineNbr": 120,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "refsUpdatedListener",
      "range": {
        "startLine": 120,
        "startChar": 47,
        "endLine": 120,
        "endChar": 66
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a397e8a4_67851d92",
        "filename": "java/com/google/gerrit/acceptance/ExtensionRegistry.java",
        "patchSetId": 7
      },
      "lineNbr": 120,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1ee51388_00123657",
      "range": {
        "startLine": 120,
        "startChar": 47,
        "endLine": 120,
        "endChar": 66
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25abc021_2bbda874",
        "filename": "java/com/google/gerrit/acceptance/ExtensionRegistry.java",
        "patchSetId": 7
      },
      "lineNbr": 255,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "refsUpdatedListener",
      "range": {
        "startLine": 255,
        "startChar": 57,
        "endLine": 255,
        "endChar": 75
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "96c82b44_9c656fc8",
        "filename": "java/com/google/gerrit/acceptance/ExtensionRegistry.java",
        "patchSetId": 7
      },
      "lineNbr": 255,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "25abc021_2bbda874",
      "range": {
        "startLine": 255,
        "startChar": 57,
        "endLine": 255,
        "endChar": 75
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bef7f34_5a90aa4e",
        "filename": "java/com/google/gerrit/extensions/events/GitReferencesUpdatedListener.java",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "If this listener is necessary I believe it would be much appreciated by plugin implementers if this contained some default or static conversion logic like:\n\n    default List\u003cGitReferenceUpdateListener.Event\u003e toLegacyEvents() {\n          //\n    }",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "09e95c67_98b95988",
        "filename": "java/com/google/gerrit/extensions/events/GitReferencesUpdatedListener.java",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-01-27T08:09:20Z",
      "side": 1,
      "message": "I don\u0027t think this would reduce the efforts of plugin developers. Take for example the hooks plugin.\n\nBefore this change:\n\n  @Override\n  public void onGitReferenceUpdated(GitReferenceUpdatedListener.Event event) {\n    HookArgs args \u003d hookFactory.createArgs();\n    args.add(\"--oldrev\", event.getOldObjectId());\n    args.add(\"--newrev\", event.getNewObjectId());\n    args.add(\"--refname\", event.getRefName());\n    args.add(\"--project\", event.getProjectName());\n    args.add(\"--submitter\", event.getUpdater());\n    hook.execute(event.getProjectName(), args);\n  }\n  \nWith this change (PS7):\n\n  @Override\n  public void onGitReferencesUpdated(GitReferencesUpdatedListener.Event event) {\n    for (UpdatedRef updatedRef : event.getUpdatedRefs()) {\n      HookArgs args \u003d hookFactory.createArgs();\n      args.add(\"--oldrev\", updatedRef.getOldObjectId());\n      args.add(\"--newrev\", updatedRef.getNewObjectId());\n      args.add(\"--refname\", updatedRef.getRefName());\n      args.add(\"--project\", event.getProjectName());\n      args.add(\"--submitter\", event.getUpdater());\n      hook.execute(event.getProjectName(), args);\n    }\n  }\n  \nWith your suggestion:\n\n  @Override\n  public void onGitReferencesUpdated(GitReferencesUpdatedListener.Event gitReferencesUpdatedEvent) {\n    for (LegacyEvent event : gitReferencesUpdatedEvent.toLegacyEvents()) {\n      HookArgs args \u003d hookFactory.createArgs();\n      args.add(\"--oldrev\", event.getOldObjectId());\n      args.add(\"--newrev\", event.getNewObjectId());\n      args.add(\"--refname\", event.getRefName());\n      args.add(\"--project\", event.getProjectName());\n      args.add(\"--submitter\", event.getUpdater());\n      hook.execute(event.getProjectName(), args);\n    }\n  }",
      "parentUuid": "3bef7f34_5a90aa4e",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b87040c8_9985984f",
        "filename": "java/com/google/gerrit/extensions/events/GitReferencesUpdatedListener.java",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-27T09:34:02Z",
      "side": 1,
      "message": "To the hooks plugin it doesn\u0027t matter since it has it\u0027s own \"ref-updated event\", but for other plugins it might.\nWe use the rabbitmq plugin to push all events to an ELK stack, if the old event isn\u0027t produced anymore we will probably want to split the multi-ref event into legacy events and publish those instead.",
      "parentUuid": "09e95c67_98b95988",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f5be3e6_56968cf6",
        "filename": "java/com/google/gerrit/extensions/events/GitReferencesUpdatedListener.java",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "b87040c8_9985984f",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc1a979f_e592b3c7",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 63,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "refsUpdatedEvents",
      "range": {
        "startLine": 63,
        "startChar": 51,
        "endLine": 63,
        "endChar": 67
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "90fa4341_96932ac2",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 63,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "fc1a979f_e592b3c7",
      "range": {
        "startLine": 63,
        "startChar": 51,
        "endLine": 63,
        "endChar": 67
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ec1a26e_02d942f8",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 65,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "getRefsUpdatedEvents ?",
      "range": {
        "startLine": 65,
        "startChar": 50,
        "endLine": 65,
        "endChar": 69
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "07bc60fa_cc0b1804",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 65,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0ec1a26e_02d942f8",
      "range": {
        "startLine": 65,
        "startChar": 50,
        "endLine": 65,
        "endChar": 69
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b57f06f2_ce015dd8",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 69,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "addRefsUpdatedEvents?",
      "range": {
        "startLine": 69,
        "startChar": 14,
        "endLine": 69,
        "endChar": 33
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec7a5f81_6b4cc22e",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 69,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "b57f06f2_ce015dd8",
      "range": {
        "startLine": 69,
        "startChar": 14,
        "endLine": 69,
        "endChar": 33
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a265e002_8f24e980",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "resetRefsUpdatedEvents",
      "range": {
        "startLine": 73,
        "startChar": 14,
        "endLine": 73,
        "endChar": 35
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7919e111_18b71fcd",
        "filename": "java/com/google/gerrit/httpd/WebSession.java",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a265e002_8f24e980",
      "range": {
        "startLine": 73,
        "startChar": 14,
        "endLine": 73,
        "endChar": 35
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dbabcd76_bf7c040a",
        "filename": "java/com/google/gerrit/server/events/EventBroker.java",
        "patchSetId": 7
      },
      "lineNbr": 64,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-27T09:34:02Z",
      "side": 1,
      "message": "For backwards compatibility these listeners should be fed the old event and not the new.",
      "range": {
        "startLine": 60,
        "startChar": 1,
        "endLine": 64,
        "endChar": 72
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53a7ef62_7895f103",
        "filename": "java/com/google/gerrit/server/events/EventBroker.java",
        "patchSetId": 7
      },
      "lineNbr": 64,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "AFAIK those listeners are registered by the plugins and not in core, right?",
      "parentUuid": "dbabcd76_bf7c040a",
      "range": {
        "startLine": 60,
        "startChar": 1,
        "endLine": 64,
        "endChar": 72
      },
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c334bb80_22832abf",
        "filename": "java/com/google/gerrit/server/extensions/events/GitReferenceUpdated.java",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2022-01-26T15:17:07Z",
      "side": 1,
      "message": "GitReferencesUpdated",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9f6a73f8_83e3fbd6",
        "filename": "java/com/google/gerrit/server/extensions/events/GitReferenceUpdated.java",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-02-15T17:04:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c334bb80_22832abf",
      "revId": "ba9187195ecd697ccdd7209f79541b9d1c1b64a0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}