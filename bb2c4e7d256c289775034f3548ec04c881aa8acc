{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d798e665_088d3315",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "I just realized this says \"pgm\", but you\u0027re not adding a pgm class, only a server class. How will someone run this?",
      "range": {
        "startLine": 7,
        "startChar": 6,
        "endLine": 7,
        "endChar": 9
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe26b1f7_a56132a5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-06-27T13:30:16Z",
      "side": 1,
      "message": "Yeah, this is not a pgm (aka a program that is a server side administrative tool [1]), but I also think it doesn\u0027t need to be one, as we are intending to make this a schema migration (see l. 27-29) below. A pgm is only needed if for some reason it\u0027s not possible to implement this as a schema migration. So I think rephrasing this should be sufficient.\n\n[1] https://gerrit-review.googlesource.com/Documentation/pgm-index.html",
      "parentUuid": "d798e665_088d3315",
      "range": {
        "startLine": 7,
        "startChar": 6,
        "endLine": 7,
        "endChar": 9
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be7f345a_1af013f2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-29T18:26:16Z",
      "side": 1,
      "message": "\u003e A pgm is only needed if for some reason it\u0027s not possible to implement this as a schema migration.\n\nBut would it be safe to run this migration on 3.6.X (online or offline) so that you don\u0027t need downtime upgrading to 3.7? If yes, I think have a pgm (and moving this change to stable-3.6) would be beneficial.\n\nIf there must be a schema version change, does this need to be idempotent? We only expect those to run once.",
      "parentUuid": "fe26b1f7_a56132a5",
      "range": {
        "startLine": 7,
        "startChar": 6,
        "endLine": 7,
        "endChar": 9
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2ffb6e8_05ea0015",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-06-30T07:58:02Z",
      "side": 1,
      "message": "This must be a schema migration, since we will drop all code for the deprecated label functions in the next step. At that moment your projects will be broken if you haven\u0027t migrated yet.\n\nIt would be possible to delay the removal of the deprecated label functions to the next release so that you could do an online migration in this release, but AFAIK we are not committed to support online migration and haven\u0027t done such an approach for any other migrations yet (an exception may have been the copy-approvals pgm, but that\u0027s an optional migration that is not mandatory to be executed, and I think it only became a pgm by accident since we missed the release where this should have been included as a schema migration).\n\n\u003e I think have a pgm (and moving this change to stable-3.6) would be beneficial.\n\nThis would require backporting other changes, at least [1], as otherwise people may manually reset the deprecated label functions after they have been migrated. I think backporting that change would be against our stable branch policy.\n\n[1] https://gerrit-review.googlesource.com/c/gerrit/+/337456",
      "parentUuid": "be7f345a_1af013f2",
      "range": {
        "startLine": 7,
        "startChar": 6,
        "endLine": 7,
        "endChar": 9
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb5da239_fc91deff",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "I think your intent is to make this safe to run ahead of upgrading. Is that true? If yes, how could someone do that?",
      "range": {
        "startLine": 28,
        "startChar": 37,
        "endLine": 29,
        "endChar": 15
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4ae4514d_b74883fa",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-06-27T13:30:16Z",
      "side": 1,
      "message": "We have a custom framework to run migrations against all our live servers. For such a migration we write custom code, and in this case this code will get the MigrateLabelFunctionsToSubmitRequirement class injected to do the migration of the project configs, the same way as the upstream schema migration will get the MigrateLabelFunctionsToSubmitRequirement class injected to do the migration of the project configs.\n\nFWIW the upstream schema migration could be part of this change, instead of being a follow-up change. I believe this change followed the example of the MigrateLabelConfigToCopyCondition migration were this was split in 2 changes. In that case I\u0027ve split this in 2 changes because we were waiting for another migration (persist copied votes) to be done in the latest stable branch, and we had to avoid a clash between the schema versions, hence the migration in master could only be submitted after the other migration landed in the stable branch and was merged into master (note that in the end persisting copied votes had been implemented as a pgm program and not as a schema migration, so in retrospect this was not necessary).",
      "parentUuid": "bb5da239_fc91deff",
      "range": {
        "startLine": 28,
        "startChar": 37,
        "endLine": 29,
        "endChar": 15
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01c9aab9_13e50178",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-29T18:26:16Z",
      "side": 1,
      "message": "I\u0027m fine with adding the schema migration to this change if it doesn\u0027t move to stable-3.6 and become a pgm. Otherwise I think you\u0027d add the schema bump on master after merging from stable-3.6.",
      "parentUuid": "4ae4514d_b74883fa",
      "range": {
        "startLine": 28,
        "startChar": 37,
        "endLine": 29,
        "endChar": 15
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "68c48759_807c16df",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 31,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "Assuming this does become a pgm someone can run, it should be mentioned in the release notes.",
      "range": {
        "startLine": 31,
        "startChar": 15,
        "endLine": 31,
        "endChar": 19
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d2d0a0a_7e285511",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-06-27T13:30:16Z",
      "side": 1,
      "message": "Didn\u0027t review the code yet.",
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "372cab04_1c7ca560",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2022-06-30T07:58:02Z",
      "side": 1,
      "message": "FYI, I will take over implementing this migration from Youssef, since Youssef is overbooked with other, more important, topics.\n\nI still didn\u0027t look at the implementation, but I plan to pickup reworking this change somewhen next week.",
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5b810ff_81cd0320",
        "filename": "java/com/google/gerrit/server/schema/MigrateLabelFunctionsToSubmitRequirement.java",
        "patchSetId": 4
      },
      "lineNbr": 38,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "I think we only call things programs if they live in com.google.gerrit.pgm?",
      "range": {
        "startLine": 38,
        "startChar": 3,
        "endLine": 38,
        "endChar": 8
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c16e89f0_47b996f4",
        "filename": "java/com/google/gerrit/server/schema/MigrateLabelFunctionsToSubmitRequirement.java",
        "patchSetId": 4
      },
      "lineNbr": 76,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "nit: inline the single-use variable\n\n if (anyProjectHasProlog(allProjects)) {",
      "range": {
        "startLine": 76,
        "startChar": 8,
        "endLine": 76,
        "endChar": 17
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "865726ff_ed272855",
        "filename": "java/com/google/gerrit/server/schema/MigrateLabelFunctionsToSubmitRequirement.java",
        "patchSetId": 4
      },
      "lineNbr": 78,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "nit: you can be more specific about the criteria, \"at least one project\"",
      "range": {
        "startLine": 78,
        "startChar": 42,
        "endLine": 78,
        "endChar": 66
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4c48eac_b3135b1a",
        "filename": "java/com/google/gerrit/server/schema/MigrateLabelFunctionsToSubmitRequirement.java",
        "patchSetId": 4
      },
      "lineNbr": 82,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "nit: inline the single-use variable\n\n for (Project.NameKey project : sortProjectsWithInheritance(allProjects)) {",
      "range": {
        "startLine": 82,
        "startChar": 35,
        "endLine": 82,
        "endChar": 49
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61fdc282_a9a29f0c",
        "filename": "java/com/google/gerrit/server/schema/MigrateLabelFunctionsToSubmitRequirement.java",
        "patchSetId": 4
      },
      "lineNbr": 83,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-06-23T16:00:38Z",
      "side": 1,
      "message": "Since you\u0027re not catching the exceptions here, this will stop and block on the first project with any problems always. Is that the behavior you want?",
      "range": {
        "startLine": 83,
        "startChar": 6,
        "endLine": 83,
        "endChar": 32
      },
      "revId": "bb2c4e7d256c289775034f3548ec04c881aa8acc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}