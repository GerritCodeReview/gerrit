{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4c6197d0_dcf7379d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-19T11:36:10Z",
      "side": 1,
      "message": "I believe this isn\u0027t really independent from his predecessor: if we keep them separate we actually break the user experience.\n\nCan you squash it with its predecessor?",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3ee24239_b010f03f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-19T11:58:55Z",
      "side": 1,
      "message": "With this further fix, Gerrit starts but existing clients see a warning of a man-in-the-middle attack:\n\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\n",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e9ff107_71f90277",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-19T11:59:57Z",
      "side": 1,
      "message": "@Kenyon can you also try yourself E2E? It should be simple to reproduce:\n- install Gerrit v2.13\n- add your RSA key and verify that you can SSH\n- upgrade to Gerrit v2.16\n- verify you can still SSH as before",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cad6fae3_18a050dd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-19T12:12:46Z",
      "side": 1,
      "message": "The issue is this one:\n[2021-11-19 11:56:48,625] [sshd-SshServer[6c8d638a]-nio2-thread-6] WARN  org.apache.sshd.common.keyprovider.FileKeyPairProvider : Failed (InvalidKeyException) to load key resource\u003d/var/gerrit/etc/ssh_host_key: Unsupported private key file format: /var/gerrit/etc/ssh_host_key\n\nInstead of tolerating the situation, I believe we should read the old key and convert that into OpenSSH format. That would allow to avoid ignoring the key and preserving the same identity.",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "138b58fc_e5566883",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1111258
      },
      "writtenOn": "2021-11-19T20:11:44Z",
      "side": 1,
      "message": "Yes, there is a thread about that here, where a conversion during init is suggested: https://groups.google.com/g/repo-discuss/c/csJIIyekh28/m/yBuMSmOsBwAJ\n\nI thought that Gerrit still supported the old key format. I thought I tested using the old key type along with new ones and it worked.\n\nThere is a small Java program in that thread for doing the conversion. For my own upgrades, I am using an Ansible playbook which uses that program to convert the old host key.\n\nI suppose we could basically use that conversion code inside of gerrit. I\u0027m guessing it should go into java/com/google/gerrit/pgm/init/InitSshd.java.",
      "parentUuid": "cad6fae3_18a050dd",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de49da7b_59cf07f1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1111258
      },
      "writtenOn": "2021-11-19T20:11:44Z",
      "side": 1,
      "message": "I was thinking the same thing this morning.",
      "parentUuid": "4c6197d0_dcf7379d",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1940a9b0_54e7e647",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-19T20:20:18Z",
      "side": 1,
      "message": "That\u0027s the catch: if we create the extra keys, they\u0027ll be generated in OpenSSH format and then we\u0027ll end up in the mixed mode mess.\n\nNot generating the extra keys would still work (as the upgrade to v2.16 without your fix did not have this problem) but longer term a new key generation will be required.\n\nHere we are talking about old RSA Keys that were generated at least 5 years ago and are today considered insecure anyway. A responsible Gerrit admin *must* rotate those keys and, when he does it, the clients will have to trust again the new key.\n\nConverting automatically the old obsolete keys into OpenSSH format is just hiding a bigger problem: the keys are unusable anyway. *IF* the Gerrit admin wants to do it, he has to do it consciously, and Gerrit shouldn\u0027t do it automatically.\n\nHope that makes sense.",
      "parentUuid": "138b58fc_e5566883",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3dbe219b_0e2753f0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1111258
      },
      "writtenOn": "2021-11-23T18:21:52Z",
      "side": 1,
      "message": "\u003e Not generating the extra keys would still work (as the upgrade to v2.16 without your fix did not have this problem) but longer term a new key generation will be required.\n\u003e \n\u003e Here we are talking about old RSA Keys that were generated at least 5 years ago and are today considered insecure anyway. A responsible Gerrit admin *must* rotate those keys and, when he does it, the clients will have to trust again the new key.\n\u003e \n\u003e Converting automatically the old obsolete keys into OpenSSH format is just hiding a bigger problem: the keys are unusable anyway. *IF* the Gerrit admin wants to do it, he has to do it consciously, and Gerrit shouldn\u0027t do it automatically.\n\nWhy would the RSA keys be considered insecure? I understand that the ssh-rsa signature algorithm, which is based on SHA-1, is obsolete. But RSA keys themselves are still good.",
      "parentUuid": "1940a9b0_54e7e647",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e74e9720_2165da9e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-23T19:22:15Z",
      "side": 1,
      "message": "[...]\n\n\u003e Why would the RSA keys be considered insecure? I understand that the ssh-rsa signature algorithm, which is based on SHA-1, is obsolete. But RSA keys themselves are still good.\n\nIf you generated an RSA key pair 5 years ago and you never rotated them, then the keys are considered insecure.\n\nThe security of a key lies in the maximum time that a potential attacker can \"guess\" the key. The longer the key, the longer the time it gets to guess the key by brute-force or other techniques.\n\nHope that explains my statement on why RSA keys generated over 5 years ago aren\u0027t secure anymore.",
      "parentUuid": "3dbe219b_0e2753f0",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d09d2dc3_644ec662",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1111258
      },
      "writtenOn": "2021-11-23T20:06:10Z",
      "side": 1,
      "message": "Yes, due to the duration, that makes sense.\n\nI still think that my two patches fix actual bugs in Gerrit, where the current code is not providing the expected experience for the Gerrit administrator. Host key rotation should be a separate activity, not forced unexpectedly during upgrade. If we don\u0027t fix these bugs, at least the release notes should say something about this situation.\n\nI have worked around this in my own upgrades by converting the key format as a separate step. So I leave it up to the Gerrit maintainers on what to do with these patches.",
      "parentUuid": "e74e9720_2165da9e",
      "revId": "bf7673b637f28fbe886168af9fdf7cc14ce67ed3",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}