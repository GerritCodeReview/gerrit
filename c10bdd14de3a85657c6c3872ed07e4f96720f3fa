{
  "comments": [
    {
      "key": {
        "uuid": "89e65427_b2e000d7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2016-06-19T18:57:26Z",
      "side": 1,
      "message": "execute",
      "range": {
        "startLine": 10,
        "startChar": 28,
        "endLine": 10,
        "endChar": 35
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "89e65427_b2f7e093",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-06-19T19:20:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "89e65427_b2e000d7",
      "range": {
        "startLine": 10,
        "startChar": 28,
        "endLine": 10,
        "endChar": 35
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "89e65427_52c8b457",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/BatchUpdate.java",
        "patchSetId": 1
      },
      "lineNbr": 683,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2016-06-19T18:57:26Z",
      "side": 1,
      "message": "Here\u0027s how to get what you want:\n\nModify ChangeTask constructor to take a long startNanos. Initialize this once in the caller(s) such that all ChangeTask are created with the same startNanos value.\n\nStore in ChangeTask two fields:\n\n  long startNanos;\n  long endNanos;\n\nWrap the method with a try/finally that just sets endNanos:\n\n  try {\n    ...\n  } finally {\n    endNanos \u003d System.nanoTime();\n  }\n\nNow here in the loop what you say instead is:\n\n  long startNanos \u003d Long.MAX_VALUE;\n  long endNanos \u003d 0;\n  for (ChangeTask task : tasks) {\n    startNanos \u003d Math.min(startNanos, task.startNanos);\n    endNanos \u003d Math.max(endNanos, task.endNanos);\n  }\n  latency \u003d endNanos - startNanos\n\nI think you want the observed user latency, which is what this gives us. If  things run on parallel threads we may get some tasks overlapped, if they share the main thread they will have progressively larger endNanos.",
      "range": {
        "startLine": 676,
        "startChar": 0,
        "endLine": 683,
        "endChar": 49
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e971901c_85bf22c3",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/BatchUpdate.java",
        "patchSetId": 1
      },
      "lineNbr": 683,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-06-19T19:20:06Z",
      "side": 1,
      "message": "IIUC that gives the end user latency from running all the ChangeTasks from start to finish. It doesn\u0027t directly measure the subset of a task that is due stageNoteDbUpdate.",
      "parentUuid": "89e65427_52c8b457",
      "range": {
        "startLine": 676,
        "startChar": 0,
        "endLine": 683,
        "endChar": 49
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e971901c_c5b91ade",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/BatchUpdate.java",
        "patchSetId": 1
      },
      "lineNbr": 683,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2016-06-19T19:25:07Z",
      "side": 1,
      "message": "Ok, then two other options:\n\n- Use the noteDbStageLatencyNanos you have here in ps1, but report the max.\n- Report each noteDbStageLatencyNanos individually so the bucketer sees all samples.\n\nWhat you have here doesn\u0027t make much sense.",
      "parentUuid": "e971901c_85bf22c3",
      "range": {
        "startLine": 676,
        "startChar": 0,
        "endLine": 683,
        "endChar": 49
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "69e920fa_912f3cee",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/NoteDbUpdateManager.java",
        "patchSetId": 1
      },
      "lineNbr": 304,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2016-06-19T18:57:26Z",
      "side": 1,
      "message": "Seems like a TODO? Certainly you don\u0027t want to do this as below when you call stage its wrapped in the same timer context and will double report the latency.",
      "range": {
        "startLine": 301,
        "startChar": 0,
        "endLine": 304,
        "endChar": 76
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "89e65427_d202646b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/NoteDbUpdateManager.java",
        "patchSetId": 1
      },
      "lineNbr": 304,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-06-19T19:20:06Z",
      "side": 1,
      "message": "Um I guess I was so wrapped up in writing this comment that I neglected to actually make the code change that the comment suggested...",
      "parentUuid": "69e920fa_912f3cee",
      "range": {
        "startLine": 301,
        "startChar": 0,
        "endLine": 304,
        "endChar": 76
      },
      "revId": "c10bdd14de3a85657c6c3872ed07e4f96720f3fa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}