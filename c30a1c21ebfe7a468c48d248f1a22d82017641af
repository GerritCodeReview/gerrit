{
  "comments": [
    {
      "key": {
        "uuid": "3ca94b57_58037399",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2020-01-17T17:06:32Z",
      "side": 1,
      "message": "Not sure if or how this other sha should be updated.",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "851d95fd_59ccc2c9",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-01-17T18:20:04Z",
      "side": 1,
      "message": "Compute it, and then compare against the value provided on Central:\n\n  $ wget https://repo1.maven.org/maven2/com/github/ben-manes/caffeine/guava/2.8.1/guava-2.8.1.jar\n  2020-01-17 19:13:03 (2.19 MB/s) - ‘guava-2.8.1.jar’ saved [21003/21003]\n\n  $ sha256sum guava-2.8.1.jar\n  25da1aee744e477c015b78fe6e015a8795ff91cd9d58be20dfa30b99c0d05ad0  guava-2.8.1.jar\n\nCompare it with the value provided on Central:\n\n  $ wget https://repo1.maven.org/maven2/com/github/ben-manes/caffeine/guava/2.8.1/guava-2.8.1.jar.sha256\n  2020-01-17 19:17:42 (5.38 MB/s) - ‘guava-2.8.1.jar.sha256’ saved [64/64]\n\n  $ cat guava-2.8.1.jar.sha256\n  25da1aee744e477c015b78fe6e015a8795ff91cd9d58be20dfa30b99c0d05ad0",
      "parentUuid": "3ca94b57_58037399",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce498429_413cd112",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2020-01-17T19:11:54Z",
      "side": 1,
      "message": "\u003e Compute it, and then compare against the value provided on Central:\n\u003e \n\u003e   $ wget https://repo1.maven.org/maven2/com/github/ben-manes/caffeine/guava/2.8.1/guava-2.8.1.jar\n\u003e   2020-01-17 19:13:03 (2.19 MB/s) - ‘guava-2.8.1.jar’ saved [21003/21003]\n\u003e \n\u003e   $ sha256sum guava-2.8.1.jar\n\u003e   25da1aee744e477c015b78fe6e015a8795ff91cd9d58be20dfa30b99c0d05ad0  guava-2.8.1.jar\n\u003e \n\u003e Compare it with the value provided on Central:\n\u003e \n\u003e   $ wget https://repo1.maven.org/maven2/com/github/ben-manes/caffeine/guava/2.8.1/guava-2.8.1.jar.sha256\n\u003e   2020-01-17 19:17:42 (5.38 MB/s) - ‘guava-2.8.1.jar.sha256’ saved [64/64]\n\u003e \n\u003e   $ cat guava-2.8.1.jar.sha256\n\u003e   25da1aee744e477c015b78fe6e015a8795ff91cd9d58be20dfa30b99c0d05ad0\n\nDone. Thanks.",
      "parentUuid": "851d95fd_59ccc2c9",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b24bf4f6_a9561526",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-01-17T20:19:41Z",
      "side": 1,
      "message": "Note, that SHA256 must always be updated in http_file(). Unfortunately, the rule is broken. Consider the patch set 1 of this change, where you have updated the file name but missed to bump the hash value.\n\nIf you build that patch set and investigate the final artifact, you could see, that even though the file name look sane:\n\n  $ bazel build :headless\n  bazel-bin/headless.war\n\n  $ unzip -t bazel-bin/headless.war | grep caffeine\n    testing: WEB-INF/lib/caffeine-guava-2.8.1.jar   OK\n    testing: WEB-INF/lib/caffeine-2.8.1.jar   OK\n\nIt\u0027s actually broken! Why? Because the content of the file WEB-INF/lib/caffeine-guava-2.8.1.jar is still outdated file caffeine-guava-2.8.0.jar. Why it is so? Because the algorithm in bazel is broken. It\u0027s cached with SHA256 only. The original file 2.8.0 is retrieved and delivered.\n\nYou can see this, it if you extract the files and compute the SHA256/SHA1 and compare with the ones provided on Central:\n\n  $ mkdir junk\n  $ cd junk\n  $ unzip -q ../bazel-bin/headless.war\n  $ cd WEB-INF/lib\n  $ sha256sum caffeine-guava-2.8.1.jar\n  3a66ee3ec70971dee0bae6e56bda7b8742bc4bedd7489161bfbbaaf7137d89e1  caffeine-guava-2.8.1.jar\n  $ sha1sum caffeine-guava-2.8.1.jar\n  e3cf0d6629b64706041cffe9de5b1dadab2fec4e  caffeine-guava-2.8.1.jar\n\nHowever, if you download the right file:\n\n  $  wget https://repo1.maven.org/maven2/com/github/ben-manes/caffeine/guava/2.8.1/guava-2.8.1.jar\n  --2020-01-17 21:09:17--  https://repo1.maven.org/maven2/com/github/ben-manes/caffeine/guava/2.8.1/guava-2.8.1.jar\n\nAnd compute its hash it can be seen, that it is a different file:\n\n  $ sha256sum guava-2.8.1.jar\n  25da1aee744e477c015b78fe6e015a8795ff91cd9d58be20dfa30b99c0d05ad0  guava-2.8.1.jar\n  $ sha1sum guava-2.8.1.jar\n  8f65aae2c69dc83f616ae64bbeaeb32ddb429782  guava-2.8.1.jar",
      "parentUuid": "ce498429_413cd112",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7752d396_04c18d2d",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2020-01-17T21:09:32Z",
      "side": 1,
      "message": "Ack. And thanks for the detailed explanation. This review is a reference for that matter now. I was indeed wondering why the build hadn\u0027t failed, upon such a previously mismatching sha256.",
      "parentUuid": "b24bf4f6_a9561526",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "18957c89_1ace9150",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-01-17T21:56:36Z",
      "side": 1,
      "message": "I have filed this issue upstream: [1], sent this CL to Bazel: [2] and fixed that issue in Gerrit build tool chain on top of it: [3]. If you now patch Bazel, build it from source, and then try partial http_file rule upgrade (similar to the patch set 1 of that change), the build would fail, as expected.\n\n* [1] https://github.com/bazelbuild/bazel/issues/10612\n* [2] https://bazel-review.googlesource.com/c/bazel/+/127210\n* [3] https://gerrit-review.googlesource.com/c/gerrit/+/251095",
      "parentUuid": "7752d396_04c18d2d",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "785b70e5_44f4fd40",
        "filename": "WORKSPACE",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2020-01-19T23:19:46Z",
      "side": 1,
      "message": "\u003e If you now patch Bazel, build it from source, and then try partial http_file rule upgrade (similar to the patch set 1 of that change), the build would fail, as expected.\n\nYes it does, for me locally too; thanks again.",
      "parentUuid": "18957c89_1ace9150",
      "range": {
        "startLine": 310,
        "startChar": 14,
        "endLine": 310,
        "endChar": 78
      },
      "revId": "c30a1c21ebfe7a468c48d248f1a22d82017641af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}