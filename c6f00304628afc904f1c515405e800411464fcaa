{
  "comments": [
    {
      "key": {
        "uuid": "AAAAo3///7k\u003d",
        "filename": "src/main/java/com/google/gerrit/client/changes/MessagePanel.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2009-11-04T02:47:04Z",
      "side": 1,
      "message": "Hmmph.  We somehow need to be able to rewrite a match of\n\n  issue 12\n\nto\n \n  \u003ca href\u003d\"http://bugs/?id\u003d12\"\u003eissue 12\u003c/a\u003e\n\nIdeally we do this by the user only having to enter the URL in the commentlink.*.link part of gerrit.config, and we automatically make link generate this HTML.  This way the comment is shown as-is, but we text is linkified with the proper target underneath.\n\nWe probably also need to run this after wikify to keep it from expanding and linking the URL twice.",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///7Y\u003d",
        "filename": "src/main/java/com/google/gerrit/client/changes/MessagePanel.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2009-11-04T03:05:46Z",
      "side": 1,
      "message": "I\u0027m handling that with:\n match \u003d (issue\\\\s*(\\\\d+))\n link \u003d \u003ca href\u003d\"http://code.google.com/p/gerrit/issues/detail?id\u003d$2\"\u003e$1\u003c/a\u003e\n\nWhich isn\u0027t pretty, but it works.  I can\u0027t think of a better method off the top of my head...\n\nYeah, if I run it before wikify then things get ugly",
      "parentUuid": "AAAAo3///7k\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///7E\u003d",
        "filename": "src/main/java/com/google/gerrit/client/changes/MessagePanel.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2009-11-04T03:14:09Z",
      "side": 1,
      "message": "I think you should handle the expansion of the link value in the configuration into the HTML a href as part of GerritConfigProvider, when you parse the configuration.  Everyone will want the behavior you just described.  Lets do it for them rather than make them repeat it.",
      "parentUuid": "AAAAo3///7Y\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///6g\u003d",
        "filename": "src/main/java/com/google/gerrit/client/changes/MessagePanel.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2009-11-04T03:55:42Z",
      "side": 1,
      "message": "I agree that is much cleaner.  The only downside is that I cannot turn the whole phrase \"issue xx\" into a hyperlink, just the xx.  If that is OK with you, or you have a workaround, just let me know.  Javascript doesn\u0027t support named groups with regex and the only other possibility I can think of is to change a $1 in the link string to a $2.",
      "parentUuid": "AAAAo3///7E\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///6M\u003d",
        "filename": "src/main/java/com/google/gerrit/client/changes/MessagePanel.java",
        "patchSetId": 1
      },
      "lineNbr": 29,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2009-11-04T06:35:36Z",
      "side": 1,
      "message": "I played around with this a bit more, and I didn\u0027t notice one problem.  If I set\n\n match \u003d issue\\\\s*(\\\\d+)\nand\n link \u003d http://code.google.com/p/gerrit/issues/detail?id\u003d$1\n\nand expand link to link \u003d \"\u003ca href\u003d\\\"\" + link + \"\\\"\u003e$1\u003c/a\u003e\"\nthen it replaces \"issue xx\" with a hyperlink text \"xx\" - it drops the \"issue\" string.  I can\u0027t think of a good way to work around this, other than specifying the full link html in the config file.  Any thoughts?",
      "parentUuid": "AAAAo3///6g\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///7w\u003d",
        "filename": "src/main/java/com/google/gerrit/server/http/GerritConfigProvider.java",
        "patchSetId": 1
      },
      "lineNbr": 104,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2009-11-04T02:47:04Z",
      "side": 1,
      "message": "FWIW I wouldn\u0027t bother with this temporary list.  Just use cfg.getSubsections in the for loop and allocate commentLinks with the default allocation size.  Its not critical we allocate that at the right size.",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///7o\u003d",
        "filename": "src/main/java/com/google/gerrit/server/http/GerritConfigProvider.java",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2009-11-04T02:47:04Z",
      "side": 1,
      "message": "This part is case insensitive and Git tradition has made it all lowercase.  I\u0027d like to stick with that tradition here, which means we call it \"commentlink\".\n\nThis is nagging at me as perhaps being the wrong name, but I think you are right, this is a really flexible feature that can be used to grep anything in a comment and generate a link, so this is pretty good.\n\nThinking longer term here, we probably need to somehow support this on a per-project basis.  E.g. on this site tools/gerrit uses a different issue tracker than tools/repo, which still uses a different issue tracker from all of the other platform/* projects.  So we need 3 different regex rules that are selected based on project.\n\nBetter, we should be able to define additional regex rules that need project names to produce hyperlinks, here\u0027s an example:\n\n  [commentlink \"issue\"]\n    match \u003d issue (\\d+)\n    link \u003d http://code.google.com/p/gerrit/issues/detail?id\u003d$1\n\n  [commentlink \"gitweb\"]\n    match \u003d ((?!I)[0-9a-f]{8,40})\n    link \u003d http://android.git.kernel.org/?p\u003d${project};a\u003dcommit;h\u003d$1\n\nWhich is pretty darn cool actually.",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///7U\u003d",
        "filename": "src/main/java/com/google/gerrit/server/http/GerritConfigProvider.java",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2009-11-04T03:05:46Z",
      "side": 1,
      "message": "The gitweb idea is awesome, I\u0027ll see if I can grab the project name very easily...\n\nI see your point with differences per-project.  hrm.  I can add a \"project\" line to each commentlink section, and have empty default to all except projects which already have a commentlink section with the same name.  The logic might get a little hairy, but it is the best I can think of.\n\n [commentlink \"issue\"]\n   match \u003d issue (\\d+)\n   link \u003d http://code.google.com/p/gerrit/issues/detail?id\u003d$1\n   project \u003d tools/gerrit\n   project \u003d tools/repo\n\n [commentlink \"issue\"]\n   match \u003d issue (\\d+)\n   link \u003d http://code.google.com/p/android/issues/detail?id\u003d$1\n(this is used for everything except tools/gerrit and tools/repo)",
      "parentUuid": "AAAAo3///7o\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///7I\u003d",
        "filename": "src/main/java/com/google/gerrit/server/http/GerritConfigProvider.java",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2009-11-04T03:14:09Z",
      "side": 1,
      "message": "Your project idea is a good one, but you can\u0027t tell the two blocks in your example above apart once they have been parsed into memory, they appear in the same collection.  :-(\n\nAnother way to do this is to name the commentlink in one location, and in another bind them to a project.  So we could do:\n\n  [commentlink \"issue-gerrit\"]\n    match \u003d issue (\\d+)\n    link \u003d http://code.google.com/p/gerrit/issues/detail?id\u003d$1\n\n  [commentlink \"issue-android\"]\n    match \u003d issue (\\d+)\n    link \u003d http://code.google.com/p/android/issues/detail?id\u003d$1\n\n  [project \"tools/gerrit\"]\n    commentlink \u003d issue-gerrit\n\nAnd maybe have the logic work as follows:\n\n* If no project.*.commentlink is declared for a given project, use all commentlinks which are not mentioned in another project.*.commentlink field.\n* If a project.*.commentlink is declared for a given project, use only those commentlinks and no others.\n\nYes, its a bit tricky when you parse in the configuration file to keep track of those.  But I can\u0027t think of another way right now to manage it.",
      "parentUuid": "AAAAo3///7U\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAo3///6k\u003d",
        "filename": "src/main/java/com/google/gerrit/server/http/GerritConfigProvider.java",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1000253
      },
      "writtenOn": "2009-11-04T03:55:42Z",
      "side": 1,
      "message": "That makes sense, but lots of extra logic...\n\nInternally, we use multiple bug tracking servers.  It won\u0027t be a problem for us because issues have the project name in the identifier, like with Jira GERRIT-XXX and ANDROID-YYY\n\nMaybe you could change the policy for Bug tags with google code issues?  We could parse out \"gerrit issue \\d+\" and \"android issue \\d+\", but it will be a pain to enforce.",
      "parentUuid": "AAAAo3///7I\u003d",
      "revId": "c6f00304628afc904f1c515405e800411464fcaa",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}