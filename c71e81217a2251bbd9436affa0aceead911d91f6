{
  "comments": [
    {
      "key": {
        "uuid": "da30cd82_39cfa452",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 22,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-19T08:53:04Z",
      "side": 1,
      "message": "nit We call them \u0027changes\u0027 in Gerrit.",
      "range": {
        "startLine": 22,
        "startChar": 5,
        "endLine": 22,
        "endChar": 7
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d14d8e2e_b87a93f6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 22,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-03-19T16:00:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "da30cd82_39cfa452",
      "range": {
        "startLine": 22,
        "startChar": 5,
        "endLine": 22,
        "endChar": 7
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c593847b_e1783a31",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 54,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-03-18T23:36:32Z",
      "side": 1,
      "message": "Unlike the groups\u0027 external cache loader which loops on all internal groups\u0027 refs and parses them from NoteDb (defined in Groups.getExternalGroupsFromNoteDb), this call here loads the group references from the single ref \"REFS_GROUPNAMES\" without the need to parse them. So this is expected to be faster.",
      "range": {
        "startLine": 54,
        "startChar": 41,
        "endLine": 54,
        "endChar": 75
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "455bb6cd_88e2a57e",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 54,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-19T08:53:04Z",
      "side": 1,
      "message": "I think it\u0027d be faster to do:\n\nrepo.getRefDatabase().refsByPrefix(\"refs/groups/\");\n\nThe ref database is sorted internally, so the runtime of byPrefix is log(numRefs) (seek to start) + numGroups\n\nWith the current approach, it would be:\nnumGroups x log(n)\n\nbecause each exact ref is in theory n.\n\nIf RefTable is used, exact ref has near-constant time behavior, but byPrefix would still be faster for other ref stores and potentially even for RefTable.\n\nYou could benchmark this, if you want.",
      "parentUuid": "c593847b_e1783a31",
      "range": {
        "startLine": 54,
        "startChar": 41,
        "endLine": 54,
        "endChar": 75
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac74cbdf_8446a932",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 54,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-03-19T16:00:16Z",
      "side": 1,
      "message": "Yeah makes sense. Thanks for pointing that out.\nI tried adding 1K group refs and the readRevision method takes 2 milliseconds using byPrefx and 245 milliseconds using exactRef on my Linux workstation.",
      "parentUuid": "455bb6cd_88e2a57e",
      "range": {
        "startLine": 54,
        "startChar": 41,
        "endLine": 54,
        "endChar": 75
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d52f8642_7b793815",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-19T08:53:04Z",
      "side": 1,
      "message": "Instead of hashing strings, I would hash the bytes directly and use ByteBuffer, that\u0027s more efficient.\n\nYou know upfront how many ObjectIds you have because the RefDb returns a list (so you can call size). That way, you can right-size the ByteBuffer and avoid upscaling while copying. (SHA1 \u003d 20 bytes)\n\nJGit\u0027s ObjectId class gives you #copyRawTo(ByteBuffer buffer) which you can just use to fill up the buffer.\n\nIn the end, you can call putBytes(ByteBuffer bytes) on the hasher.",
      "range": {
        "startLine": 59,
        "startChar": 36,
        "endLine": 59,
        "endChar": 48
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a65af5c_71260ed8",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-03-19T16:00:16Z",
      "side": 1,
      "message": "Thanks for your detailed explanation here.",
      "parentUuid": "d52f8642_7b793815",
      "range": {
        "startLine": 59,
        "startChar": 36,
        "endLine": 59,
        "endChar": 48
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fb79c28d_4cd088e1",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-19T08:53:04Z",
      "side": 1,
      "message": "Please see check the JavaDoc for this, they recommend putUnencodedChars instead as it\u0027s faster (putString is for x-language encodings).\n\n(obsolete when you work with bytes)",
      "range": {
        "startLine": 60,
        "startChar": 6,
        "endLine": 60,
        "endChar": 15
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d48d0d61_c0fa07c1",
        "filename": "java/com/google/gerrit/server/account/ExternalGroupsReader.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-03-19T16:00:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fb79c28d_4cd088e1",
      "range": {
        "startLine": 60,
        "startChar": 6,
        "endLine": 60,
        "endChar": 15
      },
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee31398_bac5f7fa",
        "filename": "javatests/com/google/gerrit/acceptance/api/group/GroupsIT.java",
        "patchSetId": 2
      },
      "lineNbr": 157,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2020-03-19T08:53:04Z",
      "side": 1,
      "message": "Does this really need a binding? Usually, plain classes like these can just be injected without a binding.",
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8321450d_f650a184",
        "filename": "javatests/com/google/gerrit/acceptance/api/group/GroupsIT.java",
        "patchSetId": 2
      },
      "lineNbr": 157,
      "author": {
        "id": 1091982
      },
      "writtenOn": "2020-03-19T16:00:16Z",
      "side": 1,
      "message": "Yeah it works without this explicit binding. Thanks for your comment.",
      "parentUuid": "0ee31398_bac5f7fa",
      "revId": "c71e81217a2251bbd9436affa0aceead911d91f6",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}