{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8536c0ea_4dec4fba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-10-04T10:53:06Z",
      "side": 1,
      "message": "note that CommitsCollection already does a visibility/reachability check on the commit, so you\u0027re doing double work here.\n\nif performance is a concern, you\u0027d better make an endpoint on the projects/$PROJECT/ level.  ",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aa45f754_87a17ac3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2021-10-04T16:48:25Z",
      "side": 1,
      "message": "\u003e note that CommitsCollection already does a visibility/reachability check on the commit, so you\u0027re doing double work here.\nYes, CommitsCollection does a visibility/reachability check on the commit. We would still need a check to filter the input refs based on the caller\u0027s visibility.(as we only did a check on commit in CommitsCollection)\n\n\u003e if performance is a concern, you\u0027d better make an endpoint on the projects/$PROJECT/ level.\nCould you elaborate on this..?",
      "parentUuid": "8536c0ea_4dec4fba",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "228b17e6_be8c59d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-10-04T17:35:00Z",
      "side": 1,
      "message": "\u003e\u003e if performance is a concern, you\u0027d better make an endpoint on the projects/$PROJECT/ level.\n\u003eCould you elaborate on this..?\n\nright now, you\u0027ll first look for any readable ref that can reach the commit, and then look for a ref in your input that can reach the commit.\n\nso you\u0027re doing trying to reach the commit from some refs twice. As this is an expensive operation for large repositories, I think it would be better to have an endpoint on projects, eg.\n\n  projects/$PROJECT/commitin?commit\u003dabc\u0026ref\u003dref1\u0026ref\u003dref2\n  \nwhich does the following:\n\n1) check ref1, ref2 for visibility. return 403 if any ref is not visible.\n2) check commit for reachability from ref1, ref2 (return the refs from which it is reachable)",
      "parentUuid": "aa45f754_87a17ac3",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "794835c8_6b9d7946",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-10-04T18:00:52Z",
      "side": 1,
      "message": "That does seem more efficient. We could even extend that API in the future to support checking multiple commits\u0027 reachability (if someone had that as a use case).\n\nPrudhvi, do you see any issues with that? If not, do you want to make that update?",
      "parentUuid": "228b17e6_be8c59d9",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9bd1f545_f42f8998",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2021-10-04T18:11:57Z",
      "side": 1,
      "message": "I see Han-Wen\u0027s suggestions as two separate things: 1) Altering the API slightly and 2) Improving the performance of the API. Han-Wen, it seems that you are implying that it takes #1 to do #2, but it is not clear to me how they are related, are they?",
      "parentUuid": "794835c8_6b9d7946",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbebaa1a_b8278a24",
        "filename": "java/com/google/gerrit/server/change/IncludedInResolver.java",
        "patchSetId": 6
      },
      "lineNbr": 107,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-10-04T10:53:06Z",
      "side": 1,
      "message": "if you are concerned about performance, it might be useful to look into Iee62e745360d08 (\"Speed up reachability checks using bitmaps\").\n\nI think you could plug in the JGit reachability checker here too for a 10x speed increase (assuming you\u0027re checking against refs/heads/ refs.)",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5da85c2b_a19d09a5",
        "filename": "java/com/google/gerrit/server/change/IncludedInResolver.java",
        "patchSetId": 6
      },
      "lineNbr": 107,
      "author": {
        "id": 1096442
      },
      "writtenOn": "2021-10-04T16:48:25Z",
      "side": 1,
      "message": "ACK. I will take a look and I believe that effort is separate from this change.",
      "parentUuid": "cbebaa1a_b8278a24",
      "revId": "c9931a73e9e6fdb653cf7e28c5ce9ba629287277",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}