{
  "comments": [
    {
      "key": {
        "uuid": "a0989217_c64b2b93",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 60,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "How do you ensure this manual step happens ? Can users delete projects on their own ?",
      "range": {
        "startLine": 60,
        "startChar": 27,
        "endLine": 60,
        "endChar": 38
      },
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "46e283c8_2e72480c",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 60,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-04-23T05:17:49Z",
      "side": 1,
      "message": "It is assumed that the admin would have to do this step.",
      "parentUuid": "a0989217_c64b2b93",
      "range": {
        "startLine": 60,
        "startChar": 27,
        "endLine": 60,
        "endChar": 38
      },
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92fb1186_2d332a48",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "This way you can impose a limit on the total size of the sum of git and lfs data.\nThough you will no longer be able to limit the maximum total size\nof git objects per repository. We limit maxRepositorySize globally in order to avoid\ntypical problems caused by huge git repositories (also Github limits git repositories\nto 1GB for the same reason). Though projects using lfs may store a lot more in lfs\nobjects.",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7063328d_1e205025",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-04-23T05:17:49Z",
      "side": 1,
      "message": "\u003e you will no longer be able to limit the maximum total size\nof git objects per repository\n\ngood point; I don\u0027t think we considered this drawback.",
      "parentUuid": "92fb1186_2d332a48",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2dd4a91_11a4303f",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-04-23T07:56:44Z",
      "side": 1,
      "message": "+1 to Matthias proposal: the LFS plugin should take care of his quota and should be sparate from Gitâ€™s one",
      "parentUuid": "7063328d_1e205025",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6109771b_eedbf81c",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2019-04-23T13:55:26Z",
      "side": 1,
      "message": "\u003e good point; I don\u0027t think we considered this drawback.\n\nWe did consider this drawback ;) First of all, it is not a drawback if/when one doesn\u0027t want to store files under .git repository or don\u0027t care about single repo quota but cares about quota for repos in a namespace (our case).\nSecondly, it can be still circumvented by setting \u0027plugin.quota.useGitObjectCount \u003d true\u0027 in gerrit.config. The later will only work when LFS quota gets calculated independently (currently not possible hence this drawback was internally accepted)...\n\nIn general, I don\u0027t see having independent Git, LFS quotas or single unified quota contradict each other. We need to have the possibility to specify X as a total amount of space that user can consume and this is in user\u0027s discretion how it should be divided (that was the main driver of starting this proposal). I don\u0027t care if it gets automatically added behind the scenes as long as I don\u0027t have to specify an artificial size for Git and LFS parts correspondingly. Having said that I understand that one would like to keep them counted separately (callback interface [1] could be used to deliver that) and see it part of the configuration.\n\n[1] https://git.eclipse.org/r/#/c/140646/",
      "parentUuid": "e2dd4a91_11a4303f",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1017c709_10a52dc7",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "I think there should be 2 quotas, storing 10GB in lfs probably won\u0027t cause issues, though storing\n10GB in git objects is typically not a good idea. So why don\u0027t you implement the lfs quota in the lfs plugin ?\nI guess you could still reuse parts of the implementation.",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26ea6087_5cf4984c",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-04-23T05:17:49Z",
      "side": 1,
      "message": "The use case that we\u0027re looking at is a total storage quota that includes both git data and LFS data, without caring where the storage is consumed.",
      "parentUuid": "1017c709_10a52dc7",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fde8236e_cf43428d",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-04-23T08:34:05Z",
      "side": 1,
      "message": "\u003e The use case that we\u0027re looking at is a total storage quota that includes both git data and LFS data, without caring where the storage is consumed.\n\nI think enforcing large file quota in the LFS plugin and the rest in the quota plugin is a good idea. I see why you want this quota to be the same, uniform quota, but I think that is dangerous. From a system health perspective it would be better to enforce the limits separately forcing users to put large objects in the LFS in my opinion.",
      "parentUuid": "26ea6087_5cf4984c",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "355de316_6190e54d",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2019-04-23T13:55:26Z",
      "side": 1,
      "message": "When git object size is limited (https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.7/config-project-config.html#receive.maxObjectSizeLimit) the only place that user can actually store bigger file is LFS... again can\u0027t see these 2 requirements as contradicting but rather a matter of choice how to perform/enforce it.\n\nAFAICT in the case when one doesn\u0027t want to store LFS files under `.git` repository but still want them removed when repository gets removed `ProjectDeletion` AuditEvent could be used (that is a fresh idea that I haven\u0027t POC\u0027ed yet)... otherwise inter-plugin dependencies would have to be introduced...",
      "parentUuid": "fde8236e_cf43428d",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "166c0654_f0ef8d1d",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-23T19:18:53Z",
      "side": 1,
      "message": "We implemented receive.maxObjectSizeLimit as the first line of defense when we came across users\nstoring ISO images and database backups in Gerrit which caused massive load issues on the server side.\nSince then we enforce a hard limit of 20MB for the max. blob size.\nThough we learnt that this isn\u0027t sufficient since projects e.g. try to store binary dependencies\nin git and keep adding new versions of dependencies. Hence we implemented the quota plugin as a tool helping to restrict\nsuch practice before users end up with performance problems in the support hotline.",
      "parentUuid": "355de316_6190e54d",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "df21830a_bf73646e",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-04-23T08:34:05Z",
      "side": 1,
      "message": "Please use QuotaEnforcer/QuotaBackend instead of creating new generic events",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "645f2a17_5d78320f",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2019-04-23T13:55:26Z",
      "side": 1,
      "message": "they are not available for 2.16...",
      "parentUuid": "df21830a_bf73646e",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b3d8ee3d_3d7cfe50",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-23T19:18:53Z",
      "side": 1,
      "message": "maybe this could be downported ?",
      "parentUuid": "645f2a17_5d78320f",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b12a89d9_eb4bf5e3",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "again I think there should be different quotas for git and lfs objects",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8bf926fb_dabb721f",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2019-04-23T13:55:26Z",
      "side": 1,
      "message": "again I would say they could be different quotas ;)",
      "parentUuid": "b12a89d9_eb4bf5e3",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3da3b392_7575fe74",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-23T19:18:53Z",
      "side": 1,
      "message": "isn\u0027t that what I said ?",
      "parentUuid": "8bf926fb_dabb721f",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "224ebdcf_311b00f6",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1014257
      },
      "writtenOn": "2019-05-13T09:34:14Z",
      "side": 1,
      "message": "I think there are two different concept here:\n\n1. separate quota for Git objects and LFS objects.\n2. a quota for total size of Git repository, no matter if it is Git or LFS objects.\n\nNote that the second cannot be achieved by using combination of quotas from 1.\nThis is because there is no assumption on how to divide the total quota between LFS and Git objects.\n\nSo in other words: if you have total quota of 1MB it could be used entirely (whole 1MB) for Git objects or for 1MB of LFS data, but the limit should still be 1MB.\n\nI think it would be good to have a possibility to define both.",
      "parentUuid": "3da3b392_7575fe74",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "062966fc_ca4b35a9",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-05-13T12:59:39Z",
      "side": 1,
      "message": "looks good to me if it\u0027s possible to limit total size of git objects and, using a different quota setting,\nalso to limit the total size of a repository (git + lfs objects)",
      "parentUuid": "224ebdcf_311b00f6",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "593a7edd_616e91f6",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 104,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-04-23T08:34:05Z",
      "side": 1,
      "message": "When you use QuotaEnforcer/QuotaBackend, you could. The LFS plugin checks for a quota bucket (\"lfs_quota\", this is just a string, so you don\u0027t need any dependencies). The quota plugin knows how to check that quota.\n\nThis isn\u0027t clean, but it is one way of making this work without complicated inter-plugin dependencies.\n\nAs said in an earlier comment, I don\u0027t think you should :)",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "018c5a2a_169d1abf",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-04-23T08:34:05Z",
      "side": 1,
      "message": "I am not a huge fan of adding new plugin interfaces to core while the thing you really need is already in master and would be the cleaner solution.\n\nWe are already eyeballing the new Gerrit release for around the hackathon. Any chance you can wait for that? If not, we could think about cherry-picking over as a last resort. The series was submitted within days of the release, so I would not expect many conflicts.\n\nIn any case, I think we shouldn\u0027t do any kind of feature development on a stable branch.",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c84c1d53_1b578b52",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "Did you consider to extract the common reusable code into a public library module\nand to refactor both the quota and lfs plugins to use this common code in order to\nimplement quotas for git objects (in quota plugin) and lfs objects (in the lfs plugin)?",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1dca59e1_e718f443",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-04-23T05:17:49Z",
      "side": 1,
      "message": "We have considered that.  We preferred not to do it because it adds another component that needs to be versioned and included in both plugin builds.",
      "parentUuid": "c84c1d53_1b578b52",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57d297ad_f842cf27",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-05-13T12:59:39Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1dca59e1_e718f443",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "641e4997_3fe5355a",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 142,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "I think this could be upstreamed if you do it in the way I described above.",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bae06815_d738a11e",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-04-23T07:56:44Z",
      "side": 1,
      "message": "This should be managed at the client Git side, as it is already possible today. Having the large files into the repo in a custom and non interoperable way with cgit isnâ€™t a promising path IMHO",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c62b211b_d8d86046",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-04-23T08:04:23Z",
      "side": 1,
      "message": "Yes, it\u0027s already possible anyway, but with LFS you don\u0027t get *any* of the objects if you clone a project, even with all refs.  The idea is to mimic that behavior, i.e. if the objects are in a separate git repo, they don\u0027t get included.\n\nThe main benefit behind this approach is being able to use replication to distribute the objects.\n\nAlso note, this is in the \"ideas considered\" section and the implicit \"...and rejected\" is omitted in the title :)",
      "parentUuid": "bae06815_d738a11e",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19be27e7_fca87e94",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-22T21:47:28Z",
      "side": 1,
      "message": "But this means you need to implement the lfs transport protocol on top of git.\nWhere would you store the sha256 hashes of the large files stored in separate git repositories ?\nWhen would you create a commit in these separate git repositories ?\nGit versioning for these objects would be redundant, right ?",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb1770a4_6cda72a4",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-04-23T05:17:49Z",
      "side": 1,
      "message": "We haven\u0027t got as far as thinking about how it would be implemented. This was just a \"what if...\" idea that was raised during discussions; I\u0027ve only added it here as something that we considered.",
      "parentUuid": "19be27e7_fca87e94",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4a026edc_bcaadefe",
        "filename": "Documentation/lfs-quota-design.txt",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-04-23T19:18:53Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "eb1770a4_6cda72a4",
      "revId": "cbdb2888125cbe25ab6cdd464d3264cdf212ce4c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}