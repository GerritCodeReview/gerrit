{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "139b6ae5_17a2286f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-10T18:08:37Z",
      "side": 1,
      "message": "I still need to go through a extensive manual testing but this is the direction I am heading to.\n\nCan you think of a better way of understanding if a change only contains AS changes?\n\nCan you think of other cases I didn\u0027t cover?",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8dc4e506_a0a3f8e6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-10T21:01:36Z",
      "side": 1,
      "message": "Sorry I resolved it by mistake",
      "parentUuid": "139b6ae5_17a2286f",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab2e8342_a01dfdc9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-06-11T08:04:09Z",
      "side": 1,
      "message": "Good catch!\n\nMaybe after performing all the updates to \"msg\" in ChangeUpdate#applyImpl, you can check if msg contains anything other than attention set update.\n\nIf that doesn\u0027t work, you did miss a few cases, full list is here:\nhttps://gerrit-review.googlesource.com/Documentation/user-attention-set.html\n\nOne example is making a change WIP, abandoned, or submitted removes all users from the attention set. Another example is deleting a vote (maybe you should check if planned attention set updates includes only deletions from the attention set too?)\n\nAnyway it\u0027s a bit error prone so I suggest my other idea first :-)",
      "parentUuid": "8dc4e506_a0a3f8e6",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c8aa5b9_74993605",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-11T14:57:36Z",
      "side": 1,
      "message": "\u003e Good catch!\n\u003e \n\u003e Maybe after performing all the updates to \"msg\" in ChangeUpdate#applyImpl, you can check if msg contains anything other than attention set update.\n\nCurrently the call stack is the following: ChangeUpdate#addUpdates -\u003e AbstractChangeUpdate#apply -\u003e ChangeUpdate#applyImpl\n\nThat means ChangeUpdate#applyImpl is already called in the current stack.\nWhat I am doing in the ChangeUpdate#isAttentionSetChangeOnly is checking a subset of the possible ChangeUpdate parameters (which I agree with you is error prone).\n\nWas your suggestion to check them all, similarly to what ChangeUpdate#isEmpty is currently doing? Or did you have something else in mind?",
      "parentUuid": "ab2e8342_a01dfdc9",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04023be3_d1dd0354",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-06-11T15:13:30Z",
      "side": 1,
      "message": "nevermind, you\u0027re right, my suggestion is only possible with a deeper refactor.\n\nYou could do that - only reject after going through creating the message. However, I guess in that case I would just cover all the cases in https://gerrit-review.googlesource.com/Documentation/user-attention-set.html",
      "parentUuid": "7c8aa5b9_74993605",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "35330678_bee8e7da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-14T08:50:46Z",
      "side": 1,
      "message": "I have added test cases to cover all the cases listed in the docs. I hope I didn\u0027t miss any.",
      "parentUuid": "04023be3_d1dd0354",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dba8cc51_410007fe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-06-15T11:45:04Z",
      "side": 1,
      "message": "rather than trying to infer which is a pure A/S update, wouldn\u0027t it be easier to have a \"ignoreMaxUpdateLimit\" setting on the ChangeUpdate, and set that flag from the REST endpoints that update the attention set?",
      "parentUuid": "35330678_bee8e7da",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b492e112_16e0c2ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-06-16T08:14:32Z",
      "side": 1,
      "message": "Then we would need to infer which is a pure attention set update on the \"PostReview\" endpoint, so I don\u0027t think so.",
      "parentUuid": "dba8cc51_410007fe",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9cda311c_08d2a87c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-06-16T08:24:12Z",
      "side": 1,
      "message": "My suggestion is to only let A/S endpoints (ie. https://gerrit-review.googlesource.com/Documentation/rest-api-changes.html#attention-set-endpoints) bypass the max update setting (ie. removing yourself from A/S), but not PostReview.\n\nwhat is the use-case for PostReview on a change that is already at its maximum number of updates? If the change isn\u0027t submitted yet, you wouldn\u0027t be able to submit it, because the submit is another update.",
      "parentUuid": "b492e112_16e0c2ed",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ac39677_5e7120ff",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-06-16T08:33:44Z",
      "side": 1,
      "message": "PostReview could be used as an attention set endpoint; You can remove users from the attention set via the \"reply\" dialog without doing anything else just by specifying remove_from_attention_set in ReviewInput (https://gerrit-review.googlesource.com/Documentation/rest-api-changes.html#review-input).",
      "parentUuid": "9cda311c_08d2a87c",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e575c985_6038bfc3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-06-16T08:37:12Z",
      "side": 1,
      "message": "hmm.. isn\u0027t it be easy to infer what a pure A/S upadte on PostReview, though? Just check if the input has only {add_to,remove_from}_attention_set defined.",
      "parentUuid": "2ac39677_5e7120ff",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8e27360_1ab49d55",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2021-06-16T08:45:42Z",
      "side": 1,
      "message": "yea, ok, that works :-)",
      "parentUuid": "e575c985_6038bfc3",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64d8bfa1_3d1411ff",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-16T16:21:25Z",
      "side": 1,
      "message": "\u003e Just check if the input has only {add_to,remove_from}_attention_set defined.\n\nI think this can be done in the PostReview#apply. There are a bunch of checks on ReviewInput to see which fields have been set. We could do something like that: \n\n      public Response\u003cReviewResult\u003e apply(RevisionResource revision, ReviewInput input, Timestamp ts)\n      throws ... {\n      boolean attentionSetUpdateOnly \u003d true;\n      ...\n      ...\n      \n      if (input.onBehalfOf !\u003d null) {\n        revision \u003d onBehalfOf(revision, labelTypes, input);\n        attentionSetUpdateOnly \u003d false;\n      }\n      if (input.labels !\u003d null) {\n        checkLabels(revision, labelTypes, input.labels);\n        attentionSetUpdateOnly \u003d false;\n      }\n      if (input.comments !\u003d null) {\n        input.comments \u003d cleanUpComments(input.comments);\n        checkComments(revision, input.comments);\n        attentionSetUpdateOnly \u003d false;\n      }\n      ...\n      \nNot really nice, but I think it will work. @Han-Wen Is that what you meant by \"has only {add_to,remove_from}_attention_set\"?\n\nAn alternative would be considering the case of a change to the A/S via the PostReview endpoint *not* a \"pure A/S update\". It might be a rare case...unfortunately I don\u0027t have data to prove/disprove it.",
      "parentUuid": "e8e27360_1ab49d55",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "624e97ee_b2d0f5a2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-16T16:40:40Z",
      "side": 1,
      "message": "See in PS10 how it looks like when making the distinction between \"pure and non-pure A/S update\" only based on the endpoint called.",
      "parentUuid": "64d8bfa1_3d1411ff",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab0841d7_966c66d3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-06-16T18:06:30Z",
      "side": 1,
      "message": "\u003e We could do something like that: \n\nthat\u0027s really complicated.\n\n \n filtered \u003d new ReviewInput()\n filtered.add_attention_set \u003d input.add_attention_set\n filtered.rm_attention_set \u003d input.rm_attention_set\n boolean pure_as \u003d filtered.equals(input)",
      "parentUuid": "624e97ee_b2d0f5a2",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d76756d_31838d61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-06-16T22:10:48Z",
      "side": 1,
      "message": "\u003e \u003e We could do something like that: \n\u003e \n\u003e that\u0027s really complicated.\n\u003e  \n\u003e  filtered \u003d new ReviewInput()\n\u003e  filtered.add_attention_set \u003d input.add_attention_set\n\u003e  filtered.rm_attention_set \u003d input.rm_attention_set\n\u003e  boolean pure_as \u003d filtered.equals(input)\n\nOuch! That is definitively neater ðŸ˜Š\n\nHowever, it won\u0027t be enough checking {add_to,remove_from}_attention_set. There are some other parameters defaulted. \n\nFollowing an example of ReviewInput coming from a call like this (which I was expecting to only populate {add_to,remove_from}_attention_set):\n\n    curl \u0027http://localhost:8080/changes/test~61/revisions/1/review\u0027 --data-raw \u0027{\"add_to_attention_set\":[],\"remove_from_attention_set\":[{\"user\":1000001,\"reason\":\"Administrator replied on the change\"}]}\u0027\n\nAnd the corresponding ReviewInput:\n\n    message \u003d null\n    tag \u003d null\n    labels \u003d null\n    comments \u003d null\n    robotComments \u003d null\n    drafts \u003d null\n    notify \u003d null\n    notifyDetails \u003d null\n    omitDuplicateComments \u003d false\n    onBehalfOf \u003d null\n    reviewers \u003d null\n    workInProgress \u003d false\n    ready \u003d false\n    addToAttentionSet \u003d {ArrayList@18210}  size \u003d 0\n    removeFromAttentionSet \u003d {ArrayList@18211}  size \u003d 1\n    ignoreAutomaticAttentionSetRules \u003d false \n    \nIt is still doable but it is not going to be as neat as I thought.",
      "parentUuid": "ab0841d7_966c66d3",
      "revId": "cc13ac917ba730b5bb4cf29dfc188653b6f0a464",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}