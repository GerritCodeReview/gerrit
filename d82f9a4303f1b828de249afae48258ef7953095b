{
  "comments": [
    {
      "key": {
        "uuid": "2864a22d_f79cfa4b",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-01-23T10:31:29Z",
      "side": 1,
      "message": "This regex is already quite complex and we should avoid having to maintain two copies of it. Why do we need the LFS URL regex on two places? Why not reuse the existing one (and fix it by adding the non-capturing group operators)?\n\nTaking the GitOverHttpServlet.URL_REGEX as an example, we also have only one copy of it... so it seems possible?",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "486b96ff_98cdf93f",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2017-01-23T12:42:05Z",
      "side": 1,
      "message": "this is based on LFS regex, but it is not the same in a sense that it comes into play only in case there is LFS endpoint meant but there is no /a/ prefix in the URL as /a/ prefixed URLs are handled by auth-filter anyway see 64",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "486b96ff_d8c7711b",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2017-01-23T12:50:08Z",
      "side": 1,
      "message": "IMHO: /p/ is not needed neither here nor in Git LFS servlet but I have kept it as it was in source REGEX.",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b597168c_8f164750",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2017-01-26T07:56:08Z",
      "side": 1,
      "message": "Sasa, is this still an issue?",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c73a6d6_8cc0cc86",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-02-06T16:31:19Z",
      "side": 1,
      "message": "Trying to better understand the issue: the only place where we bind the LfsPluginServlet.URL_REGEX is in the HttpPluginModule. There is no auth filter which filters LfsPluginServlet.URL_REGEX. Only when a LFS request URL starts-with \"/a\" it will be filtered by the ProjectBasicAuthFilter, assuming basic auth is configured (this is in the GitOverHttpModule).\nOtherwise, there is no authentication and this is the issue?\n\nCorrect?",
      "parentUuid": "b597168c_8f164750",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a1b9efd_dac459c9",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-02-06T16:40:46Z",
      "side": 1,
      "message": "What is this dot intended to match?",
      "range": {
        "startLine": 30,
        "startChar": 17,
        "endLine": 30,
        "endChar": 18
      },
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17b36d72_06738cab",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2017-02-07T12:03:08Z",
      "side": 1,
      "message": "it might be more precise without \".\"\n^(?:(?!/a/))(?:/p/|/)?(.+)(?:/info/lfs/objects/batch)$",
      "parentUuid": "3a1b9efd_dac459c9",
      "range": {
        "startLine": 30,
        "startChar": 17,
        "endLine": 30,
        "endChar": 18
      },
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "47c894ca_8ef28407",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2017-02-07T12:03:08Z",
      "side": 1,
      "message": "Right, I didn\u0027t want to have auth duplicated in case \"/a\" is in the URL (for instance when one uses gerrit checkout-url from UI - with download plugin).",
      "parentUuid": "5c73a6d6_8cc0cc86",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3bd25021_5dfdc17f",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-02-06T16:31:19Z",
      "side": 1,
      "message": "What is we here put the LfPluginServlet.URL_REGEX)?\nWhy would this not work? Even if /a/ is missing in a valid LFS request, the LfsPluginServlet.URL_REGEX will still match it and the ProjectBasicAuthFilter will be involved.",
      "range": {
        "startLine": 63,
        "startChar": 16,
        "endLine": 63,
        "endChar": 29
      },
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aae8fce7_0955ff8f",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-02-06T16:32:13Z",
      "side": 1,
      "message": "Correction:\n\n\u003e What is we here put the LfPluginServlet.URL_REGEX)?\n\nWhat if ...",
      "parentUuid": "3bd25021_5dfdc17f",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5343ebaa_45a7fed6",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2017-02-07T12:03:08Z",
      "side": 1,
      "message": "It will not work due:\n- ProjectBasicAuthFilter filters only requests that are Git specific (therefore we need this additional filter that acts when there is no \"/a\" prefix\n- it works as long as we don\u0027t enable auth checking in LFS (performed in [1]) as it accepts everything without checking if user has rights to it\n\nAgain solution is to either modify repository\u0027s lfs.url to contain \"a/\" prefix (impractical probably achievable on proxy to rewrite URL) or make sure that Git LFS requests are filtered regardless of prefix presence - this patch ;)\n\n\n[1] https://gerrit-review.googlesource.com/#/c/93991/",
      "parentUuid": "aae8fce7_0955ff8f",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85a546b8_1329d3c9",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-02-07T17:29:18Z",
      "side": 1,
      "message": "\u003e It will not work due:\n \u003e - ProjectBasicAuthFilter filters only requests that are Git\n \u003e specific (therefore we need this additional filter that acts when\n \u003e there is no \"/a\" prefix\n\nThe LfsPluginServlet.URL_REGEX specifies /a as optional. If, here, we define that requests for LfsPluginServlet.URL_REGEX go through the ProjectBasicAuthFilter then any request matching LfsPluginServlet.URL_REGEX should go through this filter including those not containing the /a prefix (but otherwise matching the regex). What am I missing?",
      "parentUuid": "5343ebaa_45a7fed6",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d67cfcfe_812ef5d8",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2017-02-08T07:25:39Z",
      "side": 1,
      "message": "There will be no user if requests don\u0027t go over ProjectBasicAuthFilter. If one calls Git LFS with \"/a\" prefix it will go automatically over this filter, however IMHO all LFS requests should go over this filter so that if basic auth is given to the request (that will be the case when anonymous access is not granted and LfsPluginServlet returns 401) user is read from it and added to the request and finally LfsPluginServlet can authorize against it see [1]. LfsPluginServlet uses Provider\u003cCurrentUser\u003e to get the user from request and this is the way to make sure that user is there when Git LFS client uses either basic or digest auth.\n\n[1] https://gerrit-review.googlesource.com/#/c/93991/",
      "parentUuid": "85a546b8_1329d3c9",
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2ea1b9a_cd871141",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/GitOverHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-02-10T09:06:23Z",
      "side": 1,
      "message": "\u003e There will be no user if requests don\u0027t go over ProjectBasicAuthFilter. If one calls Git LFS with \"/a\" prefix it will go automatically over this filter,\n\nYes\n\n\u003e however IMHO all LFS requests should go over this filter\n\nYes.\nHowever, I don\u0027t understand why do you think that LfPluginServlet.URL_REGEX will not match\nthose LFS requests without the /a prefix?\n\n\nExample: consider 2 LFS requests\n\n  1. /a/foo/info/lfs/objects/batch\n  2.   /foo/info/lfs/objects/batch\n\nBoth 1 and 2 are matched by the LfPluginServlet.URL_REGEX",
      "parentUuid": "d67cfcfe_812ef5d8",
      "range": {
        "startLine": 63,
        "startChar": 16,
        "endLine": 63,
        "endChar": 29
      },
      "revId": "d82f9a4303f1b828de249afae48258ef7953095b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}