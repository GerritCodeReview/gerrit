{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6293fb78_6e92e3f1",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 1
      },
      "lineNbr": 2594,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-04-01T09:31:24Z",
      "side": 0,
      "message": "I understand why you want to do this, but it\u0027s not obvious to the reader of the commit message.\n\nFrom the POV of usability, this change is a step backwards. Have you considered doing some kind of templating, eg.\n\n  Removed Code-Review+1 by ${Account 1234}\n\nand have either the backend or the frontend insert the name/email back in at runtime?\n\n(if this happens in the FE, there might be some XSS issues that we need to worry about.)\n\nan unrelated problem is that this can easily regress when we add new features. It would be great to have a test that scours the meta log for a change for usernames and emails. For now, it could just print the violations, but once we\u0027re clean, we could have it fail if something is added again.",
      "range": {
        "startLine": 2594,
        "startChar": 64,
        "endLine": 2594,
        "endChar": 91
      },
      "revId": "dae4ddcc7fb6c584b0520000b249bb74ff491192",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db4a4cda_dc7fe590",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 1
      },
      "lineNbr": 2594,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-04-01T15:31:55Z",
      "side": 0,
      "message": "Please, correct me if I am wrong, but I do not see it as a step back from the usability POV.\nWhen deleting the vote, NoteDB still has user account in change footer, so it does not affect debuggability.\n\nWe only set ChangeMessage on a few NoteDB operations today, and from eyeballing, I doubt frontend is using them. \n\nI would just drop commitMessage from NoteDB altogether, but as I am not certain, I prefer to fix these few cases first and see if there is any regression.\n\nAs for the regressions for new features, I was thinking about it, but wanted to sync with Joerg first:\n* It looks to me like we would need to rewrite NotedDB history to backfill such cases, looks like it is possible:\nhttp://google3/third_party/java_src/gerritcodereview/gerrit/java/com/google/gerrit/server/notedb/NoteDbUpdateManager.java?l\u003d90\n* It should be easy enough to write such a test for backend regression, however, it is unclear what we do about data in comments/gerrit change messages (subject in NoteDb) and other input to the backend, that is currently unsanitised (e.g. the case of attention set, you found).",
      "parentUuid": "6293fb78_6e92e3f1",
      "range": {
        "startLine": 2594,
        "startChar": 64,
        "endLine": 2594,
        "endChar": 91
      },
      "revId": "dae4ddcc7fb6c584b0520000b249bb74ff491192",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbde78f7_5ad99b0e",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 1
      },
      "lineNbr": 2594,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-04-01T15:41:56Z",
      "side": 0,
      "message": "\u003e We only set ChangeMessage on a few NoteDB operations today, and from eyeballing, I doubt frontend is using them. \n\nthe FE serves them verbatim in the log of actions. See this change, where I removed the code-style +1. In many cases, the original voter is useful information. For example some CI setups have a different account per target platform.\n\n\u003e It should be easy enough to write such a test for backend regression, however, it is unclear what we do about data in comments/gerrit change messages (subject in NoteDb) and other input to the backend, that is currently unsanitised (e.g. the case of attention set, you found).\n\nYou\u0027d have to set the name and email of accounts to something easily recognizable, eg. \"Do Not Persist \u003cdonotpersist@domain\u003e\" to get the NoteDb commits and diffs as raw text, and then look for donotpersist and \"Do Not Persist\".",
      "parentUuid": "db4a4cda_dc7fe590",
      "range": {
        "startLine": 2594,
        "startChar": 64,
        "endLine": 2594,
        "endChar": 91
      },
      "revId": "dae4ddcc7fb6c584b0520000b249bb74ff491192",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b36fd194_bb429639",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 1
      },
      "lineNbr": 2594,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-04-06T07:08:31Z",
      "side": 0,
      "message": "I will rework this, but could you, please, point me to the endpoint for \u0027log of actions\u0027 that is used by the fronted? The original voter is still available in NoteDb, and should be constructed from there, if needed. It looked to me like the commit message is redundant in NoteDB for all the operations I am modifying in this chain.",
      "parentUuid": "cbde78f7_5ad99b0e",
      "range": {
        "startLine": 2594,
        "startChar": 64,
        "endLine": 2594,
        "endChar": 91
      },
      "revId": "dae4ddcc7fb6c584b0520000b249bb74ff491192",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c7321b7_83fbbe4d",
        "filename": "javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java",
        "patchSetId": 1
      },
      "lineNbr": 2594,
      "author": {
        "id": 1118500
      },
      "writtenOn": "2021-04-06T07:29:13Z",
      "side": 0,
      "message": "Just to be clear, what I mean is, commit created in NoteDb has the following format:\nAuthor: Gerrit User ACCOUNT_ID_OF_COMMITER \u003c\u003e\nDate:   Wed Dec 2 06:32:58 2020 +0000\n\n    Update patch set 4\n    \n    Removed Code-Review-1 by REAL_NAME_OF_REVIEWER \u003cREAL_EMAIL_OF_REVIEWER\u003e\n    \n    \n    Patch-set: 4\n    Tag: autogenerated:gerrit:deleteVote\n    Label: -Code-Review Gerrit User ACCOUNT_ID_OF_REVIEWER \u003c\u003e\n\n\nSo I think that the information in commit message is redundant,so unless frontend uses it in any meaningful way, I don\u0027t see any problem cutting it/removing it completely.",
      "parentUuid": "b36fd194_bb429639",
      "range": {
        "startLine": 2594,
        "startChar": 64,
        "endLine": 2594,
        "endChar": 91
      },
      "revId": "dae4ddcc7fb6c584b0520000b249bb74ff491192",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}