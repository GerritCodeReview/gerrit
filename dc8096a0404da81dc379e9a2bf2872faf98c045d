{
  "comments": [
    {
      "key": {
        "uuid": "5e14046a_271d2ef5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 22,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-07-24T22:09:11Z",
      "side": 1,
      "message": "This explanation is mentioned as an afterthought after the previous paragraph. I am not sure it is obvious that this problem should only happen in normal installations on the master on startup (I think that is what you are implying?) To make it more obvious what use case you are trying to improve I think that you want to start line 14 with something like \"Prior to this commit, on servers where an update does not originate (on other masters or slaves) and on server startup, the cache loader would...\"",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aaf62e6d_c0b58ce9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 22,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-25T13:58:08Z",
      "side": 1,
      "message": "Will update tomorrow",
      "parentUuid": "5e14046a_271d2ef5",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ec94dea1_cbbd2ba6",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 4
      },
      "lineNbr": 135,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-07-24T22:09:11Z",
      "side": 1,
      "message": "If I understand correctly, this history traversal is because we don\u0027t know what our own cached version is? It seems like we should be able to fix this somehow with a lot less code and less expense. Could we:\n\n1) store the sha1 of latest version somewhere\n2) only store one value cached value with an bogus key (\"latest\")\n3) grab any of the stored values and assume that it will be good enough for a diff since we are expiring them pretty quickly\n4) grab all the values and check which is the latest?",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b65343bf_78a04a0a",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 4
      },
      "lineNbr": 135,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2019-07-25T11:38:22Z",
      "side": 1,
      "message": "the traversal here only takes 20 lines of code. I\u0027m skeptical that you can do your 4 steps in less than that.",
      "parentUuid": "ec94dea1_cbbd2ba6",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0ba27a6_657baeee",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 4
      },
      "lineNbr": 135,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-25T13:58:08Z",
      "side": 1,
      "message": "Asking the cache about what it has (e.g. through #asMap) relies on how it\u0027s configured. If the size is \u003e 1 we\u0027d get two entries and then have to figure out which version is the more current one (your #1) that would require extra logic for storing that. I like the loader approach because it\u0027s simple and follows common patterns (just a LoadingCache with not much extras on the side).\n\nThis is also about what is most probable: In the most likely case, we have the n-1 version cached, so the RevWalk isn\u0027t really performing a RevWalk, it\u0027s just parsing the current commit which is has to do anyway and parsing the parent (which it also has to do anyway), so essentially it\u0027s free :-)",
      "parentUuid": "b65343bf_78a04a0a",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee95e4a_f4fc810c",
        "filename": "javatests/com/google/gerrit/server/account/externalids/ExternalIDCacheLoaderTest.java",
        "patchSetId": 4
      },
      "lineNbr": 133,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2019-07-25T11:38:22Z",
      "side": 1,
      "message": "should you have a test that creates 15 updates, so we have coverage for the code path where you can\u0027t find the thing?",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e5cd7ec_17a47e05",
        "filename": "javatests/com/google/gerrit/server/account/externalids/ExternalIDCacheLoaderTest.java",
        "patchSetId": 4
      },
      "lineNbr": 133,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-25T13:58:08Z",
      "side": 1,
      "message": "This is already there: fallsBackToFullReloadOnManyUpdatesOnBranch\n\nI can add another test where we don\u0027t use the barrier (say 5 updates) but just don\u0027t have an old state cached.",
      "parentUuid": "0ee95e4a_f4fc810c",
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db4802d4_7e5abde0",
        "filename": "javatests/com/google/gerrit/server/account/externalids/ExternalIDCacheLoaderTest.java",
        "patchSetId": 4
      },
      "lineNbr": 181,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2019-07-25T11:38:22Z",
      "side": 1,
      "message": "insert",
      "range": {
        "startLine": 181,
        "startChar": 24,
        "endLine": 181,
        "endChar": 40
      },
      "revId": "dc8096a0404da81dc379e9a2bf2872faf98c045d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}