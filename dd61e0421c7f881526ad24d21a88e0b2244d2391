{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "728e7989_ecbb4f40",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-10-12T19:03:25Z",
      "side": 1,
      "message": "w00t???? If you really have 25M records in account_patch_reviews you should just do some cleanup *before* even starting the migration process.\n\naccount_patch_reviews is a table that contains a reference to the files that have been reviewed for open changes.\n\nWould it be instead more meaningful to write a simple clean-up script?\nJust remove all rows associated with:\n- abandoned changes\n- merged changes\n\nWDYT?",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "60632b36_5a504f55",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-10-13T16:27:51Z",
      "side": 1,
      "message": "Our goal is complete data migration with no loss due to upgrade. account_patch_reviews is not limited to open changes, thus it\u0027s very reasonable to have millions of records. Records are only removed when changes are deleted, the consistency checker is run for a change, or if the API is purposefully used to clear records.",
      "parentUuid": "728e7989_ecbb4f40",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09b1d573_9ca75f80",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-10-13T20:50:14Z",
      "side": 1,
      "message": "\u003e Our goal is complete data migration with no loss due to upgrade. \n\nTrue, but account_patch_reviews is storing a \"user-specific\" session data about the change under review, it isn\u0027t really associated with the data consistency of the change.\n\n\u003e account_patch_reviews is not limited to open changes,\n\nFrom Gerrit 3.0, you can remove all account_patch_reviews records for abandoned changes (Ie7ac0a6c70284).",
      "parentUuid": "60632b36_5a504f55",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "23df0028_ceba2018",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-10-13T21:21:55Z",
      "side": 1,
      "message": "\u003e \u003e account_patch_reviews is not limited to open changes,\n\u003e \n\u003e From Gerrit 3.0, you can remove all account_patch_reviews records for abandoned changes (Ie7ac0a6c70284).\n\nGood to know. We do have a lot of abandoned changes and we would be likely to use the auto-abandon feature when we upgrade, so perhaps pruning those ahead of time would be reasonable. Not sure how many of the 25M that makes up though.",
      "parentUuid": "09b1d573_9ca75f80",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cd779c8e_d6c964d9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-10-13T23:20:24Z",
      "side": 1,
      "message": "I believe it should be fairly easy to check that with a query.\n\nP.S. I am a bit surprised you guys don\u0027t have issues with 25M rows on that table ðŸ˜® My worry is that moving that giant table forward could introduce other problems in more recent versions of Gerrit. I recall Hugo mentioning big issues with just 1M of records on it.",
      "parentUuid": "23df0028_ceba2018",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e4d06ebf_8a6e5042",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-10-14T04:32:13Z",
      "side": 1,
      "message": "FYI, looks like reviewed flags on abandoned changes make up about 5.6M of those rows. Also, our latest data is up to 27.4M rows, so while that 5.6M is significant, there\u0027s still a lot of data in there. Obviously we plan to keep this in postgres and not h2 ðŸ˜Š\n\nI do wonder what Hugo\u0027s setup was that they saw issues with only 1M records. Do you have a reference for those issues? I\u0027d be good to know what to test to see if we have problems too.",
      "parentUuid": "cd779c8e_d6c964d9",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9268498c_fc0de08c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-10-19T22:34:01Z",
      "side": 1,
      "message": "I don\u0027t believe he raised an *actual* Monorail issue but he rather discussed in one of the hackathons. It was the time where we were about to decide where to put that data.\n\nWhen we all agreed to put the data on H2, then he implemented the option to keep on PostgreSQL because it was just too much for H2.\n\nIf I were you, I would prepare the conversion of that table \"off-line\" because I reckon 99% of the remaining 27.4M-5.6M are associated with closed changes and therefore aren\u0027t moving.",
      "parentUuid": "e4d06ebf_8a6e5042",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d9bfb25_01eb8e69",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-10-21T15:21:35Z",
      "side": 1,
      "message": "We\u0027ll keep that in mind if this seems like it will end up the long pole, thanks. In general, we\u0027re trying to keep steps to the bare minimum other than things we can completely do in production now (like add columns to the changes table!). For those steps like that where we can do them early we\u0027re going to update the 2.16 release notes to note for others the possible optimization.\n\nI think you still have a -1 on this, did you have a concern with the code or approach?\n\nWe\u0027re doing testing with h2 and postgres to ensure there\u0027s a reasonable default and we\u0027ll update this change with that data once it\u0027s ready.",
      "parentUuid": "9268498c_fc0de08c",
      "range": {
        "startLine": 11,
        "startChar": 5,
        "endLine": 11,
        "endChar": 42
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "843c9fe5_c6014e2f",
        "filename": "java/com/google/gerrit/server/schema/Schema_127.java",
        "patchSetId": 2
      },
      "lineNbr": 80,
      "author": {
        "id": 1105741
      },
      "writtenOn": "2021-10-10T20:58:24Z",
      "side": 1,
      "message": "wait for pool to complete ?",
      "range": {
        "startLine": 80,
        "startChar": 20,
        "endLine": 80,
        "endChar": 24
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5390bc47_e9cb176e",
        "filename": "java/com/google/gerrit/server/schema/Schema_127.java",
        "patchSetId": 2
      },
      "lineNbr": 80,
      "author": {
        "id": 1012457
      },
      "writtenOn": "2021-10-24T03:33:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "843c9fe5_c6014e2f",
      "range": {
        "startLine": 80,
        "startChar": 20,
        "endLine": 80,
        "endChar": 24
      },
      "revId": "dd61e0421c7f881526ad24d21a88e0b2244d2391",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}