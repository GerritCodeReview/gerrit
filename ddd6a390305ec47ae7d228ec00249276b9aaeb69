{
  "comments": [
    {
      "key": {
        "uuid": "4976fe72_28efdc29",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 22,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2018-12-22T06:55:25Z",
      "side": 1,
      "message": "This comment was only applicable on stable-2.16, but not on master any more, because the GWT UI was removed here.",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 22,
        "endChar": 69
      },
      "revId": "ddd6a390305ec47ae7d228ec00249276b9aaeb69",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a6f48a2_66c5fe49",
        "filename": "java/com/google/gerrit/index/FieldDef.java",
        "patchSetId": 7
      },
      "lineNbr": 39,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-12-24T08:45:43Z",
      "side": 1,
      "message": "Why do we need this field type now only for the project index?\nHow is sorting done for the other indexes that don\u0027t use this field type?",
      "range": {
        "startLine": 37,
        "startChar": 2,
        "endLine": 39,
        "endChar": 3
      },
      "revId": "ddd6a390305ec47ae7d228ec00249276b9aaeb69",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "94e522a4_80d3d0c8",
        "filename": "java/com/google/gerrit/index/FieldDef.java",
        "patchSetId": 7
      },
      "lineNbr": 39,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-12-24T09:00:41Z",
      "side": 1,
      "message": "I think the Lucene project index should already handle sorting in its getSource method [1]. The question is why this is not working for the project index while this approach works for the other indexes?\n\n[1] https://gerrit.googlesource.com/gerrit/+/master/java/com/google/gerrit/lucene/LuceneProjectIndex.java#114",
      "parentUuid": "6a6f48a2_66c5fe49",
      "range": {
        "startLine": 37,
        "startChar": 2,
        "endLine": 39,
        "endChar": 3
      },
      "revId": "ddd6a390305ec47ae7d228ec00249276b9aaeb69",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a4d9cf5_663aacff",
        "filename": "java/com/google/gerrit/index/FieldDef.java",
        "patchSetId": 7
      },
      "lineNbr": 39,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2018-12-24T09:22:20Z",
      "side": 1,
      "message": "I think the answer is that project index, group index and account index are broken from the beginning regarding sorting. It wasn\u0027t discovered until today, because the sorting columns are technical kind (uuid and account_id):\n\n* accounts: ID_SORT_FIELD \u003d sortFieldName(ID);\n* groups: UUID_SORT_FIELD \u003d sortFieldName(UUID);\n\nIn fact the sorting only works for changes. I see, that the sort fields are added explicitly here: [1]:\n\n  @Override\n  void add(Document doc, Values\u003cChangeData\u003e values) {\n    // Add separate DocValues fields for those fields needed for sorting.\n    FieldDef\u003cChangeData, ?\u003e f \u003d values.getField();\n    if (f \u003d\u003d ChangeField.LEGACY_ID) {\n      int v \u003d (Integer) getOnlyElement(values.getValues());\n      doc.add(new NumericDocValuesField(ID_SORT_FIELD, v));\n    } else if (f \u003d\u003d ChangeField.UPDATED) {\n      long t \u003d ((Timestamp) getOnlyElement(values.getValues())).getTime();\n      doc.add(new NumericDocValuesField(UPDATED_SORT_FIELD, t));\n    }\n  [...]\n\nI don\u0027t find this logic for other indexes.\n\n* [1] https://github.com/GerritCodeReview/gerrit/blob/master/java/com/google/gerrit/lucene/ChangeSubIndex.java#L97-L105",
      "parentUuid": "94e522a4_80d3d0c8",
      "range": {
        "startLine": 37,
        "startChar": 2,
        "endLine": 39,
        "endChar": 3
      },
      "revId": "ddd6a390305ec47ae7d228ec00249276b9aaeb69",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed357bde_eb73b77f",
        "filename": "java/com/google/gerrit/index/project/ProjectField.java",
        "patchSetId": 7
      },
      "lineNbr": 38,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2018-12-22T08:07:08Z",
      "side": 1,
      "message": "The same comment as in previous patch set: you need to bump project index schema definition.",
      "range": {
        "startLine": 38,
        "startChar": 6,
        "endLine": 38,
        "endChar": 25
      },
      "revId": "ddd6a390305ec47ae7d228ec00249276b9aaeb69",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}