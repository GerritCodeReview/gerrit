{
  "comments": [
    {
      "key": {
        "uuid": "b46ffaaa_f4dd7810",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-08-05T14:17:58Z",
      "side": 1,
      "message": "Seems like this will trigger writing even on a HEAD request. Have you checked whether the body is empty when you issue a HEAD?",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f925eba0_369fd84a",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-05T14:39:39Z",
      "side": 1,
      "message": "That\u0027s what I was trying to test with this line:\n\n assertThat(response.hasContent()).isFalse();\n\nbut I\u0027m not sure if that\u0027s actually doing what I expect.\n\nI\u0027ve also tested from the command line with the results as seen here:\n\nhttp://paste.openstack.org/show/550612/\n\nthat\u0027s using curl with the `-IL` option.  The request was getting stuck at the initial 401 redirect when I tried with `-X HEAD`.",
      "parentUuid": "b46ffaaa_f4dd7810",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f43ed29a_6ee1afc4",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-08-05T15:03:02Z",
      "side": 1,
      "message": "My concern is that even if it appears to work as written, that might be because the servlet container is truncating the body even when the calling code attempts to write to the response. Then that behavior might be container-dependent, even if it works in tests.",
      "parentUuid": "f925eba0_369fd84a",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f925eba0_16a4dca0",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-05T15:52:59Z",
      "side": 1,
      "message": "Other than having a separate handler method for HEAD, as I was doing in the previous attempt, I don\u0027t see any other way to solve this.  There doesn\u0027t seem to be any way to get the request method in the GetContent implementation.",
      "parentUuid": "f43ed29a_6ee1afc4",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f43ed29a_0e2d8bfc",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-08-05T16:04:49Z",
      "side": 1,
      "message": "No, I mean, reply{BinaryResult,Json} should either not be called or should not call any write() methods when the request method is HEAD. You can return the full result from the handler but don\u0027t attempt to write anything to the body of the HttpServletResponse.",
      "parentUuid": "f925eba0_16a4dca0",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f925eba0_b6b2c8df",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-05T16:08:07Z",
      "side": 1,
      "message": "Ah.  In the meantime I\u0027ve restored what was in the earlier version and fixed it up so it actually works now.",
      "parentUuid": "f43ed29a_0e2d8bfc",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b46ffaaa_d4ef9cb5",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2016-08-05T16:33:45Z",
      "side": 1,
      "message": "We must be miscommunicating, I don\u0027t see why you did that.\n\nThe implementation you had a few minutes ago was the right approach. It was just calling write where it shouldn\u0027t have. You just needed to guard the calls to write in this file with \"GET\".equals(req.getMethod()).",
      "parentUuid": "f925eba0_b6b2c8df",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f925eba0_76ce7062",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 347,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-05T23:58:10Z",
      "side": 1,
      "message": "We can\u0027t add the guard here; that also prevents the Content-Type from being sent.\n\nIt turns out there\u0027s already a check at the appropriate place.\n\nSee the comment at line 768.",
      "parentUuid": "b46ffaaa_d4ef9cb5",
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "190d5f2c_17a4d4a0",
        "filename": "gerrit-httpd/src/main/java/com/google/gerrit/httpd/restapi/RestApiServlet.java",
        "patchSetId": 2
      },
      "lineNbr": 772,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2016-08-05T23:58:10Z",
      "side": 1,
      "message": "Writing the response is already guarded here.",
      "range": {
        "startLine": 768,
        "startChar": 6,
        "endLine": 772,
        "endChar": 7
      },
      "revId": "df8298b758f386878f6e32eb139812b936252306",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}