{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "f78ff99e_5bb66923",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 2
      },
      "lineNbr": 346,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-09-16T21:19:22Z",
      "side": 1,
      "message": "nit: Lucene",
      "range": {
        "startLine": 346,
        "startChar": 37,
        "endLine": 346,
        "endChar": 38
      },
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b82112a5_5dc4bf39",
        "filename": "Documentation/user-search.txt",
        "patchSetId": 2
      },
      "lineNbr": 346,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-09-19T07:15:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f78ff99e_5bb66923",
      "range": {
        "startLine": 346,
        "startChar": 37,
        "endLine": 346,
        "endChar": 38
      },
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "03ccfd50_2669f469",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-09-16T21:19:22Z",
      "side": 1,
      "message": "This doesn\u0027t make sense to me (both as an idea and the grammar). I think it\u0027s saying that if Lucene changed their max term length and we used this constant, it would affect us. But if Lucene changed, wouldn\u0027t we also want to change ours?\n\nAdditionally, this should probably come from a config (that each index backend can provide a default for) since it\u0027s probably an index backend specific value?",
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "593ee840_cd072191",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-09-19T07:15:54Z",
      "side": 1,
      "message": "Sorry for the bad grammar. Should have checked the comment more closely myself.\n\nI saw David\u0027s comment here: https://gerrit-review.googlesource.com/c/gerrit/+/328636. He just states that we should not rely on the value provided by Lucene without giving a reason. My own reasoning was that we would like to have closer control on the indexed data ourselves. Maybe @david.ostrovsky@gmail.com could comment on why we should redefine the constant?\n\nMaking it configurable would be nice. I guess however that this would require major changes, since all values in the field are constants. The only reasonable way of doing that would be Guice providing multiple versions of the ChangeField class dependent on the configured index type. Not sure whether we should do that in a stable branch, especially since Lucene is currently the only officially supported index, that Elasticsearch is also based on Lucene and thus likely has the same limitation and that this truncation would only be a small inconvenience for people using an index supporting larger value sizes.",
      "parentUuid": "03ccfd50_2669f469",
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "29f6a184_0a520dfe",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-09-28T14:33:47Z",
      "side": 1,
      "message": "\u003e Sorry for the bad grammar. Should have checked the comment more closely myself.\n\nNo worries.\n\n\u003e \n\u003e I saw David\u0027s comment here: https://gerrit-review.googlesource.com/c/gerrit/+/328636. He just states that we should not rely on the value provided by Lucene without giving a reason. My own reasoning was that we would like to have closer control on the indexed data ourselves. Maybe @david.ostrovsky@gmail.com could comment on why we should redefine the constant?\n\nI wonder if it was just because this is in the generic index code and not Lucene-specific and David didn\u0027t want to introduce a Lucene compilation dependency here (though maybe we already have one?). I would accept that as the reasoning in the comment if you want to update it.\n\n\u003e \n\u003e Making it configurable would be nice. I guess however that this would require major changes, since all values in the field are constants. The only reasonable way of doing that would be Guice providing multiple versions of the ChangeField class dependent on the configured index type. Not sure whether we should do that in a stable branch, especially since Lucene is currently the only officially supported index, that Elasticsearch is also based on Lucene and thus likely has the same limitation and that this truncation would only be a small inconvenience for people using an index supporting larger value sizes.\n\nES does have the same limitation and I do agree it would take more significant changes to make this fully configurable, likely for little value. If you can include some of this reasoning in the commit message, that would help.",
      "parentUuid": "593ee840_cd072191",
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c7c5ed9_b1c37e4c",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 882,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2022-09-16T11:14:37Z",
      "side": 1,
      "message": "Is this enough to solve the problem or could there be a corner-case we are missing? \nI ask because we created a change internally that do the same thing as this, we ran the indexing and it worked for all changes expect one. \nFor that change it complained that it was 1 byte too long. Maybe one extra byte is appended later before it arrives to Lucene?",
      "range": {
        "startLine": 882,
        "startChar": 6,
        "endLine": 882,
        "endChar": 99
      },
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc8904ac_be1249c1",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 882,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-09-19T07:15:54Z",
      "side": 1,
      "message": "I haven\u0027t seen that happen in my tests yet, but I will also try to reindex all of the changes that failed for us and see whether I observe something similar.\n\nI guess however this happens, if the commit message String contains a multibyte character, since the limit given by Lucene is based on bytes. Let me fix this.",
      "parentUuid": "3c7c5ed9_b1c37e4c",
      "range": {
        "startLine": 882,
        "startChar": 6,
        "endLine": 882,
        "endChar": 99
      },
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ec30d01_86dcf222",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 882,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-09-19T07:28:15Z",
      "side": 1,
      "message": "Done.\n\n@david.akerman@axis.com Would you be able to test this change on the change that failed to reindex for you?",
      "parentUuid": "bc8904ac_be1249c1",
      "range": {
        "startLine": 882,
        "startChar": 6,
        "endLine": 882,
        "endChar": 99
      },
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d95398e7_72cd891b",
        "filename": "java/com/google/gerrit/server/index/change/ChangeField.java",
        "patchSetId": 2
      },
      "lineNbr": 882,
      "author": {
        "id": 1135623
      },
      "writtenOn": "2022-09-20T13:54:24Z",
      "side": 1,
      "message": "That solved it. Now all our repos are reindexed. Thanks!",
      "parentUuid": "9ec30d01_86dcf222",
      "range": {
        "startLine": 882,
        "startChar": 6,
        "endLine": 882,
        "endChar": 99
      },
      "revId": "dfe93f2e72d08a9c5d99e4256e1a7a06a887826f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}