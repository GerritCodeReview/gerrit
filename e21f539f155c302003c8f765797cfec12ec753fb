{
  "pushCert": "certificate version 0.1\npusher A0D0EF51 1516876879 +0100\nnonce AGjzz38Py+frMTc6DsujNwrMsrF3zgf8iuTPNIZRR12KvtSjsPdAo8UozgwpgJ2Th2qNgBlHBXYf\n\n0000000000000000000000000000000000000000 e21f539f155c302003c8f765797cfec12ec753fb refs/for/master\n-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEjcOJ9ZBmQPrFqZA3UbX9l6DQ71EFAlpptFAACgkQUbX9l6DQ\n71Eyfwf8C/FJwha8vGYFB2sm8HRJV/2pykvEuCEwXvF3dAto3hWbmLr1tCJU5ZvH\nKChDOXXT4kCChghb5fbyJbRV1L6YIPGMf05bJp37wm8zW48TiaJaTjATumRv8K66\nzoZanIajC/xTtaaqt25ia9JB74Me9JMYbbkYtyXAvAVZAKdMmN0MmoxOM6FsQ0mc\nDVxHGtGPv7kDhOnEcp+EDS6n37lwpSe8c4MYmHHS8PE8k1MI2UI34JuTzaCPGGUx\nx0hZkGAkvQJvyXd2qEDmGcF3xvut3Ll3I0T3lzfuvucrAmMkYf3kkbnVIDZp8HE8\nSP3lmg/KDfKZascnh9Yznm9Gzh1s3g\u003d\u003d\n\u003dI/Dl\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "202c10aa_49970004",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 1380,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T13:59:08Z",
      "side": 1,
      "message": "patch set",
      "range": {
        "startLine": 1380,
        "startChar": 24,
        "endLine": 1380,
        "endChar": 30
      },
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e43a72dc_e66005c4",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 1380,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-12T16:00:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "202c10aa_49970004",
      "range": {
        "startLine": 1380,
        "startChar": 24,
        "endLine": 1380,
        "endChar": 30
      },
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3206fc5b_40798ddd",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 1384,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T13:59:08Z",
      "side": 1,
      "message": "or if the branch is updated behind Gerrit\u0027s back?",
      "range": {
        "startLine": 1384,
        "startChar": 16,
        "endLine": 1384,
        "endChar": 59
      },
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "67422759_8a5df5cc",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 1384,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-12T16:00:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3206fc5b_40798ddd",
      "range": {
        "startLine": 1384,
        "startChar": 16,
        "endLine": 1384,
        "endChar": 59
      },
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd45bbc7_0b918e78",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 1443,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T14:02:58Z",
      "side": 1,
      "message": "I think the response to the request above with fix\u003dtrue will also include \"problems\"?",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8d095a9_f4011cf7",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 1443,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-12T16:00:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bd45bbc7_0b918e78",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "55760e80_cebbb9fa",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 2868,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T13:59:08Z",
      "side": 1,
      "message": "In the case where fix is true, ISTM it would be more accurate to describe these as \"closed\" rather than \"closeable\". Not a big deal though.\n\nIn the case of checking changes, we also use a ProblemInfo to indicate whether the fix was successful or not; how do you indicate that with this endpoint? Looking at the code, I think the answer is the \"problems\" field of the resulting ChangeInfo will be populated. Possibly worth mentioning explicitly.",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9cbea0b8_07abe580",
        "filename": "Documentation/rest-api-projects.txt",
        "patchSetId": 6
      },
      "lineNbr": 2868,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-12T16:00:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "55760e80_cebbb9fa",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2ba2f131_2d01b2ba",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 96,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T13:59:08Z",
      "side": 1,
      "message": "branch \u003d RefNames.fullName(branch)\n\nThough arguably you could also skip this and do repo.findRef instead (although the semantics are slightly different than fullName)",
      "range": {
        "startLine": 94,
        "startChar": 8,
        "endLine": 96,
        "endChar": 9
      },
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f3f17b72_483b69cb",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 96,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-12T16:00:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2ba2f131_2d01b2ba",
      "range": {
        "startLine": 94,
        "startChar": 8,
        "endLine": 96,
        "endChar": 9
      },
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d3ac928c_a0f77ef6",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T13:59:08Z",
      "side": 1,
      "message": "This is too many sequential queries. At the very least, these need to be batched up to the limit supported by the index backend. But even so, if we can use a batch size of 100 and there are 500k commits in the history of the repo, that\u0027s 5k sequential queries, which is still a lot. I am thinking we need to provide some way to limit the search, perhaps by providing a maximum age or an earliest date.",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d1002d2_848fc451",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-12T16:00:49Z",
      "side": 1,
      "message": "\u003e This is too many sequential queries. At the very least, these need to be batched up to the\n\u003e limit supported by the index backend. \n\nYeah, I was aware of this. Just didn\u0027t want to implement batching before agreeing that we want this REST endpoint.\n\nDone with a hard-coded limit. How can I know the max number of queries that the index backend can execute at once?\n\n\u003e But even so, if we can use a batch size of 100 and there are 500k commits in the history\n\u003e of the repo, that\u0027s 5k sequential queries, which is still a lot. I am thinking we need to\n\u003e provide some way to limit the search, perhaps by providing a maximum age or an earliest \n\u003e date.\n\nStill need to implement this, but in the meantime I would appreciate feedback on the batching.",
      "parentUuid": "d3ac928c_a0f77ef6",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cef39741_811da2ee",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-02-12T16:16:29Z",
      "side": 1,
      "message": "\u003e Done with a hard-coded limit. How can I know the max number of\n \u003e queries that the index backend can execute at once?\n \u003e \n\n\nindex.maxLimit in gerrit.config but you cannot just use this parameter as it is configured to no limit per default.\n\nI think you want to define you own limit (e.g 1000) and use the min value of you own limit and \nindex.maxLimit",
      "parentUuid": "8d1002d2_848fc451",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ae7e70a_a958102e",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-12T16:33:42Z",
      "side": 1,
      "message": "\u003e How can I know the max number of queries that the index backend can execute at once?\n\nIt\u0027s not the max number of queries, it\u0027s the max number of terms per query. This is IndexConfig#maxTerms. You need to remember to subtract out any constant terms.\n\nCan you follow the approach of InternalChangeQuery#byProjectGroups? I think that should even work lazily, if you use the RevWalk as an iterable, and it\u0027s much less code.",
      "parentUuid": "cef39741_811da2ee",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "676a6111_b84d70f6",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-12T16:34:31Z",
      "side": 1,
      "message": "\u003e Just didn\u0027t want to implement batching before agreeing that we want this REST endpoint.\n\nAgreed, we want this :)",
      "parentUuid": "7ae7e70a_a958102e",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6288cbc8_42269968",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-13T10:02:33Z",
      "side": 1,
      "message": "\u003e Can you follow the approach of InternalChangeQuery#byProjectGroups?\n\u003e I think that should even work lazily, if you use the RevWalk as an iterable,\n\u003e and it\u0027s much less code.\n\nI looked at this code, but don\u0027t see how this can help me to simplify this code.\n\nThe problem is that from the query result we must be able to map back to the query that produced this result:\n\n- For a commit we create a change query, this change query contains a predicate with the commit ID or the Change-Id from the commit message.\n- Let\u0027s say this query returns change X.\n- To report the problem for change X (or to autoclose it) we need to pass the commit that merged it to ChangeJson. Just knowing the changes that should have been autoclosed is not enough, we also need to know which commit merged which change.",
      "parentUuid": "676a6111_b84d70f6",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a18cdf9_2e3a93ec",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-13T10:11:26Z",
      "side": 1,
      "message": "\u003e It\u0027s not the max number of queries, it\u0027s the max number of terms per query.\n\u003e This is IndexConfig#maxTerms. You need to remember to subtract out any constant terms.\n\nI\u0027m confused. We cannot have one query with lots of OR-conditions because then we cannot map back from the result to the query, e.g. know which change was found for which commit. What I\u0027m trying to do is to send multiple queries at once to the index backend. At least QueryProcessor#query allows me to pass a list of queries.",
      "parentUuid": "6288cbc8_42269968",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed0681fa_35d8cd19",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 111,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-06-13T15:14:11Z",
      "side": 1,
      "message": "\u003e I\u0027m confused. We cannot have one query with lots of OR-conditions because then we cannot map back from the result to the query, e.g. know which change was found for which commit.\n\nSure you can, just request the PATCH_SET field",
      "parentUuid": "7a18cdf9_2e3a93ec",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f900ef5_0e533979",
        "filename": "java/com/google/gerrit/server/project/ProjectsConsistencyChecker.java",
        "patchSetId": 6
      },
      "lineNbr": 160,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-02-07T13:59:08Z",
      "side": 1,
      "message": "query.run(queryProvider.get()).stream().findFirst() (but this code will go away if we switch to batching).",
      "revId": "e21f539f155c302003c8f765797cfec12ec753fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}