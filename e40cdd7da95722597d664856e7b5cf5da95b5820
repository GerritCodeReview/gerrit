{
  "comments": [
    {
      "key": {
        "uuid": "96a5341c_6a1f431e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-02-06T01:55:41Z",
      "side": 1,
      "message": "This will allow to simplify setting up a slave cluster, thanks for working on this.\n\nCurrently, we need to setup something on the side to receive replication such as git daemon with ssh tunnel or apache server with git smart http. We will be able to get rid of extra component and make use of the same Gerrit process for handling user traffic as well as replication from master.",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 63
      },
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8b50821c_f4af364d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-02-06T01:55:41Z",
      "side": 1,
      "message": "FYI: Because slaves are read only, some people (including us) setup slaves as a cluster, i.e. multiple Gerrit processes (sharing repos and database) behind a load balancer.\n\nIf we need secondary index on slaves, anyone having such a setup will also require to use ElasticSearch(which is not yet fully supported in Gerrit) as the secondary index implementation on slaves in order to have a sharable index for the cluster.",
      "range": {
        "startLine": 14,
        "startChar": 32,
        "endLine": 16,
        "endChar": 36
      },
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "afafab55_eb0090a2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-06T13:59:24Z",
      "side": 1,
      "message": "It would be good if you can help with resolving this. We want to finish the groups to NoteDb migration and then having groups in NoteDb will be mandatory. This means slaves then need a group index, e.g. to lookup the groups of a user for permission evaluation.\n\nThis is why we are working on:\n\n- enabling the group index in slaves\n- allowing replication to push through Gerrit so that the Gerrit slave can keep the index up-to-date\n\nSince at Google we are not using slaves any help with testing slaves that have a group index enabled is more than welcome. I\u0027m afraid that we don\u0027t have enough resources to make sure that everything keeps working with such a slave cluster setup. Can you help with this?",
      "parentUuid": "8b50821c_f4af364d",
      "range": {
        "startLine": 14,
        "startChar": 32,
        "endLine": 16,
        "endChar": 36
      },
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af56db03_3e881f69",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-02-06T14:23:45Z",
      "side": 1,
      "message": "Sure, I was not trying to get a free ride, I just wanted to bring awareness :)\n\nWe already worked on ElasticSearch and planned to resume the work because we want it for our master cluster. Now, with slaves that will require index, we have one more reason to resume the work.\n\nI will also review and test the changes you guys do.",
      "parentUuid": "afafab55_eb0090a2",
      "range": {
        "startLine": 14,
        "startChar": 32,
        "endLine": 16,
        "endChar": 36
      },
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "029b33c1_98ca42d7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-06T14:33:27Z",
      "side": 1,
      "message": "Sounds great, thanks!\nWe are definitely thankful for any input you can provide. And yes, we were not aware of this, so it\u0027s good to know :)",
      "parentUuid": "af56db03_3e881f69",
      "range": {
        "startLine": 14,
        "startChar": 32,
        "endLine": 16,
        "endChar": 36
      },
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a8c65cb6_d674f81b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 25,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-02-06T01:55:41Z",
      "side": 1,
      "message": "FWIW:\n\nI do not think any setup that needs to scale is using replication over ssh as the performance is not as good as http or git protocol.\n\nOn our side we use Apache with git smart http so migrating to replicate directly to Gerrit using http will be easy.\n\nAnother option that we used in the past that would no longer be supported, if replicating through Gerrit becomes mandatory, is replication using git protocol inside an ssh tunnel.",
      "range": {
        "startLine": 24,
        "startChar": 52,
        "endLine": 25,
        "endChar": 40
      },
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8326045e_f1a42179",
        "filename": "java/com/google/gerrit/server/git/validators/ReplicationUserVerifier.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-02-06T08:06:58Z",
      "side": 1,
      "message": "If this is a problem we don\u0027t need to support all account identifiers as replication user in the gerrit config.  I think it would be okay to just do the simplest possible thing, e.g. just support the account ID.",
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce03a625_f99118ce",
        "filename": "java/com/google/gerrit/server/git/validators/ReplicationUserVerifier.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2018-02-06T11:19:18Z",
      "side": 1,
      "message": "I agree that we should keep it simple for now. We can always refine it later on. (I thought about just comparing the configured string with the ID, name, user name, and email but then we have to be careful not to allow identifiers which might not be unique. That\u0027s why I went with only the account ID as you suggested in the next patch set.)",
      "parentUuid": "8326045e_f1a42179",
      "revId": "e40cdd7da95722597d664856e7b5cf5da95b5820",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}