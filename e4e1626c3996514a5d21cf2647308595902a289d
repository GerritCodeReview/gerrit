{
  "pushCert": "certificate version 0.1\npusher Dave Borowitz \u003cdborowitz@google.com\u003e 1502383431 -0400\nnonce AHIDc+PNY+ObHncAmQJaxJ8i2NJjR7Rm8Bn6fwE8U+zyaR3yUMEJ8PnyYIOzq2u0Uvaxf+UT9YtA\n\n0000000000000000000000000000000000000000 d5d032be3f5f4662bbae4e2805f08fe486f4cb33 refs/for/master\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJZjI1HAAoJEF/XxZqaEoiMVdcQAKqNJLBxrOrlqDMxs6qi81hx\n8g6e7+p5i3yWbL9HtZplrY4JBIqyyqs0g5vAGxXN62TJ2Wv5HWP3bcUbNR7W5brH\nMJwiBrrRwo/X1jXE1qjyaXeZNtQbWfVcOOrDKCZXrYkTRqc9RPNpyxZaPiFXvvC3\nLXKVUOHEIpu05aXkZIiABtcArlQgh6GOl2V1eZC8DQ98hWqG2Vebq3200E3DxXK3\n+nWfp7gVIVK4rhtnKq9iE09yLsUiH71hctne90cj3uYs/3BYHoNvQhuHqGL9fivR\nNMzlcflpMJoSJP5YN5vtrW7+Ulj11/1Q5HkU87dycdGnTafe5yUd6C0jAcsnsRyO\nopvTXdJ6lBJbtjb7OOxDIN/tGL4JOaFlPwdLXxrNhfpaAiDJvc+ZHhZ1w6fJ6l1l\nhRgnNKWn29DDQzDW0yuZ3eY/Bo8PXt1+4+Uifs4ollExxSzaf429DlN0rBjlwcdB\n1qeW20igCMgaYq2fM5MrsrFqM4i6sp/b1TLNmgWzaDqULJd4M7tvNcJ1Incq+BqJ\nGyy5NtF3kj6fbz/RheMkpRfcFvEd1OAS0MSS1EYyS4s46Akn1nIWG0nhfyTV+DP0\n9vLuDMKIgmvxprN9KhuHnoJRRko/G8EXaHjmdAacNYfKIEM2AglYOJX8Qxplcj1H\ndKy56aS3dfdnumZsNFB4\n\u003dqwyv\n-----END PGP SIGNATURE-----\n",
  "comments": [
    {
      "key": {
        "uuid": "6ae35629_7202ccfa",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-08-11T14:03:14Z",
      "side": 1,
      "message": "InternalQuery#query calls QueryProcessor#query without checking for this. Is that wrong?",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 19,
        "endChar": 63
      },
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ba7c0abc_90eb4519",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-08-13T14:17:38Z",
      "side": 1,
      "message": "I think this comment addresses this question: https://gerrit-review.googlesource.com/c/119030/7/gerrit-server/src/main/java/com/google/gerrit/server/query/QueryProcessor.java#141",
      "parentUuid": "6ae35629_7202ccfa",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 19,
        "endChar": 63
      },
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57c44873_602ec5c4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-08-14T11:07:24Z",
      "side": 1,
      "message": "I see. I\u0027ll follow up with questions on that other comment.",
      "parentUuid": "ba7c0abc_90eb4519",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 19,
        "endChar": 63
      },
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70425f15_7e557920",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/query/QueryProcessor.java",
        "patchSetId": 7
      },
      "lineNbr": 141,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-08-10T19:43:36Z",
      "side": 1,
      "message": "The most common usage is just to call queryProvider.get().bySomething(), which doesn\u0027t call isDisabled(). This is ok: it\u0027s guaranteed to not be disabled, because enforceVisibility defaults to false, so it doesn\u0027t matter what the user\u0027s permissions say in that case.\n\nThis documentation needs to be updated to reflect that this is ok.",
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e0f435c0_082f4e00",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/query/QueryProcessor.java",
        "patchSetId": 7
      },
      "lineNbr": 141,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-08-14T11:07:24Z",
      "side": 1,
      "message": "CommitsCollection#canRead explicitly sets enforceVisibility to true before calling bySomething():\n\n queryProvider.get().enforceVisibility(true).byProjectCommit(project, commit);\n\nIs this still okay?",
      "parentUuid": "70425f15_7e557920",
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "96f7b850_f35a8d7c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/query/QueryProcessor.java",
        "patchSetId": 7
      },
      "lineNbr": 141,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-08-14T12:18:14Z",
      "side": 1,
      "message": "No, this byProjectCommit call is the kind of programmer error we want to catch. After this change, it would throw ISE.\n\nI think after tracing through the code more thoroughly, prior to this change, incorrect usage would still result in some sort of unchecked exception before attempting to actually execute a query. I was initially worried that it might result in an unlimited query, but now I don\u0027t think that is the case.\n\nSuppose a user has the maximum of their Query Limit capability set to 0 (or a negative number). This is what an admin does when they want to completely disable querying for a user.\n\nBefore: getPermittedLimit() call on line 258 returns 0, which is the minimum of all possible limits, so getEffectiveLimit() returns 0. This results in ArithmeticException on line 172. Or, if the limit is negative, QueryOptions#create throws ISE from line 188; but this exception message is not especially useful.\n\nAfter: query() throws ISE with a useful error message because isDisabled() returned false. (The additional checkState on line 268 never throws, unless there is a bug within this file.)\n\nLike I said in the commit message, this change is about making this assumptions explicit within this file.",
      "parentUuid": "e0f435c0_082f4e00",
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d58bb394_eee11621",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/query/QueryProcessor.java",
        "patchSetId": 7
      },
      "lineNbr": 141,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-08-14T12:19:22Z",
      "side": 1,
      "message": "\u003e After this change, it would throw ISE.\n\n(Only if the current user has a non-positive Query Limit capability.)",
      "parentUuid": "96f7b850_f35a8d7c",
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f92ac65d_66db5233",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/query/QueryProcessor.java",
        "patchSetId": 7
      },
      "lineNbr": 269,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-08-10T19:43:36Z",
      "side": 1,
      "message": "This block should be wrapped in \"if (enforceVisibility)\"",
      "range": {
        "startLine": 267,
        "startChar": 4,
        "endLine": 269,
        "endChar": 39
      },
      "revId": "e4e1626c3996514a5d21cf2647308595902a289d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}