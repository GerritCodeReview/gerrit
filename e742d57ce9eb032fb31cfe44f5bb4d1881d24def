{
  "comments": [
    {
      "key": {
        "uuid": "fbbb069f_22f3815b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 22,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "s/peviously/previously/",
      "range": {
        "startLine": 22,
        "startChar": 53,
        "endLine": 22,
        "endChar": 62
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eed67aa4_98bc1b98",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 22,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fbbb069f_22f3815b",
      "range": {
        "startLine": 22,
        "startChar": 53,
        "endLine": 22,
        "endChar": 62
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26b2f40e_632b74d4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "This would be clearer if it specified that the tip (as seen by that server) of refs/meta/external-ids is always what is requested. We never expect arbitrary SHA1 values to be requested.",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ef9c435_b7a4b63a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "26b2f40e_632b74d4",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 25,
        "endChar": 67
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1d506b2_bd7d435e",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 7
      },
      "lineNbr": 878,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "I don\u0027t see a reference to a \"cache GC task\" in the docs and I don\u0027t believe I\u0027m otherwise familiar with it. Can you clarify what that is please?",
      "range": {
        "startLine": 878,
        "startChar": 28,
        "endLine": 878,
        "endChar": 45
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4de23b28_ac3fd1ee",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 7
      },
      "lineNbr": 878,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "You can find the details in H2CacheImpl#prune, but contrary to the rest of our GCs, it seems timing isn\u0027t configurable. I\u0027ve removed this paragraph.\n\nI think it\u0027d be a good follow up for this change to either make this cache GC a task that users can schedule by calling Gerrit from external or make the timing configurable.",
      "parentUuid": "f1d506b2_bd7d435e",
      "range": {
        "startLine": 878,
        "startChar": 28,
        "endLine": 878,
        "endChar": 45
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c664882_f67ad8aa",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 7
      },
      "lineNbr": 878,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-30T17:23:57Z",
      "side": 1,
      "message": "Good to know, thanks Patrick.",
      "parentUuid": "4de23b28_ac3fd1ee",
      "range": {
        "startLine": 878,
        "startChar": 28,
        "endLine": 878,
        "endChar": 45
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "74f88879_14ce6df4",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 110,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "Can the size of this method be reduced? It\u0027s over 100 lines right now.",
      "range": {
        "startLine": 110,
        "startChar": 24,
        "endLine": 110,
        "endChar": 28
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e29f52f9_374ef10c",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 110,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "74f88879_14ce6df4",
      "range": {
        "startLine": 110,
        "startChar": 24,
        "endLine": 110,
        "endChar": 28
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c6b5dc54_66db6cdc",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 126,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "Perhaps not for this change, but wouldn\u0027t it be better to just grab any entry from the cache than to rebuild from scratch?\n\nThat might even be a better approach than walking anything at all.",
      "range": {
        "startLine": 125,
        "startChar": 64,
        "endLine": 126,
        "endChar": 38
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "baab628b_4ab11b2e",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 126,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "This depends on the age (mutations after that state was created). If we have an installation with 200k external IDs and assume each one was created and later on mutated once on average, that would mean 400k commits \u003d 400k operations to perform while the trivial \u0027reload from scratch\u0027 needs in the order of 200k operations.\n\nI think we can inform this decision based on the numbers (full vs. partial reload we get). With the current window of walking 10 I would bluntly assume that the vast majority are differential reloads already and a walk of worst-case 10 commits and average case 1 commit is almost free (not entirely).\n\nIt also depends on the cache implementation, last I checked, our H2 cache implementation didn\u0027t support a prefix scan or #allAsMap or similar (our internal storage doesn\u0027t either, I\u0027d assume most fast key-value stores don\u0027t support a cheap scan). So more work would have to be done before that is possible.\n\nSo for now, the walk seems to be the better option to me, but if metrics say otherwise, we can reconsider.",
      "parentUuid": "c6b5dc54_66db6cdc",
      "range": {
        "startLine": 125,
        "startChar": 64,
        "endLine": 126,
        "endChar": 38
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a9bdb75_20b0e552",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 126,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-30T17:23:57Z",
      "side": 1,
      "message": "Huh, I would have though asMap() worked, but I haven\u0027t tried it.\n\nI\u0027m good with learning from metrics and reconsidering if needed.",
      "parentUuid": "baab628b_4ab11b2e",
      "range": {
        "startLine": 125,
        "startChar": 64,
        "endLine": 126,
        "endChar": 38
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41f5bb0c_bc7a22b2",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 160,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "This looks like it could make a good method.",
      "range": {
        "startLine": 139,
        "startChar": 6,
        "endLine": 160,
        "endChar": 7
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0804458d_76dd1631",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 160,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "The method would have to return a Pair\u003cRevCommit, AllExternalIDs\u003e (or a data structure to hold the two) which I would like to avoid.\n\nThe alternative is to call #getIfPresent twice, once for detection (could also be a call to contains or equivalent) and once for value retrieval but that makes the code racy.",
      "parentUuid": "41f5bb0c_bc7a22b2",
      "range": {
        "startLine": 139,
        "startChar": 6,
        "endLine": 160,
        "endChar": 7
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79cef4e7_ef5edf72",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 190,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "another method?",
      "range": {
        "startLine": 167,
        "startChar": 6,
        "endLine": 190,
        "endChar": 7
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4cf89578_cdfb2b82",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 190,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "I instead put the next part in a separate method because it can return a single object and doesn\u0027t have to mutate parameters.\n\nIf we would put this part in a separate method, it\u0027d have to add to \u0027removals\u0027 and \u0027additions\u0027 that we pass in as parameters. That certainly works, but I think it\u0027s cleaner if we outsource the next part.",
      "parentUuid": "79cef4e7_ef5edf72",
      "range": {
        "startLine": 167,
        "startChar": 6,
        "endLine": 190,
        "endChar": 7
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d445b3fa_2e4d5ba1",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdCacheLoader.java",
        "patchSetId": 7
      },
      "lineNbr": 190,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-30T17:23:57Z",
      "side": 1,
      "message": "Yeah, that\u0027s a big improvement, thanks.",
      "parentUuid": "4cf89578_cdfb2b82",
      "range": {
        "startLine": 167,
        "startChar": 6,
        "endLine": 190,
        "endChar": 7
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6cd1f461_f1df8600",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdModule.java",
        "patchSetId": 7
      },
      "lineNbr": 36,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "duplicated line?",
      "range": {
        "startLine": 36,
        "startChar": 0,
        "endLine": 36,
        "endChar": 18
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9423483_0e6b4750",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdModule.java",
        "patchSetId": 7
      },
      "lineNbr": 36,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6cd1f461_f1df8600",
      "range": {
        "startLine": 36,
        "startChar": 0,
        "endLine": 36,
        "endChar": 18
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bb419f50_6a364ec5",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdModule.java",
        "patchSetId": 7
      },
      "lineNbr": 38,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2019-07-29T20:42:58Z",
      "side": 1,
      "message": "Why did this change to 5 minutes?",
      "range": {
        "startLine": 38,
        "startChar": 56,
        "endLine": 38,
        "endChar": 57
      },
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "29532b14_5de7622c",
        "filename": "java/com/google/gerrit/server/account/externalids/ExternalIdModule.java",
        "patchSetId": 7
      },
      "lineNbr": 38,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-30T07:42:38Z",
      "side": 1,
      "message": "I wanted to give it more time to have an old state in memory, but this is better tweaked with a separate commit and configs just for trying out, so I reverted it.",
      "parentUuid": "bb419f50_6a364ec5",
      "range": {
        "startLine": 38,
        "startChar": 56,
        "endLine": 38,
        "endChar": 57
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "e742d57ce9eb032fb31cfe44f5bb4d1881d24def",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}