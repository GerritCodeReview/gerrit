{
  "comments": [
    {
      "key": {
        "uuid": "08776c23_942ac381",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-05-19T15:22:20Z",
      "side": 1,
      "message": "How can a Java deadlock timeout? AFAIK, a true deadlock in JVM will stay forever i.e. until the JVM gets restarted. See also [1].\n\nBtw, we also got this issue for the first time last Sunday.\n\n[1] https://stackoverflow.com/q/18908012",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a510f90f_f059922f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2020-05-15T20:35:48Z",
      "side": 1,
      "message": "Does not work, unfortunately.\n\nOn client side, I see some (expected) remote hung up / could not read from remote, but also a \"protocol error: bad pack header\".\n\nServer-side, I still get the deadlock, and it still there ~30min later.",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c9d6c181_449bf6a0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-05-19T15:09:35Z",
      "side": 1,
      "message": "\u003e Server-side, I still get the deadlock, and it still there ~30min later.\n\nA deadlock will stay forever i.e. until the JVM shutdown.",
      "parentUuid": "a510f90f_f059922f",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "310fcf82_d85be8b2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-05-19T15:26:25Z",
      "side": 1,
      "message": "\u003e \u003e Server-side, I still get the deadlock, and it still there ~30min later.\n\u003e \n\u003e A deadlock will stay forever i.e. until the JVM shutdown.\n\nI think you have misread Francois\u0027s comment. What he was saying: after running gerrit under stress: with this specific configuration, as described in the linked Apache SSHD issue: [1]:\n\n  NOTE: in our setup, we can reproduce this quite easily\n  by increasing the parallelism in git-repo,\n  reducing the values of waitTimeout (WAIT_FOR_SPACE_TIMEOUT),\n  rekeyBytesLimit (REKEY_BYTES_LIMIT)\n  and rekeyTimeLimit (REKEY_TIME_LIMIT) configuration options.\n\nthe deadlock was showing up 30 minutes later. First 29 minutes no deadlock, then deadlock occured and gerrit must be re-started.\n\n\n[1] https://issues.apache.org/jira/browse/SSHD-966",
      "parentUuid": "c9d6c181_449bf6a0",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7071778a_0da0678d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-05-19T21:20:02Z",
      "side": 1,
      "message": "The commit message still says \"Even if there is a deadlock it will eventually time out after at most ~2 min\"!? I thought that Francois was referring to that and\nthen found out that a deadlock never timed out, not even after 30 minutes.\n\nAnyway, this part of the commit message is misleading.",
      "parentUuid": "310fcf82_d85be8b2",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e3880dda_7505a162",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2020-05-20T16:22:03Z",
      "side": 1,
      "message": "Had some build/deploy issue, and ended up testing incorrect version.\nWith the patched JGit, there are indeed no more deadlock, but I very often hit the timeout, possibly on almost every rekey; and thus git checkout fails very often, esp. on large repositories (even without repo)",
      "parentUuid": "a510f90f_f059922f",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8655d2ee_7b183dd0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2020-05-20T16:25:31Z",
      "side": 1,
      "message": "My bad, not clear indeed.\n\nWhat I meant is I checked 30 minutes later, and add the deadlock: i.e. much longer than the expected timeout, which was thus not reached.\n\nBut anyway, this test was done with an incorrect build, so did not have the updated jgit. With updated jgit there is indeed no deadlock, but timeout happens too often : it breaks downloading large repositories, even with a single git client on the whole server.",
      "parentUuid": "e3880dda_7505a162",
      "revId": "e89db8c45d4f1c041ee6db77843eedda85ca3085",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}