{
  "comments": [
    {
      "key": {
        "uuid": "506bee69_aa40aff5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeDraftUpdate.java",
        "patchSetId": 2
      },
      "lineNbr": 222,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-30T19:26:18Z",
      "side": 1,
      "message": "This looks wrong to me. Suppose draft1 was added in ps1, and draft2 was added in ps2. Now, draft2 from ps2 is going to be removed. deleteComments contains draft2 and upsert comments is empty. In this loop draft1 from ps1 is skipped, because updatedRevs doesn\u0027t contain rev from ps1. As the consequence allComments remained empty and draft1 from ps1 is lost.",
      "range": {
        "startLine": 213,
        "startChar": 4,
        "endLine": 222,
        "endChar": 5
      },
      "revId": "ea3fc0c970534df46ac25bb77cf53acbfe4d5ec8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "907f2621_4ca35fad",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeDraftUpdate.java",
        "patchSetId": 2
      },
      "lineNbr": 222,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2015-04-30T20:44:48Z",
      "side": 1,
      "message": "The call to writeCommentsToNoteMap reads the NoteMap, modifies the revisions from the comment map passed in, and leaves everything else alone. So draft1 will be skipped and as a result writeCommentsToNoteMap will not touch the note entry for ps1 at all.\n\nI tried to explain this in the comment but I wasn\u0027t clear. I will reword.",
      "parentUuid": "506bee69_aa40aff5",
      "range": {
        "startLine": 213,
        "startChar": 4,
        "endLine": 222,
        "endChar": 5
      },
      "revId": "ea3fc0c970534df46ac25bb77cf53acbfe4d5ec8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "506bee69_6a3397a2",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeDraftUpdate.java",
        "patchSetId": 2
      },
      "lineNbr": 222,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-30T20:52:54Z",
      "side": 1,
      "message": "OK. But when allComments is remained empty, then removedAllComments is set to true on the line 225 below. That leads to the removal of all comments.",
      "parentUuid": "907f2621_4ca35fad",
      "range": {
        "startLine": 213,
        "startChar": 4,
        "endLine": 222,
        "endChar": 5
      },
      "revId": "ea3fc0c970534df46ac25bb77cf53acbfe4d5ec8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "707ab234_6bdac1ec",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/server/notedb/ChangeNotesTest.java",
        "patchSetId": 2
      },
      "lineNbr": 1119,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-30T19:26:18Z",
      "side": 1,
      "message": "While removal of all draft comments seems to work, removal of only some of them is broken, e.g.: [1].\n\n* [1]: http://paste.openstack.org/show/213861/",
      "range": {
        "startLine": 1085,
        "startChar": 2,
        "endLine": 1119,
        "endChar": 3
      },
      "revId": "ea3fc0c970534df46ac25bb77cf53acbfe4d5ec8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}