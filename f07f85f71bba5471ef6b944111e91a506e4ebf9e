{
  "comments": [
    {
      "key": {
        "uuid": "6d7c9e57_627536bd",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/Gerrit.java",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-07-28T12:20:05Z",
      "side": 1,
      "message": "Why loading of account preferences is moved earlier from line 649?",
      "revId": "f07f85f71bba5471ef6b944111e91a506e4ebf9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8dbf1232_83421e64",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/Gerrit.java",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-07-28T12:50:48Z",
      "side": 1,
      "message": "It\u0027s not really moved to an earlier point. With the old code the preferences are taken from the host page data (from the account that is contained in host page data). They were applied already in line 465. So at the same place were are now fetching the preferences via REST.\n\nOnly since the preferences that we got from the account didn\u0027t contain the my menus, we had to fetch them extra later in line 649. Since we now fetch the preferences here via REST they include the my menus and we do not need to do that request later again.",
      "parentUuid": "6d7c9e57_627536bd",
      "revId": "f07f85f71bba5471ef6b944111e91a506e4ebf9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8dbf1232_c33c16f0",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/Gerrit.java",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-07-28T13:37:43Z",
      "side": 1,
      "message": "Thanks. Now I see it, old applyUserPreferences() is doing that. I also saw, that in the follow-up change you removed account from host page data servlet, but in this change the GeneralPreference part of it isn\u0027t used any more, right? Can it be partially removed from host page data already in this change, so that no preferences are transported over the wire to the client, when they aren\u0027t used any more? But probably this is a hack one would be removed in this series anyway, but what I mean is to do in HostPageServlet.doGet() something like:\n\n  if (user.isIdentifiedUser()) {\n      Account a \u003d ((IdentifiedUser) user).getAccount();\n      w.write(HPD_ID + \".account\u003d\");\n      AccountGeneralPreferences rememberMe \u003d a.getGeneralPreferences();\n      a.setGeneralPreferences(null);\n      json(a, w);\n      a.setGeneralPreferences(rememberMe);\n      [...]",
      "parentUuid": "8dbf1232_83421e64",
      "revId": "f07f85f71bba5471ef6b944111e91a506e4ebf9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8dbf1232_a3a47abe",
        "filename": "gerrit-gwtui/src/main/java/com/google/gerrit/client/Gerrit.java",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2015-07-28T14:18:51Z",
      "side": 1,
      "message": "Yes, this could be done, but since there is already a change that removes this, I think we can save this effort.",
      "parentUuid": "8dbf1232_c33c16f0",
      "revId": "f07f85f71bba5471ef6b944111e91a506e4ebf9e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}