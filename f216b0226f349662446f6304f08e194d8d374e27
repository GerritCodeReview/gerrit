{
  "comments": [
    {
      "key": {
        "uuid": "95ece903_84042a97",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 15,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-04T14:03:37Z",
      "side": 1,
      "message": "set",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 32
      },
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a1559170_19216a9e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 15,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:39:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "95ece903_84042a97",
      "range": {
        "startLine": 15,
        "startChar": 28,
        "endLine": 15,
        "endChar": 32
      },
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7efd7e46_675b4fbf",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-04T14:03:37Z",
      "side": 1,
      "message": "duplicate",
      "range": {
        "startLine": 21,
        "startChar": 17,
        "endLine": 21,
        "endChar": 30
      },
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fa09e263_9aee230e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:39:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7efd7e46_675b4fbf",
      "range": {
        "startLine": 21,
        "startChar": 17,
        "endLine": 21,
        "endChar": 30
      },
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4fc586bf_abf2aa4c",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 745,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-04T14:03:37Z",
      "side": 1,
      "message": "Is the plan that the FE reloads the change after the request, or that the FE has the same logic and will perform these operations itself w/o going through the backend?",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bca2f400_e12c770d",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 745,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:39:23Z",
      "side": 1,
      "message": "I don\u0027t think it\u0027s reasonable for the frontend to have the same logic, I guess it will refresh?\nI\u0027m not the frontend expert though :-)\nCC Ben to answer, is this relevant to this change?",
      "parentUuid": "4fc586bf_abf2aa4c",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15edeba8_d9b31fb9",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 745,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-05T08:35:52Z",
      "side": 1,
      "message": "IIRC the plan was actually for the FE to duplicate the logic. I agree it\u0027s not really relevant to this change, because it will either refresh or duplicate :-)",
      "parentUuid": "bca2f400_e12c770d",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d51b417a_600ad2b5",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-04T14:03:37Z",
      "side": 1,
      "message": "It used to be that re-adding an existing reviewer was idempotent (I assume). Now this will add them to the attention set (where they will not be e.g. after sending comments). Is that OK?",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de8913f6_c6c65a06",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:39:23Z",
      "side": 1,
      "message": "Interesting question, I added a test that answer the question as \"no\".",
      "parentUuid": "d51b417a_600ad2b5",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "81e09340_11c5729d",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:41:45Z",
      "side": 1,
      "message": "by \"no\" I mean \"This will not add an existing reviewer to the attention set again\".",
      "parentUuid": "de8913f6_c6c65a06",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9977630c_af95d5c1",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-05T08:35:52Z",
      "side": 1,
      "message": "Where is this second update filtered? I\u0027m a bit concerned that this behavior depends on some optimization that detects that the reviewers remain unchanged and skips this code, which only works because that hypothetical optimization isn\u0027t smart enough to know about attention sets yet.",
      "parentUuid": "81e09340_11c5729d",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ad974dcb_014fa579",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-05T10:48:13Z",
      "side": 1,
      "message": "Why do you think it is a problem that such optimisation exists? Essentially, in AddReviewersOp, reviewers are not added to the ChangeUpdate if they already exist. A pointer would be AddReviewersOp#UpdateChange around the end of the method there is \"if(addedReviewers.isEmpty() -\u003e skip update\".\n\nThat sounds good to me, since this optimization doesn\u0027t need to know about the attention set: users are added to the attention set when reviewers are *really* added (\u003d\u003d they were not reviewers before the update).",
      "parentUuid": "9977630c_af95d5c1",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20bda60d_33edb322",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-09T11:26:31Z",
      "side": 1,
      "message": "When AddReviewersOp is changed, or we intentionally want to perform another write, or there\u0027s a case where we can\u0027t easily tell whether the write is idempotent, then this will cause undesired behavior in a seemingly unrelated area of the code. So now, in order to understand AddReviewersOp, the reader also needs to understand this part of ChangeUpdate, and vice versa.\n\nI\u0027d feel better if we defensively filter by currentReviewer right here, or else at least add comments here and in AddReviewersOp to point out this implicit interdependency.",
      "parentUuid": "ad974dcb_014fa579",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f0482f6_3068787b",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-12T08:48:57Z",
      "side": 1,
      "message": "I\u0027m still unsure if this is helpful, but since the cost is just writing another simple condition, I\u0027m ok with going with the idea.",
      "parentUuid": "20bda60d_33edb322",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3ca6e6bd_06c1c31f",
        "filename": "java/com/google/gerrit/server/notedb/ChangeUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 747,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-15T07:55:35Z",
      "side": 1,
      "message": "Thanks. Maybe some more explanation at the risk of oversimplification: I feel that many parts in Gerrit are hard to understand because architecturally different parts are semantically closely connected. This is one such case where I read the code and wonder \"Why does this do A and not B?\" and then find the explanation in a very different place of the codebase. So while the additional condition is technically redundant, it means that this part of the code can be read on its own.",
      "parentUuid": "7f0482f6_3068787b",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f1f08ea_fbef1d18",
        "filename": "javatests/com/google/gerrit/acceptance/rest/change/AttentionSetIT.java",
        "patchSetId": 7
      },
      "lineNbr": 182,
      "author": {
        "id": 1083042
      },
      "writtenOn": "2020-06-04T14:03:37Z",
      "side": 1,
      "message": "TODO uses round parentheses (\"()\").",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "62071c25_7f71e496",
        "filename": "javatests/com/google/gerrit/acceptance/rest/change/AttentionSetIT.java",
        "patchSetId": 7
      },
      "lineNbr": 182,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:39:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0f1f08ea_fbef1d18",
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cb93c93f_ec4a8e49",
        "filename": "javatests/com/google/gerrit/acceptance/rest/change/AttentionSetIT.java",
        "patchSetId": 7
      },
      "lineNbr": 274,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-02T12:12:55Z",
      "side": 1,
      "message": "todo: change to isEmpty",
      "range": {
        "startLine": 274,
        "startChar": 45,
        "endLine": 274,
        "endChar": 55
      },
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be0905a1_db213feb",
        "filename": "javatests/com/google/gerrit/acceptance/rest/change/AttentionSetIT.java",
        "patchSetId": 7
      },
      "lineNbr": 274,
      "author": {
        "id": 1085183
      },
      "writtenOn": "2020-06-04T21:39:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cb93c93f_ec4a8e49",
      "range": {
        "startLine": 274,
        "startChar": 45,
        "endLine": 274,
        "endChar": 55
      },
      "revId": "f216b0226f349662446f6304f08e194d8d374e27",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}