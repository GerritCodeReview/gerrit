{
  "comments": [
    {
      "key": {
        "uuid": "2cbcf774_7f661e3f",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 24
      },
      "lineNbr": 168,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2019-10-08T05:19:30Z",
      "side": 1,
      "message": "Add a comment that this is a DiffInfo API object.",
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20b01acd_5a2101c3",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-host/gr-diff-host.js",
        "patchSetId": 24
      },
      "lineNbr": 168,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2019-10-08T07:40:18Z",
      "side": 1,
      "message": "thanks, done.",
      "parentUuid": "2cbcf774_7f661e3f",
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30ae87fa_b042f3f5",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 89,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2019-10-08T05:19:30Z",
      "side": 1,
      "message": "fix formatting",
      "range": {
        "startLine": 87,
        "startChar": 6,
        "endLine": 89,
        "endChar": 11
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "395959ca_d82690b8",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 89,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2019-10-08T07:40:18Z",
      "side": 1,
      "message": "thanks, done.",
      "parentUuid": "30ae87fa_b042f3f5",
      "range": {
        "startLine": 87,
        "startChar": 6,
        "endLine": 89,
        "endChar": 11
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c5cefcf_50cd6a09",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 90,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2019-10-08T05:19:30Z",
      "side": 1,
      "message": "Add a comment that this is retrieved and owned by a child component.",
      "range": {
        "startLine": 90,
        "startChar": 6,
        "endLine": 90,
        "endChar": 11
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4bee7cdf_277b87eb",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 90,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2019-10-08T07:40:18Z",
      "side": 1,
      "message": "thanks, done.",
      "parentUuid": "6c5cefcf_50cd6a09",
      "range": {
        "startLine": 90,
        "startChar": 6,
        "endLine": 90,
        "endChar": 11
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "55f5f252_f41731bf",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 908,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2019-10-08T05:19:30Z",
      "side": 1,
      "message": "Looking at _computeDownloadFileLink below and the API docs at https://gerrit-review.googlesource.com/Documentation/rest-api-changes.html#get-safe-content, I am confused why a constant for the \"parent\" parameter would work.\n\nCan\u0027t you also have a patchset on the left side and you have to use 0 then as a parent?\n\nAnd why \"2\"?\n\nShould the parent value be derived from patchRange somehow?",
      "range": {
        "startLine": 908,
        "startChar": 60,
        "endLine": 908,
        "endChar": 61
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f76f0975_6ac08d63",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 908,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-10-08T06:39:39Z",
      "side": 1,
      "message": "\u003e Should the parent value be derived from patchRange somehow?\n\nNo, it is unrelated to the patch set. Let me clarify this. The used REST endpoint is more generic, and supports retrieval of arbitrary parent commits, sing ?parent\u003dn notation. The relevant code in FileContentUtil#downloadContent() method, along these lines:\n\n  if (parent !\u003d null \u0026\u0026 parent \u003e 0) {\n        if (commit.getParentCount() \u003d\u003d 1) {\n          suffix \u003d \"old\";\n        } else {\n          suffix \u003d \"old\" + parent;\n        }\n        commit \u003d rw.parseCommit(commit.getParent(parent - 1));\n      }\n\nThe pare: commit.getParent(parent - 1) is doing just that.\n\nIn addition, the parent is used to derive the download file name. So if parent\u003d1 is passed, then the name of READMDE.md.zip file will be changed to: README_old.md.zip.\n\nHowever, in this specific use we don\u0027t use any arbitrary parents, but onls one specific: parent of this change, that is accessed with parent\u003d1, to retrieve the files from the left side.\n\nTo access the files from the right side, from this change, we don\u0027t need the parent at all. If we pass parent\u003d0, for the code simplicity reasons, then this parameter is dropped on the server side see, because of this part in the if statement above: if (parent !\u003d null \u0026\u0026 parent \u003e 0) { ... part.\n\nBut see also my comment below, for alternative suggestion.",
      "parentUuid": "55f5f252_f41731bf",
      "range": {
        "startLine": 908,
        "startChar": 60,
        "endLine": 908,
        "endChar": 61
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "319e6d8d_45bccaa4",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 908,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2019-10-08T07:57:24Z",
      "side": 1,
      "message": "What happens, if the file on the left side is not a base file, e.g. I am comparing patchset 1 and 2. How does the code handle that?",
      "parentUuid": "f76f0975_6ac08d63",
      "range": {
        "startLine": 908,
        "startChar": 60,
        "endLine": 908,
        "endChar": 61
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d78004c4_6bd3c36f",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 908,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-10-08T10:08:12Z",
      "side": 1,
      "message": "\u003e What happens, if the file on the left side is not a base file, e.g. I am comparing patchset 1 and 2. How does the code handle that?\n\nIndependently what is compared against, the code would send the request with \"?parent\u003d1\" originating from the patch set commit on the right side (revision number). Say you are comparing patch set 3 against the base:\n\n  https://gerrit-review.googlesource.com/c/gerrit/+/238862/3/BUILD\n\nin that case the URL to download the left side content would be:\n\n  https://gerrit-review.googlesource.com/changes/gerrit~238862/revisions/3/files/BUILD/download?parent\u003d1\n\nOr, you are comparing patch set 2 against patch set 1:\n\n  https://gerrit-review.googlesource.com/c/gerrit/+/238862/1..2/BUILD\n\nin that case the URL to download the left side content would be:\n\n  https://gerrit-review.googlesource.com/changes/gerrit~238862/revisions/2/files/BUILD/download?parent\u003d1\n\nSo yes, while the original commit we are retrieving the parent from differs, the parent for all patch sets is always the base commit. One possible confusion here to think that parent of patch_set_n is patch_set_n-1, that is not the case for Gerrit\u0027s patch set workflow, this would only apply for GitHub\u0027s branch workflow.\n\nHaving said that, if a change was rebased, then you could get a different content on the left side depending on whether you are looking on patch set n before the rebase or your are looking on patch set n+1 after the rebase. But that is correct and WAI.",
      "parentUuid": "319e6d8d_45bccaa4",
      "range": {
        "startLine": 908,
        "startChar": 60,
        "endLine": 908,
        "endChar": 61
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e4ece89b_45658652",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 908,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2019-10-09T00:21:44Z",
      "side": 1,
      "message": "Fixed all use cases in new patchset!\n\nIn matter of fact GWTUI has a bug with renames.\n\nWhen renaming a file and comparing base to patchset 3 the download link is like:\n\nhttps://gerrit.git.wmflabs.org/r/cat/3143%2C3%2Cindex2.php^1\n\nWhere as it should be:\n\nhttps://gerrit.git.wmflabs.org/r/cat/3143%2C3%2Cindex.php^1",
      "parentUuid": "d78004c4_6bd3c36f",
      "range": {
        "startLine": 908,
        "startChar": 60,
        "endLine": 908,
        "endChar": 61
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "902c8be2_6eb18887",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 919,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-10-08T06:39:39Z",
      "side": 1,
      "message": "// We pass 0 here to indicate this patch set commit.\n// This is done for code simplicity reasons only.\n// It is not needed and will be ignored on the server side.",
      "range": {
        "startLine": 917,
        "startChar": 14,
        "endLine": 919,
        "endChar": 32
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf356d27_2e54600a",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 919,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2019-10-08T07:40:18Z",
      "side": 1,
      "message": "I’ve changed so that it only adds parent if it’s 1.",
      "parentUuid": "902c8be2_6eb18887",
      "range": {
        "startLine": 917,
        "startChar": 14,
        "endLine": 919,
        "endChar": 32
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dd170658_c47998de",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 932,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2019-10-08T06:39:39Z",
      "side": 1,
      "message": "Of course, parent can be left out for parent \u003d 0. Would it be more clear:\n\n  let url \u003d this.changeBaseURL(project, changeNum, patchRange.patchNum) +\n          `/files/${encodeURIComponent(path)}/download`;\n  if (parent \u003d\u003d\u003d 1) {\n    url +\u003d `?parent\u003d${parent}`;\n  }\n  return url;\n\n? Of course parent can be change to be boolean, and only pass true for parent 1 case, then the of above can be simplified:\n\n  let url \u003d [...]\n  if (parent) {\n    url +\u003d \u0027?parent\u003d1\u0027;\n  }\n  return url;",
      "range": {
        "startLine": 931,
        "startChar": 6,
        "endLine": 932,
        "endChar": 73
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ee9345d_a1ee14fe",
        "filename": "polygerrit-ui/app/elements/diff/gr-diff-view/gr-diff-view.js",
        "patchSetId": 24
      },
      "lineNbr": 932,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2019-10-08T07:40:18Z",
      "side": 1,
      "message": "thanks, done!",
      "parentUuid": "dd170658_c47998de",
      "range": {
        "startLine": 931,
        "startChar": 6,
        "endLine": 932,
        "endChar": 73
      },
      "revId": "f47140006824f643d5e39c18d9390a8be8b1d640",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}