{
  "comments": [
    {
      "key": {
        "uuid": "7799c4f8_3c99917b",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 711,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-03-20T15:30:26Z",
      "side": 1,
      "message": "something is missing here?",
      "range": {
        "startLine": 711,
        "startChar": 64,
        "endLine": 711,
        "endChar": 74
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7799c4f8_1c9cd56a",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 711,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-03-20T15:30:26Z",
      "side": 1,
      "message": "diff?",
      "range": {
        "startLine": 711,
        "startChar": 26,
        "endLine": 711,
        "endChar": 36
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e68ee87f_6fb2d1d9",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 711,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7799c4f8_3c99917b",
      "range": {
        "startLine": 711,
        "startChar": 64,
        "endLine": 711,
        "endChar": 74
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e68ee87f_4fb58dbe",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 711,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7799c4f8_1c9cd56a",
      "range": {
        "startLine": 711,
        "startChar": 26,
        "endLine": 711,
        "endChar": 36
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7799c4f8_5ca65dbe",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 713,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-03-20T15:30:26Z",
      "side": 1,
      "message": "diff?",
      "range": {
        "startLine": 713,
        "startChar": 19,
        "endLine": 713,
        "endChar": 29
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26856059_b1010009",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 713,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7799c4f8_5ca65dbe",
      "range": {
        "startLine": 713,
        "startChar": 19,
        "endLine": 713,
        "endChar": 29
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7cc449d2_c467fe23",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 727,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-03-11T05:27:41Z",
      "side": 1,
      "message": "I think we should combine the two diff thread pools into a single pool. There is no reason to run 3 * CPUs of threads out of the box idling just in case a diff request is made.",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "66f758e2_e3ba3205",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 727,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-19T15:05:17Z",
      "side": 1,
      "message": "I am working on combining the 2 diff thread pools into a single pool and the pool will be a standard ExecutorService now that we can interrupt MyersDiff. \n\nDo we really need to keep idle threads, can I use a common CachedThreadPool instead (corePoolSize\u003d0 and keepAliveTime\u003d60sec)?",
      "parentUuid": "7cc449d2_c467fe23",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2637206d_e1ba6605",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 727,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-03-19T16:29:57Z",
      "side": 1,
      "message": "No, I think we can safely use a CachedThreadPool instead. Which would be much simpler code to write.",
      "parentUuid": "66f758e2_e3ba3205",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26856059_5107741a",
        "filename": "Documentation/config-gerrit.txt",
        "patchSetId": 2
      },
      "lineNbr": 727,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2637206d_e1ba6605",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d76190bc_772a5079",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Daemon.java",
        "patchSetId": 2
      },
      "lineNbr": 324,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-03-11T05:27:41Z",
      "side": 1,
      "message": "Any binding added here must also be in the WebAppInitializer.\n\nBut I think this should be combined with the IntralineWorkerPool.",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e68ee87f_0fbf85a0",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Daemon.java",
        "patchSetId": 2
      },
      "lineNbr": 324,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "Done, the new combined pool in declared in this file and in WebAppInitializer",
      "parentUuid": "d76190bc_772a5079",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d76190bc_97c36437",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-03-11T05:27:41Z",
      "side": 1,
      "message": "I ... am unsure you can do this safely.\n\nstop() throws ThreadDeath which nobody catches. Locks are released on the way out but the state of any object is unknown and unpredictable.\n\ntoFileHeader is going to dig deep around inside JGit to load the blobs into memory. That pack file accessing can be unsafe.\n\nNote that IntraLineWorkerPool tries harder to prevent this problem by shipping over the full file contents for either side so that no JGit locks need to be acquired during the (possibly broken) computation.",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d76190bc_37a37880",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-11T15:29:20Z",
      "side": 1,
      "message": "Do you have a suggestion how I could do it but easier than extracting the files to pass to the worker (this would involve a lot of changes which I am not confident putting on our production to be able to upgrade to gerrit 2.10)? \n\nI think it would be easier to modify jgit MyersDiff to be interruptible, WDYT?",
      "parentUuid": "d76190bc_97c36437",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7cc449d2_c4037e0c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-03-11T16:59:49Z",
      "side": 1,
      "message": "Yes. It would be easier to make MyersDiff interruptible, then we can eliminate these dangerous thread kills.",
      "parentUuid": "d76190bc_37a37880",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a6eeb034_fd12a78d",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2015-03-20T15:30:26Z",
      "side": 1,
      "message": "@Hugo: now that the MyersDiff in JGit is interruptible [1] do you want to work further on this change? I am seeing a couple of threads running for hours in MyersDiff when testing online reindexing in 2.10 on a large Gerrit instance. We would need a newer JGit which would contain [1]. Either I would prepare a custom JGit version (3.6 + [1]) or I convince Matthias Sohn to release 3.7 + [1] officially.\n\n[1] https://git.eclipse.org/r/44041",
      "parentUuid": "7cc449d2_c4037e0c",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e68ee87f_8fca954c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T15:43:28Z",
      "side": 1,
      "message": "I am currently working on that change. I moved my change on master because I needed my change in jgit[1] which we have on master but if you can upgrade 2.10 with jgit 3.6 + [1], I will submit my changes (I have 2 now, I rework the intraline diff to interrupt MyersDiff instead of killing it) on 2.10.\n\nI think it would be less risky to take 3.6 + [1] than 3.7.\n\nI will submit my changes on master today so we can start review.\n\n[1] https://git.eclipse.org/r/44041",
      "parentUuid": "a6eeb034_fd12a78d",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a6eeb034_5d047b42",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-03-20T16:38:37Z",
      "side": 1,
      "message": "| I am currently working on that change.\n\nHave you found a way to reproduce the problem?",
      "parentUuid": "e68ee87f_8fca954c",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26856059_7104f814",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/DiffWorkerPool.java",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "\u003e Have you found a way to reproduce the problem?\n\nWe have some changes on our production server that always trigger the MyersDiff infinite loop. Without this change, the online reindexer was never completing(version 8 to 11) after upgrading to gerrit version 2.11",
      "parentUuid": "a6eeb034_5d047b42",
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d76190bc_b7c86852",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/PatchListLoader.java",
        "patchSetId": 2
      },
      "lineNbr": 189,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2015-03-11T05:27:41Z",
      "side": 1,
      "message": "nit: indentation is wrong here.",
      "range": {
        "startLine": 188,
        "startChar": 0,
        "endLine": 189,
        "endChar": 87
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e68ee87f_2fbcc9a8",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/patch/PatchListLoader.java",
        "patchSetId": 2
      },
      "lineNbr": 189,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2015-03-20T16:47:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d76190bc_b7c86852",
      "range": {
        "startLine": 188,
        "startChar": 0,
        "endLine": 189,
        "endChar": 87
      },
      "revId": "f65de952ca2d86de5439f6a0412ffeeb76a87000",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}