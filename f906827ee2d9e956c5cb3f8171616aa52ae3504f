{
  "comments": [
    {
      "key": {
        "uuid": "401744d8_d3a1c244",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/RebaseSorter.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1010008
      },
      "writtenOn": "Jan 26, 2017 10:51:45 AM",
      "side": 1,
      "message": "I don\u0027t see how this avoids the problem of making index calls in a loop.\n\nSay you have 10 commits between the commit you\u0027re submitting and the current branch tip, each corresponding to an open change. None of those commits are already merged into this or any branch, because they\u0027re open changes. isAlreadyMerged won\u0027t return false until it\u0027s done the index lookup.\n\nSo this loop iterates through 10 commits and makes one index lookup per iteration. That\u0027s what I want to avoid.\n\nYou just want to look up merged changes corresponding to each of these commits, right? You should be able to generalize InternalChangeQuery#byCommitsOnBranchNotMerged to look it up in one or a few batches.",
      "revId": "f906827ee2d9e956c5cb3f8171616aa52ae3504f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12e7ea90_d5535738",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/RebaseSorter.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1026258
      },
      "writtenOn": "Jan 27, 2017 9:48:37 AM",
      "side": 1,
      "message": "Totally agree your point.\n\nI\u0027ve had another idea, please see my new patchset which will break the while loop if we found a merged commit or missing dependency. This will make sure that at most one index lookup.\n\nMy assumption is that once we found one missing dependency, we don\u0027t need walk further.",
      "revId": "f906827ee2d9e956c5cb3f8171616aa52ae3504f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6873a94_eceb88e9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/RebaseSorter.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1010008
      },
      "writtenOn": "Jan 27, 2017 11:09:29 AM",
      "side": 1,
      "message": "\u003e My assumption is that once we found one missing dependency, we don\u0027t need walk further.\n\nI think this new approach works and is not much code, thanks.\n\nThe only thing is, this is a behavior change in the error message that\u0027s generated. SubmitStrategyListener collects all MISSING_DEPENDENCY changes and concatenates them together in the error message. So this will result in only one of them showing up.\n\nI think that\u0027s probably not a big deal, it just means that the user might still be unable to submit after correcting the one missing dependency in the error message. Do you think that\u0027s reasonable behavior?",
      "revId": "f906827ee2d9e956c5cb3f8171616aa52ae3504f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "74649037_6dbf699c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/RebaseSorter.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1026258
      },
      "writtenOn": "Jan 27, 2017 11:54:37 AM",
      "side": 1,
      "message": "This will still try to looking for one missing dependency for each change. Note that there is a outer while loop for all changes. We do not change anything reported to user. Because in SubmitStrategyListener, we only say \" Change #  depends on change that was not submitted\" for each change, we don\u0027t report how many missing dependencies for that change. \n\nI also think we should change MergeSorter to the  same behavior and the List\u003cCodeReviewCommit\u003e missing; field in CodeReviewCommit is useless, I should remove it in a separate change.",
      "revId": "f906827ee2d9e956c5cb3f8171616aa52ae3504f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "19484ae3_d592f2c4",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/RebaseSorter.java",
        "patchSetId": 8
      },
      "lineNbr": 117,
      "author": {
        "id": 1010008
      },
      "writtenOn": "Jan 26, 2017 10:51:45 AM",
      "side": 1,
      "message": "This also seems like it will be extremely slow. alreadyAccepted contains branch tips; you\u0027re asking it to check whether a given branch tip is merged into this commit. It does this by walking from `commit` to `accepted`, and needs to walk all history before it can return false.",
      "revId": "f906827ee2d9e956c5cb3f8171616aa52ae3504f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "14f06757_bf98ba14",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/git/RebaseSorter.java",
        "patchSetId": 8
      },
      "lineNbr": 117,
      "author": {
        "id": 1026258
      },
      "writtenOn": "Jan 27, 2017 9:48:37 AM",
      "side": 1,
      "message": "Agree. This is introduced at https://gerrit-review.googlesource.com/c/91610 . I would like optimize this in a separate change.",
      "revId": "f906827ee2d9e956c5cb3f8171616aa52ae3504f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}