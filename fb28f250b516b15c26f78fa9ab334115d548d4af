{
  "comments": [
    {
      "key": {
        "uuid": "OfGYAbg0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2013-01-17T04:29:02Z",
      "side": 1,
      "message": "Adding changid checking to refs/heads seems like a major policy change which does not seem obviously correct to me.  It seems miss-leading to characterize this as a fix.\n\nI would like to see a policy discussion surrounding these changes, likely a discussion on the mailing list.",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfUX7agU",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2013-01-17T04:44:35Z",
      "side": 1,
      "message": "Hi Martin \nplease refer https://gerrit-review.googlesource.com/#/c/40950/7..11/gerrit-server/src/main/java/com/google/gerrit/server/git/validators/CommitValidators.java if you have not spot it.:)",
      "parentUuid": "OfGYAbg0",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfAYYmn0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2013-01-17T05:02:40Z",
      "side": 1,
      "message": "OK, but that really isn\u0027t a policy discussion, that is a discussion about this validator.  I am fine with this validator not making the ref check, but I am not fine with the implied policy change.  If this check is going to be removed from here, is it going to be wired in somewhere else?  Ideally it would seem that the refs which call this validator would be configurable somewhere?",
      "parentUuid": "OfUX7agU",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfeULdiw",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2013-01-17T05:16:22Z",
      "side": 1,
      "message": ":)  yeah I got it.  and are you fine with PS9?",
      "parentUuid": "OfAYYmn0",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfSUdjm4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2013-01-17T05:54:47Z",
      "side": 1,
      "message": "I just make a test and find push with refs/heads/\u003cbranch\u003e will not reach here, it will skip by the \u0027return\u0027 of the fist if checking code in ReceiveCommits.validateNewCommits().  \nso this patch has not touch the policy. I will update the change message.",
      "parentUuid": "OfeULdiw",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfYUrooQ",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2013-01-17T06:16:08Z",
      "side": 1,
      "message": "please also refer Line 762~782 of ReceiveCommits.parseCommands()\nwe need not discuss adding changid checking to refs/heads as this patch has not touch it. this Change\u0027s message have been updated in PS12",
      "parentUuid": "OfSUdjm4",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfEZNMm4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2013-01-17T06:18:03Z",
      "side": 1,
      "message": "But it does affect other pieces of the policy and it is not clear which pieces.  The old code applied the policy in a few exact situations, now it is only applied when some other piece of code in gerrit applies it.  That still seems like a pretty big change and I don\u0027t get the feeling that the implications of this are well understood.\n\nPlease explain the motivation behind this change.   Is it to simply make the validator more generic, or is it to change policy?",
      "parentUuid": "OfSUdjm4",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfeUilqQ",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2013-01-17T07:18:13Z",
      "side": 1,
      "message": "Hi Martin and Sasa\n\nMartin\u0027s above first paragraph is in fact the background of PS9 which is the foolproof wayï¼Œ with CommitValidators.NEW_PATCHSET we can know the exact situations.\n\n the discuss : https://gerrit-review.googlesource.com/#/c/40950/7..11/gerrit-server/src/main/java/com/google/gerrit/server/git/validators/CommitValidators.java\nhas 2 points \n\n1. Sasa think refs/heads  also need change-id checking. \n\n2. further more, I think Sasa want do change-id checking on every kind refs therefor CommitValidators.NEW_PATCHSET becomes unnecessary. \n\nmy test today have turn out   \u0027refs/heads/\u0027 never come here.\nand after checking \nLine 762~782 of ReceiveCommits.parseCommands()\nand \nReceiveCommits.validateNewCommits()\n\nI find the policy(do change-id checking only on new patchset/change for review , not on others type like refs/heads ...)\nis not under control of CommitValidators.onCommitReceived()\nand has nothing to do with this patch. \n\nIn other word remove CommitValidators.NEW_PATCHSET or not will never change the policy.  \n\nso I think PS12 has not different effective with PS9, \nwhich is better? I prefer to PS9, simple and 100% sure there is not bug.",
      "parentUuid": "OfEZNMm4",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfaUzPvA",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2013-01-17T10:08:10Z",
      "side": 1,
      "message": "\u003e 1. Sasa think refs/heads also need change-id checking.\n\nI am only telling that, right now, the ChangeIdValidator cannot be used for these branches because of that reference name pattern check.\n\nIt doesn\u0027t look to me that the risk of removing the reference check from the ChangeIdValidator is too big. This validator is used from a couple of places only.\n\nThe ChangeIdValidator, as it is know, is buggy. If, for example,\nit would be used to check presence of Change-Id in commit message of a commit on refs/heads/master branch then it would fail to detect a missing Change-Id because of the (unnecessary) check for the reference name pattern. The caller would think that the Change-Id is present event when it is not.\n\nIf you don\u0027t want to fix this issue in this change I will push another change which removes that check.",
      "parentUuid": "OfeUilqQ",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "Oekif-70",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1010015
      },
      "writtenOn": "2013-01-17T15:10:52Z",
      "side": 1,
      "message": "Thanks Sasa!\n\n if my understanding is right, now  you do not think the risk of removing the reference check from the ChangeIdValidator is too big and want remove that check just like PS 12. \n however  Martin worry about it and disagree PS12 ,he want PS9.\nboth sounds reasonable,  hmm, it is sad and strange for me why cores always can not reach to same point on my change  \n \nI prefer to fix the issue you said above in another change where I hope you can get same idea quickly.:)",
      "parentUuid": "OfaUzPvA",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OfuSv.uQ",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2013-01-17T17:05:08Z",
      "side": 1,
      "message": "It is still unclear to me what the intent of this change is?  Is this an attempt to fix a regression caused by this change: https://gerrit-review.googlesource.com/#/c/40071/6/gerrit-server/src/main/java/com/google/gerrit/server/git/validators/CommitValidators.java\n\nCould you please clarify the latest commit message a bit, because even PS 13 is not clear to me and keeps me guessing a bit.  I don\u0027t want to have to guess, because I usually am wrong. :(",
      "parentUuid": "Oekif-70",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "OgMJM4nQ",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 14,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2013-01-18T10:23:45Z",
      "side": 1,
      "message": "My guess is that this change is trying to fix the issue that the ChangeIdValidator skips the check for the presence of the \u0027Change-Id\u0027 in the commit message returning a wrong result.\n\nThis happens because the ChangeIdValidator has an assumption on which references it should and on which it shouldn\u0027t be checked. For those references where it assumes that change-id should not be checked it returns an OK result regardless of the presence or absence of change-id in the commit message.\n\nThis could be fixed in two ways:\n\n1. by fixing the regex and, thus, include a couple of more references into the check.\n\n2. by removing the check for the reference pattern from the ChangeIdValidator.\n\nI am in favor of doing 2. since ChangeIdValidator, as its name says, should only check the presence of the change-id in a commit message. It shouldn\u0027t assume anything about the reference. It is wrong to do so as it returns wrong results for some references.\n\nIf 2. is considered too risky Bruce can only do 1.\nHowever, I would, anyway, like to to 2.",
      "parentUuid": "OfuSv.uQ",
      "revId": "fb28f250b516b15c26f78fa9ab334115d548d4af",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}