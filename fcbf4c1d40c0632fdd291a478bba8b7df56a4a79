{
  "comments": [
    {
      "key": {
        "uuid": "21f965cf_fd773378",
        "filename": "java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 148,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-11-06T21:19:26Z",
      "side": 1,
      "message": "See my comment below.\n\nThis creates an identity of the form \"Full Name \u003cpreferredemail@example.com\u003e\", which has the downside that it is not guaranteed to map to the same Account.Id over time. This may be ok for other usages of MetaDataUpdate.User (e.g. project.config changes), but I think it\u0027s probably not appropriate for the group audit logs.\n\n(Unlike below, this uses IdentifiedUser#newCommitterIdent, which is a valid git identity, unlke Account#getNameEmail.)",
      "revId": "fcbf4c1d40c0632fdd291a478bba8b7df56a4a79",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a41c0dc5_259faac3",
        "filename": "java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 148,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-11-07T11:51:39Z",
      "side": 1,
      "message": "If I use \"Preferred Name \u003caccountId@serverId\u003e\" for the author here, should I use the same identity for updates of the project config after renames?",
      "parentUuid": "21f965cf_fd773378",
      "revId": "fcbf4c1d40c0632fdd291a478bba8b7df56a4a79",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ec48d143_6360c0aa",
        "filename": "java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 148,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-11-07T15:06:50Z",
      "side": 1,
      "message": "\u003e If I use \"Preferred Name \u003caccountId@serverId\u003e\" for the author here, should I use the same identity for updates of the project config after renames?\n\nYou mean updating the groups file in refs/meta/config? I think I would prefer to use \"Preferred Name \u003cpreferredemail@example.com\u003e\" for those, to match the other commits in that particular ref\u0027s history. The difference between this graph and NoteDb graphs is that refs/meta/config is exposed to and intended to be edited directly by normal human users.\n\nrefs/meta/config is also not really an audit log, just a normal git log. I guess my point here is that we are intending to make a distinction between a \"real audit log\" and a git log.",
      "parentUuid": "a41c0dc5_259faac3",
      "revId": "fcbf4c1d40c0632fdd291a478bba8b7df56a4a79",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c58bfe8_8160c08d",
        "filename": "java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 398,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-11-06T21:19:26Z",
      "side": 1,
      "message": "I\u0027m not sure this is the right format; it doesn\u0027t match what\u0027s used elsewhere in NoteDb. Specifically, in the change meta graph, any time we need a PersonIdent in NoteDb, we use \"Preferred Name \u003caccountId@serverId\u003e\".\n\nThere are two reasons for doing it the way we do it for changes:\n\n* There is no guarantee the (name, preferred email) pair always maps to the same account ID. It\u0027s possible for one account to relinquish its preferred email, which then gets picked up by a different account. For the audit log specifically, this is a problem.\n\n* In the case where preferredEmail is null, Account#getNameEmail does not return a valid identity that is parseable by RawParseUtils#parsePersonIdent. This means that this method can\u0027t be used to generate a string for use as a committer/author identity.",
      "revId": "fcbf4c1d40c0632fdd291a478bba8b7df56a4a79",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d2c8edf_9c0caedb",
        "filename": "java/com/google/gerrit/server/group/db/GroupsUpdate.java",
        "patchSetId": 7
      },
      "lineNbr": 398,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2017-11-07T10:07:54Z",
      "side": 1,
      "message": "Good point. (I was just following the design doc and didn\u0027t question it further.) I\u0027ll change it.\n\nThe same reasoning can be applied to subgroups. They can change their names too and hence mentioning only their name in the commit message isn\u0027t sufficient. I\u0027ll include their UUID as well.",
      "parentUuid": "3c58bfe8_8160c08d",
      "revId": "fcbf4c1d40c0632fdd291a478bba8b7df56a4a79",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}