{
  "comments": [
    {
      "key": {
        "uuid": "586f6876_693f259c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/SchemaVersion.java",
        "patchSetId": 8
      },
      "lineNbr": 96,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-08-12T20:35:43Z",
      "side": 1,
      "message": "This call is either too early or too late depending on the state of the schema.\n\nWhen going from 77/79 to 81 this call is too late. The prior.get().check() call on line 91 recurses into schema 80 and calls the s.updateSchema() on line 99, which in turn creates the missing tables and columns. When this is finally called for schema 81 its too late and we cannot rename the tables/columns.\n\nIf we later add a schema 82 and we are going from 77/79 to 82 then schema 82 needs to ensure schema 81\u0027s preUpdateSchema() is run first.",
      "revId": "fd01e3da32891cbd33c8dd3a01961d69d1821f43",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "586f6876_895059dc",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/SchemaVersion.java",
        "patchSetId": 8
      },
      "lineNbr": 96,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-08-12T21:10:17Z",
      "side": 1,
      "message": "This bug has existed since I created the automatic schema update system. I\u0027m trying to work on a change to fix the bug. :-)",
      "parentUuid": "586f6876_693f259c",
      "revId": "fd01e3da32891cbd33c8dd3a01961d69d1821f43",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b8fce4ed_dc5b6d2c",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/SchemaVersion.java",
        "patchSetId": 8
      },
      "lineNbr": 96,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2013-08-12T21:14:13Z",
      "side": 1,
      "message": ";-) It is embarrassing, i didn\u0027t see it ... last time i tested it, it just worked. I do not have any explanation for that.",
      "parentUuid": "586f6876_895059dc",
      "revId": "fd01e3da32891cbd33c8dd3a01961d69d1821f43",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "586f6876_a93c3da9",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/schema/Schema_81.java",
        "patchSetId": 8
      },
      "lineNbr": 52,
      "author": {
        "id": 1001240
      },
      "writtenOn": "2013-08-12T20:31:38Z",
      "side": 1,
      "message": "The problem shows up when going from e.g. 79 to 81. During the execution of Schema_80 gwtorm creates missing tables and columns before Schema_81\u0027s preUpdateSchema is even attempted. This causes the following call to _81 to fail because the table now exists.\n\nThis of course means an upgrade from e.g. 2.6 or 2.7 to 2.8 will fail with the same error as the server will be going from 77 or 79 and run into this failure mode.",
      "revId": "fd01e3da32891cbd33c8dd3a01961d69d1821f43",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}