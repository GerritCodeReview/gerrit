{
  "comments": [
    {
      "key": {
        "uuid": "9a80f2dc_30bf01f4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-10-17T06:47:01Z",
      "side": 1,
      "message": "What server error? It\u0027s fixed with synchronization now, right?",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92fd1d09_8d5d55e6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2017-10-17T07:42:10Z",
      "side": 1,
      "message": "Should be SC_CONFLICT?",
      "parentUuid": "9a80f2dc_30bf01f4",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de59f9ed_0742416a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:43:29Z",
      "side": 1,
      "message": "Yes, it should be SC_CONFLICT but it is 500 internal server error when two threads try to create the same project concurrently. You can just try running the one test from this change.\n\n\u003e What server error? It\u0027s fixed with synchronization now, right?\n\nYes, it is fixed with this change which synchronizes on project name.",
      "parentUuid": "92fd1d09_8d5d55e6",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "56ca5679_4f0efae6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-10-17T20:12:04Z",
      "side": 1,
      "message": "Thanks for clarifying, I see it now when running the test from this change without the syncronization code. It is sporadically failing with SC_CONFLICT or SC_INTERNAL_SERVER_ERROR depending on the timing:\n\n* SC_CONFLICT: stack trace: http://paste.openstack.org/show/623882\n* SC_INTERNAL_SERVER_ERROR: stack trace: http://paste.openstack.org/show/623885\n\nThis change fixed it, but to make sure, we are not sporadically running into SC_INTERNAL_SERVER_ERROR again but consistently reporting SC_CONFLICT we are using the loop in the unit test.\n\nI still find it hard to understand what you were trying to say in the section above. Is this because you are mixing the situations from before and after this change?",
      "parentUuid": "de59f9ed_0742416a",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f7621c7e_fe33e87e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-18T07:01:40Z",
      "side": 1,
      "message": "OK, now that I asked someone else here to read my commit message I think I understood what is confusing. Yes, I am mixing the situation from before and after this change:\n\n* if we run this test on the code as it was before this change then, to reproduce the issue we need to run it in a loop\n\n* if the test is run on the code as it is in this change then the internal server error is gone, regardless of how many iterations in the loop we have\n\nWould this wording be better:\n\nAdd a test for concurrent project creation. Execute concurrent project\ncreation several times to increases probability of reproducing the issue\nin the code as it was before this change.",
      "parentUuid": "56ca5679_4f0efae6",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08cc930e_2936cf7d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2017-10-18T07:23:05Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "f7621c7e_fe33e87e",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f6e58b1_e5920107",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-10-18T07:26:35Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "f7621c7e_fe33e87e",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 25
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05bc8676_2fb3cbc7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 26,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-10-17T20:12:04Z",
      "side": 1,
      "message": "server?",
      "range": {
        "startLine": 26,
        "startChar": 23,
        "endLine": 26,
        "endChar": 30
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f029afa_b1323538",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 26,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2017-10-18T07:23:05Z",
      "side": 1,
      "message": "Plural is correct.",
      "parentUuid": "05bc8676_2fb3cbc7",
      "range": {
        "startLine": 26,
        "startChar": 23,
        "endLine": 26,
        "endChar": 30
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "01af7fa0_dfb26d3d",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project/CreateProjectIT.java",
        "patchSetId": 6
      },
      "lineNbr": 97,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-10-17T06:47:01Z",
      "side": 1,
      "message": "Why this loop is needed?",
      "range": {
        "startLine": 97,
        "startChar": 6,
        "endLine": 97,
        "endChar": 36
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d00300ff_1bf8f87f",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project/CreateProjectIT.java",
        "patchSetId": 6
      },
      "lineNbr": 97,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:44:31Z",
      "side": 1,
      "message": "As wrote in the commit message: when two requests concurrently try to create a project with the same name we MAY get an internal server error in one of them. It depends on timing.\n\nA strategy to test such scenarios is to repeat the test several times to increase the probability of hitting the race condition. Therefore, run 10 times.",
      "parentUuid": "01af7fa0_dfb26d3d",
      "range": {
        "startLine": 97,
        "startChar": 6,
        "endLine": 97,
        "endChar": 36
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba3f2b34_ae936a3c",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project/CreateProjectIT.java",
        "patchSetId": 6
      },
      "lineNbr": 107,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-10-17T06:47:01Z",
      "side": 1,
      "message": "Callable is a FunctionalInterface so that you can use lambda expression instead:\n\n  Callable\u003cRestResponse\u003e createProjectFoo \u003d\n           () -\u003e {\n              sync.await();\n              return adminRestSession.put(\"/projects/\" + newProjectName);\n            };",
      "range": {
        "startLine": 100,
        "startChar": 8,
        "endLine": 107,
        "endChar": 14
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "69c89532_d0eafcc2",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project/CreateProjectIT.java",
        "patchSetId": 6
      },
      "lineNbr": 107,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:43:29Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ba3f2b34_ae936a3c",
      "range": {
        "startLine": 100,
        "startChar": 8,
        "endLine": 107,
        "endChar": 14
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9fbfb9f7_40bcaba9",
        "filename": "gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project/CreateProjectIT.java",
        "patchSetId": 6
      },
      "lineNbr": 107,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:58:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "69c89532_d0eafcc2",
      "range": {
        "startLine": 100,
        "startChar": 8,
        "endLine": 107,
        "endChar": 14
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5660b20b_b69f50d3",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Daemon.java",
        "patchSetId": 6
      },
      "lineNbr": 478,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2017-10-17T05:00:56Z",
      "side": 1,
      "message": "optional:\n\n new DefaultProjectNameLockManager.Module()\n\nper the comment in DefaultProjectNameLockManager",
      "range": {
        "startLine": 478,
        "startChar": 16,
        "endLine": 478,
        "endChar": 54
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8465646_f28a296a",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Daemon.java",
        "patchSetId": 6
      },
      "lineNbr": 478,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:51:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "5660b20b_b69f50d3",
      "range": {
        "startLine": 478,
        "startChar": 16,
        "endLine": 478,
        "endChar": 54
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "66c45e7d_26e77199",
        "filename": "gerrit-pgm/src/main/java/com/google/gerrit/pgm/Daemon.java",
        "patchSetId": 6
      },
      "lineNbr": 478,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:58:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f8465646_f28a296a",
      "range": {
        "startLine": 478,
        "startChar": 16,
        "endLine": 478,
        "endChar": 54
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "651934cd_c0c407fc",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/DefaultProjectNameLockManager.java",
        "patchSetId": 6
      },
      "lineNbr": 35,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2017-10-17T05:00:56Z",
      "side": 1,
      "message": "optional: Most other classes having their own module expose it as a static class named Module that extends AbstractModule.",
      "range": {
        "startLine": 34,
        "startChar": 2,
        "endLine": 35,
        "endChar": 32
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e33495d7_59eae047",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/DefaultProjectNameLockManager.java",
        "patchSetId": 6
      },
      "lineNbr": 35,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:51:11Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "651934cd_c0c407fc",
      "range": {
        "startLine": 34,
        "startChar": 2,
        "endLine": 35,
        "endChar": 32
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0dc4f06f_88db1164",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/project/DefaultProjectNameLockManager.java",
        "patchSetId": 6
      },
      "lineNbr": 35,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2017-10-17T09:58:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e33495d7_59eae047",
      "range": {
        "startLine": 34,
        "startChar": 2,
        "endLine": 35,
        "endChar": 32
      },
      "revId": "fd8a2c63d7f97f594c74c540675442fff44f8726",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}