{
  "comments": [
    {
      "key": {
        "uuid": "684fa426_a55aada6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-01T13:48:45Z",
      "side": 1,
      "message": "Need to make sure originalValue is getting set correctly every time we upsert a PatchSetApproval in ReviewDb: we have to always check and see if there is an originalValue already in the database that we need to copy. IOW, we can\u0027t hand-create PatchSetApprovals and then upsert them.",
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ceac1cc5_f0126a84",
        "filename": "gerrit-reviewdb/src/main/java/com/google/gerrit/reviewdb/client/PatchSetApproval.java",
        "patchSetId": 2
      },
      "lineNbr": 114,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-10-01T21:05:09Z",
      "side": 1,
      "message": "setOriginalValue(v) to be consistent with the lines above and below",
      "range": {
        "startLine": 114,
        "startChar": 4,
        "endLine": 114,
        "endChar": 22
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a189796a_125e7410",
        "filename": "gerrit-reviewdb/src/main/java/com/google/gerrit/reviewdb/client/PatchSetApproval.java",
        "patchSetId": 2
      },
      "lineNbr": 114,
      "author": {
        "id": 1031898
      },
      "writtenOn": "2017-10-10T09:59:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ceac1cc5_f0126a84",
      "range": {
        "startLine": 114,
        "startChar": 4,
        "endLine": 114,
        "endChar": 22
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6f5fcbb4_21ff661b",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 853,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-10-01T21:05:09Z",
      "side": 1,
      "message": "I\u0027m not sure if I understand this, what if:\n\n1. user votes Code-Review+1\n\n2. user changes vote to Code-Review+2\n\n3. change is moved to a branch where user can only vote Code-Review+1, hence the vote is squashed to Code-Review+1\n\n4. change is moved back to the branch where user can vote Code-Review+2, hence Code-Review+2 should be restored as it was the value from before squashing, but wouldn\u0027t this code detect the vote from 1. as original value?",
      "range": {
        "startLine": 847,
        "startChar": 4,
        "endLine": 853,
        "endChar": 36
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ed7f77ab_dbf442ce",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 853,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2017-10-03T10:01:27Z",
      "side": 1,
      "message": "Good point. I was hoping we would be able to do this without introducing a new footer in NoteDb, but I guess not.\n\nI think we would need to support 2 different footers:\n\n* \"Label: Foo\u003d2\" creates a new PSA with originalValue \u003d\u003d value \u003d\u003d 2\n* \"Squash-label: Foo\u003d1\" updates value in the previous PSA.\n\nThis may change the equation about which proposal is the simplest.",
      "parentUuid": "6f5fcbb4_21ff661b",
      "range": {
        "startLine": 847,
        "startChar": 4,
        "endLine": 853,
        "endChar": 36
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "94b82253_610889d5",
        "filename": "gerrit-server/src/main/java/com/google/gerrit/server/notedb/ChangeNotesParser.java",
        "patchSetId": 2
      },
      "lineNbr": 853,
      "author": {
        "id": 1031898
      },
      "writtenOn": "2017-10-10T12:14:48Z",
      "side": 1,
      "message": "For a short summary:\n\nThe implementation in ReviewDb is:\n\n* \"value\" keeps the value for a label (it could be squashed) which is used by the change.\n* \"originalValue\" keeps the latest vote from the reviewer.\n\nThe implementation in NoteDb is:\n\n* \"Label: Foo\u003d2\" keeps the value from the reviewer.\n* \"Squash-Label: Foo\u003d1\" keeps the value after a squash.\n\nWhen parsing NoteDB, we read the latest \"Label: ***\" and \"Squash-Label: ***\" for a change. \n\n* For moving a change, we squash the last value of \"Label: ***\" and record a \"Squash-Label:\" in NoteDb if a squash happens.\n* For normal use of votes, we use the latest value from \"Label: ***\" \u0026 \"Squash-Label: ***\".",
      "parentUuid": "ed7f77ab_dbf442ce",
      "range": {
        "startLine": 847,
        "startChar": 4,
        "endLine": 853,
        "endChar": 36
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dca9db54_fa7abdb7",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/server/notedb/ChangeNotesTest.java",
        "patchSetId": 2
      },
      "lineNbr": 362,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-10-01T21:05:09Z",
      "side": 1,
      "message": "nit: uses spaces",
      "range": {
        "startLine": 362,
        "startChar": 0,
        "endLine": 362,
        "endChar": 1
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7f31d328_e4236411",
        "filename": "gerrit-server/src/test/java/com/google/gerrit/server/notedb/ChangeNotesTest.java",
        "patchSetId": 2
      },
      "lineNbr": 390,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2017-10-01T21:05:09Z",
      "side": 1,
      "message": "spaces",
      "range": {
        "startLine": 390,
        "startChar": 0,
        "endLine": 390,
        "endChar": 1
      },
      "revId": "fd98f09035d6d8eb52d01ebc05de6b3a4931051d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}