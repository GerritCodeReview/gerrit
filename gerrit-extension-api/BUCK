SRC = 'src/main/java/com/google/gerrit/extensions/'
SRCS = glob([SRC + '**/*.java'])

# TODO(davido): align this rule with package boundaries.
# This would probably affect quite some plugins, though.
CLIENT_SRCS = [SRC + n for n in [
  'api/projects/ProjectState.java',
  'common/ChangeStatus.java',
  'common/Comment.java',
  'common/InheritableBoolean.java',
  'common/ListChangesOption.java',
  'common/Side.java',
  'common/SubmitType.java',
  'common/Theme.java',
  'webui/GerritTopMenu.java',
]]

gwt_module(
  name = 'client',
  srcs = glob(CLIENT_SRCS),
  gwt_xml = SRC + 'Extensions.gwt.xml',
  visibility = ['PUBLIC'],
)

java_library(
  name = 'client-lib',
  srcs = glob(CLIENT_SRCS),
  resources = glob(CLIENT_SRCS + [SRC + 'Extensions.gwt.xml']),
  visibility = ['PUBLIC'],
)

java_binary(
  name = 'extension-api',
  deps = [':lib'],
  visibility = ['PUBLIC'],
)

java_library(
  name = 'lib',
  exported_deps = [
    ':api',
    '//lib/guice:guice',
    '//lib/guice:guice-servlet',
    '//lib:servlet-api-3_1',
  ],
  visibility = ['PUBLIC'],
)

java_library(
  name = 'api',
  srcs = glob([SRC + '**/*.java']),
  provided_deps = ['//lib/guice:guice'],
  visibility = ['PUBLIC'],
)

java_sources(
  name = 'extension-api-src',
  srcs = SRCS,
  visibility = ['PUBLIC'],
)

java_doc(
  name = 'extension-api-javadoc',
  title = 'Gerrit Review Extension API Documentation',
  pkgs = ['com.google.gerrit.extensions'],
  paths = ['src/main/java'],
  srcs = SRCS,
  deps = [
    '//lib/guice:javax-inject',
    '//lib/guice:guice_library'
  ],
  visibility = ['PUBLIC'],
)
