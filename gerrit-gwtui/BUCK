MODULE = 'com.google.gerrit.GerritGwtUI'

gwt_application(
  name = 'ui_opt',
  module_target = MODULE,
  compiler_opts = [
    '-strict',
    '-style', 'OBF',
    '-optimize', '9',
    '-XdisableClassMetadata',
    '-XdisableCastChecking',
  ],
  deps = [
    ':ui_module',
    '//gerrit-common:version',
  ],
  visibility = ['PUBLIC'],
)

gwt_application(
  name = 'ui_dbg',
  module_target = MODULE,
  compiler_opts = [
    '-strict',
    '-style', 'PRETTY',
  ],
  deps = [
    ':ui_module',
    '//gerrit-common:version',
  ],
  visibility = ['PUBLIC'],
)

genrule(
  name = 'ui_optdbg',
  cmd = 'for z in $SRCS;do unzip -qod $TMP $z;done;' +
    'cd $TMP;' +
    'mkdir -p $(dirname $OUT);' +
    'zip -9Dqr $OUT .',
  srcs = [
    genfile('ui_dbg.zip'),
    genfile('ui_opt.zip'),
  ],
  deps = [
    ':ui_opt',
    ':ui_dbg',
  ],
  out = 'resources/ui_optdbg.zip',
  visibility = ['PUBLIC'],
)

gwt_module(
  name = 'ui_module',
  srcs = glob(['src/main/java/**/*.java']),
  gwtxml = 'src/main/java/com/google/gerrit/GerritGwtUI.gwt.xml',
  resources = glob(['src/main/java/**/*']),
  deps = [
    '//gerrit-gwtexpui:Clippy',
    '//gerrit-gwtexpui:CSS',
    '//gerrit-gwtexpui:GlobalKey',
    '//gerrit-gwtexpui:Linker',
    '//gerrit-gwtexpui:Progress',
    '//gerrit-gwtexpui:SafeHtml',
    '//gerrit-gwtexpui:UserAgent',

    '//gerrit-common:client',
    '//gerrit-patch-jgit:client',
    '//gerrit-prettify:client',
    '//gerrit-reviewdb:client',

    '//lib:gwtjsonrpc',
    '//lib:gwtjsonrpc_src',
    '//lib/gwt:user',
  ],
)
