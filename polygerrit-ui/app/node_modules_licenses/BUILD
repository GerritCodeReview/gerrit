load("@npm_bazel_typescript//:index.bzl", "ts_config", "ts_library")
load("@build_bazel_rules_nodejs//:index.bzl", "nodejs_binary", "npm_package_bin")
load("//tools/node_tools/node_modules_licenses:node_modules_licenses.bzl", "node_modules_licenses")

filegroup(
    name = "licenses-texts",
    srcs = glob(["licenses/*.txt"]),
)

ts_library(
    name = "node-modules-licenses",
    srcs = [
        "licenses.ts",
    ],
    compiler = "//tools/node_tools:tsc_wrapped-bin",
    data = [
        "licenses-texts",
    ],
    node_modules = "@tools_npm//:node_modules",
    tsconfig = "tsconfig.json",
    deps = [
        "//tools/node_tools/node_modules_licenses:licenses-map",
        "@tools_npm//@types/node",
    ],
)

genrule(
    name = "tsconfig_editor",
    srcs = [":tsconfig.json"],
    outs = ["tsconfig_editor.json"],
    cmd = "cp $< $@",
)

filegroup(
    name = "licenses-js",
    srcs = [":node-modules-licenses"],
    output_group = "es5_sources",
)

node_modules_licenses(
    name = "polygerrit-licenses",
    licenses_config = "licenses-js",
    licenses_texts = [":licenses-texts"],
    node_modules = "@ui_npm//:node_modules",
    visibility = ["//visibility:public"],
)
