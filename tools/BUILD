load(
    "@bazel_tools//tools/jdk:default_java_toolchain.bzl",
    "JDK9_JVM_OPTS",
    "default_java_toolchain",
)
load("@rules_java//java:defs.bzl", "java_package_configuration")

exports_files(["nongoogle.bzl"])

default_java_toolchain(
    name = "error_prone_warnings_toolchain",
    bootclasspath = ["@bazel_tools//tools/jdk:platformclasspath.jar"],
    jvm_opts = JDK9_JVM_OPTS,
    package_configuration = [
        ":error_prone",
    ],
    visibility = ["//visibility:public"],
)

# Error Prone errors enabled by default; see ../.bazelrc for how this is
# enabled. This warnings list is originally based on:
# https://github.com/bazelbuild/BUILD_file_generator/blob/master/tools/bazel_defs/java.bzl
# However, feel free to add any additional errors. Thus far they have all been pretty useful.
# TODO(davido): Enable ImmutableAnnotationChecker again when these issues are fixed:
# https://github.com/google/error-prone/issues/1348
# https://github.com/bazelbuild/bazel/issues/9378
java_package_configuration(
    name = "error_prone",
    javacopts = [
        "-XepDisableWarningsInGeneratedCode",
        "-Xep:AlmostJavadoc:WARN",
        "-Xep:AmbiguousMethodReference:ERROR",
        "-Xep:AnnotateFormatMethod:WARN",
        "-Xep:ArgumentSelectionDefectChecker:WARN",
        "-Xep:ArrayAsKeyOfSetOrMap:WARN",
        "-Xep:AssertEqualsArgumentOrderChecker:WARN",
        "-Xep:AssertThrowsMultipleStatements:WARN",
        "-Xep:AssertionFailureIgnored:ERROR",
        "-Xep:AssignmentToMock:ERROR",
        "-Xep:AutoValueFinalMethods:ERROR",
        "-Xep:AutoValueImmutableFields:ERROR",
        "-Xep:AutoValueSubclassLeaked:WARN",
        "-Xep:BadAnnotationImplementation:ERROR",
        "-Xep:BadComparable:ERROR",
        "-Xep:BadImport:WARN",
        "-Xep:BadInstanceof:WARN",
        "-Xep:BigDecimalEquals:WARN",
        "-Xep:BoxedPrimitiveConstructor:ERROR",
        "-Xep:BoxedPrimitiveEquality:WARN",
        "-Xep:ByteBufferBackingArray:WARN",
        "-Xep:CacheLoaderNull:WARN",
        "-Xep:CatchFail:WARN",
        "-Xep:CanonicalDuration:WARN",
        "-Xep:CannotMockFinalClass:ERROR",
        "-Xep:CatchAndPrintStackTrace:WARN",
        "-Xep:ClassCanBeStatic:ERROR",
        "-Xep:ComparableAndComparator:WARN",
        "-Xep:CompareToZero:ERROR",
        "-Xep:ComplexBooleanConstant:WARN",
        "-Xep:ClassNewInstance:ERROR",
        "-Xep:DateFormatConstant:ERROR",
        "-Xep:DeduplicateConstants:ERROR",
        "-Xep:DefaultCharset:ERROR",
        "-Xep:DiscardedPostfixExpression:ERROR",
        "-Xep:DoubleBraceInitialization:WARN",
        "-Xep:DoubleCheckedLocking:ERROR",
        "-Xep:DuplicateMapKeys:ERROR",
        "-Xep:ElementsCountedInLoop:ERROR",
        "-Xep:EmptyBlockTag:WARN",
        "-Xep:EmptySetMultibindingContributions:WARN",
        "-Xep:EscapedEntity:WARN",
        "-Xep:EqualsGetClass:WARN",
        "-Xep:EqualsHashCode:ERROR",
        "-Xep:EqualsIncompatibleType:ERROR",
        "-Xep:EqualsUnsafeCast:WARN",
        "-Xep:EqualsUsingHashCode:WARN",
        "-Xep:ExpectedExceptionChecker:ERROR",
        "-Xep:ExtendingJUnitAssert:WARN",
        "-Xep:FallThrough:WARN",
        "-Xep:Finally:ERROR",
        "-Xep:FloatCast:ERROR",
        "-Xep:FloatingPointLiteralPrecision:ERROR",
        "-Xep:FormatStringAnnotation:WARN",
        "-Xep:FragmentInjection:ERROR",
        "-Xep:FragmentNotInstantiable:ERROR",
        "-Xep:FunctionalInterfaceClash:ERROR",
        "-Xep:FutureReturnValueIgnored:ERROR",
        "-Xep:GetClassOnEnum:ERROR",
        "-Xep:HidingField:ERROR",
        "-Xep:IgnoredPureGetter:WARN",
        "-Xep:ImmutableAnnotationChecker:OFF",
        "-Xep:ImmutableEnumChecker:ERROR",
        "-Xep:InconsistentCapitalization:WARN",
        "-Xep:InconsistentHashCode:WARN",
        "-Xep:IncompatibleModifiers:ERROR",
        "-Xep:IncrementInForLoopAndHeader:WARN",
        "-Xep:InheritDoc:ERROR",
        "-Xep:InjectOnConstructorOfAbstractClass:ERROR",
        "-Xep:InjectedConstructorAnnotations:ERROR",
        "-Xep:InlineFormatString:WARN",
        "-Xep:InputStreamSlowMultibyteRead:ERROR",
        "-Xep:InstanceOfAndCastMatchWrongType:WARN",
        "-Xep:IntLongMath:WARN",
        "-Xep:InterfaceWithOnlyStatics:WARN",
        "-Xep:InvalidBlockTag:WARN",
        "-Xep:InvalidInlineTag:ERROR",
        "-Xep:InvalidLink:WARN",
        "-Xep:InvalidParam:WARN",
        "-Xep:InvalidTargetingOnScopingAnnotation:WARN",
        "-Xep:InvalidThrows:WARN",
        "-Xep:IterableAndIterator:ERROR",
        "-Xep:JUnit3FloatingPointComparisonWithoutDelta:ERROR",
        "-Xep:JUnit4ClassUsedInJUnit3:ERROR",
        "-Xep:JUnitAmbiguousTestClass:ERROR",
        "-Xep:JavaDurationGetSecondsGetNano:WARN",
        "-Xep:JavaDurationWithNanos:WARN",
        "-Xep:JavaDurationWithSeconds:WARN",
        "-Xep:JavaInstantGetSecondsGetNano:WARN",
        "-Xep:LiteralClassName:ERROR",
        "-Xep:JavaLocalTimeGetNano:ERROR",
        "-Xep:JavaLocalTimeGetNano:ERROR",
        "-Xep:JavaPeriodGetDays:ERROR",
        "-Xep:JavaTimeDefaultTimeZone:ERROR",
        "-Xep:JavaxInjectOnFinalField:ERROR",
        "-Xep:LockNotBeforeTry:ERROR",
        "-Xep:LockOnBoxedPrimitive:ERROR",
        "-Xep:LogicalAssignment:ERROR",
        "-Xep:MathAbsoluteRandom:ERROR",
        "-Xep:MissingCasesInEnumSwitch:ERROR",
        "-Xep:MissingFail:ERROR",
        "-Xep:MissingOverride:ERROR",
        "-Xep:MissingSummary:WARN",
        "-Xep:MixedDescriptors:ERROR",
        "-Xep:MixedMutabilityReturnType:WARN",
        "-Xep:MockitoInternalUsage:ERROR",
        "-Xep:ModifiedButNotUsed:WARN",
        "-Xep:ModifyCollectionInEnhancedForLoop:WARN",
        "-Xep:ModifySourceCollectionInStream:ERROR",
        "-Xep:MultipleParallelOrSequentialCalls:WARN",
        "-Xep:MultipleUnaryOperatorsInMethodCall:WARN",
        "-Xep:MutableConstantField:ERROR",
        "-Xep:NarrowingCompoundAssignment:ERROR",
        "-Xep:NestedInstanceOfConditions:WARN",
        "-Xep:NonAtomicVolatileUpdate:ERROR",
        "-Xep:NonCanonicalType:ERROR",
        "-Xep:NonOverridingEquals:ERROR",
        "-Xep:NullableConstructor:ERROR",
        "-Xep:NullOptional:WARN",
        "-Xep:NullableConstructor:WARN",
        "-Xep:NullablePrimitive:ERROR",
        "-Xep:NullableVoid:ERROR",
        "-Xep:ObjectToString:ERROR",
        "-Xep:ObjectsHashCodePrimitive:WARN",
        "-Xep:OperatorPrecedence:ERROR",
        "-Xep:OptionalMapToOptional:ERROR",
        "-Xep:OptionalNotPresent:WARN",
        "-Xep:OrphanedFormatString:WARN",
        "-Xep:OutlineNone:ERROR",
        "-Xep:OverridesGuiceInjectableMethod:ERROR",
        "-Xep:OverrideThrowableToString:WARN",
        "-Xep:OverridesGuiceInjectableMethod:WARN",
        "-Xep:ParameterName:WARN",
        "-Xep:PreconditionsCheckNotNullRepeated:ERROR",
        "-Xep:PreconditionsInvalidPlaceholder:ERROR",
        "-Xep:PrimitiveAtomicReference:WARN",
        "-Xep:ProtectedMembersInFinalClass:ERROR",
        "-Xep:ProtoDurationGetSecondsGetNano:ERROR",
        "-Xep:ProtoFieldPreconditionsCheckNotNull:ERROR",
        "-Xep:ProtoRedundantSet:ERROR",
        "-Xep:ProtoTimestampGetSecondsGetNano:ERROR",
        "-Xep:ProtocolBufferOrdinal:ERROR",
        "-Xep:QualifierOrScopeOnInjectMethod:ERROR",
        "-Xep:ReachabilityFenceUsage:ERROR",
        "-Xep:RedundantOverride:ERROR",
        "-Xep:ReferenceEquality:ERROR",
        "-Xep:RequiredModifiers:ERROR",
        "-Xep:ReturnFromVoid:ERROR",
        "-Xep:SameNameButDifferent:WARN",
        "-Xep:ScopeAnnotationOnInterfaceOrAbstractClass:ERROR",
        "-Xep:ShortCircuitBoolean:ERROR",
        "-Xep:SimpleDateFormatConstant:ERROR",
        "-Xep:StaticAssignmentInConstructor:ERROR",
        "-Xep:StaticGuardedByInstance:ERROR",
        "-Xep:StringEquality:ERROR",
        "-Xep:StreamResourceLeak:WARN",
        "-Xep:SynchronizeOnNonFinalField:ERROR",
        "-Xep:ToStringReturnsNull:ERROR",
        "-Xep:TreeToString:ERROR",
        "-Xep:TruthAssertExpected:ERROR",
        "-Xep:TruthConstantAsserts:ERROR",
        "-Xep:TruthGetOrDefault:ERROR",
        "-Xep:TruthIncompatibleType:ERROR",
        "-Xep:TypeEquals:ERROR",
        "-Xep:TypeEqualsChecker:ERROR",
        "-Xep:TypeNameShadowing:ERROR",
        "-Xep:TypeParameterShadowing:ERROR",
        "-Xep:TypeParameterUnusedInFormals:ERROR",
        "-Xep:URLEqualsHashCode:ERROR",
        "-Xep:UndefinedEquals:ERROR",
        "-Xep:UnescapedEntity:WARN",
        "-Xep:UnnecessaryAnonymousClass:WARN",
        "-Xep:UnnecessaryLambda:WARN",
        "-Xep:UnnecessaryMethodInvocationMatcher:WARN",
        "-Xep:UnnecessaryParentheses:WARN",
        "-Xep:UnsynchronizedOverridesSynchronized:ERROR",
        "-Xep:UnusedException:ERROR",
        "-Xep:UnusedNestedClass:ERROR",
        "-Xep:UseCorrectAssertInTests:WARN",
        "-Xep:VariableNameSameAsType:WARN",
        "-Xep:WaitNotInLoop:ERROR",
        "-Xep:WildcardImport:ERROR",
    ],
    packages = ["error_prone_packages"],
)

package_group(
    name = "error_prone_packages",
    packages = [
        "//java/...",
        "//javatests/...",
        "//plugins/codemirror-editor/...",
        "//plugins/commit-message-length-validator/...",
        "//plugins/delete-project/...",
        "//plugins/download-commands/...",
        "//plugins/gitiles/...",
        "//plugins/hooks/...",
        "//plugins/plugin-manager/...",
        "//plugins/replication/...",
        "//plugins/reviewnotes/...",
        "//plugins/singleusergroup/...",
        "//plugins/webhooks/...",
    ],
)
